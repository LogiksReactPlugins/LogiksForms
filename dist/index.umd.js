(function(W,I){typeof exports=="object"&&typeof module<"u"?I(exports,require("react"),require("axios"),require("yup"),require("formik")):typeof define=="function"&&define.amd?define(["exports","react","axios","yup","formik"],I):(W=typeof globalThis<"u"?globalThis:W||self,I(W.LogiksForm={},W.React,W.axios,W.Yup,W.formik))})(this,function(W,I,V,Ee,oe){"use strict";function $e(e){const r=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const i in e)if(i!=="default"){const n=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(r,i,n.get?n:{enumerable:!0,get:()=>e[i]})}}return r.default=e,Object.freeze(r)}const q=$e(Ee);var ie={exports:{}},re={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ge;function Ae(){if(ge)return re;ge=1;var e=Symbol.for("react.transitional.element"),r=Symbol.for("react.fragment");function i(n,m,x){var w=null;if(x!==void 0&&(w=""+x),m.key!==void 0&&(w=""+m.key),"key"in m){x={};for(var u in m)u!=="key"&&(x[u]=m[u])}else x=m;return m=x.ref,{$$typeof:e,type:n,key:w,ref:m!==void 0?m:null,props:x}}return re.Fragment=r,re.jsx=i,re.jsxs=i,re}var ae={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var be;function Te(){return be||(be=1,process.env.NODE_ENV!=="production"&&function(){function e(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===A?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case C:return"Fragment";case p:return"Profiler";case d:return"StrictMode";case R:return"Suspense";case P:return"SuspenseList";case $:return"Activity"}if(typeof a=="object")switch(typeof a.tag=="number"&&console.error("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),a.$$typeof){case E:return"Portal";case S:return(a.displayName||"Context")+".Provider";case b:return(a._context.displayName||"Context")+".Consumer";case j:var o=a.render;return a=a.displayName,a||(a=o.displayName||o.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case k:return o=a.displayName||null,o!==null?o:e(a.type)||"Memo";case z:o=a._payload,a=a._init;try{return e(a(o))}catch{}}return null}function r(a){return""+a}function i(a){try{r(a);var o=!1}catch{o=!0}if(o){o=console;var h=o.error,f=typeof Symbol=="function"&&Symbol.toStringTag&&a[Symbol.toStringTag]||a.constructor.name||"Object";return h.call(o,"The provided key is an unsupported type %s. This value must be coerced to a string before using it here.",f),r(a)}}function n(a){if(a===C)return"<>";if(typeof a=="object"&&a!==null&&a.$$typeof===z)return"<...>";try{var o=e(a);return o?"<"+o+">":"<...>"}catch{return"<...>"}}function m(){var a=s.A;return a===null?null:a.getOwner()}function x(){return Error("react-stack-top-frame")}function w(a){if(L.call(a,"key")){var o=Object.getOwnPropertyDescriptor(a,"key").get;if(o&&o.isReactWarning)return!1}return a.key!==void 0}function u(a,o){function h(){H||(H=!0,console.error("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://react.dev/link/special-props)",o))}h.isReactWarning=!0,Object.defineProperty(a,"key",{get:h,configurable:!0})}function g(){var a=e(this.type);return Y[a]||(Y[a]=!0,console.error("Accessing element.ref was removed in React 19. ref is now a regular prop. It will be removed from the JSX Element type in a future release.")),a=this.props.ref,a!==void 0?a:null}function c(a,o,h,f,M,N,v,T){return h=N.ref,a={$$typeof:F,type:a,key:o,props:N,_owner:M},(h!==void 0?h:null)!==null?Object.defineProperty(a,"ref",{enumerable:!1,get:g}):Object.defineProperty(a,"ref",{enumerable:!1,value:null}),a._store={},Object.defineProperty(a._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(a,"_debugInfo",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(a,"_debugStack",{configurable:!1,enumerable:!1,writable:!0,value:v}),Object.defineProperty(a,"_debugTask",{configurable:!1,enumerable:!1,writable:!0,value:T}),Object.freeze&&(Object.freeze(a.props),Object.freeze(a)),a}function _(a,o,h,f,M,N,v,T){var O=o.children;if(O!==void 0)if(f)if(K(O)){for(f=0;f<O.length;f++)l(O[f]);Object.freeze&&Object.freeze(O)}else console.error("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else l(O);if(L.call(o,"key")){O=e(a);var D=Object.keys(o).filter(function(J){return J!=="key"});f=0<D.length?"{key: someKey, "+D.join(": ..., ")+": ...}":"{key: someKey}",X[O+f]||(D=0<D.length?"{"+D.join(": ..., ")+": ...}":"{}",console.error(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,f,O,D,O),X[O+f]=!0)}if(O=null,h!==void 0&&(i(h),O=""+h),w(o)&&(i(o.key),O=""+o.key),"key"in o){h={};for(var B in o)B!=="key"&&(h[B]=o[B])}else h=o;return O&&u(h,typeof a=="function"?a.displayName||a.name||"Unknown":a),c(a,O,N,M,m(),h,v,T)}function l(a){typeof a=="object"&&a!==null&&a.$$typeof===F&&a._store&&(a._store.validated=1)}var y=I,F=Symbol.for("react.transitional.element"),E=Symbol.for("react.portal"),C=Symbol.for("react.fragment"),d=Symbol.for("react.strict_mode"),p=Symbol.for("react.profiler"),b=Symbol.for("react.consumer"),S=Symbol.for("react.context"),j=Symbol.for("react.forward_ref"),R=Symbol.for("react.suspense"),P=Symbol.for("react.suspense_list"),k=Symbol.for("react.memo"),z=Symbol.for("react.lazy"),$=Symbol.for("react.activity"),A=Symbol.for("react.client.reference"),s=y.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,L=Object.prototype.hasOwnProperty,K=Array.isArray,G=console.createTask?console.createTask:function(){return null};y={"react-stack-bottom-frame":function(a){return a()}};var H,Y={},Z=y["react-stack-bottom-frame"].bind(y,x)(),U=G(n(x)),X={};ae.Fragment=C,ae.jsx=function(a,o,h,f,M){var N=1e4>s.recentlyCreatedOwnerStacks++;return _(a,o,h,!1,f,M,N?Error("react-stack-top-frame"):Z,N?G(n(a)):U)},ae.jsxs=function(a,o,h,f,M){var N=1e4>s.recentlyCreatedOwnerStacks++;return _(a,o,h,!0,f,M,N?Error("react-stack-top-frame"):Z,N?G(n(a)):U)}}()),ae}var xe;function Oe(){return xe||(xe=1,process.env.NODE_ENV==="production"?ie.exports=Ae():ie.exports=Te()),ie.exports}var t=Oe();function Ce(e){return e.template==="accordion"?"accordion":e.template==="simple"?"simple":e.template==="cards"?"cards":Object.values(e.fields||{}).some(n=>n.group)?"tab":"simple"}function Fe(e,r="create",i="Info"){const n={};let m=!1;if(Object.values(e).forEach(w=>{w.group&&(m=!0)}),!m)return{};const x=[];return Object.entries(e).forEach(([w,u])=>{if(u.vmode==="edit"&&r==="create")return;const g={...u,name:w};if(u.group){const c=u.group;n[c]||(n[c]=[]),n[c].push(g)}else x.push(g)}),x.length>0?{[i]:x,...n}:n}function ye(e,r="create"){const i={};return Object.keys(e).forEach(n=>{e[n].vmode==="edit"&&r==="create"||(i[n]={label:n,required:e[n].required??!1})}),i}const se=(e,r,i,n,m,x)=>{const w=x==="create"&&m?Ne(m):{};e.forEach(u=>{const g=u?.name;if(!g)return;let c=n?.[g];const _=x==="create"&&m?we(u):null;x==="create"&&_&&w[_]!==void 0&&c==null&&(c=w[_]),c==null&&(c=u.default),u.multiple===!0||u.type==="checkbox"||u.type==="tags"?r[g]=Array.isArray(c)?c:typeof c=="string"?c.split(",").map(y=>y.trim()).filter(Boolean):[]:u.type==="json"?r[g]=typeof c=="object"&&c!==null?JSON.stringify(c,null,2):c??"":u.type==="date"?r[g]=typeof c=="string"?c.slice(0,10):"":u.type==="time"?typeof c=="string"?c.includes("T")?r[g]=c.slice(11,16):r[g]=c.slice(0,5):r[g]="":g==="blocked"||g==="blacklist"?r[g]=String(c??"false"):r[g]=c??"";let l;u.type==="file"?l=u.multiple?q.array().of(q.mixed()):q.mixed():u.multiple===!0||u.type==="checkbox"||u.type==="tags"?l=q.array().of(q.string()):u.type==="email"?l=q.string().email("Invalid email"):u.type==="number"?l=q.number().typeError("Must be a number"):u.type==="json"?l=q.string().test("json","Invalid JSON",y=>{if(!y)return!0;try{return JSON.parse(y),!0}catch{return!1}}):l=q.string(),u.required&&(l=l.required(u.error_message||`${u.label||g} is required`)),u?.validate?.regex&&typeof u.validate.regex=="string"&&(l=l.matches(new RegExp(u?.validate?.regex),u?.error_message||"Invalid input format")),u?.validate&&Object.entries(u.validate).forEach(([y,F])=>{switch(y){case"email":F&&(l=l.email("Invalid email format"));break;case"mobile":l=l.matches(/^[1-9][0-9]*$/,"Invalid mobile number format");break;case"regex":l=l.matches(new RegExp(F),`Must match pattern: ${F}`);break;case"date":l=q.date().typeError("Invalid date format (expected dd/MM/yyyy or dd-MM-yyyy)").transform((E,C)=>{if(typeof C=="string"){const d=C.replace(/-/g,"/"),[p,b,S]=d.split("/");if(p&&b&&S)return new Date(`${S}-${b}-${p}`)}return E});break;case"time":l=l.matches(/^([0-1][0-9]|2[0-3])[:\-]([0-5][0-9])$/,"Invalid time format (HH:MM)");break;case"timesec":l=l.matches(/^([0-1][0-9]|2[0-3]):([0-5][0-9]):([0-5][0-9])$/,"Invalid time format (HH:MM:SS)");break;case"number":case"numeric":l=q.number().typeError("Must be numeric");break;case"float":case"decimal":l=q.number().typeError("Must be a decimal").transform((E,C)=>{if(C==null||C==="")return;const d=Number(C);if(isNaN(d))return E;if(typeof E=="number"&&!isNaN(E)){const p=Number(E);return Number.isInteger(p)?Number(d.toFixed(p)):d}return d});break;case"alphanumeric":l=l.matches(/^[a-z0-9]+$/i,"Must be alphanumeric");break;case"alpha":l=l.matches(/^[a-zA-Z]+$/,"Must contain only letters");break;case"upper":l=l.transform(E=>E&&E.toUpperCase());break;case"lower":l=l.transform(E=>E&&E.toLowerCase());break;case"length-min":{const E=Number(F);isNaN(E)||(l=l.min(E,`Minimum length is ${E}`));break}case"length-max":{const E=Number(F);isNaN(E)||(l=l.max(E,`Maximum length is ${E}`));break}}}),i[g]=l})},le={12:"lg:col-span-12",11:"lg:col-span-11",10:"lg:col-span-10",9:"lg:col-span-9",8:"lg:col-span-8",7:"lg:col-span-7",6:"lg:col-span-6",5:"lg:col-span-5",4:"lg:col-span-4",3:"lg:col-span-3",2:"lg:col-span-2",1:"lg:col-span-1"};function ce(e){return[1,2,3,4,5,6,7,8,9,10,11,12].includes(e)?e:6}const ue=e=>e===!0||e==="true",Q=(e,r)=>typeof e=="string"?e.replace(/#(\w+)#/g,(i,n)=>r[n]!==void 0?String(r[n]):i):Array.isArray(e)?e.map(i=>Q(i,r)):e&&typeof e=="object"?Object.fromEntries(Object.entries(e).map(([i,n])=>[Q(i,r),Q(n,r)])):e,ee=(e,r,i,n)=>{if(!Array.isArray(i)||i.length===0)return{};const m=n??(i[0]&&typeof i[0]=="object"&&"category"in i[0]?"category":void 0);if(!m){const w={};return i.forEach(u=>{const g=u[e],c=u[r];g!=null&&c!=null&&(w[String(g)]=String(c))}),w}const x={};return i.forEach(w=>{const u=w[m]??"Others",g=w[e],c=w[r];g==null||c==null||(x[u]||(x[u]={}),x[u][String(g)]=String(c))}),x},fe=(e,r)=>{if(!e||r==null)return;const i=String(r);if(typeof Object.values(e)[0]=="string")return e[i];for(const m of Object.values(e))if(i in m)return m[i]},Ie=e=>{if(!e)return[];if(Array.isArray(e))return e.map(n=>[String(n.value),String(n.title??n.label??n.value)]);const r=Object.values(e);return r.length?typeof r[0]=="string"?Object.entries(e).map(([n,m])=>[String(n),m]):Object.values(e).flatMap(n=>Object.entries(n).map(([m,x])=>[String(m),x])):[]},ve=e=>{if(!e||typeof e!="object")return!1;const r=Object.values(e)[0];return typeof r=="object"&&r!==null&&!Array.isArray(r)};async function Pe(){if(!("geolocation"in navigator))throw new Error("Geolocation is not supported by this browser. You cannot access this portal.");try{const e=await new Promise((n,m)=>{navigator.geolocation.getCurrentPosition(n,m,{enableHighAccuracy:!1,timeout:3e4,maximumAge:12e4})}),{latitude:r,longitude:i}=e.coords;return`${r},${i}`}catch(e){if(!(e instanceof GeolocationPositionError))throw new Error("Failed to get your location.");switch(e.code){case e.PERMISSION_DENIED:throw new Error("Please allow location access in browser settings.");case e.POSITION_UNAVAILABLE:throw new Error("Unable to detect your location. Try connecting to Wi-Fi.");case e.TIMEOUT:throw new Error("Your device took too long to fetch GPS position.");default:throw new Error("Failed to get your location.")}}}const Re=e=>Object.entries(e??{}).filter(([,r])=>r.type==="geolocation").map(([r])=>r);function _e(e,r="create"){return Object.entries(e).filter(([,i])=>!(i.vmode==="edit"&&r==="create")).map(([i,n])=>({...n,name:i}))}function Me(e){return typeof e=="object"&&e!==null&&typeof e.target=="string"&&typeof e.src=="object"&&e.src!==null&&typeof e.src.table=="string"}function ke(e){return e.split(",").map(r=>r.trim()).map(r=>{const i=r.match(/^(.+?)\s+as\s+.+$/i);return i?i[1]?.trim():r}).filter(r=>!!r)}const te=e=>{const r={};for(const[i,n]of Object.entries(e)){const m=i.includes(".")?i.split(".").pop():i;if(m in r){console.warn(`Duplicate key after normalization: ${m}`);continue}r[m]=n}return r},Le="__form_persist__",je=e=>`${Le}:${e}`;function we(e){return e.persistent?e.persistent===!0?e.name:typeof e.persistent=="string"?e.persistent:null:null}function Ne(e){try{return JSON.parse(localStorage.getItem(je(e))||"{}")}catch{return{}}}function ze(e,r,i){const n=Ne(e);localStorage.setItem(je(e),JSON.stringify({...n,[r]:i}))}const ne=e=>({Authorization:`Bearer ${e.accessToken}`}),me=async e=>(await V.get(e.baseURL+e.dbopsGetHash,{headers:ne(e)})).data.refhash,pe=async(e,r)=>(await V.post(e.baseURL+e.dbopsGetRefId,r,{headers:ne(e)})).data.refid,De={async fetch(e,r,i,n){const m=await me(e);let x=!1,w;i&&(x=!0,w=i),x||(w=await pe(e,{operation:"fetch",source:r.source,fields:r.fields??{},datahash:m,srcid:n}));const u=await V.post(e.baseURL+e.dbopsFetch,{refid:w,datahash:m},{headers:ne(e)});return u.data?.data??u.data},async create(e,r,i){const n=await me(e),m=await pe(e,{operation:"create",source:r.source,fields:r.values,datahash:n,srcid:i});return(await V.post(e.baseURL+e.dbopsCreate,{refid:m,fields:r.values,datahash:n},{headers:ne(e)})).data},async update(e,r,i){const n=await me(e),m=await pe(e,{operation:"update",source:r.source,fields:r.values,datahash:n,srcid:i});return(await V.post(e.baseURL+e.dbopsUpdate,{refid:m,fields:r.values,datahash:n},{headers:ne(e)})).data}};async function de(e,r,i,n=void 0,m=void 0,x={}){try{let w=i;return w||(w=(await V({method:"POST",url:e.baseURL+e.registerQuery,data:{query:r??{},srcid:m},headers:{Authorization:`Bearer ${e?.accessToken}`}})).data.queryid),await V({method:"POST",url:e.baseURL+e.runQuery,data:{queryid:w,filter:x,refid:n,page:0,limit:1e4},headers:{Authorization:`Bearer ${e?.accessToken}`}})}catch(w){throw w}}function qe({field:e,formik:r,methods:i={},sqlOpsUrls:n,refid:m,module_refid:x="menuManager.main",optionsOverride:w,setFieldOptions:u}){const[g,c]=I.useState(!1),[_,l]=I.useState(w??e.options??{});I.useRef(null);const[y,F]=I.useState(""),[E,C]=I.useState(0),d=I.useRef(null),p=I.useRef(null),[b,S]=I.useState(!1),j=I.useRef(y),R=e.disabled===!0;I.useEffect(()=>{j.current=y},[y]);const P=a=>{if(R){a.preventDefault(),p.current?.removeAttribute("open");return}a.currentTarget.open||F("")};I.useEffect(()=>{w&&Object.keys(w).length!==0&&l(w)},[w]),I.useEffect(()=>{const a=o=>{p.current&&!p.current.contains(o.target)&&(p.current.open=!1,F(""))};return document.addEventListener("mousedown",a),()=>{document.removeEventListener("mousedown",a)}},[]);const k=e.name;I.useEffect(()=>{let a=!0;return(async()=>{let h=e.valueKey??"value",f=e.labelKey??"title";if(e?.options){if(typeof e.options=="object"&&!Array.isArray(e.options)){const O=Object.values(e.options);if(O.length&&typeof O[0]=="string"){l(e.options);return}}const v=(Array.isArray(e.options)?e.options:[e.options]).map(te),T=ee(h,f,v,e.groupKey);l(T);return}const M=e?.source??{};if(e.type==="dataMethod"){const N=e.method,v=N?i[N]:void 0;if(v)try{const T=await Promise.resolve(v()),O=Array.isArray(T?.data?.data)?T.data.data:Array.isArray(T?.data)?T.data:T,D=Array.isArray(O)?O.map(te):[],B=ee(h,f,D,e.groupKey);a&&l(B)}catch(T){console.error("Method execution failed:",T),a&&l({})}else a&&l({})}if(M.type==="api"&&M.url)try{const N=await V({method:M.method||"GET",url:M.url,data:M.body??{},params:M.params??{},headers:M.headers??{}}),v=Array.isArray(N?.data?.data)?N.data.data:Array.isArray(N?.data)?N.data:N,T=Array.isArray(v)?v.map(te):[],O=ee(h,f,T,e.groupKey);a&&l(O)}catch(N){console.error("API execution failed:",N),a&&l({})}if(e.table||e.type==="dataSelector"||e.queryid){if(!n){console.error("SQL source requires formJson.endPoints but it is missing");return}try{let N;if(e.type==="dataSelector")N={table:"do_lists",cols:"title,value",where:{groupid:e.groupid??""}};else if(!e.queryid){if(!e.table||!e.columns){console.error("Invalid SQL field config",e);return}N={table:e.table,cols:e.columns,where:e.where?m?Q(e.where,{refid:m}):e.where:void 0}}const v=await de(n,N,e?.queryid,void 0,x),T=Array.isArray(v?.data?.data)?v.data.data:Array.isArray(v?.data)?v.data:v,O=Array.isArray(T)?T.map(te):[],D=ee(h,f,O,e.groupKey);a&&l(D)}catch(N){console.error("API fetch failed:",N)}}})(),()=>{a=!1}},[e.options,e.source,e.table,e.columns,e.where,m,e.queryid,e.groupKey,e.valueKey,e.labelKey]);const z=`
  w-full px-4 py-2 rounded-lg border transition-all duration-300
  backdrop-blur-sm text-gray-800 placeholder-gray-400
  focus:outline-none focus:ring-0

  ${R?"bg-gray-100 border-gray-200 text-gray-500 cursor-not-allowed":"bg-white border-gray-300 hover:border-gray-400 focus:border-indigo-500 focus:shadow-md"}
`,$=`
    border-gradient-to-r 
    focus:border-gray-400 focus:shadow-lg focus:shadow-gray-100/50
  `,A=`
    block text-sm font-semibold mb-1  transition-all duration-300 text-gray-700
  `,s=I.useMemo(()=>Ie(_),[_]),L=s.length,K=I.useMemo(()=>e.search||!y?s:s.filter(([,a])=>a.toLowerCase().includes(y.toLowerCase())),[e.search,y,s]),G=(a,o)=>{if(p.current?.open===!0||b===!0)if(a.key==="ArrowDown")a.preventDefault(),C(h=>h+1<K.length?h+1:0);else if(a.key==="ArrowUp")a.preventDefault(),C(h=>h-1>=0?h-1:K.length-1);else if(a.key==="Enter"){a.preventDefault();const[h]=K[E]||[];if(h){let f=o?h:[...r.values[e.name],h];r.setFieldValue(e.name,f),X(f)}p.current&&(p.current.open=!1)}else a.key==="Escape"&&(p.current.open=!1,F(""),S(!1))};I.useEffect(()=>{d.current?.querySelector(`[data-index="${E}"]`)?.scrollIntoView({block:"nearest"})},[E]),I.useEffect(()=>{E>=K.length&&C(0)},[K,E]),I.useEffect(()=>{const a=e.autocomplete,o=e.ajaxchain;if(!a&&!o)return;const h=r.values[e.name];if(!h)return;const f=Array.isArray(o)?o:o?[o]:[];(async()=>{try{if(Me(a)){const N=a.src;if(!N||!n)return;const v=Q(N.where??{},{refid:h}),T={...N,table:N.table,cols:N.columns,where:v},{data:O}=await de(n,T,e?.queryid,void 0,x),D=Array.isArray(O?.data)?O.data[0]:O?.data;D&&a.target.split(",").map(B=>B.trim()).forEach(B=>{D[B]!==void 0&&r.setFieldValue(B,D[B])})}for(const N of f){const v=N.src;if(!N||typeof N!="object"||!v||typeof v!="object"||!n)continue;let T;if(!v.queryid){if(!v.table||!v.columns)throw new Error("SQL query requires field.table");const Xe=Q(v?.where??{},{refid:h});T={...v,table:v.table,cols:v.columns,where:Xe}}const{data:O}=await de(n,T,v?.queryid,h,x);let D=e.valueKey??"value",B=e.labelKey??"title";const J=Array.isArray(O?.data?.data)?O.data.data:Array.isArray(O?.data)?O.data:O,Qe=Array.isArray(J)?J.map(te):[],Ue=ee(D,B,Qe,e.groupKey);u?.(N.target,Ue)}}catch(N){console.error("Autocomplete / AjaxChain fetch failed",N)}})()},[r.values[e.name]]),I.useEffect(()=>{if(!e.search||!y.trim()||!e.table||!n)return;const a=ke(e.columns??""),o=new AbortController,h=setTimeout(async()=>{try{let f;if(!e.queryid){if(!e.table||!e.cols)throw new Error("SQL query requires field.table");const J=m?Q(e.where??{},{refid:m}):e.where;f={...e,table:e.table,cols:e.columns||e.cols,where:J}}let M={};Array.isArray(a)&&a.forEach(J=>{M[J]=[y,"LIKE"]});let N=e.valueKey??"value",v=e.labelKey??"title";const{data:T}=await de(n,f,e?.queryid,void 0,x,M),O=Array.isArray(T?.data?.data)?T.data.data:Array.isArray(T?.data)?T.data:T,D=Array.isArray(O)?O.map(te):[],B=ee(N,v,D,e.groupKey);l(B)}catch(f){if(V.isCancel(f))return;console.error("Search fetch failed",f)}},500);return()=>{clearTimeout(h),o.abort()}},[y,m]);const H=async a=>{if(a.length===0){console.error("No file");return}const o=n?.baseURL+n?.uploadURL;if(!o){console.error("No Upload URL ");return}const h=e.multiple===!0;try{const f=await Promise.all(Array.from(a).map(async N=>{const v=new FormData;return v.append("file",N),(await V({method:"POST",url:o,data:v,headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${n?.accessToken}`}})).data}));let M=h?f.map(N=>N.path):f[0]?.path;r.setFieldValue(k,M),X(M)}catch(f){console.error("File upload failed",f),r.setFieldError(k,"File upload failed")}},Y=async(a,o,h)=>{const f=o[a];if(!f)return;const M=i?.[f];if(typeof M!="function"){console.error(`Method "${String(f)}" not found`);return}try{await Promise.resolve(M(h))}catch(N){console.error(`Method "${String(f)}" failed`,N)}},Z=a=>{if(R)return;const o=a.target.value;F(o),C(0),o.trim()?S(!0):(S(!1),r.setFieldValue(k,""))},U=a=>{r.setFieldValue(k,a),X(a),F(""),S(!1),Y("onChange",e,`${k}-${a}`)};function X(a){const o=we(e);o&&x&&ze(x,o,a)}return{setHighlightedIndex:C,executeFieldMethod:Y,handleFileUpload:H,handleKeyDown:G,handleToggle:P,setSearch:F,setOpen:S,setIsFocused:c,handleInputChange:Z,handleSelect:U,handlePersist:X,optionCount:L,baseInputClasses:z,focusClasses:$,labelClasses:A,search:y,highlightedIndex:E,options:_,isDisabled:R,key:k,filteredOptions:K,open:b,listRef:d,detailsRef:p,isFocused:g}}function Se({field:e,isDisabled:r,handleToggle:i,detailsRef:n,handleKeyDown:m,valueArray:x,labelClasses:w,listRef:u,search:g,filteredOptions:c,highlightedIndex:_,setSearch:l,formik:y,setHighlightedIndex:F,executeFieldMethod:E,handlePersist:C}){const d=e.name;return t.jsxs("div",{className:"relative",children:[t.jsxs("label",{className:w,children:[e.label,e.required&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsxs("details",{className:`relative w-full ${r?" opacity-70":""}`,onToggle:i,ref:n,onKeyDown:p=>{r||m(p,!1)},children:[t.jsxs("summary",{className:`
    select-none border rounded-lg px-4 py-2.5 flex justify-between items-center
    ${r?"bg-gray-100 border-gray-200 text-gray-500 cursor-not-allowed":"bg-white border-gray-300 cursor-pointer"}
  `,children:[t.jsx("span",{className:"text-sm text-gray-700",children:x?.length>0?x.join(", "):`Select ${e.label}`}),t.jsx("svg",{className:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),!r&&t.jsxs("div",{ref:u,className:"absolute mt-1 w-full border border-gray-200 rounded-lg bg-white shadow-md z-10 max-h-60 overflow-y-auto p-2",children:[e.search&&t.jsx("div",{className:"sticky top-0 bg-white p-1",children:t.jsx("input",{type:"text",value:g,onChange:p=>{r||(l(p.target.value),F(0))},placeholder:"Search...",className:`px-2 py-[5px] rounded w-full border border-gray-200 transition-all duration-300 
                bg-white/80 backdrop-blur-sm text-gray-800 placeholder-gray-400
                focus:outline-none focus:ring-0`})}),c.length>0?c.map(([p,b],S)=>t.jsxs("label",{htmlFor:`${d}-${p}`,className:`flex items-center gap-x-2 px-2 py-1 hover:bg-gray-50 rounded cursor-pointer text-sm
                        ${x?.includes(p)?"bg-indigo-50 text-indigo-600 font-medium":_===S?"bg-gray-100":"hover:bg-gray-50"}`,children:[t.jsx("input",{id:`${d}-${p}`,type:"checkbox",checked:x?.includes(p),onChange:j=>{const R=j.target.checked?[...x,p]:x?.filter(P=>P!==p);y.setFieldValue(d,R),C(R),E("onChange",e,`${d}-${p}`)},onBlur:y.handleBlur,disabled:r,className:"h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),b]},p)):t.jsx("div",{className:"px-2 py-1 text-gray-400 text-sm",children:"No results"})]})]}),y.touched[d]&&y.errors[d]&&t.jsx("span",{className:"text-xs text-red-500 ml-2",children:String(y.errors[d])})]})}function he({field:e,formik:r,methods:i={},sqlOpsUrls:n,refid:m,module_refid:x="menuManager.main",optionsOverride:w,setFieldOptions:u}){const{setHighlightedIndex:g,executeFieldMethod:c,handleFileUpload:_,handleKeyDown:l,handleToggle:y,setSearch:F,setOpen:E,setIsFocused:C,handleInputChange:d,handleSelect:p,handlePersist:b,optionCount:S,baseInputClasses:j,focusClasses:R,labelClasses:P,search:k,highlightedIndex:z,options:$,isDisabled:A,key:s,filteredOptions:L,open:K,listRef:G,detailsRef:H,isFocused:Y}=qe({field:e,formik:r,methods:i,sqlOpsUrls:n,refid:m,module_refid:x,...w&&{optionsOverride:w},...u&&{setFieldOptions:u}}),Z=U=>U.icon?t.jsx("i",{className:U.icon}):null;switch(e.type){case"autocomplete":{const a=r.values[s]??"",o=k!==""?k:fe($,a)??String(a??"");return t.jsxs("div",{className:"relative",children:[t.jsxs("label",{className:P,children:[e.label,e.required&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsx("input",{className:`${j} ${R}`,value:o,placeholder:e.placeholder||"Type to search...",onChange:d,onBlur:()=>{setTimeout(()=>E(!1),150)},onKeyDown:h=>{if(h.key==="Enter"){if(h.preventDefault(),L[z]){const[f]=L[z];r.setFieldValue(s,f),b(f)}else k.trim()&&(r.setFieldValue(s,k.trim()),b(k.trim()));E(!1);return}l(h,!0)},disabled:A}),K&&!A&&t.jsx("div",{ref:G,className:"absolute z-20 w-full bg-white border rounded shadow max-h-52 overflow-y-auto mt-1",children:L.length>0?L.map(([h,f],M)=>t.jsx("div",{id:`${s}-${h}`,"data-index":M,className:`px-3 py-2 cursor-pointer text-sm
                  ${z===M?"bg-gray-100":"hover:bg-gray-100"}`,onMouseDown:()=>p(h),children:f},h)):t.jsx("div",{className:"px-3 py-2 text-sm text-gray-400",children:`No matches press enter to add "${o}" `})}),r.touched[s]&&r.errors[s]&&t.jsx("span",{className:"text-xs text-red-500",children:String(r.errors[s])})]})}case"dataSelector":case"dataSelectorFromTable":case"dataSelectorFromUniques":case"dataMethod":{if(e.multiple===!0){const a=r.values[s];return t.jsx(Se,{field:e,isDisabled:A,handleToggle:y,detailsRef:H,handleKeyDown:l,valueArray:a,labelClasses:P,listRef:G,search:k,filteredOptions:L,highlightedIndex:z,setSearch:F,formik:r,executeFieldMethod:c,setHighlightedIndex:g,handlePersist:b})}return t.jsxs("div",{className:"relative",children:[t.jsxs("label",{className:P,children:[e.label,e.required&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsxs("details",{className:`relative w-full ${A?"opacity-70":""}`,onToggle:y,ref:H,onKeyDown:a=>{A||l(a,!0)},children:[t.jsxs("summary",{className:`
    select-none border rounded-lg px-4 py-2.5 flex justify-between items-center
    ${A?"bg-gray-100 border-gray-200 text-gray-500 cursor-not-allowed":"bg-white border-gray-300 cursor-pointer"}
  `,children:[t.jsx("span",{className:"text-sm text-gray-700",children:r.values[s]?fe($,r.values[s])??"Select option":`Select ${e.label}`}),t.jsx("svg",{className:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),!A&&t.jsxs("div",{ref:G,className:"absolute mt-1 w-full border border-gray-200 rounded-lg bg-white shadow-md z-10 max-h-60 overflow-y-auto p-2",children:[e.search&&t.jsx("div",{className:"sticky top-0 bg-white p-1",children:t.jsx("input",{type:"text",value:k,onChange:a=>{F(a.target.value),g(0)},onKeyDown:a=>l(a,!0),placeholder:"Search...",className:`px-2 py-[5px] rounded w-full border border-gray-200 transition-all duration-300 
                  bg-white/80 backdrop-blur-sm text-gray-800 placeholder-gray-400
                  focus:outline-none focus:ring-0`})}),L.length>0&&t.jsx("div",{onClick:a=>{a.preventDefault(),a.stopPropagation(),r.setFieldValue(s,""),b(""),H.current?.removeAttribute("open"),F("")},className:"px-2 py-1 hover:bg-gray-50 rounded cursor-pointer text-sm hover:bg-gray-50",children:"Clear selection"}),L.length>0?L.map(([a,o],h)=>t.jsx("div",{id:`${s}-${a}`,"data-index":h,onClick:f=>{f.preventDefault(),f.stopPropagation(),r.setFieldValue(s,a),b(a),H.current?.removeAttribute("open"),F(""),g(0),c("onChange",e,`${s}-${a}`)},className:`px-2 py-1 hover:bg-gray-50 rounded cursor-pointer text-sm 
                        ${r.values[s]===a?"bg-indigo-50 text-indigo-600 font-medium":z===h?"bg-gray-100":"hover:bg-gray-50"}`,children:o},a)):t.jsx("div",{className:"px-2 py-1 text-gray-400 text-sm",children:"No results"})]})]}),r.touched[s]&&r.errors[s]&&t.jsx("span",{className:"text-xs text-red-500 ml-2",children:String(r.errors[s])})]})}case"textarea":return t.jsx(t.Fragment,{children:t.jsxs("div",{className:"relative",children:[t.jsxs("label",{className:P,children:[e.label,e.required&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsxs("div",{className:"relative",children:[t.jsx("textarea",{id:s,className:`${j} ${R} min-h-[120px] resize-none`,onFocus:()=>C(!0),name:s,value:r.values[s],onBlur:r.handleBlur,onChange:a=>{r.setFieldValue(s,a.target.value),b(a.target.value),c("onChange",e,`${s}`)},placeholder:e.placeholder,disabled:A}),t.jsx("div",{className:`absolute inset-0 rounded-lg bg-gradient-to-r from-purple-400 to-indigo-400 opacity-0 transition-opacity duration-300 pointer-events-none ${Y?"opacity-20":""}`,style:{zIndex:-1,filter:"blur(8px)"}})]}),r.touched[s]&&r.errors[s]&&t.jsx("span",{className:"text-xs text-red-500",children:String(r.errors[s])})]})});case"select":if(e.multiple===!0){const a=r.values[s];return t.jsx(Se,{field:e,isDisabled:A,handleToggle:y,detailsRef:H,handleKeyDown:l,valueArray:a,labelClasses:P,listRef:G,search:k,filteredOptions:L,highlightedIndex:z,setSearch:F,formik:r,executeFieldMethod:c,setHighlightedIndex:g,handlePersist:b})}return t.jsxs("div",{className:"relative",children:[t.jsxs("label",{className:P,children:[e.label,e.required&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsxs("div",{className:"relative",children:[t.jsxs("select",{className:`${j} ${R} appearance-none ${A?"":"cursor-pointer"} pr-12`,onFocus:()=>C(!0),name:s,id:s,value:r.values[s],onBlur:r.handleBlur,onChange:a=>{r.setFieldValue(s,a.target.value),b(a.target.value),c("onChange",e,`${s}`)},disabled:A,children:[t.jsx("option",{value:"",disabled:!0,children:e?.["no-option"]||`Please select ${e.label}`}),!ve($)&&Object.entries($).map(([a,o])=>t.jsx("option",{value:a,className:"py-2",children:o},a)),ve($)&&Object.entries($).map(([a,o])=>t.jsx("optgroup",{label:a,children:Object.entries(o).map(([h,f])=>t.jsx("option",{value:h,children:f},h))},a))]}),t.jsx("div",{className:"absolute right-4 top-1/2 transform -translate-y-1/2 pointer-events-none",children:t.jsx("svg",{className:"w-5 h-5 transition-colors duration-300 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),r.touched[s]&&r.errors[s]&&t.jsx("span",{className:"text-xs text-red-500",children:String(r.errors[s])})]});case"radioList":case"radio":return t.jsxs("div",{className:"relative",children:[t.jsxs("label",{className:P,children:[e.label,e.required&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsx("div",{className:`flex ${S>3?"flex-col":""} gap-2 ml-1`,children:Object.entries($||{}).map(([a,o])=>t.jsxs("label",{htmlFor:`${s}-${a}`,className:"flex items-center gap-x-2 text-sm font-medium text-gray-700 cursor-pointer",children:[t.jsx("input",{id:`${s}-${a}`,type:"radio",name:s,checked:r.values[s]===a,value:a,onChange:h=>{r.setFieldValue(s,h.target.value),b(h.target.value),c("onChange",e,`${s}-${a}`)},onBlur:r.handleBlur,disabled:A,className:`h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500
                    ${A?"bg-gray-100 border-gray-200 text-gray-500 cursor-not-allowed":""}
                    `}),o]},a))}),r.touched[s]&&r.errors[s]&&t.jsx("span",{className:"text-xs text-red-500 ml-2",children:String(r.errors[s])})]});case"checkbox":{const a=r.values[s];return t.jsxs("div",{className:"relative",children:[t.jsxs("label",{className:P,children:[e.label,e.required&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsx("div",{className:"flex flex-col gap-2 ml-1",children:Object.entries($||{}).map(([o,h])=>t.jsxs("label",{className:"flex items-center gap-x-2 text-sm font-medium text-gray-700 cursor-pointer",children:[t.jsx("input",{id:`${s}-${o}`,type:"checkbox",checked:a.includes(o),onChange:f=>{const M=f.target.checked?[...a,o]:a.filter(N=>N!==o);r.setFieldValue(s,M),b(M),c("onChange",e,`${s}-${o}`)},onBlur:r.handleBlur,disabled:A,className:`h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500
                    ${A?"bg-gray-100 border-gray-200 text-gray-500 cursor-not-allowed":""}
                    `}),h]},o))}),r.touched[s]&&r.errors[s]&&t.jsx("span",{className:"text-xs text-red-500 ml-2",children:String(r.errors[s])})]})}case"tags":{const a=r.values[s],o=k.trim(),h=Array.isArray($)?$:Object.entries($||{}).map(([v,T])=>({value:v,label:T})),f=v=>{if(!A&&v&&!a.includes(v)){let T=[...a,v];r.setFieldValue(s,T),b(T),F("")}},M=v=>{let T=a.filter(O=>O!==v);r.setFieldValue(s,T),b(T)},N=v=>h.find(T=>T.value===v)?.label??v;return t.jsxs("div",{className:"relative",children:[t.jsxs("label",{className:P,children:[e.label,e.required&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsxs("div",{className:`${j} 
            flex flex-wrap gap-2 min-h-[42px] max-h-[120px] overflow-y-auto items-center
            ${A?"pointer-events-none opacity-70":""}
            `,onClick:()=>!A&&document.getElementById(`${s}-input`)?.focus(),children:[a.map(v=>t.jsxs("span",{className:"flex items-center gap-2 px-2 py-1 rounded-full text-sm bg-indigo-50 border border-indigo-100",children:[t.jsx("span",{className:"text-indigo-700",children:N(v)}),t.jsx("button",{type:"button",onClick:T=>{T.stopPropagation(),A||M(v)},onMouseDown:T=>T.preventDefault(),className:"ml-1 text-indigo-500 hover:text-red-500 focus:outline-none",children:"Ã—"})]},v)),t.jsx("input",{id:`${s}-input`,type:"text",value:k,onChange:v=>F(v.target.value),onKeyDown:v=>{(v.key==="Enter"||v.key===",")&&(v.preventDefault(),f(o))},placeholder:a.length===0?e.placeholder||"Type and press Enter":"",className:"flex-1 min-w-[120px] border-none outline-none text-sm bg-transparent p-1",disabled:A})]}),r.touched[s]&&r.errors[s]&&t.jsx("span",{className:"text-xs text-red-500",children:String(r.errors[s])})]})}case"attachment":case"photo":case"avatar":case"file":const U=e.multiple===!0,X=Array.isArray(r.values[s])?r.values[s]:r.values[s]?[r.values[s]]:[];return t.jsxs("div",{className:"relative",children:[t.jsxs("label",{className:P,children:[e.label,e.required&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsxs("div",{className:"relative",children:[e.icon&&t.jsx("div",{className:"absolute z-10 left-3 top-1/2 -translate-y-1/2 pointer-events-none",children:Z(e)}),t.jsx("input",{id:s,type:"file",className:`${j} ${R} ${e.icon?"pl-9":""} `,onFocus:()=>C(!0),name:s,multiple:U,onChange:a=>{const o=a.currentTarget.files;o&&_(o),c("onChange",e,`${s}`)},onBlur:r.handleBlur,placeholder:e.placeholder,disabled:A}),t.jsx("div",{className:`absolute inset-0 rounded-lg bg-gradient-to-r from-purple-400 to-indigo-400 opacity-0 transition-opacity duration-300 pointer-events-none ${Y?"opacity-20":""}`,style:{zIndex:-1,filter:"blur(8px)"}})]}),X.map(a=>{const o=a?.split("/").pop();return o?t.jsx("div",{className:"mt-1",children:t.jsx("span",{className:"text-sm",children:o})},a):null}),r.touched[s]&&r.errors[s]&&t.jsx("span",{className:"text-xs text-red-500",children:String(r.errors[s])})]});case"json":return t.jsxs("div",{className:"relative",children:[t.jsxs("label",{className:P,children:[e.label,e.required&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsxs("div",{className:"relative",children:[t.jsx("textarea",{id:s,name:s,value:r.values[s],onChange:a=>{r.setFieldValue(s,a.target.value),b(a.target.value),c("onChange",e,`${s}`)},onBlur:r.handleBlur,placeholder:e.placeholder||"Enter valid JSON",disabled:A,className:`${j} ${R} min-h-[200px] font-mono text-sm resize-y`}),t.jsx("div",{className:`absolute inset-0 rounded-lg bg-gradient-to-r from-emerald-400 to-cyan-400 opacity-0 transition-opacity duration-300 pointer-events-none ${Y?"opacity-20":""}`,style:{zIndex:-1,filter:"blur(8px)"}})]}),r.touched[s]&&r.errors[s]&&t.jsx("span",{className:"text-xs text-red-500",children:String(r.errors[s])})]});case"date":return t.jsxs("div",{className:"relative",children:[t.jsxs("label",{className:P,children:[e.label,e.required&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute z-10 right-3 top-1/2 -translate-y-1/2 pointer-events-none",children:t.jsx("i",{className:"fa-solid fa-calendar"})}),t.jsx("input",{id:s,type:"date",name:s,min:e.min,max:e.max,value:r.values[s],onChange:a=>{r.setFieldValue(s,a.target.value),b(a.target.value),c("onChange",e,`${s}`)},onBlur:r.handleBlur,placeholder:e.placeholder,disabled:A,className:`${j} ${R} ${e.icon?"pl-9":""}`}),t.jsx("div",{className:`absolute inset-0 rounded-lg bg-gradient-to-r from-purple-400 to-indigo-400 opacity-0 transition-opacity duration-300 pointer-events-none ${Y?"opacity-20":""}`,style:{zIndex:-1,filter:"blur(8px)"}})]}),r.touched[s]&&r.errors[s]&&t.jsx("span",{className:"text-xs text-red-500",children:String(r.errors[s])})]});case"number":return t.jsxs("div",{className:"relative",children:[t.jsxs("label",{className:P,children:[e.label,e.required&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsxs("div",{className:"relative",children:[e.icon&&t.jsx("div",{className:"absolute z-10 left-3 top-1/2 -translate-y-1/2 pointer-events-none",children:Z(e)}),t.jsx("input",{id:s,type:"number",className:`${j} ${R} ${e.icon?"pl-9":""} `,onFocus:()=>C(!0),name:s,value:r.values[s],onBlur:r.handleBlur,onChange:a=>{r.setFieldValue(s,a.target.value),b(a.target.value),c("onChange",e,`${s}`)},step:e.step,placeholder:e.placeholder,disabled:A,min:e.min??1,max:e.max}),t.jsx("div",{className:`absolute inset-0 rounded-lg bg-gradient-to-r from-purple-400 to-indigo-400 opacity-0 transition-opacity duration-300 pointer-events-none ${Y?"opacity-20":""}`,style:{zIndex:-1,filter:"blur(8px)"}})]}),r.touched[s]&&r.errors[s]&&t.jsx("span",{className:"text-xs text-red-500",children:String(r.errors[s])})]});default:return t.jsxs("div",{className:"relative",children:[t.jsxs("label",{className:P,children:[e.label,e.required&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsxs("div",{className:"relative",children:[e.icon&&t.jsx("div",{className:"absolute z-10 left-3 top-1/2 -translate-y-1/2 pointer-events-none",children:Z(e)}),t.jsx("input",{id:s,type:e.type||"text",className:`${j} ${R} ${e.icon?"pl-9":""} `,onFocus:()=>C(!0),name:s,value:r.values[s],onBlur:r.handleBlur,onChange:a=>{r.setFieldValue(s,a.target.value),b(a.target.value),c("onChange",e,`${s}`)},step:e.step,placeholder:e.placeholder,disabled:A,minLength:e.minlength,maxLength:e.maxlength}),t.jsx("div",{className:`absolute inset-0 rounded-lg bg-gradient-to-r from-purple-400 to-indigo-400 opacity-0 transition-opacity duration-300 pointer-events-none ${Y?"opacity-20":""}`,style:{zIndex:-1,filter:"blur(8px)"}})]}),r.touched[s]&&r.errors[s]&&t.jsx("span",{className:"text-xs text-red-500",children:String(r.errors[s])})]})}}function Ve({title:e,children:r,isFirst:i}){const[n,m]=I.useState(i);return t.jsx("div",{className:"group relative mt-1",children:t.jsxs("div",{className:"relative bg-white rounded-lg border border-gray-100 shadow-xs hover:shadow-sm transition-all duration-300 overflow-hidden ",children:[t.jsxs("button",{onClick:()=>m(!n),className:"w-full bg-gray-50 flex justify-between items-center px-6 py-3 b text-left transition-all duration-300 ",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:`w-3 h-3 rounded-full transition-all duration-300 ${n?"bg-action":"bg-gray-300"}`}),t.jsx("h3",{className:"text-md font-semibold bg-gradient-to-r from-gray-800 to-gray-600 bg-clip-text text-transparent",children:e})]}),t.jsxs("div",{className:`relative transition-all duration-300 ${n?"rotate-180":""}`,children:[t.jsx("div",{className:`absolute inset-0 rounded-full blur-md transition-opacity duration-300 ${n?"bg-action opacity-30":"bg-transparent opacity-0"}`}),t.jsx("svg",{className:"relative w-4 h-4 text-gray-500 group-hover:text-action-500 transition-colors duration-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]}),t.jsx("div",{className:`transition-all duration-500 ease-in-out overflow-hidden  ${n?"max-h-[2000px] opacity-100":"max-h-0 opacity-0"}`,children:t.jsx("div",{className:"px-6 pb-6 bg-gradient-to-br from-gray-50/50 to-white overflow-auto mb-5",children:t.jsx("div",{className:"space-y-5 pt-4",children:r})})})]})})}function Be({title:e,groupedFields:r,data:i,onSubmit:n=_=>{},onCancel:m=()=>{},methods:x={},components:w={},sqlOpsUrls:u={},refid:g,module_refid:c}){const[_,l]=I.useState({}),y=(d,p)=>{l(b=>({...b,[d]:p}))},{initialValues:F,validationSchema:E}=I.useMemo(()=>{const d={},p={};return Object.values(r).flat().forEach(b=>{se([b],d,p,i,c,u.operation)}),{initialValues:d,validationSchema:p}},[r,i,c,u.operation]),C=oe.useFormik({initialValues:F,enableReinitialize:!0,validationSchema:q.object().shape(E),onSubmit:d=>{n(d)}});return t.jsx("div",{className:"relative z-10 max-w-full  m-4",children:t.jsx("div",{className:"bg-white border border-gray-100 rounded-md animate-in fade-in duration-300",children:t.jsxs("form",{onSubmit:C.handleSubmit,className:"p-4 mx-auto",children:[t.jsx("div",{className:"space-y-2",children:r&&Object.entries(r).map(([d,p],b)=>t.jsx(Ve,{title:d,isFirst:b===0,children:t.jsx("div",{className:"grid grid-cols-12 gap-4",children:p.map((S,j)=>ue(S.hidden)||S.type==="geolocation"||S.vmode==="edit"&&u.operation==="create"?null:t.jsx("div",{className:`col-span-12 md:col-span-6 ${le[ce(Number(S.width))]||"lg:col-span-4"}`,children:t.jsx(he,{refid:g,module_refid:c,sqlOpsUrls:u,components:w,field:S,formik:C,methods:x,setFieldOptions:y,..._[S.name]?{optionsOverride:_[S.name]}:{}},S.name)},S?.name??`field-${j}`))})},d))}),t.jsxs("div",{className:"mt-8 flex justify-between space-x-3",children:[t.jsx("p",{className:"text-sm text-gray-700",children:"All fields marked (*) are required"}),t.jsxs("div",{className:"space-x-3",children:[t.jsx("button",{type:"button",onClick:m,className:"px-5 py-2 bg-white text-gray-700 font-semibold rounded-lg border-2 border-gray-200  shadow-sm hover:shadow-lg transform hover:scale-105 transition-all duration-300 ",children:"Cancel"}),t.jsx("button",{type:"submit",className:"px-5 py-2 bg-action font-semibold rounded-lg border-2 border-gray-200 shadow-sm hover:shadow-lg transform hover:scale-105 transition-all duration-300 ",children:"Save"})]})]})]})})})}function Ke({title:e,groupedFields:r,data:i,onSubmit:n=l=>{},onCancel:m=()=>{},methods:x={},components:w={},sqlOpsUrls:u={},widget:g,refid:c,module_refid:_}){const l=Object.keys(r),[y,F]=I.useState(0),[E,C]=I.useState({}),d=($,A)=>{C(s=>({...s,[$]:A}))},{initialValues:p,validationSchema:b,stepperSchemas:S}=I.useMemo(()=>{const $={},A={},s={};return g?Object.entries(r).forEach(([L,K])=>{const G={};se(K,$,G,i,_,u.operation),s[L]=G}):Object.entries(r).forEach(([L,K])=>{se(K,$,A,i,_,u.operation)}),{initialValues:$,validationSchema:A,stepperSchemas:s}},[r,i,g,_,u.operation]),j=l[y]??null,R=g&&j?S[j]??{}:b,P=oe.useFormik({initialValues:p,enableReinitialize:!0,validationSchema:q.object().shape(R),onSubmit:$=>{g?(y<l.length-1&&F(A=>A+1),y===l.length-1&&n($)):n($)}}),k=async $=>{if($.preventDefault(),!g){const A=await P.validateForm();if(Object.keys(A).length>0){alert("Please fill all required fields before submitting."),P.setTouched(Object.keys(A).reduce((s,L)=>({...s,[L]:!0}),{}));return}}P.handleSubmit($)},z=()=>{F($=>$>0?$-1:$)};return t.jsxs("div",{className:" max-w-full  m-4",children:[t.jsx("div",{className:"relative",children:t.jsx("div",{className:"relative bg-gray-100 rounded-t-lg px-1 pt-1  shadow-inner",children:t.jsx("nav",{className:"relative flex",children:l.map(($,A)=>t.jsx("button",{type:"button",onClick:()=>F(A),className:`relative cursor-pointer flex-shrink-0 py-2 px-2 sm:px-4 rounded-t-lg  text-xs sm:text-sm font-semibold transition-all duration-300 ease-out focus:outline-none whitespace-nowrap ${y===A?"text-action bg-white":"text-gray-600 hover:text-gray-800 hover:bg-white/50"}`,children:t.jsx("span",{className:"relative z-10 flex items-center justify-center gap-2 capitalize",children:$})},$))})})}),t.jsxs("div",{className:"bg-white  border border-gray-100 border-t-0 rounded-b-lg p-3 animate-in fade-in duration-300",children:[t.jsxs("form",{onSubmit:k,className:"w-full mx-auto",children:[t.jsx("div",{className:"grid grid-cols-12 gap-4",children:j&&r[j]?.map(($,A)=>ue($.hidden)||$.type==="geolocation"||$.vmode==="edit"&&u.operation==="create"?null:t.jsx("div",{className:`col-span-12  ${le[ce(Number($.width))]||"lg:col-span-4"}`,children:t.jsx(he,{refid:c,module_refid:_,sqlOpsUrls:u,field:$,formik:P,methods:x,components:w,setFieldOptions:d,...E[$.name]?{optionsOverride:E[$.name]}:{}},$.name)},$?.name??`field-${A}`))}),t.jsxs("div",{className:`mt-8 flex ${y>0?"justify-between":"justify-end"} space-x-3`,children:[y>0&&t.jsx("button",{onClick:z,type:"button",className:"px-5 py-2 bg-white text-gray-700 font-semibold rounded-lg border-2 border-gray-200  shadow-sm hover:shadow-lg transform hover:scale-105 transition-all duration-300 ",children:"Previous"}),t.jsxs("div",{className:"space-x-3",children:[t.jsx("button",{onClick:m,type:"button",className:"px-5 cursor-pointer py-2 bg-white text-gray-700 font-semibold rounded-lg border-2 border-gray-200  shadow-sm hover:shadow-lg transform hover:scale-105 transition-all duration-300 ",children:"Cancel"}),t.jsx("button",{type:"submit",className:"px-5 cursor-pointer py-2 bg-action font-semibold rounded-lg border-2 border-gray-200 shadow-sm hover:shadow-lg transform hover:scale-105 transition-all duration-300 ",children:g?"Next":"Save"})]})]})]}),t.jsx("div",{className:"mt-2 pt-3  border-t border-gray-100",children:t.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsxs("span",{children:["Tab ",y+1," of ",l.length]}),t.jsx("p",{className:"text-sm text-gray-700 ml-3",children:"All fields marked (*) are required"})]}),t.jsx("div",{className:"flex gap-1",children:l.map(($,A)=>t.jsx("div",{className:`w-2 h-2 rounded-full transition-all duration-300 ${A===y?"bg-action w-6":"bg-gray-300"}`},A))})]})})]},l[y])]})}function Ge({title:e,fields:r,data:i,onSubmit:n=c=>{},onCancel:m=()=>{},methods:x={},sqlOpsUrls:w={},refid:u,module_refid:g}){const c=_e(r,w.operation),[_,l]=I.useState({}),y=(d,p)=>{l(b=>({...b,[d]:p}))},{initialValues:F,validationSchema:E}=I.useMemo(()=>{const d={},p={};return c.forEach(b=>{se([b],d,p,i,g,w.operation)}),{initialValues:d,validationSchema:p}},[c,i]),C=oe.useFormik({initialValues:F,enableReinitialize:!0,validationSchema:q.object().shape(E),onSubmit:d=>{n(d)}});return t.jsx("div",{className:"relative z-10 max-w-full  m-4",children:t.jsx("div",{className:"bg-white border border-gray-100 rounded-md animate-in fade-in duration-300",children:t.jsxs("form",{onSubmit:C.handleSubmit,className:"p-4  mx-auto",children:[t.jsx("div",{className:"grid grid-cols-12 gap-4",children:c.map((d,p)=>ue(d.hidden)||d.type==="geolocation"||d.vmode==="edit"&&w.operation==="create"?null:t.jsx("div",{className:`col-span-12 md:col-span-6 ${le[ce(Number(d.width))]||"lg:col-span-4"}`,children:t.jsx(he,{refid:u,module_refid:g,sqlOpsUrls:w,field:d,formik:C,methods:x,setFieldOptions:y,..._[d.name]?{optionsOverride:_[d.name]}:{}})},d?.name??`field-${p}`))}),t.jsxs("div",{className:"mt-8 flex justify-between space-x-3",children:[t.jsx("p",{className:"text-sm text-gray-700",children:"All fields marked (*) are required"}),t.jsxs("div",{className:"space-x-3",children:[t.jsx("button",{type:"button",onClick:m,className:"px-5 py-2 bg-white text-gray-700 font-semibold rounded-lg border-2 border-gray-200  shadow-sm hover:shadow-lg transform hover:scale-105 transition-all duration-300 cursor-pointer",children:"Cancel"}),t.jsx("button",{type:"submit",className:"px-5 py-2 bg-action font-semibold rounded-lg border-2 border-gray-200 shadow-sm hover:shadow-lg transform hover:scale-105 transition-all duration-300 cursor-pointer",children:"Save"})]})]})]})})})}function Ye({title:e,children:r}){return t.jsx("div",{className:"group relative mt-1",children:t.jsxs("div",{className:"relative bg-white rounded-lg border border-gray-100 shadow-sm hover:shadow-lg transition-all duration-300 overflow-hidden ",children:[t.jsx("button",{className:"w-full bg-gray-50 flex justify-between items-center px-6 py-3 b text-left transition-all duration-300 ",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-3 h-3 rounded-full transition-all duration-300 bg-action"}),t.jsx("h3",{className:"text-md font-semibold bg-gradient-to-r from-gray-800 to-gray-600 bg-clip-text text-transparent",children:e})]})}),t.jsx("div",{className:`transition-all duration-500 ease-in-out overflow-hidden max-h-[2000px] opacity-100'
            }`,children:t.jsx("div",{className:"px-6 pb-6 bg-gradient-to-br from-gray-50/50 to-white",children:t.jsx("div",{className:"space-y-5 pt-4",children:r})})})]})})}function We({title:e,groupedFields:r,data:i,onSubmit:n=_=>{},onCancel:m=()=>{},methods:x={},components:w={},sqlOpsUrls:u={},refid:g,module_refid:c}){const[_,l]=I.useState({}),y=(d,p)=>{l(b=>({...b,[d]:p}))},{initialValues:F,validationSchema:E}=I.useMemo(()=>{const d={},p={};return Object.values(r).flat().forEach(b=>{se([b],d,p,i,c,u.operation)}),{initialValues:d,validationSchema:p}},[r,i,c,u.operation]),C=oe.useFormik({initialValues:F,enableReinitialize:!0,validationSchema:q.object().shape(E),onSubmit:d=>{n(d)}});return t.jsx("div",{className:"relative z-10 max-w-full  m-4",children:t.jsx("div",{className:"bg-white animate-in fade-in duration-300",children:t.jsxs("form",{onSubmit:C.handleSubmit,className:"p-4 mx-auto",children:[t.jsx("div",{className:"space-y-2",children:r&&Object.entries(r).map(([d,p],b)=>t.jsx(Ye,{title:d,children:t.jsx("div",{className:"grid grid-cols-12 gap-4",children:p.map((S,j)=>ue(S.hidden)||S.type==="geolocation"||S.vmode==="edit"&&u.operation==="create"?null:t.jsx("div",{className:`col-span-12 md:col-span-6 ${le[ce(Number(S.width))]||"lg:col-span-4"}`,children:t.jsx(he,{refid:g,module_refid:c,sqlOpsUrls:u,components:w,field:S,formik:C,methods:x,setFieldOptions:y,..._[S.name]?{optionsOverride:_[S.name]}:{}},S.name)},S?.name??`field-${j}`))})},d))}),t.jsxs("div",{className:"mt-8 flex justify-between space-x-3",children:[t.jsx("p",{className:"px-4 pt-4 text-sm text-secondary",children:"All fields marked (*) are required"}),t.jsxs("div",{className:"space-x-3",children:[t.jsx("button",{type:"button",onClick:m,className:"px-5 py-2 bg-white text-gray-700 font-semibold rounded-lg border-2 border-gray-200  shadow-sm hover:shadow-lg transform hover:scale-105 transition-all duration-300 ",children:"Cancel"}),t.jsx("button",{type:"submit",className:"px-5 py-2 bg-action font-semibold rounded-lg border-2 border-gray-200 shadow-sm hover:shadow-lg transform hover:scale-105 transition-all duration-300 ",children:"Save"})]})]})]})})})}function He({formJson:e={title:"",fields:{},source:{}},methods:r={},userid:i=null,onCancel:n=()=>{},components:m={},callback:x=()=>{},initialvalues:w={}}){let u=Ce(e);const g=e.endPoints,c=e?.source?.refid,_=Fe(e?.fields??{},g?.operation),[l,y]=I.useState(w),F=I.useMemo(()=>Re(e.fields),[e.fields]);I.useEffect(()=>{let d=!0;return(async()=>{const b=e?.source??{};if(!b?.type){d&&y({});return}if(b.type==="method"){const S=b.method,j=S?r[S]:void 0;if(j)try{const R=await Promise.resolve(j());d&&y(R??{})}catch(R){console.error("Method execution failed:",R),d&&y({})}else d&&y({})}if(b.type==="api"&&g?.operation!=="create")try{const S=await V({method:b.method||"GET",url:b.url??"",data:b.body??{},params:b.params??{},headers:b.headers??{}});d&&y(S.data??{})}catch(S){console.error("API fetch failed:",S),d&&y({})}if(b.type==="sql"&&b.refid&&b.refid!=="0"&&g?.operation!=="create"||g?.operation!=="create"&&b.dbopsid){if(!g){console.error("SQL source requires formJson.endPoints but it is missing");return}try{const S=await De.fetch(g,{source:{...b,table:b.table,columns:b.columns,where:Q(b.where,{refid:c})},fields:ye(e.fields,g.operation)},b?.dbopsid,e?.module_refid);d&&y(S)}catch(S){console.error("API fetch failed:",S)}}})(),()=>{d=!1}},[i,e?.source?.type||"",e?.source?.method||"",e?.source?.url||"",JSON.stringify(e?.source?.params??{}),JSON.stringify(e?.source?.body??{}),JSON.stringify(e?.source?.headers??{})]);const E=async d=>{const p=e?.source??{};let b=null;if(F.length>0)try{b=await Pe()}catch(j){console.error("catch fetchGeolocation",j),b=null}const S={...d,...Object.fromEntries(F.map(j=>[j,b]))};if(p.type==="method"){const j=p.method,R=j?r[j]:void 0;if(R)try{const P=await Promise.resolve(R(S));if(x?.(P),r?.handleActions){let k=g?.operation==="update"?c:P?.data?.refid;const z=e?.gotolink?.replace("{hashid}",String(k));r.handleActions(z)}}catch(P){x?.(P),console.error("Method execution failed:",P)}}if(p.type==="api"){if(!g){console.error("SQL source requires formJson.endPoints but it is missing");return}try{const j=await V({method:p.method||"POST",url:g.baseURL+p.endpoint,data:S??{},headers:{Authorization:`Bearer ${g?.accessToken}`}});if(x?.(j),r?.handleActions){let R=g.operation==="update"?c:j?.data?.refid;const P=e?.gotolink?.replace("{hashid}",String(R));r.handleActions(P)}}catch(j){x?.(j),console.error("API fetch failed:",j)}}if(p.type==="sql"){const j=e.endPoints;if(!j){console.error("SQL source requires formJson.endPoints but it is missing");return}try{let R=!1,P;p?.dbopsid&&(R=!0,P=p?.dbopsid);const k=await V({method:"GET",url:j.baseURL+j.dbopsGetHash,headers:{Authorization:`Bearer ${j?.accessToken}`}});if(!R){let $={...p};p.where&&($={...p,where:Q(p.where,{refid:c})}),P=(await V({method:"POST",url:j.baseURL+j.dbopsGetRefId,data:{operation:j.operation,source:$,fields:ye(e.fields,j.operation),forcefill:e.forcefill,datahash:k.data.refhash,srcid:e?.module_refid},headers:{Authorization:`Bearer ${j?.accessToken}`}}))?.data.refid}const z=await V({method:"POST",url:j.baseURL+j[j.operation==="update"?"dbopsUpdate":"dbopsCreate"],data:{refid:P,fields:S,datahash:k.data.refhash},headers:{Authorization:`Bearer ${j?.accessToken}`}});if(x?.(z),r?.handleActions){let $=j.operation==="update"?c:z?.data?.refid;const A=e?.gotolink?.replace("{hashid}",String($));r.handleActions(A)}}catch(R){x?.(R),console.error("API fetch failed:",R)}}},C={accordion:t.jsx(Be,{title:e?.title??"",groupedFields:_,data:l,onSubmit:E,onCancel:n,methods:r,components:m,sqlOpsUrls:g,refid:c,module_refid:e?.module_refid}),cards:t.jsx(We,{title:e?.title??"",groupedFields:_,data:l,onSubmit:E,onCancel:n,methods:r,components:m,sqlOpsUrls:g,refid:c,module_refid:e?.module_refid}),tab:t.jsx(Ke,{title:e?.title??"",groupedFields:_,data:l,onSubmit:E,onCancel:n,methods:r,components:m,widget:e?.widget,sqlOpsUrls:g,refid:c,module_refid:e?.module_refid}),simple:t.jsx(Ge,{title:e?.title??"",fields:e.fields,data:l,onSubmit:E,onCancel:n,methods:r,components:m,sqlOpsUrls:g,refid:c,module_refid:e?.module_refid})};return t.jsx("div",{className:"relative",children:C[u]??C.simple})}W.LogiksForm=He,Object.defineProperty(W,Symbol.toStringTag,{value:"Module"})});
