(function(Q,S){typeof exports=="object"&&typeof module<"u"?S(exports,require("react"),require("axios"),require("yup"),require("formik"),require("@tinymce/tinymce-react")):typeof define=="function"&&define.amd?define(["exports","react","axios","yup","formik","@tinymce/tinymce-react"],S):(Q=typeof globalThis<"u"?globalThis:Q||self,S(Q.LogiksForm={},Q.React,Q.axios,Q.Yup,Q.formik,Q.tinymceReact))})(this,function(Q,S,K,Re,de,ke){"use strict";function Me(e){const r=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const o in e)if(o!=="default"){const n=Object.getOwnPropertyDescriptor(e,o);Object.defineProperty(r,o,n.get?n:{enumerable:!0,get:()=>e[o]})}}return r.default=e,Object.freeze(r)}const q=Me(Re);var he={exports:{}},ae={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fe;function Le(){if(fe)return ae;fe=1;var e=Symbol.for("react.transitional.element"),r=Symbol.for("react.fragment");function o(n,m,c){var x=null;if(c!==void 0&&(x=""+c),m.key!==void 0&&(x=""+m.key),"key"in m){c={};for(var d in m)d!=="key"&&(c[d]=m[d])}else c=m;return m=c.ref,{$$typeof:e,type:n,key:x,ref:m!==void 0?m:null,props:c}}return ae.Fragment=r,ae.jsx=o,ae.jsxs=o,ae}var se={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ve;function ze(){return ve||(ve=1,process.env.NODE_ENV!=="production"&&function(){function e(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===k?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case P:return"Fragment";case T:return"Profiler";case O:return"StrictMode";case N:return"Suspense";case F:return"SuspenseList";case D:return"Activity"}if(typeof a=="object")switch(typeof a.tag=="number"&&console.error("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),a.$$typeof){case f:return"Portal";case b:return(a.displayName||"Context")+".Provider";case l:return(a._context.displayName||"Context")+".Consumer";case y:var i=a.render;return a=a.displayName,a||(a=i.displayName||i.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case _:return i=a.displayName||null,i!==null?i:e(a.type)||"Memo";case L:i=a._payload,a=a._init;try{return e(a(i))}catch{}}return null}function r(a){return""+a}function o(a){try{r(a);var i=!1}catch{i=!0}if(i){i=console;var g=i.error,j=typeof Symbol=="function"&&Symbol.toStringTag&&a[Symbol.toStringTag]||a.constructor.name||"Object";return g.call(i,"The provided key is an unsupported type %s. This value must be coerced to a string before using it here.",j),r(a)}}function n(a){if(a===P)return"<>";if(typeof a=="object"&&a!==null&&a.$$typeof===L)return"<...>";try{var i=e(a);return i?"<"+i+">":"<...>"}catch{return"<...>"}}function m(){var a=s.A;return a===null?null:a.getOwner()}function c(){return Error("react-stack-top-frame")}function x(a){if(R.call(a,"key")){var i=Object.getOwnPropertyDescriptor(a,"key").get;if(i&&i.isReactWarning)return!1}return a.key!==void 0}function d(a,i){function g(){W||(W=!0,console.error("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://react.dev/link/special-props)",i))}g.isReactWarning=!0,Object.defineProperty(a,"key",{get:g,configurable:!0})}function h(){var a=e(this.type);return Y[a]||(Y[a]=!0,console.error("Accessing element.ref was removed in React 19. ref is now a regular prop. It will be removed from the JSX Element type in a future release.")),a=this.props.ref,a!==void 0?a:null}function u(a,i,g,j,I,z,v,w){return g=z.ref,a={$$typeof:A,type:a,key:i,props:z,_owner:I},(g!==void 0?g:null)!==null?Object.defineProperty(a,"ref",{enumerable:!1,get:h}):Object.defineProperty(a,"ref",{enumerable:!1,value:null}),a._store={},Object.defineProperty(a._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(a,"_debugInfo",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(a,"_debugStack",{configurable:!1,enumerable:!1,writable:!0,value:v}),Object.defineProperty(a,"_debugTask",{configurable:!1,enumerable:!1,writable:!0,value:w}),Object.freeze&&(Object.freeze(a.props),Object.freeze(a)),a}function C(a,i,g,j,I,z,v,w){var E=i.children;if(E!==void 0)if(j)if(H(E)){for(j=0;j<E.length;j++)p(E[j]);Object.freeze&&Object.freeze(E)}else console.error("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else p(E);if(R.call(i,"key")){E=e(a);var M=Object.keys(i).filter(function(G){return G!=="key"});j=0<M.length?"{key: someKey, "+M.join(": ..., ")+": ...}":"{key: someKey}",re[E+j]||(M=0<M.length?"{"+M.join(": ..., ")+": ...}":"{}",console.error(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,j,E,M,E),re[E+j]=!0)}if(E=null,g!==void 0&&(o(g),E=""+g),x(i)&&(o(i.key),E=""+i.key),"key"in i){g={};for(var B in i)B!=="key"&&(g[B]=i[B])}else g=i;return E&&d(g,typeof a=="function"?a.displayName||a.name||"Unknown":a),u(a,E,z,I,m(),g,v,w)}function p(a){typeof a=="object"&&a!==null&&a.$$typeof===A&&a._store&&(a._store.validated=1)}var $=S,A=Symbol.for("react.transitional.element"),f=Symbol.for("react.portal"),P=Symbol.for("react.fragment"),O=Symbol.for("react.strict_mode"),T=Symbol.for("react.profiler"),l=Symbol.for("react.consumer"),b=Symbol.for("react.context"),y=Symbol.for("react.forward_ref"),N=Symbol.for("react.suspense"),F=Symbol.for("react.suspense_list"),_=Symbol.for("react.memo"),L=Symbol.for("react.lazy"),D=Symbol.for("react.activity"),k=Symbol.for("react.client.reference"),s=$.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,R=Object.prototype.hasOwnProperty,H=Array.isArray,V=console.createTask?console.createTask:function(){return null};$={"react-stack-bottom-frame":function(a){return a()}};var W,Y={},X=$["react-stack-bottom-frame"].bind($,c)(),Z=V(n(c)),re={};se.Fragment=P,se.jsx=function(a,i,g,j,I){var z=1e4>s.recentlyCreatedOwnerStacks++;return C(a,i,g,!1,j,I,z?Error("react-stack-top-frame"):X,z?V(n(a)):Z)},se.jsxs=function(a,i,g,j,I){var z=1e4>s.recentlyCreatedOwnerStacks++;return C(a,i,g,!0,j,I,z?Error("react-stack-top-frame"):X,z?V(n(a)):Z)}}()),se}var je;function _e(){return je||(je=1,process.env.NODE_ENV==="production"?he.exports=Le():he.exports=ze()),he.exports}var t=_e();const De=["jpg","jpeg","png","gif","svg","webp"],Ve=["mp4","webm","ogg"],Be=["txt","json","csv"],Ke=["pdf"];function qe(e){return e.template==="accordion"?"accordion":e.template==="simple"?"simple":e.template==="cards"?"cards":Object.values(e.fields||{}).some(n=>n.group)?"tab":"simple"}function Ge(e,r="create",o="Info"){const n={};let m=!1;if(Object.values(e).forEach(x=>{x.group&&(m=!0)}),!m)return{};const c=[];return Object.entries(e).forEach(([x,d])=>{if(d.vmode==="edit"&&r==="create")return;const h={...d,name:x};if(d.group){const u=d.group;n[u]||(n[u]=[]),n[u].push(h)}else c.push(h)}),c.length>0?{[o]:c,...n}:n}function we(e,r="create"){const o={};return Object.keys(e).forEach(n=>{e[n].vmode==="edit"&&r==="create"||(o[n]={label:n,required:e[n].required??!1})}),o}const ne=(e,r,o,n,m,c)=>{const x=c==="create"&&m?Ae(m):{};e.forEach(d=>{const h=d?.name;if(!h)return;let u=n?.[h];const C=c==="create"&&m?Ee(d):null;c==="create"&&C&&x[C]!==void 0&&u==null&&(u=x[C]),u==null&&(u=d.default),d.multiple===!0||d.type==="checkbox"||d.type==="tags"?r[h]=Array.isArray(u)?u:typeof u=="string"?u.split(",").map($=>$.trim()).filter(Boolean):[]:d.type==="json"?r[h]=typeof u=="object"&&u!==null?JSON.stringify(u,null,2):u??"":d.type==="date"?r[h]=typeof u=="string"?u.slice(0,10):"":d.type==="time"?typeof u=="string"?u.includes("T")?r[h]=u.slice(11,16):r[h]=u.slice(0,5):r[h]="":h==="blocked"||h==="blacklist"?r[h]=String(u??"false"):r[h]=u??"";let p;d.type==="file"?p=d.multiple?q.array().of(q.mixed()):q.mixed():d.multiple===!0||d.type==="checkbox"||d.type==="tags"?p=q.array().of(q.string()):d.type==="email"?p=q.string().email("Invalid email"):d.type==="number"?p=q.number().typeError("Must be a number"):d.type==="json"?p=q.string().test("json","Invalid JSON",$=>{if(!$)return!0;try{return JSON.parse($),!0}catch{return!1}}):p=q.string(),d.required&&(p=p.required(d.error_message||`${d.label||h} is required`)),d?.validate?.regex&&typeof d.validate.regex=="string"&&(p=p.matches(new RegExp(d?.validate?.regex),d?.error_message||"Invalid input format")),d?.validate&&Object.entries(d.validate).forEach(([$,A])=>{switch($){case"email":A&&(p=p.email("Invalid email format"));break;case"mobile":p=p.matches(/^[1-9][0-9]*$/,"Invalid mobile number format");break;case"regex":p=p.matches(new RegExp(A),`Must match pattern: ${A}`);break;case"date":p=q.date().typeError("Invalid date format (expected dd/MM/yyyy or dd-MM-yyyy)").transform((f,P)=>{if(typeof P=="string"){const O=P.replace(/-/g,"/"),[T,l,b]=O.split("/");if(T&&l&&b)return new Date(`${b}-${l}-${T}`)}return f});break;case"time":p=p.matches(/^([0-1][0-9]|2[0-3])[:\-]([0-5][0-9])$/,"Invalid time format (HH:MM)");break;case"timesec":p=p.matches(/^([0-1][0-9]|2[0-3]):([0-5][0-9]):([0-5][0-9])$/,"Invalid time format (HH:MM:SS)");break;case"number":case"numeric":p=q.number().typeError("Must be numeric");break;case"float":case"decimal":p=q.number().typeError("Must be a decimal").transform((f,P)=>{if(P==null||P==="")return;const O=Number(P);if(isNaN(O))return f;if(typeof f=="number"&&!isNaN(f)){const T=Number(f);return Number.isInteger(T)?Number(O.toFixed(T)):O}return O});break;case"alphanumeric":p=p.matches(/^[a-z0-9]+$/i,"Must be alphanumeric");break;case"alpha":p=p.matches(/^[a-zA-Z]+$/,"Must contain only letters");break;case"upper":p=p.transform(f=>f&&f.toUpperCase());break;case"lower":p=p.transform(f=>f&&f.toLowerCase());break;case"length-min":{const f=Number(A);isNaN(f)||(p=p.min(f,`Minimum length is ${f}`));break}case"length-max":{const f=Number(A);isNaN(f)||(p=p.max(f,`Maximum length is ${f}`));break}}}),o[h]=p})},oe={12:"lg:col-span-12",11:"lg:col-span-11",10:"lg:col-span-10",9:"lg:col-span-9",8:"lg:col-span-8",7:"lg:col-span-7",6:"lg:col-span-6",5:"lg:col-span-5",4:"lg:col-span-4",3:"lg:col-span-3",2:"lg:col-span-2",1:"lg:col-span-1"};function ie(e){return[1,2,3,4,5,6,7,8,9,10,11,12].includes(e)?e:6}const me=e=>e===!0||e==="true",U=(e,r)=>typeof e=="string"?e.replace(/#(\w+)#/g,(o,n)=>r[n]!==void 0?String(r[n]):o):Array.isArray(e)?e.map(o=>U(o,r)):e&&typeof e=="object"?Object.fromEntries(Object.entries(e).map(([o,n])=>[U(o,r),U(n,r)])):e,ee=(e,r,o,n)=>{if(!Array.isArray(o)||o.length===0)return{};const m=n??(o[0]&&typeof o[0]=="object"&&"category"in o[0]?"category":void 0);if(!m){const x={};return o.forEach(d=>{const h=d[e],u=d[r];h!=null&&u!=null&&(x[String(h)]=String(u))}),x}const c={};return o.forEach(x=>{const d=x[m]??"Others",h=x[e],u=x[r];h==null||u==null||(c[d]||(c[d]={}),c[d][String(h)]=String(u))}),c},xe=(e,r)=>{if(!e||r==null)return;const o=String(r);if(typeof Object.values(e)[0]=="string")return e[o];for(const m of Object.values(e))if(o in m)return m[o]},Ye=e=>{if(!e)return[];if(Array.isArray(e))return e.map(n=>[String(n.value),String(n.title??n.label??n.value)]);const r=Object.values(e);return r.length?typeof r[0]=="string"?Object.entries(e).map(([n,m])=>[String(n),m]):Object.values(e).flatMap(n=>Object.entries(n).map(([m,c])=>[String(m),c])):[]},Ne=e=>{if(!e||typeof e!="object")return!1;const r=Object.values(e)[0];return typeof r=="object"&&r!==null&&!Array.isArray(r)};async function We(){if(!("geolocation"in navigator))throw new Error("Geolocation is not supported by this browser. You cannot access this portal.");try{const e=await new Promise((n,m)=>{navigator.geolocation.getCurrentPosition(n,m,{enableHighAccuracy:!1,timeout:3e4,maximumAge:12e4})}),{latitude:r,longitude:o}=e.coords;return`${r},${o}`}catch(e){if(!(e instanceof GeolocationPositionError))throw new Error("Failed to get your location.");switch(e.code){case e.PERMISSION_DENIED:throw new Error("Please allow location access in browser settings.");case e.POSITION_UNAVAILABLE:throw new Error("Unable to detect your location. Try connecting to Wi-Fi.");case e.TIMEOUT:throw new Error("Your device took too long to fetch GPS position.");default:throw new Error("Failed to get your location.")}}}const He=e=>Object.entries(e??{}).filter(([,r])=>r.type==="geolocation").map(([r])=>r);function Qe(e,r="create"){return Object.entries(e).filter(([,o])=>!(o.vmode==="edit"&&r==="create")).map(([o,n])=>({...n,name:o}))}function le(e,r,o){const n=Ee(r);n&&o&&Je(o,n,e)}function Ue(e){return typeof e=="object"&&e!==null&&typeof e.target=="string"&&typeof e.src=="object"&&e.src!==null&&typeof e.src.table=="string"}function Xe(e){return e.split(",").map(r=>r.trim()).map(r=>{const o=r.match(/^(.+?)\s+as\s+.+$/i);return o?o[1]?.trim():r}).filter(r=>!!r)}const te=e=>{if(e==null||typeof e!="object")return{value:e,title:e};const r={};for(const[o,n]of Object.entries(e)){const m=o.includes(".")?o.split(".").pop():o;if(m in r){console.warn(`Duplicate key after normalization: ${m}`);continue}r[m]=n}return r},Ze="__form_persist__",Se=e=>`${Ze}:${e}`;function Ee(e){return e.persistent?e.persistent===!0?e.name:typeof e.persistent=="string"?e.persistent:null:null}function Ae(e){try{return JSON.parse(localStorage.getItem(Se(e))||"{}")}catch{return{}}}function Je(e,r,o){const n=Ae(e);localStorage.setItem(Se(e),JSON.stringify({...n,[r]:o}))}function et(e=""){return e.split(".").pop()?.toLowerCase()??""}function tt(e){return De.includes(e)?"image":Ve.includes(e)?"video":Ke.includes(e)?"pdf":Be.includes(e)?"text":"other"}const $e={image:"fa fa-file-image",pdf:"fa fa-file-pdf",video:"fa fa-file-video",text:"fa fa-file-lines",other:"fa fa-file"},ce=e=>({Authorization:`Bearer ${e.accessToken}`}),be=async e=>(await K.get(e.baseURL+e.dbopsGetHash,{headers:ce(e)})).data.refhash,ye=async(e,r)=>(await K.post(e.baseURL+e.dbopsGetRefId,r,{headers:ce(e)})).data.refid,rt={async fetch(e,r,o,n){const m=await be(e);let c=!1,x;o&&(c=!0,x=o),c||(x=await ye(e,{operation:"fetch",source:r.source,fields:r.fields??{},datahash:m,srcid:n}));const d=await K.post(e.baseURL+e.dbopsFetch,{refid:x,datahash:m},{headers:ce(e)});return d.data?.data??d.data},async create(e,r,o){const n=await be(e),m=await ye(e,{operation:"create",source:r.source,fields:r.values,datahash:n,srcid:o});return(await K.post(e.baseURL+e.dbopsCreate,{refid:m,fields:r.values,datahash:n},{headers:ce(e)})).data},async update(e,r,o){const n=await be(e),m=await ye(e,{operation:"update",source:r.source,fields:r.values,datahash:n,srcid:o});return(await K.post(e.baseURL+e.dbopsUpdate,{refid:m,fields:r.values,datahash:n},{headers:ce(e)})).data}};async function pe(e,r,o,n=void 0,m=void 0,c={}){try{let x=o;return x||(x=(await K({method:"POST",url:e.baseURL+e.registerQuery,data:{query:r??{},srcid:m},headers:{Authorization:`Bearer ${e?.accessToken}`}})).data.queryid),await K({method:"POST",url:e.baseURL+e.runQuery,data:{queryid:x,filter:c,refid:n,page:0,limit:1e4},headers:{Authorization:`Bearer ${e?.accessToken}`}})}catch(x){throw x}}async function Fe(e,r){let o=r.previewPath??"/api/files/preview";const n=await K.get(`${r.baseURL}${o}?uri=${encodeURIComponent(e)}`,{responseType:"blob",headers:{Authorization:`Bearer ${r?.accessToken}`}});return URL.createObjectURL(n.data)}async function Ce(e,r){if(!e?.uploadURL)throw new Error("Upload URL missing");const o=e.baseURL+e.uploadURL;return Promise.all(Array.from(r).map(async n=>{const m=new FormData;return m.append("file",n),(await K.post(o,m,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${e.accessToken}`}})).data}))}function at({field:e,formik:r,methods:o={},sqlOpsUrls:n,refid:m,module_refid:c="menuManager.main",optionsOverride:x,setFieldOptions:d}){const[h,u]=S.useState(!1),[C,p]=S.useState(x??e.options??{});S.useRef(null);const $=S.useRef(null),[A,f]=S.useState(""),[P,O]=S.useState(0),T=S.useRef(null),l=S.useRef(null),[b,y]=S.useState(!1),N=S.useRef(A),F=e.disabled===!0;S.useEffect(()=>{N.current=A},[A]);const _=i=>{if(F){i.preventDefault(),l.current?.removeAttribute("open");return}i.currentTarget.open||f("")};S.useEffect(()=>{x&&Object.keys(x).length!==0&&p(x)},[x]),S.useEffect(()=>{const i=g=>{l.current&&!l.current.contains(g.target)&&(l.current.open=!1,f(""))};return document.addEventListener("mousedown",i),()=>{document.removeEventListener("mousedown",i)}},[]);const L=e.name;S.useEffect(()=>{let i=!0;return(async()=>{let j=e.valueKey??"value",I=e.labelKey??"title";if(e?.options){if(typeof e.options=="object"&&!Array.isArray(e.options)){const M=Object.values(e.options);if(M.length&&typeof M[0]=="string"){p(e.options);return}}const w=(Array.isArray(e.options)?e.options:[e.options]).map(te),E=ee(j,I,w,e.groupKey);p(E);return}const z=e?.source??{};if(e.type==="dataMethod"){const v=e.method,w=v?o[v]:void 0;if(w)try{const E=await w(),M=Array.isArray(E?.data?.data)?E.data.data:Array.isArray(E?.data)?E.data:E;if(typeof M=="object"&&!Array.isArray(M)){const J=Object.values(M);if(J.length&&typeof J[0]=="string"){p(M);return}}const B=Array.isArray(M)?M.map(te):[],G=ee(j,I,B,e.groupKey);i&&p(G)}catch(E){console.error("Method execution failed:",E),i&&p({})}else i&&p({})}if(z.type==="api"&&z.url)try{const v=await K({method:z.method||"GET",url:z.url,data:z.body??{},params:z.params??{},headers:z.headers??{}}),w=Array.isArray(v?.data?.data)?v.data.data:Array.isArray(v?.data)?v.data:v;if(typeof w=="object"&&!Array.isArray(w)){const B=Object.values(w);if(B.length&&typeof B[0]=="string"){p(w);return}}const E=Array.isArray(w)?w.map(te):[],M=ee(j,I,E,e.groupKey);i&&p(M)}catch(v){console.error("API execution failed:",v),i&&p({})}if(e.table||e.type==="dataSelector"||e.queryid){if(!n){console.error("SQL source requires formJson.endPoints but it is missing");return}try{let v;if(e.type==="dataSelector")v={table:"do_lists",cols:"title,value",where:{groupid:e.groupid??""}};else if(!e.queryid){if(!e.table||!e.columns){console.error("Invalid SQL field config",e);return}v={table:e.table,cols:e.columns,where:e.where?m?U(e.where,{refid:m}):e.where:void 0}}const w=await pe(n,v,e?.queryid,void 0,c),E=Array.isArray(w?.data?.data)?w.data.data:Array.isArray(w?.data)?w.data:w;if(typeof E=="object"&&!Array.isArray(E)){const G=Object.values(E);if(G.length&&typeof G[0]=="string"){p(E);return}}const M=Array.isArray(E)?E.map(te):[],B=ee(j,I,M,e.groupKey);i&&p(B)}catch(v){console.error("API fetch failed:",v)}}})(),()=>{i=!1}},[e.options,e.source,e.table,e.columns,e.where,m,e.queryid,e.groupKey,e.valueKey,e.labelKey]);const D=`
  w-full px-4 py-2 rounded-lg border transition-all duration-300
  backdrop-blur-sm text-gray-800 placeholder-gray-400
  focus:outline-none focus:ring-0

  ${F?"bg-gray-100 border-gray-200 text-gray-500 cursor-not-allowed":"bg-white border-gray-300 hover:border-gray-400 focus:border-indigo-500 focus:shadow-md"}
`,k=`
    border-gradient-to-r 
    focus:border-gray-400 focus:shadow-lg focus:shadow-gray-100/50
  `,s=`
    block text-sm font-semibold mb-1  transition-all duration-300 text-gray-700
  `,R=S.useMemo(()=>Ye(C),[C]),H=R.length,V=S.useMemo(()=>e.search||!A?R:R.filter(([,i])=>i.toLowerCase().includes(A.toLowerCase())),[e.search,A,R]),W=(i,g)=>{if(l.current?.open===!0||b===!0)if(i.key==="ArrowDown")i.preventDefault(),O(j=>j+1<V.length?j+1:0);else if(i.key==="ArrowUp")i.preventDefault(),O(j=>j-1>=0?j-1:V.length-1);else if(i.key==="Enter"){i.preventDefault();const[j]=V[P]||[];if(j){let I=g?j:[...r.values[e.name],j];r.setFieldValue(e.name,I),le(I,e,c)}l.current&&(l.current.open=!1)}else i.key==="Escape"&&(l.current.open=!1,f(""),y(!1))};S.useEffect(()=>{T.current?.querySelector(`[data-index="${P}"]`)?.scrollIntoView({block:"nearest"})},[P]),S.useEffect(()=>{P>=V.length&&O(0)},[V,P]),S.useEffect(()=>{const i=e.autocomplete,g=e.ajaxchain;if(!i&&!g)return;const j=r.values[e.name];if(!j)return;const I=Array.isArray(g)?g:g?[g]:[];(async()=>{try{if(Ue(i)){const v=i.src;if(!v||!n)return;const w=U(v.where??{},{refid:j}),E={...v,table:v.table,cols:v.columns,where:w},{data:M}=await pe(n,E,e?.queryid,void 0,c),B=Array.isArray(M?.data)?M.data[0]:M?.data;B&&i.target.split(",").map(G=>G.trim()).forEach(G=>{B[G]!==void 0&&r.setFieldValue(G,B[G])})}for(const v of I){const w=v.src;if(!v||typeof v!="object"||!w||typeof w!="object"||!n)continue;let E;if(!w.queryid){if(!w.table||!w.columns)throw new Error("SQL query requires field.table");const bt=U(w?.where??{},{refid:j});E={...w,table:w.table,cols:w.columns,where:bt}}const{data:M}=await pe(n,E,w?.queryid,j,c);let B=e.valueKey??"value",G=e.labelKey??"title";const J=Array.isArray(M?.data?.data)?M.data.data:Array.isArray(M?.data)?M.data:M,gt=Array.isArray(J)?J.map(te):[],xt=ee(B,G,gt,e.groupKey);d?.(v.target,xt)}}catch(v){console.error("Autocomplete / AjaxChain fetch failed",v)}})()},[r.values[e.name]]),S.useEffect(()=>{if(!e.search||!A.trim()||!e.table||!n)return;const i=Xe(e.columns??""),g=new AbortController,j=setTimeout(async()=>{try{let I;if(!e.queryid){if(!e.table||!e.cols)throw new Error("SQL query requires field.table");const J=m?U(e.where??{},{refid:m}):e.where;I={...e,table:e.table,cols:e.columns||e.cols,where:J}}let z={};Array.isArray(i)&&i.forEach(J=>{z[J]=[A,"LIKE"]});let v=e.valueKey??"value",w=e.labelKey??"title";const{data:E}=await pe(n,I,e?.queryid,void 0,c,z),M=Array.isArray(E?.data?.data)?E.data.data:Array.isArray(E?.data)?E.data:E,B=Array.isArray(M)?M.map(te):[],G=ee(v,w,B,e.groupKey);p(G)}catch(I){if(K.isCancel(I))return;console.error("Search fetch failed",I)}},500);return()=>{clearTimeout(j),g.abort()}},[A,m]);const Y=async i=>{if(i.length===0){console.error("No file");return}try{const g=await Ce(n,i),j=e.multiple?g.map(I=>I.path):g[0]?.path;r.setFieldValue(L,j),le(j,e,c)}catch(g){console.error("File upload failed",g),r.setFieldError(L,"File upload failed")}},X=async(i,g,j)=>{const I=g[i];if(!I)return;const z=o?.[I];if(typeof z!="function"){console.error(`Method "${String(I)}" not found`);return}try{await Promise.resolve(z(j))}catch(v){console.error(`Method "${String(I)}" failed`,v)}},Z=i=>{if(F)return;const g=i.target.value;f(g),O(0),g.trim()?y(!0):(y(!1),r.setFieldValue(L,""))},re=i=>{r.setFieldValue(L,i),le(i,e,c),f(""),y(!1),X("onChange",e,`${L}-${i}`)};function a(i){const g=i.currentTarget.files;g&&Y(g)}return{setHighlightedIndex:O,executeFieldMethod:X,handleFileUpload:Y,handleKeyDown:W,handleToggle:_,setSearch:f,setOpen:y,setIsFocused:u,handleInputChange:Z,handleSelect:re,handlePersist:le,handleFileChange:a,optionCount:H,baseInputClasses:D,focusClasses:k,labelClasses:s,search:A,highlightedIndex:P,options:C,isDisabled:F,key:L,filteredOptions:V,open:b,listRef:T,inputRef:$,detailsRef:l,isFocused:h}}const st=({fileUrl:e,category:r})=>e?r==="image"?t.jsx("img",{src:e,className:"max-h-[80vh] mx-auto"}):r==="pdf"||r==="text"?t.jsx("iframe",{src:e,className:"w-full h-[80vh]"}):r==="video"?t.jsx("video",{controls:!0,className:"w-full max-h-[80vh]",children:t.jsx("source",{src:e})}):t.jsxs("div",{className:"text-center p-4",children:[t.jsx("p",{children:"Preview not available"}),t.jsx("a",{href:e,download:!0,className:"text-blue-600 underline",children:"Download file"})]}):null;function nt(e){const r=$e[e]??$e.other;return t.jsx("i",{className:`${r} text-2xl text-gray-600`})}const ot=({filePath:e,sqlOpsUrls:r})=>{const[o,n]=S.useState(null),[m,c]=S.useState(!1),x=et(e),d=tt(x);S.useEffect(()=>{if(!r||d!=="image"&&!m)return;let u=!0,C=null;return Fe(e,r).then(p=>{u&&(C=p,n(p))}),()=>{u=!1,C&&URL.revokeObjectURL(C)}},[d,m,e,r]);let h=e.split("/").pop();return t.jsxs(t.Fragment,{children:[d==="image"&&o?t.jsx("img",{src:o,alt:h,title:"Click to preview",onClick:()=>c(!0),className:"h-16 w-16 object-cover rounded  cursor-pointer hover:opacity-90"}):t.jsxs("div",{role:"button",tabIndex:0,onClick:()=>c(!0),onKeyDown:u=>u.key==="Enter"&&c(!0),className:"inline-flex cursor-pointer items-center gap-1",title:"Click to preview",children:[nt(d),t.jsx("span",{className:"text-sm",children:h})]}),m&&t.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center",children:t.jsxs("div",{className:"bg-white rounded-lg p-4 max-w-5xl w-full",children:[t.jsx("button",{className:"float-right text-sm",onClick:()=>c(!1),children:"✕"}),o?t.jsx(st,{fileUrl:o,category:d}):t.jsx("div",{className:"text-center p-8",children:"Loading preview…"})]})})]})};function Te({field:e,isDisabled:r,handleToggle:o,detailsRef:n,handleKeyDown:m,valueArray:c,labelClasses:x,listRef:d,search:h,filteredOptions:u,highlightedIndex:C,setSearch:p,formik:$,setHighlightedIndex:A,executeFieldMethod:f,handlePersist:P,module_refid:O,options:T}){const l=e.name;return t.jsxs("div",{className:"relative",children:[t.jsxs("label",{className:x,children:[e.label,e.required&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsxs("details",{className:`relative w-full ${r?" opacity-70":""}`,onToggle:o,ref:n,onKeyDown:b=>{r||m(b,!1)},children:[t.jsxs("summary",{className:`
    select-none border rounded-lg px-4 py-2.5 flex justify-between items-center
    ${r?"bg-gray-100 border-gray-200 text-gray-500 cursor-not-allowed":"bg-white border-gray-300 cursor-pointer"}
  `,children:[t.jsx("span",{className:"text-sm text-gray-700",children:c?.length>0?c.map(b=>xe(T,b)??b).join(", "):`Select ${e.label}`}),t.jsx("svg",{className:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),!r&&t.jsxs("div",{ref:d,className:"absolute mt-1 w-full border border-gray-200 rounded-lg bg-white shadow-md z-10 max-h-60 overflow-y-auto p-2",children:[e.search&&t.jsx("div",{className:"sticky top-0 bg-white p-1",children:t.jsx("input",{type:"text",value:h,onChange:b=>{r||(p(b.target.value),A(0))},placeholder:"Search...",className:`px-2 py-[5px] rounded w-full border border-gray-200 transition-all duration-300 
                bg-white/80 backdrop-blur-sm text-gray-800 placeholder-gray-400
                focus:outline-none focus:ring-0`})}),u.length>0?u.map(([b,y],N)=>t.jsxs("label",{htmlFor:`${l}-${b}`,className:`flex items-center gap-x-2 px-2 py-1 hover:bg-gray-50 rounded cursor-pointer text-sm
                        ${c?.includes(b)?"bg-indigo-50 text-indigo-600 font-medium":C===N?"bg-gray-100":"hover:bg-gray-50"}`,children:[t.jsx("input",{id:`${l}-${b}`,type:"checkbox",checked:c?.includes(b),onChange:F=>{const _=F.target.checked?[...c,b]:c?.filter(L=>L!==b);$.setFieldValue(l,_),P(_,e,O),f("onChange",e,`${l}-${b}`)},onBlur:$.handleBlur,disabled:r,className:"h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),y]},b)):t.jsx("div",{className:"px-2 py-1 text-gray-400 text-sm",children:"No results"})]})]}),$.touched[l]&&$.errors[l]&&t.jsx("span",{className:"text-xs text-red-500 ml-2",children:String($.errors[l])})]})}function it({filePath:e,field_name:r,sqlOpsUrls:o}){const[n,m]=S.useState(null);return S.useEffect(()=>{if(!open||!o)return;let c=!0,x=null;return Fe(e,o).then(d=>{c&&(x=d,m(d))}),()=>{c=!1,x&&URL.revokeObjectURL(x)}},[open,e,o]),n?t.jsx("img",{alt:r,title:r,src:n,className:"h-24 w-24 object-cover rounded border border-dashed  cursor-pointer hover:opacity-90"}):null}function Oe({formik:e,field:r,sqlOpsUrls:o,module_refid:n}){let m=r?.name;const c=S.useRef(null),x=async d=>{const h=d.currentTarget.files;if(!(!h||h.length===0))try{const u=await Ce(o,h),C=r.multiple?u.map(p=>p.path):u[0]?.path;e.setFieldValue(m,C),le(C,r,n)}catch(u){console.error("File upload failed",u),e.setFieldError(m,"File upload failed")}};return t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold mb-1  transition-all duration-300 text-gray-700",children:r.label}),t.jsx("input",{ref:c,type:"file",accept:"image/*",className:"hidden",onChange:x}),t.jsx("div",{onClick:()=>c.current?.click(),children:e.values[m]?t.jsx(it,{field_name:m,filePath:e.values[m],sqlOpsUrls:o}):t.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:t.jsx("i",{className:"fa-solid fa-user"})})})]})}function lt(){return new Promise(e=>{if(window.tinymce){e();return}const r=setInterval(()=>{window.tinymce&&(clearInterval(r),e())},50)})}function ct({value:e,onChange:r,disabled:o=!1}){const[n,m]=S.useState(!1);S.useEffect(()=>{let x=!1;return lt().then(()=>{x||m(!0)}),()=>{x=!0}},[]);const c=S.useMemo(()=>({height:500,menubar:!1,statusbar:!1,branding:!1,promotion:!1,skin:!1,content_css:!1,plugins:["lists","link","image","table","code"],toolbar:"undo redo | bold italic underline | bullist numlist | table | link image | code",table_toolbar:"tableprops tabledelete | tableinsertrowbefore tableinsertrowafter tabledeleterow | tableinsertcolbefore tableinsertcolafter tabledeletecol",content_style:`
        body {
          font-family: Inter, system-ui, sans-serif;
          font-size: 14px;
        }
      `}),[]);return n?t.jsx(ke.Editor,{licenseKey:"gpl",value:e,readonly:o,onEditorChange:r,init:c}):t.jsx("div",{className:"p-3 text-sm text-gray-400 border rounded-lg",children:"Loading editor…"})}function ue({field:e,formik:r,methods:o={},sqlOpsUrls:n,refid:m,module_refid:c="menuManager.main",optionsOverride:x,setFieldOptions:d}){const{setHighlightedIndex:h,executeFieldMethod:u,handleFileUpload:C,handleKeyDown:p,handleToggle:$,setSearch:A,setOpen:f,setIsFocused:P,handleInputChange:O,handleSelect:T,handlePersist:l,optionCount:b,baseInputClasses:y,focusClasses:N,labelClasses:F,search:_,highlightedIndex:L,options:D,isDisabled:k,key:s,filteredOptions:R,open:H,listRef:V,detailsRef:W,isFocused:Y}=at({field:e,formik:r,methods:o,sqlOpsUrls:n,refid:m,module_refid:c,...x&&{optionsOverride:x},...d&&{setFieldOptions:d}}),X=Z=>Z.icon?t.jsx("i",{className:Z.icon}):null;switch(e.type){case"suggest":case"autosuggest":case"autocomplete":{const a=r.values[s]??"",i=_!==""?_:xe(D,a)??String(a??"");return t.jsxs("div",{className:"relative",children:[t.jsxs("label",{className:F,children:[e.label,e.required&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsx("input",{className:`${y} ${N}`,value:i,placeholder:e.placeholder||"Type to search...",onChange:O,onBlur:()=>{setTimeout(()=>f(!1),150)},onKeyDown:g=>{if(g.key==="Enter"){if(g.preventDefault(),R[L]){const[j]=R[L];r.setFieldValue(s,j),l(j,e,c)}else _.trim()&&(r.setFieldValue(s,_.trim()),l(_.trim(),e,c));f(!1);return}p(g,!0)},disabled:k}),H&&!k&&t.jsx("div",{ref:V,className:"absolute z-20 w-full bg-white border rounded shadow max-h-52 overflow-y-auto mt-1",children:R.length>0?R.map(([g,j],I)=>t.jsx("div",{id:`${s}-${g}`,"data-index":I,className:`px-3 py-2 cursor-pointer text-sm
                  ${L===I?"bg-gray-100":"hover:bg-gray-100"}`,onMouseDown:()=>T(g),children:j},g)):t.jsx("div",{className:"px-3 py-2 text-sm text-gray-400",children:`Press "ENTER" to ADD "${i}" `})}),r.touched[s]&&r.errors[s]&&t.jsx("span",{className:"text-xs text-red-500",children:String(r.errors[s])})]})}case"dataSelector":case"dataSelectorFromTable":case"dataSelectorFromUniques":case"dataMethod":{if(e.multiple===!0){const a=r.values[s];return t.jsx(Te,{field:e,isDisabled:k,handleToggle:$,detailsRef:W,handleKeyDown:p,valueArray:a,labelClasses:F,listRef:V,search:_,filteredOptions:R,highlightedIndex:L,setSearch:A,formik:r,executeFieldMethod:u,setHighlightedIndex:h,handlePersist:l,module_refid:c,options:D})}return t.jsxs("div",{className:"relative",children:[t.jsxs("label",{className:F,children:[e.label,e.required&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsxs("details",{className:`relative w-full ${k?"opacity-70":""}`,onToggle:$,ref:W,onKeyDown:a=>{k||p(a,!0)},children:[t.jsxs("summary",{className:`
    select-none border rounded-lg px-4 py-2.5 flex justify-between items-center
    ${k?"bg-gray-100 border-gray-200 text-gray-500 cursor-not-allowed":"bg-white border-gray-300 cursor-pointer"}
  `,children:[t.jsx("span",{className:"text-sm text-gray-700",children:r.values[s]?xe(D,r.values[s])??"Select option":`Select ${e.label}`}),t.jsx("svg",{className:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),!k&&t.jsxs("div",{ref:V,className:"absolute mt-1 w-full border border-gray-200 rounded-lg bg-white shadow-md z-10 max-h-60 overflow-y-auto p-2",children:[e.search&&t.jsx("div",{className:"sticky top-0 bg-white p-1",children:t.jsx("input",{type:"text",value:_,onChange:a=>{A(a.target.value),h(0)},onKeyDown:a=>p(a,!0),placeholder:"Search...",className:`px-2 py-[5px] rounded w-full border border-gray-200 transition-all duration-300 
                  bg-white/80 backdrop-blur-sm text-gray-800 placeholder-gray-400
                  focus:outline-none focus:ring-0`})}),R.length>0&&t.jsx("div",{onClick:a=>{a.preventDefault(),a.stopPropagation(),r.setFieldValue(s,""),l("",e,c),W.current?.removeAttribute("open"),A("")},className:"px-2 py-1 hover:bg-gray-50 rounded cursor-pointer text-sm hover:bg-gray-50",children:"Clear selection"}),R.length>0?R.map(([a,i],g)=>t.jsx("div",{id:`${s}-${a}`,"data-index":g,onClick:j=>{j.preventDefault(),j.stopPropagation(),r.setFieldValue(s,a),l(a,e,c),W.current?.removeAttribute("open"),A(""),h(0),u("onChange",e,`${s}-${a}`)},className:`px-2 py-1 hover:bg-gray-50 rounded cursor-pointer text-sm 
                        ${r.values[s]===a?"bg-indigo-50 text-indigo-600 font-medium":L===g?"bg-gray-100":"hover:bg-gray-50"}`,children:i},a)):t.jsx("div",{className:"px-2 py-1 text-gray-400 text-sm",children:"No results"})]})]}),r.touched[s]&&r.errors[s]&&t.jsx("span",{className:"text-xs text-red-500 ml-2",children:String(r.errors[s])})]})}case"richtextarea":return t.jsxs("div",{className:"relative",children:[t.jsxs("label",{className:F,children:[e.label,e.required&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsx(ct,{value:r.values[s]??"",disabled:k,onChange:a=>{r.setFieldValue(s,a),l(a,e,c),u("onChange",e,s)}}),r.touched[s]&&r.errors[s]&&t.jsx("span",{className:"text-xs text-red-500",children:String(r.errors[s])})]});case"textarea":return t.jsx(t.Fragment,{children:t.jsxs("div",{className:"relative",children:[t.jsxs("label",{className:F,children:[e.label,e.required&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsxs("div",{className:"relative",children:[t.jsx("textarea",{id:s,className:`${y} ${N} min-h-[120px] resize-none`,onFocus:()=>P(!0),name:s,value:r.values[s],onBlur:r.handleBlur,onChange:a=>{r.setFieldValue(s,a.target.value),l(a.target.value,e,c),u("onChange",e,`${s}`)},placeholder:e.placeholder,disabled:k}),t.jsx("div",{className:`absolute inset-0 rounded-lg bg-gradient-to-r from-purple-400 to-indigo-400 opacity-0 transition-opacity duration-300 pointer-events-none ${Y?"opacity-20":""}`,style:{zIndex:-1,filter:"blur(8px)"}})]}),r.touched[s]&&r.errors[s]&&t.jsx("span",{className:"text-xs text-red-500",children:String(r.errors[s])})]})});case"select":if(e.multiple===!0){const a=r.values[s];return t.jsx(Te,{field:e,isDisabled:k,handleToggle:$,detailsRef:W,handleKeyDown:p,valueArray:a,labelClasses:F,listRef:V,search:_,filteredOptions:R,highlightedIndex:L,setSearch:A,formik:r,executeFieldMethod:u,setHighlightedIndex:h,handlePersist:l,module_refid:c,options:D})}return t.jsxs("div",{className:"relative",children:[t.jsxs("label",{className:F,children:[e.label,e.required&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsxs("div",{className:"relative",children:[t.jsxs("select",{className:`${y} ${N} appearance-none ${k?"":"cursor-pointer"} pr-12`,onFocus:()=>P(!0),name:s,id:s,value:r.values[s],onBlur:r.handleBlur,onChange:a=>{r.setFieldValue(s,a.target.value),l(a.target.value,e,c),u("onChange",e,`${s}`)},disabled:k,children:[t.jsx("option",{value:"",disabled:!0,children:e?.["no-option"]||`Please select ${e.label}`}),!Ne(D)&&Object.entries(D).map(([a,i])=>t.jsx("option",{value:a,className:"py-2",children:i},a)),Ne(D)&&Object.entries(D).map(([a,i])=>t.jsx("optgroup",{label:a,children:Object.entries(i).map(([g,j])=>t.jsx("option",{value:g,children:j},g))},a))]}),t.jsx("div",{className:"absolute right-4 top-1/2 transform -translate-y-1/2 pointer-events-none",children:t.jsx("svg",{className:"w-5 h-5 transition-colors duration-300 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),r.touched[s]&&r.errors[s]&&t.jsx("span",{className:"text-xs text-red-500",children:String(r.errors[s])})]});case"radioList":case"radio":return t.jsxs("div",{className:"relative",children:[t.jsxs("label",{className:F,children:[e.label,e.required&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsx("div",{className:`flex ${b>3?"flex-col":""} gap-2 ml-1`,children:Object.entries(D||{}).map(([a,i])=>t.jsxs("label",{htmlFor:`${s}-${a}`,className:"flex items-center gap-x-2 text-sm font-medium text-gray-700 cursor-pointer",children:[t.jsx("input",{id:`${s}-${a}`,type:"radio",name:s,checked:r.values[s]===a,value:a,onChange:g=>{r.setFieldValue(s,g.target.value),l(g.target.value,e,c),u("onChange",e,`${s}-${a}`)},onBlur:r.handleBlur,disabled:k,className:`h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500
                    ${k?"bg-gray-100 border-gray-200 text-gray-500 cursor-not-allowed":""}
                    `}),i]},a))}),r.touched[s]&&r.errors[s]&&t.jsx("span",{className:"text-xs text-red-500 ml-2",children:String(r.errors[s])})]});case"checkbox":{const a=r.values[s];return t.jsxs("div",{className:"relative",children:[t.jsxs("label",{className:F,children:[e.label,e.required&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsx("div",{className:"flex flex-col gap-2 ml-1",children:Object.entries(D||{}).map(([i,g])=>t.jsxs("label",{className:"flex items-center gap-x-2 text-sm font-medium text-gray-700 cursor-pointer",children:[t.jsx("input",{id:`${s}-${i}`,type:"checkbox",checked:a.includes(i),onChange:j=>{const I=j.target.checked?[...a,i]:a.filter(z=>z!==i);r.setFieldValue(s,I),l(I,e,c),u("onChange",e,`${s}-${i}`)},onBlur:r.handleBlur,disabled:k,className:`h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500
                    ${k?"bg-gray-100 border-gray-200 text-gray-500 cursor-not-allowed":""}
                    `}),g]},i))}),r.touched[s]&&r.errors[s]&&t.jsx("span",{className:"text-xs text-red-500 ml-2",children:String(r.errors[s])})]})}case"tags":{const a=r.values[s],i=_.trim(),g=Array.isArray(D)?D:Object.entries(D||{}).map(([v,w])=>({value:v,label:w})),j=v=>{if(!k&&v&&!a.includes(v)){let w=[...a,v];r.setFieldValue(s,w),l(w,e,c),A("")}},I=v=>{let w=a.filter(E=>E!==v);r.setFieldValue(s,w),l(w,e,c)},z=v=>g.find(w=>w.value===v)?.label??v;return t.jsxs("div",{className:"relative",children:[t.jsxs("label",{className:F,children:[e.label,e.required&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsxs("div",{className:`${y} 
            flex flex-wrap gap-2 min-h-[42px] max-h-[120px] overflow-y-auto items-center
            ${k?"pointer-events-none opacity-70":""}
            `,onClick:()=>!k&&document.getElementById(`${s}-input`)?.focus(),children:[a.map(v=>t.jsxs("span",{className:"flex items-center gap-2 px-2 py-1 rounded-full text-sm bg-indigo-50 border border-indigo-100",children:[t.jsx("span",{className:"text-indigo-700",children:z(v)}),t.jsx("button",{type:"button",onClick:w=>{w.stopPropagation(),k||I(v)},onMouseDown:w=>w.preventDefault(),className:"ml-1 text-indigo-500 hover:text-red-500 focus:outline-none",children:"×"})]},v)),t.jsx("input",{id:`${s}-input`,type:"text",value:_,onChange:v=>A(v.target.value),onKeyDown:v=>{(v.key==="Enter"||v.key===",")&&(v.preventDefault(),j(i))},placeholder:a.length===0?e.placeholder||"Type and press Enter":"",className:"flex-1 min-w-[120px] border-none outline-none text-sm bg-transparent p-1",disabled:k})]}),r.touched[s]&&r.errors[s]&&t.jsx("span",{className:"text-xs text-red-500",children:String(r.errors[s])})]})}case"photo":case"avatar":return t.jsx(Oe,{formik:r,field:e,sqlOpsUrls:n,module_refid:c});case"attachment":case"file":const Z=e.multiple===!0,re=Array.isArray(r.values[s])?r.values[s]:r.values[s]?[r.values[s]]:[];return t.jsxs("div",{className:"relative",children:[t.jsxs("label",{className:F,children:[e.label,e.required&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsxs("div",{className:"relative mb-1",children:[e.icon&&t.jsx("div",{className:"absolute z-10 left-3 top-1/2 -translate-y-1/2 pointer-events-none",children:X(e)}),t.jsx("input",{id:s,type:"file",className:`${y} ${N} ${e.icon?"pl-9":""} `,onFocus:()=>P(!0),name:s,multiple:Z,onChange:a=>{const i=a.currentTarget.files;i&&C(i),u("onChange",e,`${s}`)},onBlur:r.handleBlur,placeholder:e.placeholder,disabled:k}),t.jsx("div",{className:`absolute inset-0 rounded-lg bg-gradient-to-r from-purple-400 to-indigo-400 opacity-0 transition-opacity duration-300 pointer-events-none ${Y?"opacity-20":""}`,style:{zIndex:-1,filter:"blur(8px)"}})]}),re.map(a=>{const i=a?.split("/").pop();return t.jsx(ot,{sqlOpsUrls:n,filePath:a},i)}),r.touched[s]&&r.errors[s]&&t.jsx("span",{className:"text-xs text-red-500",children:String(r.errors[s])})]});case"json":return t.jsxs("div",{className:"relative",children:[t.jsxs("label",{className:F,children:[e.label,e.required&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsxs("div",{className:"relative",children:[t.jsx("textarea",{id:s,name:s,value:r.values[s],onChange:a=>{r.setFieldValue(s,a.target.value),l(a.target.value,e,c),u("onChange",e,`${s}`)},onBlur:r.handleBlur,placeholder:e.placeholder||"Enter valid JSON",disabled:k,className:`${y} ${N} min-h-[200px] font-mono text-sm resize-y`}),t.jsx("div",{className:`absolute inset-0 rounded-lg bg-gradient-to-r from-emerald-400 to-cyan-400 opacity-0 transition-opacity duration-300 pointer-events-none ${Y?"opacity-20":""}`,style:{zIndex:-1,filter:"blur(8px)"}})]}),r.touched[s]&&r.errors[s]&&t.jsx("span",{className:"text-xs text-red-500",children:String(r.errors[s])})]});case"date":return t.jsxs("div",{className:"relative",children:[t.jsxs("label",{className:F,children:[e.label,e.required&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute z-10 right-3 top-1/2 -translate-y-1/2 pointer-events-none",children:t.jsx("i",{className:"fa-solid fa-calendar"})}),t.jsx("input",{id:s,type:"date",name:s,min:e.min,max:e.max,value:r.values[s],onChange:a=>{r.setFieldValue(s,a.target.value),l(a.target.value,e,c),u("onChange",e,`${s}`)},onBlur:r.handleBlur,placeholder:e.placeholder,disabled:k,className:`${y} ${N} ${e.icon?"pl-9":""}`}),t.jsx("div",{className:`absolute inset-0 rounded-lg bg-gradient-to-r from-purple-400 to-indigo-400 opacity-0 transition-opacity duration-300 pointer-events-none ${Y?"opacity-20":""}`,style:{zIndex:-1,filter:"blur(8px)"}})]}),r.touched[s]&&r.errors[s]&&t.jsx("span",{className:"text-xs text-red-500",children:String(r.errors[s])})]});case"number":return t.jsxs("div",{className:"relative",children:[t.jsxs("label",{className:F,children:[e.label,e.required&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsxs("div",{className:"relative",children:[e.icon&&t.jsx("div",{className:"absolute z-10 left-3 top-1/2 -translate-y-1/2 pointer-events-none",children:X(e)}),t.jsx("input",{id:s,type:"number",className:`${y} ${N} ${e.icon?"pl-9":""} `,onFocus:()=>P(!0),name:s,value:r.values[s],onBlur:r.handleBlur,onChange:a=>{r.setFieldValue(s,a.target.value),l(a.target.value,e,c),u("onChange",e,`${s}`)},step:e.step,placeholder:e.placeholder,disabled:k,min:e.min??1,max:e.max}),t.jsx("div",{className:`absolute inset-0 rounded-lg bg-gradient-to-r from-purple-400 to-indigo-400 opacity-0 transition-opacity duration-300 pointer-events-none ${Y?"opacity-20":""}`,style:{zIndex:-1,filter:"blur(8px)"}})]}),r.touched[s]&&r.errors[s]&&t.jsx("span",{className:"text-xs text-red-500",children:String(r.errors[s])})]});default:return t.jsxs("div",{className:"relative",children:[t.jsxs("label",{className:F,children:[e.label,e.required&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsxs("div",{className:"relative",children:[e.icon&&t.jsx("div",{className:"absolute z-10 left-3 top-1/2 -translate-y-1/2 pointer-events-none",children:X(e)}),t.jsx("input",{id:s,type:e.type||"text",className:`${y} ${N} ${e.icon?"pl-9":""} `,onFocus:()=>P(!0),name:s,value:r.values[s],onBlur:r.handleBlur,onChange:a=>{r.setFieldValue(s,a.target.value),l(a.target.value,e,c),u("onChange",e,`${s}`)},step:e.step,placeholder:e.placeholder,disabled:k,minLength:e.minlength,maxLength:e.maxlength}),t.jsx("div",{className:`absolute inset-0 rounded-lg bg-gradient-to-r from-purple-400 to-indigo-400 opacity-0 transition-opacity duration-300 pointer-events-none ${Y?"opacity-20":""}`,style:{zIndex:-1,filter:"blur(8px)"}})]}),r.touched[s]&&r.errors[s]&&t.jsx("span",{className:"text-xs text-red-500",children:String(r.errors[s])})]})}}function Ie({title:e,children:r,isFirst:o}){const[n,m]=S.useState(o);return t.jsx("div",{className:"group relative mt-1",children:t.jsxs("div",{className:"relative bg-white rounded-lg border border-gray-100 shadow-xs hover:shadow-sm transition-all duration-300 overflow-hidden ",children:[t.jsxs("button",{onClick:()=>m(!n),className:"w-full bg-gray-50 flex justify-between items-center px-6 py-3 b text-left transition-all duration-300 ",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:`w-3 h-3 rounded-full transition-all duration-300 ${n?"bg-action":"bg-gray-300"}`}),t.jsx("h3",{className:"text-md font-semibold bg-gradient-to-r from-gray-800 to-gray-600 bg-clip-text text-transparent",children:e})]}),t.jsxs("div",{className:`relative transition-all duration-300 ${n?"rotate-180":""}`,children:[t.jsx("div",{className:`absolute inset-0 rounded-full blur-md transition-opacity duration-300 ${n?"bg-action opacity-30":"bg-transparent opacity-0"}`}),t.jsx("svg",{className:"relative w-4 h-4 text-gray-500 group-hover:text-action-500 transition-colors duration-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]}),t.jsx("div",{className:`transition-all duration-500 ease-in-out overflow-hidden  ${n?"max-h-[2000px] opacity-100":"max-h-0 opacity-0"}`,children:t.jsx("div",{className:"px-6 pb-6 bg-gradient-to-br from-gray-50/50 to-white overflow-auto mb-5",children:t.jsx("div",{className:"space-y-5 pt-4",children:r})})})]})})}function ge({fields:e,formik:r,methods:o={},sqlOpsUrls:n,refid:m,module_refid:c,fieldOptions:x,setFieldOptions:d}){return t.jsx("div",{className:"bg-white min-h-3/10 overflow-auto",children:t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6",children:[t.jsx("div",{className:"lg:col-span-2 flex flex-col ",children:t.jsx("div",{className:"relative w-42 h-42 ",children:e?.filter(h=>h.type==="avatar").map(h=>t.jsx(Oe,{formik:r,field:h,sqlOpsUrls:n,module_refid:c}))})}),t.jsx("div",{className:"lg:col-span-10 min-h-0 max-h-40  overflow-y-auto custom-scrollbar",children:t.jsx("div",{className:"grid grid-cols-12 gap-2",children:e?.map((h,u)=>h.type==="avatar"?null:t.jsx("div",{className:`transition-colors duration-200 col-span-12 md:col-span-6 ${oe[ie(Number(h.width))]||"lg:col-span-4"}`,children:t.jsx(ue,{refid:m,module_refid:c,sqlOpsUrls:n,field:h,formik:r,methods:o,setFieldOptions:d,...x?.[h.name]?{optionsOverride:x[h.name]}:{}},h?.name||u)},h.name))})})]})})}function ut({title:e,groupedFields:r,data:o,onSubmit:n=C=>{},onCancel:m=()=>{},methods:c={},components:x={},sqlOpsUrls:d,refid:h,module_refid:u}){const{common:C=[],...p}=r,[$,A]=S.useState({}),f=(l,b)=>{A(y=>({...y,[l]:b}))},{initialValues:P,validationSchema:O}=S.useMemo(()=>{const l={},b={};return Object.values(r).flat().forEach(y=>{ne([y],l,b,o,u,d?.operation)}),{initialValues:l,validationSchema:b}},[r,o,u,d?.operation]),T=de.useFormik({initialValues:P,enableReinitialize:!0,validationSchema:q.object().shape(O),onSubmit:l=>{n(l)}});return t.jsx("div",{className:"relative z-10 max-w-full  m-4",children:t.jsx("div",{className:"bg-white border border-gray-100 rounded-md animate-in fade-in duration-300",children:t.jsxs("form",{onSubmit:T.handleSubmit,className:"p-4 mx-auto",children:[t.jsxs("div",{className:"space-y-2",children:[C.length>0&&t.jsx(Ie,{title:"Common",isFirst:!0,children:t.jsx(ge,{refid:h,module_refid:u,sqlOpsUrls:d,fields:C,formik:T,methods:c,setFieldOptions:f,fieldOptions:$})}),p&&Object.entries(p).map(([l,b],y)=>t.jsx(Ie,{title:l,isFirst:y===0&&C.length===0,children:t.jsx("div",{className:"grid grid-cols-12 gap-4",children:b.map((N,F)=>me(N.hidden)||N.type==="geolocation"?null:t.jsx("div",{className:`col-span-12 md:col-span-6 ${oe[ie(Number(N.width))]||"lg:col-span-4"}`,children:t.jsx(ue,{refid:h,module_refid:u,sqlOpsUrls:d,components:x,field:N,formik:T,methods:c,setFieldOptions:f,...$[N.name]?{optionsOverride:$[N.name]}:{}},N.name)},N?.name??`field-${F}`))})},l))]}),t.jsxs("div",{className:"mt-8 flex justify-between space-x-3",children:[t.jsx("p",{className:"text-sm text-gray-700",children:"All fields marked (*) are required"}),t.jsxs("div",{className:"space-x-3",children:[t.jsx("button",{type:"button",onClick:m,className:"px-5 py-2 bg-white text-gray-700 font-semibold rounded-lg border-2 border-gray-200  shadow-sm hover:shadow-lg transform hover:scale-105 transition-all duration-300 ",children:"Cancel"}),t.jsx("button",{type:"submit",className:"px-5 py-2 bg-action font-semibold rounded-lg border-2 border-gray-200 shadow-sm hover:shadow-lg transform hover:scale-105 transition-all duration-300 ",children:"Save"})]})]})]})})})}function dt({title:e,groupedFields:r,data:o,onSubmit:n=p=>{},onCancel:m=()=>{},methods:c={},components:x={},sqlOpsUrls:d,widget:h,refid:u,module_refid:C}){const{common:p=[],...$}=r,A=Object.keys($),[f,P]=S.useState(0),[O,T]=S.useState({}),l=(s,R)=>{T(H=>({...H,[s]:R}))},{initialValues:b,validationSchema:y,stepperSchemas:N}=S.useMemo(()=>{const s={},R={},H={};return h?Object.entries(r).forEach(([V,W])=>{const Y={};ne(W,s,Y,o,C,d?.operation),H[V]=Y}):Object.entries(r).forEach(([V,W])=>{ne(W,s,R,o,C,d?.operation)}),{initialValues:s,validationSchema:R,stepperSchemas:H}},[r,o,h,C,d?.operation]),F=A[f]??null,_=h&&F?N[F]??{}:y,L=de.useFormik({initialValues:b,enableReinitialize:!0,validationSchema:q.object().shape(_),onSubmit:s=>{h?(f<A.length-1&&P(R=>R+1),f===A.length-1&&n(s)):n(s)}}),D=async s=>{if(s.preventDefault(),!h){const R=await L.validateForm();if(Object.keys(R).length>0){alert("Please fill all required fields before submitting."),L.setTouched(Object.keys(R).reduce((H,V)=>({...H,[V]:!0}),{}));return}}L.handleSubmit(s)},k=()=>{P(s=>s>0?s-1:s)};return t.jsx("div",{className:" max-w-full  m-4",children:t.jsxs("form",{onSubmit:D,className:"w-full mx-auto",children:[t.jsx("div",{className:"relative",children:t.jsxs("div",{className:"relative  rounded-t-lg px-1 pt-1  shadow-inner",children:[p.length>0&&t.jsx("div",{className:"p-3",children:t.jsx(ge,{refid:u,module_refid:C,sqlOpsUrls:d,fields:p,formik:L,methods:c,setFieldOptions:l,fieldOptions:O})}),t.jsx("nav",{className:"relative flex bg-gray-100",children:A.map((s,R)=>t.jsx("button",{type:"button",onClick:()=>P(R),className:`relative cursor-pointer flex-shrink-0 py-2 px-2 sm:px-4 rounded-t-lg  text-xs sm:text-sm font-semibold transition-all duration-300 ease-out focus:outline-none whitespace-nowrap ${f===R?"text-action bg-white":"text-gray-600 hover:text-gray-800 hover:bg-white/50"}`,children:t.jsx("span",{className:"relative z-10 flex items-center justify-center gap-2 capitalize",children:s})},s))})]})}),t.jsxs("div",{className:"bg-white  border border-gray-100 border-t-0 rounded-b-lg p-3 animate-in fade-in duration-300",children:[t.jsx("div",{className:"grid grid-cols-12 gap-4",children:F&&$[F]?.map((s,R)=>me(s.hidden)||s.type==="geolocation"?null:t.jsx("div",{className:`col-span-12  ${oe[ie(Number(s.width))]||"lg:col-span-4"}`,children:t.jsx(ue,{refid:u,module_refid:C,sqlOpsUrls:d,field:s,formik:L,methods:c,components:x,setFieldOptions:l,...O[s.name]?{optionsOverride:O[s.name]}:{}},s.name)},s?.name??`field-${R}`))}),t.jsxs("div",{className:`mt-8 flex ${f>0?"justify-between":"justify-end"} space-x-3`,children:[f>0&&t.jsx("button",{onClick:k,type:"button",className:"px-5 py-2 bg-white text-gray-700 font-semibold rounded-lg border-2 border-gray-200  shadow-sm hover:shadow-lg transform hover:scale-105 transition-all duration-300 ",children:"Previous"}),t.jsxs("div",{className:"space-x-3",children:[t.jsx("button",{onClick:m,type:"button",className:"px-5 cursor-pointer py-2 bg-white text-gray-700 font-semibold rounded-lg border-2 border-gray-200  shadow-sm hover:shadow-lg transform hover:scale-105 transition-all duration-300 ",children:"Cancel"}),t.jsx("button",{type:"submit",className:"px-5 cursor-pointer py-2 bg-action font-semibold rounded-lg border-2 border-gray-200 shadow-sm hover:shadow-lg transform hover:scale-105 transition-all duration-300 ",children:h?"Next":"Save"})]})]}),t.jsx("div",{className:"mt-2 pt-3  border-t border-gray-100",children:t.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsxs("span",{children:["Tab ",f+1," of ",A.length]}),t.jsx("p",{className:"text-sm text-gray-700 ml-3",children:"All fields marked (*) are required"})]}),t.jsx("div",{className:"flex gap-1",children:A.map((s,R)=>t.jsx("div",{className:`w-2 h-2 rounded-full transition-all duration-300 ${R===f?"bg-action w-6":"bg-gray-300"}`},R))})]})})]},A[f])]})})}function ht({title:e,fields:r,data:o,onSubmit:n=u=>{},onCancel:m=()=>{},methods:c={},sqlOpsUrls:x,refid:d,module_refid:h}){const u=Qe(r,x?.operation),[C,p]=S.useState({}),$=(l,b)=>{p(y=>({...y,[l]:b}))},{commonFields:A,otherFields:f}=S.useMemo(()=>u.reduce((l,b)=>(b.group==="common"?l.commonFields.push(b):l.otherFields.push(b),l),{commonFields:[],otherFields:[]}),[u]),{initialValues:P,validationSchema:O}=S.useMemo(()=>{const l={},b={};return u.forEach(y=>{ne([y],l,b,o,h,x?.operation)}),{initialValues:l,validationSchema:b}},[u,o]),T=de.useFormik({initialValues:P,enableReinitialize:!0,validationSchema:q.object().shape(O),onSubmit:l=>{n(l)}});return t.jsx(t.Fragment,{children:t.jsx("div",{className:"relative z-10 max-w-full  m-4",children:t.jsx("div",{className:"bg-white border border-gray-100 rounded-md animate-in fade-in duration-300",children:t.jsxs("form",{onSubmit:T.handleSubmit,className:"p-4  mx-auto",children:[A.length>0&&t.jsx(ge,{refid:d,module_refid:h,sqlOpsUrls:x,fields:A,formik:T,methods:c,setFieldOptions:$,fieldOptions:C}),t.jsx("div",{className:"grid grid-cols-12 gap-4",children:f.map((l,b)=>me(l.hidden)||l.type==="geolocation"?null:t.jsx("div",{className:`col-span-12 md:col-span-6 ${oe[ie(Number(l.width))]||"lg:col-span-4"}`,children:t.jsx(ue,{refid:d,module_refid:h,sqlOpsUrls:x,field:l,formik:T,methods:c,setFieldOptions:$,...C[l.name]?{optionsOverride:C[l.name]}:{}})},l?.name??`field-${b}`))}),t.jsxs("div",{className:"mt-8 flex justify-between space-x-3",children:[t.jsx("p",{className:"text-sm text-gray-700",children:"All fields marked (*) are required"}),t.jsxs("div",{className:"space-x-3",children:[t.jsx("button",{type:"button",onClick:m,className:"px-5 py-2 bg-white text-gray-700 font-semibold rounded-lg border-2 border-gray-200  shadow-sm hover:shadow-lg transform hover:scale-105 transition-all duration-300 cursor-pointer",children:"Cancel"}),t.jsx("button",{type:"submit",className:"px-5 py-2 bg-action font-semibold rounded-lg border-2 border-gray-200 shadow-sm hover:shadow-lg transform hover:scale-105 transition-all duration-300 cursor-pointer",children:"Save"})]})]})]})})})})}function Pe({title:e,children:r}){return t.jsx("div",{className:"group relative mt-1",children:t.jsxs("div",{className:"relative bg-white rounded-lg border border-gray-100 shadow-sm hover:shadow-lg transition-all duration-300 overflow-hidden ",children:[t.jsx("button",{className:"w-full bg-gray-50 flex justify-between items-center px-6 py-3 b text-left transition-all duration-300 ",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-3 h-3 rounded-full transition-all duration-300 bg-action"}),t.jsx("h3",{className:"text-md font-semibold bg-gradient-to-r from-gray-800 to-gray-600 bg-clip-text text-transparent",children:e})]})}),t.jsx("div",{className:`transition-all duration-500 ease-in-out overflow-hidden max-h-[2000px] opacity-100'
            }`,children:t.jsx("div",{className:"px-4 pb-4 bg-gradient-to-br from-gray-50/50 to-white",children:t.jsx("div",{className:"space-y-5 pt-4",children:r})})})]})})}function mt({title:e,groupedFields:r,data:o,onSubmit:n=C=>{},onCancel:m=()=>{},methods:c={},components:x={},sqlOpsUrls:d,refid:h,module_refid:u}){const{common:C=[],...p}=r,[$,A]=S.useState({}),f=(l,b)=>{A(y=>({...y,[l]:b}))},{initialValues:P,validationSchema:O}=S.useMemo(()=>{const l={},b={};return Object.values(r).flat().forEach(y=>{ne([y],l,b,o,u,d?.operation)}),{initialValues:l,validationSchema:b}},[r,o,u,d?.operation]),T=de.useFormik({initialValues:P,enableReinitialize:!0,validationSchema:q.object().shape(O),onSubmit:l=>{n(l)}});return t.jsx("div",{className:"relative z-10 max-w-full  m-4",children:t.jsx("div",{className:"bg-white animate-in fade-in duration-300",children:t.jsxs("form",{onSubmit:T.handleSubmit,className:"p-4 mx-auto",children:[t.jsxs("div",{className:"space-y-2",children:[C.length>0&&t.jsx(Pe,{title:"Common",children:t.jsx(ge,{refid:h,module_refid:u,sqlOpsUrls:d,fields:C,formik:T,methods:c,setFieldOptions:f,fieldOptions:$})}),p&&Object.entries(p).map(([l,b],y)=>t.jsx(Pe,{title:l,children:t.jsx("div",{className:"grid grid-cols-12 gap-4",children:b.map((N,F)=>me(N.hidden)||N.type==="geolocation"?null:t.jsx("div",{className:`col-span-12 md:col-span-6 ${oe[ie(Number(N.width))]||"lg:col-span-4"}`,children:t.jsx(ue,{refid:h,module_refid:u,sqlOpsUrls:d,components:x,field:N,formik:T,methods:c,setFieldOptions:f,...$[N.name]?{optionsOverride:$[N.name]}:{}},N.name)},N?.name??`field-${F}`))})},l))]}),t.jsxs("div",{className:"mt-8 flex justify-between space-x-3",children:[t.jsx("p",{className:"px-4 pt-4 text-sm text-secondary",children:"All fields marked (*) are required"}),t.jsxs("div",{className:"space-x-3",children:[t.jsx("button",{type:"button",onClick:m,className:"px-5 py-2 bg-white text-gray-700 font-semibold rounded-lg border-2 border-gray-200  shadow-sm hover:shadow-lg transform hover:scale-105 transition-all duration-300 ",children:"Cancel"}),t.jsx("button",{type:"submit",className:"px-5 py-2 bg-action font-semibold rounded-lg border-2 border-gray-200 shadow-sm hover:shadow-lg transform hover:scale-105 transition-all duration-300 ",children:"Save"})]})]})]})})})}function pt({formJson:e,methods:r={},userid:o=null,onCancel:n=()=>{},components:m={},callback:c=()=>{},initialvalues:x={}}){let d=qe(e);const h=e.endPoints,u=e?.source?.refid,C=Ge(e?.fields??{},h?.operation),[p,$]=S.useState(x),A=S.useMemo(()=>He(e.fields),[e.fields]);S.useEffect(()=>{let O=!0;return(async()=>{const l=e?.source??{};if(!l?.type){O&&$({});return}if(l.type==="method"){const b=l.method,y=b?r[b]:void 0;if(y)try{const N=await Promise.resolve(y());O&&$(N??{})}catch(N){console.error("Method execution failed:",N),O&&$({})}else O&&$({})}if(l.type==="api"&&h?.operation!=="create")try{const b=await K({method:l.method||"GET",url:l.url??"",data:l.body??{},params:l.params??{},headers:l.headers??{}});O&&$(b.data??{})}catch(b){console.error("API fetch failed:",b),O&&$({})}if(l.type==="sql"&&l.refid&&l.refid!=="0"&&h?.operation!=="create"||h?.operation!=="create"&&l.dbopsid){if(!h){console.error("SQL source requires formJson.endPoints but it is missing");return}try{const b=await rt.fetch(h,{source:{...l,table:l.table,columns:l.columns,where:U(l.where,{refid:u})},fields:we(e.fields,h.operation)},l?.dbopsid,e?.module_refid);O&&$(b)}catch(b){console.error("API fetch failed:",b)}}})(),()=>{O=!1}},[o,e?.source?.type||"",e?.source?.method||"",e?.source?.url||"",JSON.stringify(e?.source?.params??{}),JSON.stringify(e?.source?.body??{}),JSON.stringify(e?.source?.headers??{})]);const f=async O=>{const T=e?.source??{};let l=null;if(A.length>0)try{l=await We()}catch(y){console.error("catch fetchGeolocation",y),l=null}const b={...O,...Object.fromEntries(A.map(y=>[y,l]))};if(T.type==="method"){const y=T.method,N=y?r[y]:void 0;if(N)try{const F=await Promise.resolve(N(b));if(c?.(F),r?.handleActions){let _=h?.operation==="update"?u:F?.data?.refid;const L=e?.gotolink?.replace("{hashid}",String(_));r.handleActions(L)}}catch(F){c?.(F),console.error("Method execution failed:",F)}}if(T.type==="api"){if(!h){console.error("SQL source requires formJson.endPoints but it is missing");return}try{const y=await K({method:T.method||"POST",url:h.baseURL+T.endpoint,data:b??{},headers:{Authorization:`Bearer ${h?.accessToken}`}});if(c?.(y),r?.handleActions){let N=h.operation==="update"?u:y?.data?.refid;const F=e?.gotolink?.replace("{hashid}",String(N));r.handleActions(F)}}catch(y){c?.(y),console.error("API fetch failed:",y)}}if(T.type==="sql"){const y=e.endPoints;if(!y){console.error("SQL source requires formJson.endPoints but it is missing");return}try{let N=!1,F;T?.dbopsid&&(N=!0,F=T?.dbopsid);const _=await K({method:"GET",url:y.baseURL+y.dbopsGetHash,headers:{Authorization:`Bearer ${y?.accessToken}`}});if(!N){let D={...T};T.where&&(D={...T,where:U(T.where,{refid:u})}),F=(await K({method:"POST",url:y.baseURL+y.dbopsGetRefId,data:{operation:y.operation,source:D,fields:we(e.fields,y.operation),forcefill:e.forcefill,datahash:_.data.refhash,srcid:e?.module_refid},headers:{Authorization:`Bearer ${y?.accessToken}`}}))?.data.refid}const L=await K({method:"POST",url:y.baseURL+y[y.operation==="update"?"dbopsUpdate":"dbopsCreate"],data:{refid:F,fields:b,datahash:_.data.refhash},headers:{Authorization:`Bearer ${y?.accessToken}`}});if(c?.(L),r?.handleActions){let D=y.operation==="update"?u:L?.data?.refid;const k=e?.gotolink?.replace("{hashid}",String(D));r.handleActions(k)}}catch(N){c?.(N),console.error("API fetch failed:",N)}}},P={accordion:t.jsx(ut,{title:e?.title??"",groupedFields:C,data:p,onSubmit:f,onCancel:n,methods:r,components:m,sqlOpsUrls:h,refid:u,module_refid:e?.module_refid}),cards:t.jsx(mt,{title:e?.title??"",groupedFields:C,data:p,onSubmit:f,onCancel:n,methods:r,components:m,sqlOpsUrls:h,refid:u,module_refid:e?.module_refid}),tab:t.jsx(dt,{title:e?.title??"",groupedFields:C,data:p,onSubmit:f,onCancel:n,methods:r,components:m,widget:e?.widget,sqlOpsUrls:h,refid:u,module_refid:e?.module_refid}),simple:t.jsx(ht,{title:e?.title??"",fields:e.fields,data:p,onSubmit:f,onCancel:n,methods:r,components:m,sqlOpsUrls:h,refid:u,module_refid:e?.module_refid})};return t.jsx("div",{className:"relative",children:P[d]})}Q.LogiksForm=pt,Object.defineProperty(Q,Symbol.toStringTag,{value:"Module"})});
