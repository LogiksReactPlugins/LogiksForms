(function(Ee,$){typeof exports=="object"&&typeof module<"u"?$(exports,require("react"),require("axios"),require("yup"),require("formik"),require("@tiptap/react"),require("@tiptap/starter-kit")):typeof define=="function"&&define.amd?define(["exports","react","axios","yup","formik","@tiptap/react","@tiptap/starter-kit"],$):(Ee=typeof globalThis<"u"?globalThis:Ee||self,$(Ee.LogiksForm={},Ee.React,Ee.axios,Ee.Yup,Ee.formik,Ee.react,Ee.StarterKit))})(this,function(Ee,$,de,Ba,xn,go,Ha){"use strict";function Wa(t){const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(t){for(const n in t)if(n!=="default"){const r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:()=>t[n]})}}return e.default=t,Object.freeze(e)}const fe=Wa(Ba);var wn={exports:{}},$t={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yo;function _a(){if(yo)return $t;yo=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(r,s,o){var i=null;if(o!==void 0&&(i=""+o),s.key!==void 0&&(i=""+s.key),"key"in s){o={};for(var l in s)l!=="key"&&(o[l]=s[l])}else o=s;return s=o.ref,{$$typeof:t,type:r,key:i,ref:s!==void 0?s:null,props:o}}return $t.Fragment=e,$t.jsx=n,$t.jsxs=n,$t}var Ft={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bo;function Ka(){return bo||(bo=1,process.env.NODE_ENV!=="production"&&function(){function t(w){if(w==null)return null;if(typeof w=="function")return w.$$typeof===B?null:w.displayName||w.name||null;if(typeof w=="string")return w;switch(w){case g:return"Fragment";case b:return"Profiler";case y:return"StrictMode";case C:return"Suspense";case M:return"SuspenseList";case V:return"Activity"}if(typeof w=="object")switch(typeof w.tag=="number"&&console.error("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),w.$$typeof){case p:return"Portal";case k:return(w.displayName||"Context")+".Provider";case x:return(w._context.displayName||"Context")+".Consumer";case E:var S=w.render;return w=w.displayName,w||(w=S.displayName||S.name||"",w=w!==""?"ForwardRef("+w+")":"ForwardRef"),w;case I:return S=w.displayName||null,S!==null?S:t(w.type)||"Memo";case P:S=w._payload,w=w._init;try{return t(w(S))}catch{}}return null}function e(w){return""+w}function n(w){try{e(w);var S=!1}catch{S=!0}if(S){S=console;var R=S.error,j=typeof Symbol=="function"&&Symbol.toStringTag&&w[Symbol.toStringTag]||w.constructor.name||"Object";return R.call(S,"The provided key is an unsupported type %s. This value must be coerced to a string before using it here.",j),e(w)}}function r(w){if(w===g)return"<>";if(typeof w=="object"&&w!==null&&w.$$typeof===P)return"<...>";try{var S=t(w);return S?"<"+S+">":"<...>"}catch{return"<...>"}}function s(){var w=v.A;return w===null?null:w.getOwner()}function o(){return Error("react-stack-top-frame")}function i(w){if(H.call(w,"key")){var S=Object.getOwnPropertyDescriptor(w,"key").get;if(S&&S.isReactWarning)return!1}return w.key!==void 0}function l(w,S){function R(){J||(J=!0,console.error("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://react.dev/link/special-props)",S))}R.isReactWarning=!0,Object.defineProperty(w,"key",{get:R,configurable:!0})}function a(){var w=t(this.type);return te[w]||(te[w]=!0,console.error("Accessing element.ref was removed in React 19. ref is now a regular prop. It will be removed from the JSX Element type in a future release.")),w=this.props.ref,w!==void 0?w:null}function c(w,S,R,j,K,G,O,z){return R=G.ref,w={$$typeof:h,type:w,key:S,props:G,_owner:K},(R!==void 0?R:null)!==null?Object.defineProperty(w,"ref",{enumerable:!1,get:a}):Object.defineProperty(w,"ref",{enumerable:!1,value:null}),w._store={},Object.defineProperty(w._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(w,"_debugInfo",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(w,"_debugStack",{configurable:!1,enumerable:!1,writable:!0,value:O}),Object.defineProperty(w,"_debugTask",{configurable:!1,enumerable:!1,writable:!0,value:z}),Object.freeze&&(Object.freeze(w.props),Object.freeze(w)),w}function u(w,S,R,j,K,G,O,z){var D=S.children;if(D!==void 0)if(j)if(ue(D)){for(j=0;j<D.length;j++)d(D[j]);Object.freeze&&Object.freeze(D)}else console.error("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else d(D);if(H.call(S,"key")){D=t(w);var q=Object.keys(S).filter(function(me){return me!=="key"});j=0<q.length?"{key: someKey, "+q.join(": ..., ")+": ...}":"{key: someKey}",Dt[D+j]||(q=0<q.length?"{"+q.join(": ..., ")+": ...}":"{}",console.error(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,j,D,q,D),Dt[D+j]=!0)}if(D=null,R!==void 0&&(n(R),D=""+R),i(S)&&(n(S.key),D=""+S.key),"key"in S){R={};for(var ie in S)ie!=="key"&&(R[ie]=S[ie])}else R=S;return D&&l(R,typeof w=="function"?w.displayName||w.name||"Unknown":w),c(w,D,G,K,s(),R,O,z)}function d(w){typeof w=="object"&&w!==null&&w.$$typeof===h&&w._store&&(w._store.validated=1)}var f=$,h=Symbol.for("react.transitional.element"),p=Symbol.for("react.portal"),g=Symbol.for("react.fragment"),y=Symbol.for("react.strict_mode"),b=Symbol.for("react.profiler"),x=Symbol.for("react.consumer"),k=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),C=Symbol.for("react.suspense"),M=Symbol.for("react.suspense_list"),I=Symbol.for("react.memo"),P=Symbol.for("react.lazy"),V=Symbol.for("react.activity"),B=Symbol.for("react.client.reference"),v=f.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,H=Object.prototype.hasOwnProperty,ue=Array.isArray,U=console.createTask?console.createTask:function(){return null};f={"react-stack-bottom-frame":function(w){return w()}};var J,te={},ye=f["react-stack-bottom-frame"].bind(f,o)(),Ue=U(r(o)),Dt={};Ft.Fragment=g,Ft.jsx=function(w,S,R,j,K){var G=1e4>v.recentlyCreatedOwnerStacks++;return u(w,S,R,!1,j,K,G?Error("react-stack-top-frame"):ye,G?U(r(w)):Ue)},Ft.jsxs=function(w,S,R,j,K){var G=1e4>v.recentlyCreatedOwnerStacks++;return u(w,S,R,!0,j,K,G?Error("react-stack-top-frame"):ye,G?U(r(w)):Ue)}}()),Ft}var xo;function Va(){return xo||(xo=1,process.env.NODE_ENV==="production"?wn.exports=_a():wn.exports=Ka()),wn.exports}var m=Va();const Ua=["jpg","jpeg","png","gif","svg","webp"],qa=["mp4","webm","ogg"],Ja=["txt","json","csv"],Ga=["pdf"];function Ya(t){return t.template==="accordion"?"accordion":t.template==="simple"?"simple":t.template==="cards"?"cards":Object.values(t.fields||{}).some(r=>r.group)?"tab":"simple"}function Qa(t,e="create",n="Info"){const r={};let s=!1;if(Object.values(t).forEach(i=>{i.group&&(s=!0)}),!s)return{};const o=[];return Object.entries(t).forEach(([i,l])=>{if(l.vmode==="edit"&&e==="create")return;const a={...l,name:i};if(l.group){const c=l.group;r[c]||(r[c]=[]),r[c].push(a)}else o.push(a)}),o.length>0?{[n]:o,...r}:r}function wo(t,e="create"){const n={};return Object.keys(t).forEach(r=>{t[r].vmode==="edit"&&e==="create"||(n[r]={label:r,required:t[r].required??!1})}),n}const Bt=(t,e,n,r,s,o)=>{const i=o==="create"&&s?Co(s):{};t.forEach(l=>{const a=l?.name;if(!a)return;let c=r?.[a];const u=o==="create"&&s?So(l):null;o==="create"&&u&&i[u]!==void 0&&c==null&&(c=i[u]),c==null&&(c=l.default),l.multiple===!0||l.type==="checkbox"||l.type==="tags"?e[a]=Array.isArray(c)?c:typeof c=="string"?c.split(",").map(f=>f.trim()).filter(Boolean):[]:l.type==="json"?e[a]=typeof c=="object"&&c!==null?JSON.stringify(c,null,2):c??"":l.type==="date"?e[a]=typeof c=="string"&&c.trim()?c.slice(0,10):null:l.type==="time"?typeof c=="string"?c.includes("T")?e[a]=c.slice(11,16):e[a]=c.slice(0,5):e[a]="":a==="blocked"||a==="blacklist"?e[a]=String(c??"false"):e[a]=c??"";let d;l.type==="file"?d=l.multiple?fe.array().of(fe.mixed()):fe.mixed():l.multiple===!0||l.type==="checkbox"||l.type==="tags"?d=fe.array().of(fe.string()):l.type==="email"?d=fe.string().email("Invalid email"):l.type==="number"?d=fe.number().typeError("Must be a number"):l.type==="json"?d=fe.string().test("json","Invalid JSON",f=>{if(!f)return!0;try{return JSON.parse(f),!0}catch{return!1}}):l.type==="date"?d=fe.string().nullable():d=fe.string(),l?.validate?.regex&&typeof l.validate.regex=="string"&&(d=d.matches(new RegExp(l?.validate?.regex),l?.error_message||"Invalid input format")),l?.validate&&Object.entries(l.validate).forEach(([f,h])=>{switch(f){case"email":h&&(d=d.email("Invalid email format"));break;case"mobile":d=d.matches(/^[1-9][0-9]*$/,"Invalid mobile number format");break;case"regex":d=d.matches(new RegExp(h),`Must match pattern: ${h}`);break;case"date":d=d.nullable().test("date","Invalid date format (expected dd/MM/yyyy or dd-MM-yyyy)",p=>{if(p==null||p==="")return!0;const g=p.replace(/-/g,"/"),[y,b,x]=g.split("/");if(!y||!b||!x)return!1;const k=new Date(`${x}-${b}-${y}`);return!isNaN(k.getTime())});break;case"time":d=d.matches(/^([0-1][0-9]|2[0-3])[:\-]([0-5][0-9])$/,"Invalid time format (HH:MM)");break;case"timesec":d=d.matches(/^([0-1][0-9]|2[0-3]):([0-5][0-9]):([0-5][0-9])$/,"Invalid time format (HH:MM:SS)");break;case"number":case"numeric":d=fe.number().typeError("Must be numeric");break;case"float":case"decimal":d=fe.number().typeError("Must be a decimal").transform((p,g)=>{if(g==null||g==="")return;const y=Number(g);if(isNaN(y))return p;if(typeof p=="number"&&!isNaN(p)){const b=Number(p);return Number.isInteger(b)?Number(y.toFixed(b)):y}return y});break;case"alphanumeric":d=d.matches(/^[a-z0-9]+$/i,"Must be alphanumeric");break;case"alpha":d=d.matches(/^[a-zA-Z]+$/,"Must contain only letters");break;case"upper":d=d.transform(p=>p&&p.toUpperCase());break;case"lower":d=d.transform(p=>p&&p.toLowerCase());break;case"length-min":{const p=Number(h);isNaN(p)||(d=d.min(p,`Minimum length is ${p}`));break}case"length-max":{const p=Number(h);isNaN(p)||(d=d.max(p,`Maximum length is ${p}`));break}}}),l.required&&(d=d.required(l.error_message||`${l.label||a} is required`)),n[a]=d})},Ht={12:"lg:col-span-12",11:"lg:col-span-11",10:"lg:col-span-10",9:"lg:col-span-9",8:"lg:col-span-8",7:"lg:col-span-7",6:"lg:col-span-6",5:"lg:col-span-5",4:"lg:col-span-4",3:"lg:col-span-3",2:"lg:col-span-2",1:"lg:col-span-1"};function Wt(t){return[1,2,3,4,5,6,7,8,9,10,11,12].includes(t)?t:6}const vn=t=>t===!0||t==="true",Be=(t,e)=>typeof t=="string"?t.replace(/#(\w+)#/g,(n,r)=>e[r]!==void 0?String(e[r]):n):Array.isArray(t)?t.map(n=>Be(n,e)):t&&typeof t=="object"?Object.fromEntries(Object.entries(t).map(([n,r])=>[Be(n,e),Be(r,e)])):t,Ct=(t,e,n,r)=>{if(!Array.isArray(n)||n.length===0)return{};const s=r??(n[0]&&typeof n[0]=="object"&&"category"in n[0]?"category":void 0);if(!s){const i={};return n.forEach(l=>{const a=l[t],c=l[e];a!=null&&c!=null&&(i[String(a)]=String(c))}),i}const o={};return n.forEach(i=>{const l=i[s]??"Others",a=i[t],c=i[e];a==null||c==null||(o[l]||(o[l]={}),o[l][String(a)]=String(c))}),o},$r=(t,e)=>{if(!t||e==null)return;const n=String(e);if(typeof Object.values(t)[0]=="string")return t[n];for(const s of Object.values(t))if(n in s)return s[n]},Xa=t=>{if(!t)return[];if(Array.isArray(t))return t.map(r=>[String(r.value),String(r.title??r.label??r.value)]);const e=Object.values(t);return e.length?typeof e[0]=="string"?Object.entries(t).map(([r,s])=>[String(r),s]):Object.values(t).flatMap(r=>Object.entries(r).map(([s,o])=>[String(s),o])):[]},vo=t=>{if(!t||typeof t!="object")return!1;const e=Object.values(t)[0];return typeof e=="object"&&e!==null&&!Array.isArray(e)};async function Za(){if(!("geolocation"in navigator))throw new Error("Geolocation is not supported by this browser. You cannot access this portal.");try{const t=await new Promise((r,s)=>{navigator.geolocation.getCurrentPosition(r,s,{enableHighAccuracy:!1,timeout:3e4,maximumAge:12e4})}),{latitude:e,longitude:n}=t.coords;return`${e},${n}`}catch(t){if(!(t instanceof GeolocationPositionError))throw new Error("Failed to get your location.");switch(t.code){case t.PERMISSION_DENIED:throw new Error("Please allow location access in browser settings.");case t.POSITION_UNAVAILABLE:throw new Error("Unable to detect your location. Try connecting to Wi-Fi.");case t.TIMEOUT:throw new Error("Your device took too long to fetch GPS position.");default:throw new Error("Failed to get your location.")}}}const ec=t=>Object.entries(t??{}).filter(([,e])=>e.type==="geolocation").map(([e])=>e);function tc(t,e="create"){return Object.entries(t).filter(([,n])=>!(n.vmode==="edit"&&e==="create")).map(([n,r])=>({...r,name:n}))}function _t(t,e,n){const r=So(e);r&&n&&oc(n,r,t)}function nc(t){return typeof t=="object"&&t!==null&&typeof t.target=="string"&&typeof t.src=="object"&&t.src!==null&&typeof t.src.table=="string"}function rc(t){return t.split(",").map(e=>e.trim()).map(e=>{const n=e.match(/^(.+?)\s+as\s+.+$/i);return n?n[1]?.trim():e}).filter(e=>!!e)}const Et=t=>{if(t==null||typeof t!="object")return{value:t,title:t};const e={};for(const[n,r]of Object.entries(t)){const s=n.includes(".")?n.split(".").pop():n;if(s in e){console.warn(`Duplicate key after normalization: ${s}`);continue}e[s]=r}return e},sc="__form_persist__",ko=t=>`${sc}:${t}`;function So(t){return t.persistent?t.persistent===!0?t.name:typeof t.persistent=="string"?t.persistent:null:null}function Co(t){try{return JSON.parse(localStorage.getItem(ko(t))||"{}")}catch{return{}}}function oc(t,e,n){const r=Co(t);localStorage.setItem(ko(t),JSON.stringify({...r,[e]:n}))}function ic(t=""){return t.split(".").pop()?.toLowerCase()??""}function lc(t){return Ua.includes(t)?"image":qa.includes(t)?"video":Ga.includes(t)?"pdf":Ja.includes(t)?"text":"other"}const Eo={image:"fa fa-file-image",pdf:"fa fa-file-pdf",video:"fa fa-file-video",text:"fa fa-file-lines",other:"fa fa-file"},Kt=t=>({Authorization:`Bearer ${t.accessToken}`}),Fr=async t=>(await de.get(t.baseURL+t.dbopsGetHash,{headers:Kt(t)})).data.refhash,Br=async(t,e)=>(await de.post(t.baseURL+t.dbopsGetRefId,e,{headers:Kt(t)})).data.refid,ac={async fetch(t,e,n,r){const s=await Fr(t);let o=!1,i;n&&(o=!0,i=n),o||(i=await Br(t,{operation:"fetch",source:e.source,fields:e.fields??{},datahash:s,srcid:r}));const l=await de.post(t.baseURL+t.dbopsFetch,{refid:i,datahash:s},{headers:Kt(t)});return l.data?.data??l.data},async create(t,e,n){const r=await Fr(t),s=await Br(t,{operation:"create",source:e.source,fields:e.values,datahash:r,srcid:n});return(await de.post(t.baseURL+t.dbopsCreate,{refid:s,fields:e.values,datahash:r},{headers:Kt(t)})).data},async update(t,e,n){const r=await Fr(t),s=await Br(t,{operation:"update",source:e.source,fields:e.values,datahash:r,srcid:n});return(await de.post(t.baseURL+t.dbopsUpdate,{refid:s,fields:e.values,datahash:r},{headers:Kt(t)})).data}};async function kn(t,e,n,r=void 0,s=void 0,o={}){try{let i=n;return i||(i=(await de({method:"POST",url:t.baseURL+t.registerQuery,data:{query:e??{},srcid:s},headers:{Authorization:`Bearer ${t?.accessToken}`}})).data.queryid),await de({method:"POST",url:t.baseURL+t.runQuery,data:{queryid:i,filter:o,refid:r,page:0,limit:1e4},headers:{Authorization:`Bearer ${t?.accessToken}`}})}catch(i){throw i}}async function No(t,e){let n=e.previewPath??"/api/files/preview";const r=await de.get(`${e.baseURL}${n}?uri=${encodeURIComponent(t)}`,{responseType:"blob",headers:{Authorization:`Bearer ${e?.accessToken}`}});return URL.createObjectURL(r.data)}async function Ao(t,e){if(!t?.uploadURL)throw new Error("Upload URL missing");const n=t.baseURL+t.uploadURL;return Promise.all(Array.from(e).map(async r=>{const s=new FormData;return s.append("file",r),(await de.post(n,s,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${t.accessToken}`}})).data}))}function cc({field:t,formik:e,methods:n={},sqlOpsUrls:r,refid:s,module_refid:o="menuManager.main",optionsOverride:i,setFieldOptions:l}){const[a,c]=$.useState(!1),[u,d]=$.useState(i??t.options??{});$.useRef(null);const f=$.useRef(null),[h,p]=$.useState(""),[g,y]=$.useState(0),b=$.useRef(null),x=$.useRef(null),[k,E]=$.useState(!1),C=$.useRef(h),M=t.disabled===!0;$.useEffect(()=>{C.current=h},[h]);const I=S=>{if(M){S.preventDefault(),x.current?.removeAttribute("open");return}S.currentTarget.open||p("")};$.useEffect(()=>{i&&Object.keys(i).length!==0&&d(i)},[i]),$.useEffect(()=>{const S=R=>{x.current&&!x.current.contains(R.target)&&(x.current.open=!1,p(""))};return document.addEventListener("mousedown",S),()=>{document.removeEventListener("mousedown",S)}},[]);const P=t.name;$.useEffect(()=>{let S=!0;return(async()=>{let j=t.valueKey??"value",K=t.labelKey??"title";if(t?.options){if(typeof t.options=="object"&&!Array.isArray(t.options)){const q=Object.values(t.options);if(q.length&&typeof q[0]=="string"){d(t.options);return}}const z=(Array.isArray(t.options)?t.options:[t.options]).map(Et),D=Ct(j,K,z,t.groupKey);d(D);return}const G=t?.source??{};if(t.type==="dataMethod"){const O=t.method,z=O?n[O]:void 0;if(z)try{const D=await z(),q=Array.isArray(D?.data?.data)?D.data.data:Array.isArray(D?.data)?D.data:D;if(typeof q=="object"&&!Array.isArray(q)){const qe=Object.values(q);if(qe.length&&typeof qe[0]=="string"){d(q);return}}const ie=Array.isArray(q)?q.map(Et):[],me=Ct(j,K,ie,t.groupKey);S&&d(me)}catch(D){console.error("Method execution failed:",D),S&&d({})}else S&&d({})}if(G.type==="api"&&G.url)try{const O=await de({method:G.method||"GET",url:G.url,data:G.body??{},params:G.params??{},headers:G.headers??{}}),z=Array.isArray(O?.data?.data)?O.data.data:Array.isArray(O?.data)?O.data:O;if(typeof z=="object"&&!Array.isArray(z)){const ie=Object.values(z);if(ie.length&&typeof ie[0]=="string"){d(z);return}}const D=Array.isArray(z)?z.map(Et):[],q=Ct(j,K,D,t.groupKey);S&&d(q)}catch(O){console.error("API execution failed:",O),S&&d({})}if(t.table||t.type==="dataSelector"||t.queryid){if(!r){console.error("SQL source requires formJson.endPoints but it is missing");return}try{let O;if(t.type==="dataSelector")O={table:"do_lists",cols:"title,value",where:{groupid:t.groupid??""}};else if(!t.queryid){if(!t.table||!t.columns){console.error("Invalid SQL field config",t);return}O={table:t.table,cols:t.columns,where:t.where?s?Be(t.where,{refid:s}):t.where:void 0}}const z=await kn(r,O,t?.queryid,void 0,o),D=Array.isArray(z?.data?.data)?z.data.data:Array.isArray(z?.data)?z.data:z;if(typeof D=="object"&&!Array.isArray(D)){const me=Object.values(D);if(me.length&&typeof me[0]=="string"){d(D);return}}const q=Array.isArray(D)?D.map(Et):[],ie=Ct(j,K,q,t.groupKey);S&&d(ie)}catch(O){console.error("API fetch failed:",O)}}})(),()=>{S=!1}},[t.options,t.source,t.table,t.columns,t.where,s,t.queryid,t.groupKey,t.valueKey,t.labelKey]);const V=`
  w-full px-4 py-2 rounded-lg border transition-all duration-300
  backdrop-blur-sm text-gray-800 placeholder-gray-400
  focus:outline-none focus:ring-0

  ${M?"bg-gray-100 border-gray-200 text-gray-500 cursor-not-allowed":"bg-white border-gray-300 hover:border-gray-400 focus:border-indigo-500 focus:shadow-md"}
`,B=`
    border-gradient-to-r 
    focus:border-gray-400 focus:shadow-lg focus:shadow-gray-100/50
  `,v=`
    block text-sm font-semibold mb-1  transition-all duration-300 text-gray-700
  `,H=$.useMemo(()=>Xa(u),[u]),ue=H.length,U=$.useMemo(()=>t.search||!h?H:H.filter(([,S])=>S.toLowerCase().includes(h.toLowerCase())),[t.search,h,H]),J=(S,R)=>{if(x.current?.open===!0||k===!0)if(S.key==="ArrowDown")S.preventDefault(),y(j=>j+1<U.length?j+1:0);else if(S.key==="ArrowUp")S.preventDefault(),y(j=>j-1>=0?j-1:U.length-1);else if(S.key==="Enter"){S.preventDefault();const[j]=U[g]||[];if(j){let K=R?j:[...e.values[t.name],j];e.setFieldValue(t.name,K),_t(K,t,o)}x.current&&(x.current.open=!1)}else S.key==="Escape"&&(x.current.open=!1,p(""),E(!1))};$.useEffect(()=>{b.current?.querySelector(`[data-index="${g}"]`)?.scrollIntoView({block:"nearest"})},[g]),$.useEffect(()=>{g>=U.length&&y(0)},[U,g]),$.useEffect(()=>{const S=t.autocomplete,R=t.ajaxchain;if(!S&&!R)return;const j=e.values[t.name];if(!j)return;const K=Array.isArray(R)?R:R?[R]:[];(async()=>{try{if(nc(S)){const O=S.src;if(!O||!r)return;const z=Be(O.where??{},{refid:j}),D={...O,table:O.table,cols:O.columns,where:z},{data:q}=await kn(r,D,t?.queryid,void 0,o),ie=Array.isArray(q?.data)?q.data[0]:q?.data;ie&&S.target.split(",").map(me=>me.trim()).forEach(me=>{ie[me]!==void 0&&e.setFieldValue(me,ie[me])})}for(const O of K){const z=O.src;if(!O||typeof O!="object"||!z||typeof z!="object"||!r)continue;let D;if(!z.queryid){if(!z.table||!z.columns)throw new Error("SQL query requires field.table");const mm=Be(z?.where??{},{refid:j});D={...z,table:z.table,cols:z.columns,where:mm}}const{data:q}=await kn(r,D,z?.queryid,j,o);let ie=t.valueKey??"value",me=t.labelKey??"title";const qe=Array.isArray(q?.data?.data)?q.data.data:Array.isArray(q?.data)?q.data:q,hm=Array.isArray(qe)?qe.map(Et):[],pm=Ct(ie,me,hm,t.groupKey);l?.(O.target,pm)}}catch(O){console.error("Autocomplete / AjaxChain fetch failed",O)}})()},[e.values[t.name]]),$.useEffect(()=>{if(!t.search||!h.trim()||!t.table||!r)return;const S=rc(t.columns??""),R=new AbortController,j=setTimeout(async()=>{try{let K;if(!t.queryid){if(!t.table||!t.cols)throw new Error("SQL query requires field.table");const qe=s?Be(t.where??{},{refid:s}):t.where;K={...t,table:t.table,cols:t.columns||t.cols,where:qe}}let G={};Array.isArray(S)&&S.forEach(qe=>{G[qe]=[h,"LIKE"]});let O=t.valueKey??"value",z=t.labelKey??"title";const{data:D}=await kn(r,K,t?.queryid,void 0,o,G),q=Array.isArray(D?.data?.data)?D.data.data:Array.isArray(D?.data)?D.data:D,ie=Array.isArray(q)?q.map(Et):[],me=Ct(O,z,ie,t.groupKey);d(me)}catch(K){if(de.isCancel(K))return;console.error("Search fetch failed",K)}},500);return()=>{clearTimeout(j),R.abort()}},[h,s]);const te=async S=>{if(S.length===0){console.error("No file");return}try{const R=await Ao(r,S),j=t.multiple?R.map(K=>K.path):R[0]?.path;e.setFieldValue(P,j),_t(j,t,o)}catch(R){console.error("File upload failed",R),e.setFieldError(P,"File upload failed")}},ye=async(S,R,j)=>{const K=R[S];if(!K)return;const G=n?.[K];if(typeof G!="function"){console.error(`Method "${String(K)}" not found`);return}try{await Promise.resolve(G(j))}catch(O){console.error(`Method "${String(K)}" failed`,O)}},Ue=S=>{if(M)return;const R=S.target.value;p(R),y(0),R.trim()?E(!0):(E(!1),e.setFieldValue(P,""))},Dt=S=>{e.setFieldValue(P,S),_t(S,t,o),p(""),E(!1),ye("onChange",t,`${P}-${S}`)};function w(S){const R=S.currentTarget.files;R&&te(R)}return{setHighlightedIndex:y,executeFieldMethod:ye,handleFileUpload:te,handleKeyDown:J,handleToggle:I,setSearch:p,setOpen:E,setIsFocused:c,handleInputChange:Ue,handleSelect:Dt,handlePersist:_t,handleFileChange:w,optionCount:ue,baseInputClasses:V,focusClasses:B,labelClasses:v,search:h,highlightedIndex:g,options:u,isDisabled:M,key:P,filteredOptions:U,open:k,listRef:b,inputRef:f,detailsRef:x,isFocused:a}}const uc=({fileUrl:t,category:e})=>t?e==="image"?m.jsx("img",{src:t,className:"max-h-[80vh] mx-auto"}):e==="pdf"||e==="text"?m.jsx("iframe",{src:t,className:"w-full h-[80vh]"}):e==="video"?m.jsx("video",{controls:!0,className:"w-full max-h-[80vh]",children:m.jsx("source",{src:t})}):m.jsxs("div",{className:"text-center p-4",children:[m.jsx("p",{children:"Preview not available"}),m.jsx("a",{href:t,download:!0,className:"text-blue-600 underline",children:"Download file"})]}):null;function dc(t){const e=Eo[t]??Eo.other;return m.jsx("i",{className:`${e} text-2xl text-gray-600`})}const fc=({filePath:t,sqlOpsUrls:e})=>{const[n,r]=$.useState(null),[s,o]=$.useState(!1),i=ic(t),l=lc(i);$.useEffect(()=>{if(!e||l!=="image"&&!s)return;let c=!0,u=null;return No(t,e).then(d=>{c&&(u=d,r(d))}),()=>{c=!1,u&&URL.revokeObjectURL(u)}},[l,s,t,e]);let a=t.split("/").pop();return m.jsxs(m.Fragment,{children:[l==="image"&&n?m.jsx("img",{src:n,alt:a,title:"Click to preview",onClick:()=>o(!0),className:"h-16 w-16 object-cover rounded  cursor-pointer hover:opacity-90"}):m.jsxs("div",{role:"button",tabIndex:0,onClick:()=>o(!0),onKeyDown:c=>c.key==="Enter"&&o(!0),className:"inline-flex cursor-pointer items-center gap-1",title:"Click to preview",children:[dc(l),m.jsx("span",{className:"text-sm",children:a})]}),s&&m.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center",children:m.jsxs("div",{className:"bg-white rounded-lg p-4 max-w-5xl w-full",children:[m.jsx("button",{className:"float-right text-sm",onClick:()=>o(!1),children:"✕"}),n?m.jsx(uc,{fileUrl:n,category:l}):m.jsx("div",{className:"text-center p-8",children:"Loading preview…"})]})})]})};function To({field:t,isDisabled:e,handleToggle:n,detailsRef:r,handleKeyDown:s,valueArray:o,labelClasses:i,listRef:l,search:a,filteredOptions:c,highlightedIndex:u,setSearch:d,formik:f,setHighlightedIndex:h,executeFieldMethod:p,handlePersist:g,module_refid:y,options:b}){const x=t.name;return m.jsxs("div",{className:"relative",children:[m.jsxs("label",{className:i,children:[t.label,t.required&&m.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),m.jsxs("details",{className:`relative w-full ${e?" opacity-70":""}`,onToggle:n,ref:r,onKeyDown:k=>{e||s(k,!1)},children:[m.jsxs("summary",{className:`
    select-none border rounded-lg px-4 py-2.5 flex justify-between items-center
    ${e?"bg-gray-100 border-gray-200 text-gray-500 cursor-not-allowed":"bg-white border-gray-300 cursor-pointer"}
  `,children:[m.jsx("span",{className:"text-sm text-gray-700",children:o?.length>0?o.map(k=>$r(b,k)??k).join(", "):`Select ${t.label}`}),m.jsx("svg",{className:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),!e&&m.jsxs("div",{ref:l,className:"absolute mt-1 w-full border border-gray-200 rounded-lg bg-white shadow-md z-10 max-h-60 overflow-y-auto p-2",children:[t.search&&m.jsx("div",{className:"sticky top-0 bg-white p-1",children:m.jsx("input",{type:"text",value:a,onChange:k=>{e||(d(k.target.value),h(0))},placeholder:"Search...",className:`px-2 py-[5px] rounded w-full border border-gray-200 transition-all duration-300 
                bg-white/80 backdrop-blur-sm text-gray-800 placeholder-gray-400
                focus:outline-none focus:ring-0`})}),c.length>0?c.map(([k,E],C)=>m.jsxs("label",{htmlFor:`${x}-${k}`,className:`flex items-center gap-x-2 px-2 py-1 hover:bg-gray-50 rounded cursor-pointer text-sm
                        ${o?.includes(k)?"bg-indigo-50 text-indigo-600 font-medium":u===C?"bg-gray-100":"hover:bg-gray-50"}`,children:[m.jsx("input",{id:`${x}-${k}`,type:"checkbox",checked:o?.includes(k),onChange:M=>{const I=M.target.checked?[...o,k]:o?.filter(P=>P!==k);f.setFieldValue(x,I),g(I,t,y),p("onChange",t,`${x}-${k}`)},onBlur:f.handleBlur,disabled:e,className:"h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),E]},k)):m.jsx("div",{className:"px-2 py-1 text-gray-400 text-sm",children:"No results"})]})]}),f.touched[x]&&f.errors[x]&&m.jsx("span",{className:"text-xs text-red-500 ml-2",children:String(f.errors[x])})]})}function hc({filePath:t,field_name:e,sqlOpsUrls:n}){const[r,s]=$.useState(null);return $.useEffect(()=>{if(!open||!n)return;let o=!0,i=null;return No(t,n).then(l=>{o&&(i=l,s(l))}),()=>{o=!1,i&&URL.revokeObjectURL(i)}},[open,t,n]),r?m.jsx("img",{alt:e,title:e,src:r,className:"h-24 w-24 object-cover rounded border border-dashed  cursor-pointer hover:opacity-90"}):null}function Mo({formik:t,field:e,sqlOpsUrls:n,module_refid:r}){let s=e?.name;const o=$.useRef(null),i=async l=>{const a=l.currentTarget.files;if(!(!a||a.length===0))try{const c=await Ao(n,a),u=e.multiple?c.map(d=>d.path):c[0]?.path;t.setFieldValue(s,u),_t(u,e,r)}catch(c){console.error("File upload failed",c),t.setFieldError(s,"File upload failed")}};return m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm font-semibold mb-1  transition-all duration-300 text-gray-700",children:e.label}),m.jsx("input",{ref:o,type:"file",accept:"image/*",className:"hidden",onChange:i}),m.jsx("div",{onClick:()=>o.current?.click(),children:t.values[s]?m.jsx(hc,{field_name:s,filePath:t.values[s],sqlOpsUrls:n}):m.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:m.jsx("i",{className:"fa-solid fa-user"})})})]})}function le(t){this.content=t}le.prototype={constructor:le,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return e==-1?void 0:this.content[e+1]},update:function(t,e,n){var r=n&&n!=t?this.remove(n):this,s=r.find(t),o=r.content.slice();return s==-1?o.push(n||t,e):(o[s+1]=e,n&&(o[s]=n)),new le(o)},remove:function(t){var e=this.find(t);if(e==-1)return this;var n=this.content.slice();return n.splice(e,2),new le(n)},addToStart:function(t,e){return new le([t,e].concat(this.remove(t).content))},addToEnd:function(t,e){var n=this.remove(t).content.slice();return n.push(t,e),new le(n)},addBefore:function(t,e,n){var r=this.remove(e),s=r.content.slice(),o=r.find(t);return s.splice(o==-1?s.length:o,0,e,n),new le(s)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(t){return t=le.from(t),t.size?new le(t.content.concat(this.subtract(t).content)):this},append:function(t){return t=le.from(t),t.size?new le(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var e=this;t=le.from(t);for(var n=0;n<t.content.length;n+=2)e=e.remove(t.content[n]);return e},toObject:function(){var t={};return this.forEach(function(e,n){t[e]=n}),t},get size(){return this.content.length>>1}},le.from=function(t){if(t instanceof le)return t;var e=[];if(t)for(var n in t)e.push(n,t[n]);return new le(e)};function Ro(t,e,n){for(let r=0;;r++){if(r==t.childCount||r==e.childCount)return t.childCount==e.childCount?null:n;let s=t.child(r),o=e.child(r);if(s==o){n+=s.nodeSize;continue}if(!s.sameMarkup(o))return n;if(s.isText&&s.text!=o.text){for(let i=0;s.text[i]==o.text[i];i++)n++;return n}if(s.content.size||o.content.size){let i=Ro(s.content,o.content,n+1);if(i!=null)return i}n+=s.nodeSize}}function Oo(t,e,n,r){for(let s=t.childCount,o=e.childCount;;){if(s==0||o==0)return s==o?null:{a:n,b:r};let i=t.child(--s),l=e.child(--o),a=i.nodeSize;if(i==l){n-=a,r-=a;continue}if(!i.sameMarkup(l))return{a:n,b:r};if(i.isText&&i.text!=l.text){let c=0,u=Math.min(i.text.length,l.text.length);for(;c<u&&i.text[i.text.length-c-1]==l.text[l.text.length-c-1];)c++,n--,r--;return{a:n,b:r}}if(i.content.size||l.content.size){let c=Oo(i.content,l.content,n-1,r-1);if(c)return c}n-=a,r-=a}}class N{constructor(e,n){if(this.content=e,this.size=n||0,n==null)for(let r=0;r<e.length;r++)this.size+=e[r].nodeSize}nodesBetween(e,n,r,s=0,o){for(let i=0,l=0;l<n;i++){let a=this.content[i],c=l+a.nodeSize;if(c>e&&r(a,s+l,o||null,i)!==!1&&a.content.size){let u=l+1;a.nodesBetween(Math.max(0,e-u),Math.min(a.content.size,n-u),r,s+u)}l=c}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,n,r,s){let o="",i=!0;return this.nodesBetween(e,n,(l,a)=>{let c=l.isText?l.text.slice(Math.max(e,a)-a,n-a):l.isLeaf?s?typeof s=="function"?s(l):s:l.type.spec.leafText?l.type.spec.leafText(l):"":"";l.isBlock&&(l.isLeaf&&c||l.isTextblock)&&r&&(i?i=!1:o+=r),o+=c},0),o}append(e){if(!e.size)return this;if(!this.size)return e;let n=this.lastChild,r=e.firstChild,s=this.content.slice(),o=0;for(n.isText&&n.sameMarkup(r)&&(s[s.length-1]=n.withText(n.text+r.text),o=1);o<e.content.length;o++)s.push(e.content[o]);return new N(s,this.size+e.size)}cut(e,n=this.size){if(e==0&&n==this.size)return this;let r=[],s=0;if(n>e)for(let o=0,i=0;i<n;o++){let l=this.content[o],a=i+l.nodeSize;a>e&&((i<e||a>n)&&(l.isText?l=l.cut(Math.max(0,e-i),Math.min(l.text.length,n-i)):l=l.cut(Math.max(0,e-i-1),Math.min(l.content.size,n-i-1))),r.push(l),s+=l.nodeSize),i=a}return new N(r,s)}cutByIndex(e,n){return e==n?N.empty:e==0&&n==this.content.length?this:new N(this.content.slice(e,n))}replaceChild(e,n){let r=this.content[e];if(r==n)return this;let s=this.content.slice(),o=this.size+n.nodeSize-r.nodeSize;return s[e]=n,new N(s,o)}addToStart(e){return new N([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new N(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let n=0;n<this.content.length;n++)if(!this.content[n].eq(e.content[n]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let n=this.content[e];if(!n)throw new RangeError("Index "+e+" out of range for "+this);return n}maybeChild(e){return this.content[e]||null}forEach(e){for(let n=0,r=0;n<this.content.length;n++){let s=this.content[n];e(s,r,n),r+=s.nodeSize}}findDiffStart(e,n=0){return Ro(this,e,n)}findDiffEnd(e,n=this.size,r=e.size){return Oo(this,e,n,r)}findIndex(e){if(e==0)return Sn(0,e);if(e==this.size)return Sn(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let n=0,r=0;;n++){let s=this.child(n),o=r+s.nodeSize;if(o>=e)return o==e?Sn(n+1,o):Sn(n,r);r=o}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,n){if(!n)return N.empty;if(!Array.isArray(n))throw new RangeError("Invalid input for Fragment.fromJSON");return new N(n.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return N.empty;let n,r=0;for(let s=0;s<e.length;s++){let o=e[s];r+=o.nodeSize,s&&o.isText&&e[s-1].sameMarkup(o)?(n||(n=e.slice(0,s)),n[n.length-1]=o.withText(n[n.length-1].text+o.text)):n&&n.push(o)}return new N(n||e,r)}static from(e){if(!e)return N.empty;if(e instanceof N)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new N([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}N.empty=new N([],0);const Hr={index:0,offset:0};function Sn(t,e){return Hr.index=t,Hr.offset=e,Hr}function Cn(t,e){if(t===e)return!0;if(!(t&&typeof t=="object")||!(e&&typeof e=="object"))return!1;let n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(let r=0;r<t.length;r++)if(!Cn(t[r],e[r]))return!1}else{for(let r in t)if(!(r in e)||!Cn(t[r],e[r]))return!1;for(let r in e)if(!(r in t))return!1}return!0}let X=class mo{constructor(e,n){this.type=e,this.attrs=n}addToSet(e){let n,r=!1;for(let s=0;s<e.length;s++){let o=e[s];if(this.eq(o))return e;if(this.type.excludes(o.type))n||(n=e.slice(0,s));else{if(o.type.excludes(this.type))return e;!r&&o.type.rank>this.type.rank&&(n||(n=e.slice(0,s)),n.push(this),r=!0),n&&n.push(o)}}return n||(n=e.slice()),r||n.push(this),n}removeFromSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return e.slice(0,n).concat(e.slice(n+1));return e}isInSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return!0;return!1}eq(e){return this==e||this.type==e.type&&Cn(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Mark.fromJSON");let r=e.marks[n.type];if(!r)throw new RangeError(`There is no mark type ${n.type} in this schema`);let s=r.create(n.attrs);return r.checkAttrs(s.attrs),s}static sameSet(e,n){if(e==n)return!0;if(e.length!=n.length)return!1;for(let r=0;r<e.length;r++)if(!e[r].eq(n[r]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return mo.none;if(e instanceof mo)return[e];let n=e.slice();return n.sort((r,s)=>r.type.rank-s.type.rank),n}};X.none=[];class En extends Error{}class T{constructor(e,n,r){this.content=e,this.openStart=n,this.openEnd=r}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,n){let r=Io(this.content,e+this.openStart,n);return r&&new T(r,this.openStart,this.openEnd)}removeBetween(e,n){return new T(jo(this.content,e+this.openStart,n+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,n){if(!n)return T.empty;let r=n.openStart||0,s=n.openEnd||0;if(typeof r!="number"||typeof s!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new T(N.fromJSON(e,n.content),r,s)}static maxOpen(e,n=!0){let r=0,s=0;for(let o=e.firstChild;o&&!o.isLeaf&&(n||!o.type.spec.isolating);o=o.firstChild)r++;for(let o=e.lastChild;o&&!o.isLeaf&&(n||!o.type.spec.isolating);o=o.lastChild)s++;return new T(e,r,s)}}T.empty=new T(N.empty,0,0);function jo(t,e,n){let{index:r,offset:s}=t.findIndex(e),o=t.maybeChild(r),{index:i,offset:l}=t.findIndex(n);if(s==e||o.isText){if(l!=n&&!t.child(i).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(r!=i)throw new RangeError("Removing non-flat range");return t.replaceChild(r,o.copy(jo(o.content,e-s-1,n-s-1)))}function Io(t,e,n,r){let{index:s,offset:o}=t.findIndex(e),i=t.maybeChild(s);if(o==e||i.isText)return r&&!r.canReplace(s,s,n)?null:t.cut(0,e).append(n).append(t.cut(e));let l=Io(i.content,e-o-1,n,i);return l&&t.replaceChild(s,i.copy(l))}function pc(t,e,n){if(n.openStart>t.depth)throw new En("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new En("Inconsistent open depths");return zo(t,e,n,0)}function zo(t,e,n,r){let s=t.index(r),o=t.node(r);if(s==e.index(r)&&r<t.depth-n.openStart){let i=zo(t,e,n,r+1);return o.copy(o.content.replaceChild(s,i))}else if(n.content.size)if(!n.openStart&&!n.openEnd&&t.depth==r&&e.depth==r){let i=t.parent,l=i.content;return ct(i,l.cut(0,t.parentOffset).append(n.content).append(l.cut(e.parentOffset)))}else{let{start:i,end:l}=mc(n,t);return ct(o,Po(t,i,l,e,r))}else return ct(o,Nn(t,e,r))}function Lo(t,e){if(!e.type.compatibleContent(t.type))throw new En("Cannot join "+e.type.name+" onto "+t.type.name)}function Wr(t,e,n){let r=t.node(n);return Lo(r,e.node(n)),r}function at(t,e){let n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function Vt(t,e,n,r){let s=(e||t).node(n),o=0,i=e?e.index(n):s.childCount;t&&(o=t.index(n),t.depth>n?o++:t.textOffset&&(at(t.nodeAfter,r),o++));for(let l=o;l<i;l++)at(s.child(l),r);e&&e.depth==n&&e.textOffset&&at(e.nodeBefore,r)}function ct(t,e){return t.type.checkContent(e),t.copy(e)}function Po(t,e,n,r,s){let o=t.depth>s&&Wr(t,e,s+1),i=r.depth>s&&Wr(n,r,s+1),l=[];return Vt(null,t,s,l),o&&i&&e.index(s)==n.index(s)?(Lo(o,i),at(ct(o,Po(t,e,n,r,s+1)),l)):(o&&at(ct(o,Nn(t,e,s+1)),l),Vt(e,n,s,l),i&&at(ct(i,Nn(n,r,s+1)),l)),Vt(r,null,s,l),new N(l)}function Nn(t,e,n){let r=[];if(Vt(null,t,n,r),t.depth>n){let s=Wr(t,e,n+1);at(ct(s,Nn(t,e,n+1)),r)}return Vt(e,null,n,r),new N(r)}function mc(t,e){let n=e.depth-t.openStart,s=e.node(n).copy(t.content);for(let o=n-1;o>=0;o--)s=e.node(o).copy(N.from(s));return{start:s.resolveNoCache(t.openStart+n),end:s.resolveNoCache(s.content.size-t.openEnd-n)}}class Ut{constructor(e,n,r){this.pos=e,this.path=n,this.parentOffset=r,this.depth=n.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,n=this.index(this.depth);if(n==e.childCount)return null;let r=this.pos-this.path[this.path.length-1],s=e.child(n);return r?e.child(n).cut(r):s}get nodeBefore(){let e=this.index(this.depth),n=this.pos-this.path[this.path.length-1];return n?this.parent.child(e).cut(0,n):e==0?null:this.parent.child(e-1)}posAtIndex(e,n){n=this.resolveDepth(n);let r=this.path[n*3],s=n==0?0:this.path[n*3-1]+1;for(let o=0;o<e;o++)s+=r.child(o).nodeSize;return s}marks(){let e=this.parent,n=this.index();if(e.content.size==0)return X.none;if(this.textOffset)return e.child(n).marks;let r=e.maybeChild(n-1),s=e.maybeChild(n);if(!r){let l=r;r=s,s=l}let o=r.marks;for(var i=0;i<o.length;i++)o[i].type.spec.inclusive===!1&&(!s||!o[i].isInSet(s.marks))&&(o=o[i--].removeFromSet(o));return o}marksAcross(e){let n=this.parent.maybeChild(this.index());if(!n||!n.isInline)return null;let r=n.marks,s=e.parent.maybeChild(e.index());for(var o=0;o<r.length;o++)r[o].type.spec.inclusive===!1&&(!s||!r[o].isInSet(s.marks))&&(r=r[o--].removeFromSet(r));return r}sharedDepth(e){for(let n=this.depth;n>0;n--)if(this.start(n)<=e&&this.end(n)>=e)return n;return 0}blockRange(e=this,n){if(e.pos<this.pos)return e.blockRange(this);for(let r=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);r>=0;r--)if(e.pos<=this.end(r)&&(!n||n(this.node(r))))return new An(this,e,r);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let n=1;n<=this.depth;n++)e+=(e?"/":"")+this.node(n).type.name+"_"+this.index(n-1);return e+":"+this.parentOffset}static resolve(e,n){if(!(n>=0&&n<=e.content.size))throw new RangeError("Position "+n+" out of range");let r=[],s=0,o=n;for(let i=e;;){let{index:l,offset:a}=i.content.findIndex(o),c=o-a;if(r.push(i,l,s+a),!c||(i=i.child(l),i.isText))break;o=c-1,s+=a+1}return new Ut(n,r,o)}static resolveCached(e,n){let r=Do.get(e);if(r)for(let o=0;o<r.elts.length;o++){let i=r.elts[o];if(i.pos==n)return i}else Do.set(e,r=new gc);let s=r.elts[r.i]=Ut.resolve(e,n);return r.i=(r.i+1)%yc,s}}class gc{constructor(){this.elts=[],this.i=0}}const yc=12,Do=new WeakMap;class An{constructor(e,n,r){this.$from=e,this.$to=n,this.depth=r}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const bc=Object.create(null);class Le{constructor(e,n,r,s=X.none){this.type=e,this.attrs=n,this.marks=s,this.content=r||N.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,n,r,s=0){this.content.nodesBetween(e,n,r,s,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,n,r,s){return this.content.textBetween(e,n,r,s)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,n,r){return this.type==e&&Cn(this.attrs,n||e.defaultAttrs||bc)&&X.sameSet(this.marks,r||X.none)}copy(e=null){return e==this.content?this:new Le(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new Le(this.type,this.attrs,this.content,e)}cut(e,n=this.content.size){return e==0&&n==this.content.size?this:this.copy(this.content.cut(e,n))}slice(e,n=this.content.size,r=!1){if(e==n)return T.empty;let s=this.resolve(e),o=this.resolve(n),i=r?0:s.sharedDepth(n),l=s.start(i),c=s.node(i).content.cut(s.pos-l,o.pos-l);return new T(c,s.depth-i,o.depth-i)}replace(e,n,r){return pc(this.resolve(e),this.resolve(n),r)}nodeAt(e){for(let n=this;;){let{index:r,offset:s}=n.content.findIndex(e);if(n=n.maybeChild(r),!n)return null;if(s==e||n.isText)return n;e-=s+1}}childAfter(e){let{index:n,offset:r}=this.content.findIndex(e);return{node:this.content.maybeChild(n),index:n,offset:r}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:n,offset:r}=this.content.findIndex(e);if(r<e)return{node:this.content.child(n),index:n,offset:r};let s=this.content.child(n-1);return{node:s,index:n-1,offset:r-s.nodeSize}}resolve(e){return Ut.resolveCached(this,e)}resolveNoCache(e){return Ut.resolve(this,e)}rangeHasMark(e,n,r){let s=!1;return n>e&&this.nodesBetween(e,n,o=>(r.isInSet(o.marks)&&(s=!0),!s)),s}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),$o(this.marks,e)}contentMatchAt(e){let n=this.type.contentMatch.matchFragment(this.content,0,e);if(!n)throw new Error("Called contentMatchAt on a node with invalid content");return n}canReplace(e,n,r=N.empty,s=0,o=r.childCount){let i=this.contentMatchAt(e).matchFragment(r,s,o),l=i&&i.matchFragment(this.content,n);if(!l||!l.validEnd)return!1;for(let a=s;a<o;a++)if(!this.type.allowsMarks(r.child(a).marks))return!1;return!0}canReplaceWith(e,n,r,s){if(s&&!this.type.allowsMarks(s))return!1;let o=this.contentMatchAt(e).matchType(r),i=o&&o.matchFragment(this.content,n);return i?i.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=X.none;for(let n=0;n<this.marks.length;n++){let r=this.marks[n];r.type.checkAttrs(r.attrs),e=r.addToSet(e)}if(!X.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(n=>n.type.name)}`);this.content.forEach(n=>n.check())}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(n=>n.toJSON())),e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Node.fromJSON");let r;if(n.marks){if(!Array.isArray(n.marks))throw new RangeError("Invalid mark data for Node.fromJSON");r=n.marks.map(e.markFromJSON)}if(n.type=="text"){if(typeof n.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(n.text,r)}let s=N.fromJSON(e,n.content),o=e.nodeType(n.type).create(n.attrs,s,r);return o.type.checkAttrs(o.attrs),o}}Le.prototype.text=void 0;class Tn extends Le{constructor(e,n,r,s){if(super(e,n,null,s),!r)throw new RangeError("Empty text nodes are not allowed");this.text=r}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):$o(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,n){return this.text.slice(e,n)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new Tn(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new Tn(this.type,this.attrs,e,this.marks)}cut(e=0,n=this.text.length){return e==0&&n==this.text.length?this:this.withText(this.text.slice(e,n))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function $o(t,e){for(let n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}class ut{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,n){let r=new xc(e,n);if(r.next==null)return ut.empty;let s=Fo(r);r.next&&r.err("Unexpected trailing text");let o=Nc(Ec(s));return Ac(o,r),o}matchType(e){for(let n=0;n<this.next.length;n++)if(this.next[n].type==e)return this.next[n].next;return null}matchFragment(e,n=0,r=e.childCount){let s=this;for(let o=n;s&&o<r;o++)s=s.matchType(e.child(o).type);return s}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:n}=this.next[e];if(!(n.isText||n.hasRequiredAttrs()))return n}return null}compatible(e){for(let n=0;n<this.next.length;n++)for(let r=0;r<e.next.length;r++)if(this.next[n].type==e.next[r].type)return!0;return!1}fillBefore(e,n=!1,r=0){let s=[this];function o(i,l){let a=i.matchFragment(e,r);if(a&&(!n||a.validEnd))return N.from(l.map(c=>c.createAndFill()));for(let c=0;c<i.next.length;c++){let{type:u,next:d}=i.next[c];if(!(u.isText||u.hasRequiredAttrs())&&s.indexOf(d)==-1){s.push(d);let f=o(d,l.concat(u));if(f)return f}}return null}return o(this,[])}findWrapping(e){for(let r=0;r<this.wrapCache.length;r+=2)if(this.wrapCache[r]==e)return this.wrapCache[r+1];let n=this.computeWrapping(e);return this.wrapCache.push(e,n),n}computeWrapping(e){let n=Object.create(null),r=[{match:this,type:null,via:null}];for(;r.length;){let s=r.shift(),o=s.match;if(o.matchType(e)){let i=[];for(let l=s;l.type;l=l.via)i.push(l.type);return i.reverse()}for(let i=0;i<o.next.length;i++){let{type:l,next:a}=o.next[i];!l.isLeaf&&!l.hasRequiredAttrs()&&!(l.name in n)&&(!s.type||a.validEnd)&&(r.push({match:l.contentMatch,type:l,via:s}),n[l.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function n(r){e.push(r);for(let s=0;s<r.next.length;s++)e.indexOf(r.next[s].next)==-1&&n(r.next[s].next)}return n(this),e.map((r,s)=>{let o=s+(r.validEnd?"*":" ")+" ";for(let i=0;i<r.next.length;i++)o+=(i?", ":"")+r.next[i].type.name+"->"+e.indexOf(r.next[i].next);return o}).join(`
`)}}ut.empty=new ut(!0);class xc{constructor(e,n){this.string=e,this.nodeTypes=n,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function Fo(t){let e=[];do e.push(wc(t));while(t.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function wc(t){let e=[];do e.push(vc(t));while(t.next&&t.next!=")"&&t.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function vc(t){let e=Cc(t);for(;;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else if(t.eat("{"))e=kc(t,e);else break;return e}function Bo(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");let e=Number(t.next);return t.pos++,e}function kc(t,e){let n=Bo(t),r=n;return t.eat(",")&&(t.next!="}"?r=Bo(t):r=-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:e}}function Sc(t,e){let n=t.nodeTypes,r=n[e];if(r)return[r];let s=[];for(let o in n){let i=n[o];i.isInGroup(e)&&s.push(i)}return s.length==0&&t.err("No node type or group '"+e+"' found"),s}function Cc(t){if(t.eat("(")){let e=Fo(t);return t.eat(")")||t.err("Missing closing paren"),e}else if(/\W/.test(t.next))t.err("Unexpected token '"+t.next+"'");else{let e=Sc(t,t.next).map(n=>(t.inline==null?t.inline=n.isInline:t.inline!=n.isInline&&t.err("Mixing inline and block content"),{type:"name",value:n}));return t.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function Ec(t){let e=[[]];return s(o(t,0),n()),e;function n(){return e.push([])-1}function r(i,l,a){let c={term:a,to:l};return e[i].push(c),c}function s(i,l){i.forEach(a=>a.to=l)}function o(i,l){if(i.type=="choice")return i.exprs.reduce((a,c)=>a.concat(o(c,l)),[]);if(i.type=="seq")for(let a=0;;a++){let c=o(i.exprs[a],l);if(a==i.exprs.length-1)return c;s(c,l=n())}else if(i.type=="star"){let a=n();return r(l,a),s(o(i.expr,a),a),[r(a)]}else if(i.type=="plus"){let a=n();return s(o(i.expr,l),a),s(o(i.expr,a),a),[r(a)]}else{if(i.type=="opt")return[r(l)].concat(o(i.expr,l));if(i.type=="range"){let a=l;for(let c=0;c<i.min;c++){let u=n();s(o(i.expr,a),u),a=u}if(i.max==-1)s(o(i.expr,a),a);else for(let c=i.min;c<i.max;c++){let u=n();r(a,u),s(o(i.expr,a),u),a=u}return[r(a)]}else{if(i.type=="name")return[r(l,void 0,i.value)];throw new Error("Unknown expr type")}}}}function Ho(t,e){return e-t}function Wo(t,e){let n=[];return r(e),n.sort(Ho);function r(s){let o=t[s];if(o.length==1&&!o[0].term)return r(o[0].to);n.push(s);for(let i=0;i<o.length;i++){let{term:l,to:a}=o[i];!l&&n.indexOf(a)==-1&&r(a)}}}function Nc(t){let e=Object.create(null);return n(Wo(t,0));function n(r){let s=[];r.forEach(i=>{t[i].forEach(({term:l,to:a})=>{if(!l)return;let c;for(let u=0;u<s.length;u++)s[u][0]==l&&(c=s[u][1]);Wo(t,a).forEach(u=>{c||s.push([l,c=[]]),c.indexOf(u)==-1&&c.push(u)})})});let o=e[r.join(",")]=new ut(r.indexOf(t.length-1)>-1);for(let i=0;i<s.length;i++){let l=s[i][1].sort(Ho);o.next.push({type:s[i][0],next:e[l.join(",")]||n(l)})}return o}}function Ac(t,e){for(let n=0,r=[t];n<r.length;n++){let s=r[n],o=!s.validEnd,i=[];for(let l=0;l<s.next.length;l++){let{type:a,next:c}=s.next[l];i.push(a.name),o&&!(a.isText||a.hasRequiredAttrs())&&(o=!1),r.indexOf(c)==-1&&r.push(c)}o&&e.err("Only non-generatable nodes ("+i.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function _o(t){let e=Object.create(null);for(let n in t){let r=t[n];if(!r.hasDefault)return null;e[n]=r.default}return e}function Ko(t,e){let n=Object.create(null);for(let r in t){let s=e&&e[r];if(s===void 0){let o=t[r];if(o.hasDefault)s=o.default;else throw new RangeError("No value supplied for attribute "+r)}n[r]=s}return n}function Vo(t,e,n,r){for(let s in e)if(!(s in t))throw new RangeError(`Unsupported attribute ${s} for ${n} of type ${s}`);for(let s in t){let o=t[s];o.validate&&o.validate(e[s])}}function Uo(t,e){let n=Object.create(null);if(e)for(let r in e)n[r]=new Mc(t,r,e[r]);return n}let qo=class La{constructor(e,n,r){this.name=e,this.schema=n,this.spec=r,this.markSet=null,this.groups=r.group?r.group.split(" "):[],this.attrs=Uo(e,r.attrs),this.defaultAttrs=_o(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(r.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==ut.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:Ko(this.attrs,e)}create(e=null,n,r){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Le(this,this.computeAttrs(e),N.from(n),X.setFrom(r))}createChecked(e=null,n,r){return n=N.from(n),this.checkContent(n),new Le(this,this.computeAttrs(e),n,X.setFrom(r))}createAndFill(e=null,n,r){if(e=this.computeAttrs(e),n=N.from(n),n.size){let i=this.contentMatch.fillBefore(n);if(!i)return null;n=i.append(n)}let s=this.contentMatch.matchFragment(n),o=s&&s.fillBefore(N.empty,!0);return o?new Le(this,e,n.append(o),X.setFrom(r)):null}validContent(e){let n=this.contentMatch.matchFragment(e);if(!n||!n.validEnd)return!1;for(let r=0;r<e.childCount;r++)if(!this.allowsMarks(e.child(r).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){Vo(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let n=0;n<e.length;n++)if(!this.allowsMarkType(e[n].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let n;for(let r=0;r<e.length;r++)this.allowsMarkType(e[r].type)?n&&n.push(e[r]):n||(n=e.slice(0,r));return n?n.length?n:X.none:e}static compile(e,n){let r=Object.create(null);e.forEach((o,i)=>r[o]=new La(o,n,i));let s=n.spec.topNode||"doc";if(!r[s])throw new RangeError("Schema is missing its top node type ('"+s+"')");if(!r.text)throw new RangeError("Every schema needs a 'text' type");for(let o in r.text.attrs)throw new RangeError("The text node type should not have attributes");return r}};function Tc(t,e,n){let r=n.split("|");return s=>{let o=s===null?"null":typeof s;if(r.indexOf(o)<0)throw new RangeError(`Expected value of type ${r} for attribute ${e} on type ${t}, got ${o}`)}}class Mc{constructor(e,n,r){this.hasDefault=Object.prototype.hasOwnProperty.call(r,"default"),this.default=r.default,this.validate=typeof r.validate=="string"?Tc(e,n,r.validate):r.validate}get isRequired(){return!this.hasDefault}}class Mn{constructor(e,n,r,s){this.name=e,this.rank=n,this.schema=r,this.spec=s,this.attrs=Uo(e,s.attrs),this.excluded=null;let o=_o(this.attrs);this.instance=o?new X(this,o):null}create(e=null){return!e&&this.instance?this.instance:new X(this,Ko(this.attrs,e))}static compile(e,n){let r=Object.create(null),s=0;return e.forEach((o,i)=>r[o]=new Mn(o,s++,n,i)),r}removeFromSet(e){for(var n=0;n<e.length;n++)e[n].type==this&&(e=e.slice(0,n).concat(e.slice(n+1)),n--);return e}isInSet(e){for(let n=0;n<e.length;n++)if(e[n].type==this)return e[n]}checkAttrs(e){Vo(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}class Rc{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let n=this.spec={};for(let s in e)n[s]=e[s];n.nodes=le.from(e.nodes),n.marks=le.from(e.marks||{}),this.nodes=qo.compile(this.spec.nodes,this),this.marks=Mn.compile(this.spec.marks,this);let r=Object.create(null);for(let s in this.nodes){if(s in this.marks)throw new RangeError(s+" can not be both a node and a mark");let o=this.nodes[s],i=o.spec.content||"",l=o.spec.marks;if(o.contentMatch=r[i]||(r[i]=ut.parse(i,this.nodes)),o.inlineContent=o.contentMatch.inlineContent,o.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!o.isInline||!o.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=o}o.markSet=l=="_"?null:l?Jo(this,l.split(" ")):l==""||!o.inlineContent?[]:null}for(let s in this.marks){let o=this.marks[s],i=o.spec.excludes;o.excluded=i==null?[o]:i==""?[]:Jo(this,i.split(" "))}this.nodeFromJSON=s=>Le.fromJSON(this,s),this.markFromJSON=s=>X.fromJSON(this,s),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,n=null,r,s){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof qo){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(n,r,s)}text(e,n){let r=this.nodes.text;return new Tn(r,r.defaultAttrs,e,X.setFrom(n))}mark(e,n){return typeof e=="string"&&(e=this.marks[e]),e.create(n)}nodeType(e){let n=this.nodes[e];if(!n)throw new RangeError("Unknown node type: "+e);return n}}function Jo(t,e){let n=[];for(let r=0;r<e.length;r++){let s=e[r],o=t.marks[s],i=o;if(o)n.push(o);else for(let l in t.marks){let a=t.marks[l];(s=="_"||a.spec.group&&a.spec.group.split(" ").indexOf(s)>-1)&&n.push(i=a)}if(!i)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return n}function Oc(t){return t.tag!=null}function jc(t){return t.style!=null}class dt{constructor(e,n){this.schema=e,this.rules=n,this.tags=[],this.styles=[];let r=this.matchedStyles=[];n.forEach(s=>{if(Oc(s))this.tags.push(s);else if(jc(s)){let o=/[^=]*/.exec(s.style)[0];r.indexOf(o)<0&&r.push(o),this.styles.push(s)}}),this.normalizeLists=!this.tags.some(s=>{if(!/^(ul|ol)\b/.test(s.tag)||!s.node)return!1;let o=e.nodes[s.node];return o.contentMatch.matchType(o)})}parse(e,n={}){let r=new Xo(this,n,!1);return r.addAll(e,X.none,n.from,n.to),r.finish()}parseSlice(e,n={}){let r=new Xo(this,n,!0);return r.addAll(e,X.none,n.from,n.to),T.maxOpen(r.finish())}matchTag(e,n,r){for(let s=r?this.tags.indexOf(r)+1:0;s<this.tags.length;s++){let o=this.tags[s];if(Lc(e,o.tag)&&(o.namespace===void 0||e.namespaceURI==o.namespace)&&(!o.context||n.matchesContext(o.context))){if(o.getAttrs){let i=o.getAttrs(e);if(i===!1)continue;o.attrs=i||void 0}return o}}}matchStyle(e,n,r,s){for(let o=s?this.styles.indexOf(s)+1:0;o<this.styles.length;o++){let i=this.styles[o],l=i.style;if(!(l.indexOf(e)!=0||i.context&&!r.matchesContext(i.context)||l.length>e.length&&(l.charCodeAt(e.length)!=61||l.slice(e.length+1)!=n))){if(i.getAttrs){let a=i.getAttrs(n);if(a===!1)continue;i.attrs=a||void 0}return i}}}static schemaRules(e){let n=[];function r(s){let o=s.priority==null?50:s.priority,i=0;for(;i<n.length;i++){let l=n[i];if((l.priority==null?50:l.priority)<o)break}n.splice(i,0,s)}for(let s in e.marks){let o=e.marks[s].spec.parseDOM;o&&o.forEach(i=>{r(i=Zo(i)),i.mark||i.ignore||i.clearMark||(i.mark=s)})}for(let s in e.nodes){let o=e.nodes[s].spec.parseDOM;o&&o.forEach(i=>{r(i=Zo(i)),i.node||i.ignore||i.mark||(i.node=s)})}return n}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new dt(e,dt.schemaRules(e)))}}const Go={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},Ic={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},Yo={ol:!0,ul:!0},qt=1,_r=2,Jt=4;function Qo(t,e,n){return e!=null?(e?qt:0)|(e==="full"?_r:0):t&&t.whitespace=="pre"?qt|_r:n&~Jt}class Rn{constructor(e,n,r,s,o,i){this.type=e,this.attrs=n,this.marks=r,this.solid=s,this.options=i,this.content=[],this.activeMarks=X.none,this.match=o||(i&Jt?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let n=this.type.contentMatch.fillBefore(N.from(e));if(n)this.match=this.type.contentMatch.matchFragment(n);else{let r=this.type.contentMatch,s;return(s=r.findWrapping(e.type))?(this.match=r,s):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&qt)){let r=this.content[this.content.length-1],s;if(r&&r.isText&&(s=/[ \t\r\n\u000c]+$/.exec(r.text))){let o=r;r.text.length==s[0].length?this.content.pop():this.content[this.content.length-1]=o.withText(o.text.slice(0,o.text.length-s[0].length))}}let n=N.from(this.content);return!e&&this.match&&(n=n.append(this.match.fillBefore(N.empty,!0))),this.type?this.type.create(this.attrs,n,this.marks):n}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!Go.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class Xo{constructor(e,n,r){this.parser=e,this.options=n,this.isOpen=r,this.open=0,this.localPreserveWS=!1;let s=n.topNode,o,i=Qo(null,n.preserveWhitespace,0)|(r?Jt:0);s?o=new Rn(s.type,s.attrs,X.none,!0,n.topMatch||s.type.contentMatch,i):r?o=new Rn(null,null,X.none,!0,null,i):o=new Rn(e.schema.topNodeType,null,X.none,!0,null,i),this.nodes=[o],this.find=n.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,n){e.nodeType==3?this.addTextNode(e,n):e.nodeType==1&&this.addElement(e,n)}addTextNode(e,n){let r=e.nodeValue,s=this.top,o=s.options&_r?"full":this.localPreserveWS||(s.options&qt)>0,{schema:i}=this.parser;if(o==="full"||s.inlineContext(e)||/[^ \t\r\n\u000c]/.test(r)){if(o)if(o==="full")r=r.replace(/\r\n?/g,`
`);else if(i.linebreakReplacement&&/[\r\n]/.test(r)&&this.top.findWrapping(i.linebreakReplacement.create())){let l=r.split(/\r?\n|\r/);for(let a=0;a<l.length;a++)a&&this.insertNode(i.linebreakReplacement.create(),n,!0),l[a]&&this.insertNode(i.text(l[a]),n,!/\S/.test(l[a]));r=""}else r=r.replace(/\r?\n|\r/g," ");else if(r=r.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(r)&&this.open==this.nodes.length-1){let l=s.content[s.content.length-1],a=e.previousSibling;(!l||a&&a.nodeName=="BR"||l.isText&&/[ \t\r\n\u000c]$/.test(l.text))&&(r=r.slice(1))}r&&this.insertNode(i.text(r),n,!/\S/.test(r)),this.findInText(e)}else this.findInside(e)}addElement(e,n,r){let s=this.localPreserveWS,o=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let i=e.nodeName.toLowerCase(),l;Yo.hasOwnProperty(i)&&this.parser.normalizeLists&&zc(e);let a=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(l=this.parser.matchTag(e,this,r));e:if(a?a.ignore:Ic.hasOwnProperty(i))this.findInside(e),this.ignoreFallback(e,n);else if(!a||a.skip||a.closeParent){a&&a.closeParent?this.open=Math.max(0,this.open-1):a&&a.skip.nodeType&&(e=a.skip);let c,u=this.needsBlock;if(Go.hasOwnProperty(i))o.content.length&&o.content[0].isInline&&this.open&&(this.open--,o=this.top),c=!0,o.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,n);break e}let d=a&&a.skip?n:this.readStyles(e,n);d&&this.addAll(e,d),c&&this.sync(o),this.needsBlock=u}else{let c=this.readStyles(e,n);c&&this.addElementByRule(e,a,c,a.consuming===!1?l:void 0)}this.localPreserveWS=s}leafFallback(e,n){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),n)}ignoreFallback(e,n){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),n,!0)}readStyles(e,n){let r=e.style;if(r&&r.length)for(let s=0;s<this.parser.matchedStyles.length;s++){let o=this.parser.matchedStyles[s],i=r.getPropertyValue(o);if(i)for(let l=void 0;;){let a=this.parser.matchStyle(o,i,this,l);if(!a)break;if(a.ignore)return null;if(a.clearMark?n=n.filter(c=>!a.clearMark(c)):n=n.concat(this.parser.schema.marks[a.mark].create(a.attrs)),a.consuming===!1)l=a;else break}}return n}addElementByRule(e,n,r,s){let o,i;if(n.node)if(i=this.parser.schema.nodes[n.node],i.isLeaf)this.insertNode(i.create(n.attrs),r,e.nodeName=="BR")||this.leafFallback(e,r);else{let a=this.enter(i,n.attrs||null,r,n.preserveWhitespace);a&&(o=!0,r=a)}else{let a=this.parser.schema.marks[n.mark];r=r.concat(a.create(n.attrs))}let l=this.top;if(i&&i.isLeaf)this.findInside(e);else if(s)this.addElement(e,r,s);else if(n.getContent)this.findInside(e),n.getContent(e,this.parser.schema).forEach(a=>this.insertNode(a,r,!1));else{let a=e;typeof n.contentElement=="string"?a=e.querySelector(n.contentElement):typeof n.contentElement=="function"?a=n.contentElement(e):n.contentElement&&(a=n.contentElement),this.findAround(e,a,!0),this.addAll(a,r),this.findAround(e,a,!1)}o&&this.sync(l)&&this.open--}addAll(e,n,r,s){let o=r||0;for(let i=r?e.childNodes[r]:e.firstChild,l=s==null?null:e.childNodes[s];i!=l;i=i.nextSibling,++o)this.findAtPoint(e,o),this.addDOM(i,n);this.findAtPoint(e,o)}findPlace(e,n,r){let s,o;for(let i=this.open,l=0;i>=0;i--){let a=this.nodes[i],c=a.findWrapping(e);if(c&&(!s||s.length>c.length+l)&&(s=c,o=a,!c.length))break;if(a.solid){if(r)break;l+=2}}if(!s)return null;this.sync(o);for(let i=0;i<s.length;i++)n=this.enterInner(s[i],null,n,!1);return n}insertNode(e,n,r){if(e.isInline&&this.needsBlock&&!this.top.type){let o=this.textblockFromContext();o&&(n=this.enterInner(o,null,n))}let s=this.findPlace(e,n,r);if(s){this.closeExtra();let o=this.top;o.match&&(o.match=o.match.matchType(e.type));let i=X.none;for(let l of s.concat(e.marks))(o.type?o.type.allowsMarkType(l.type):ei(l.type,e.type))&&(i=l.addToSet(i));return o.content.push(e.mark(i)),!0}return!1}enter(e,n,r,s){let o=this.findPlace(e.create(n),r,!1);return o&&(o=this.enterInner(e,n,r,!0,s)),o}enterInner(e,n,r,s=!1,o){this.closeExtra();let i=this.top;i.match=i.match&&i.match.matchType(e);let l=Qo(e,o,i.options);i.options&Jt&&i.content.length==0&&(l|=Jt);let a=X.none;return r=r.filter(c=>(i.type?i.type.allowsMarkType(c.type):ei(c.type,e))?(a=c.addToSet(a),!1):!0),this.nodes.push(new Rn(e,n,a,s,null,l)),this.open++,r}closeExtra(e=!1){let n=this.nodes.length-1;if(n>this.open){for(;n>this.open;n--)this.nodes[n-1].content.push(this.nodes[n].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let n=this.open;n>=0;n--){if(this.nodes[n]==e)return this.open=n,!0;this.localPreserveWS&&(this.nodes[n].options|=qt)}return!1}get currentPos(){this.closeExtra();let e=0;for(let n=this.open;n>=0;n--){let r=this.nodes[n].content;for(let s=r.length-1;s>=0;s--)e+=r[s].nodeSize;n&&e++}return e}findAtPoint(e,n){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].node==e&&this.find[r].offset==n&&(this.find[r].pos=this.currentPos)}findInside(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].pos==null&&e.nodeType==1&&e.contains(this.find[n].node)&&(this.find[n].pos=this.currentPos)}findAround(e,n,r){if(e!=n&&this.find)for(let s=0;s<this.find.length;s++)this.find[s].pos==null&&e.nodeType==1&&e.contains(this.find[s].node)&&n.compareDocumentPosition(this.find[s].node)&(r?2:4)&&(this.find[s].pos=this.currentPos)}findInText(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&(this.find[n].pos=this.currentPos-(e.nodeValue.length-this.find[n].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let n=e.split("/"),r=this.options.context,s=!this.isOpen&&(!r||r.parent.type==this.nodes[0].type),o=-(r?r.depth+1:0)+(s?0:1),i=(l,a)=>{for(;l>=0;l--){let c=n[l];if(c==""){if(l==n.length-1||l==0)continue;for(;a>=o;a--)if(i(l-1,a))return!0;return!1}else{let u=a>0||a==0&&s?this.nodes[a].type:r&&a>=o?r.node(a-o).type:null;if(!u||u.name!=c&&!u.isInGroup(c))return!1;a--}}return!0};return i(n.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let n=e.depth;n>=0;n--){let r=e.node(n).contentMatchAt(e.indexAfter(n)).defaultType;if(r&&r.isTextblock&&r.defaultAttrs)return r}for(let n in this.parser.schema.nodes){let r=this.parser.schema.nodes[n];if(r.isTextblock&&r.defaultAttrs)return r}}}function zc(t){for(let e=t.firstChild,n=null;e;e=e.nextSibling){let r=e.nodeType==1?e.nodeName.toLowerCase():null;r&&Yo.hasOwnProperty(r)&&n?(n.appendChild(e),e=n):r=="li"?n=e:r&&(n=null)}}function Lc(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function Zo(t){let e={};for(let n in t)e[n]=t[n];return e}function ei(t,e){let n=e.schema.nodes;for(let r in n){let s=n[r];if(!s.allowsMarkType(t))continue;let o=[],i=l=>{o.push(l);for(let a=0;a<l.edgeCount;a++){let{type:c,next:u}=l.edge(a);if(c==e||o.indexOf(u)<0&&i(u))return!0}};if(i(s.contentMatch))return!0}}class On{constructor(e,n){this.nodes=e,this.marks=n}serializeFragment(e,n={},r){r||(r=Kr(n).createDocumentFragment());let s=r,o=[];return e.forEach(i=>{if(o.length||i.marks.length){let l=0,a=0;for(;l<o.length&&a<i.marks.length;){let c=i.marks[a];if(!this.marks[c.type.name]){a++;continue}if(!c.eq(o[l][0])||c.type.spec.spanning===!1)break;l++,a++}for(;l<o.length;)s=o.pop()[1];for(;a<i.marks.length;){let c=i.marks[a++],u=this.serializeMark(c,i.isInline,n);u&&(o.push([c,s]),s.appendChild(u.dom),s=u.contentDOM||u.dom)}}s.appendChild(this.serializeNodeInner(i,n))}),r}serializeNodeInner(e,n){let{dom:r,contentDOM:s}=jn(Kr(n),this.nodes[e.type.name](e),null,e.attrs);if(s){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,n,s)}return r}serializeNode(e,n={}){let r=this.serializeNodeInner(e,n);for(let s=e.marks.length-1;s>=0;s--){let o=this.serializeMark(e.marks[s],e.isInline,n);o&&((o.contentDOM||o.dom).appendChild(r),r=o.dom)}return r}serializeMark(e,n,r={}){let s=this.marks[e.type.name];return s&&jn(Kr(r),s(e,n),null,e.attrs)}static renderSpec(e,n,r=null,s){return jn(e,n,r,s)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new On(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let n=ti(e.nodes);return n.text||(n.text=r=>r.text),n}static marksFromSchema(e){return ti(e.marks)}}function ti(t){let e={};for(let n in t){let r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function Kr(t){return t.document||window.document}const ni=new WeakMap;function Pc(t){let e=ni.get(t);return e===void 0&&ni.set(t,e=Dc(t)),e}function Dc(t){let e=null;function n(r){if(r&&typeof r=="object")if(Array.isArray(r))if(typeof r[0]=="string")e||(e=[]),e.push(r);else for(let s=0;s<r.length;s++)n(r[s]);else for(let s in r)n(r[s])}return n(t),e}function jn(t,e,n,r){if(typeof e=="string")return{dom:t.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let s=e[0],o;if(typeof s!="string")throw new RangeError("Invalid array passed to renderSpec");if(r&&(o=Pc(r))&&o.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let i=s.indexOf(" ");i>0&&(n=s.slice(0,i),s=s.slice(i+1));let l,a=n?t.createElementNS(n,s):t.createElement(s),c=e[1],u=1;if(c&&typeof c=="object"&&c.nodeType==null&&!Array.isArray(c)){u=2;for(let d in c)if(c[d]!=null){let f=d.indexOf(" ");f>0?a.setAttributeNS(d.slice(0,f),d.slice(f+1),c[d]):d=="style"&&a.style?a.style.cssText=c[d]:a.setAttribute(d,c[d])}}for(let d=u;d<e.length;d++){let f=e[d];if(f===0){if(d<e.length-1||d>u)throw new RangeError("Content hole must be the only child of its parent node");return{dom:a,contentDOM:a}}else{let{dom:h,contentDOM:p}=jn(t,f,n,r);if(a.appendChild(h),p){if(l)throw new RangeError("Multiple content holes");l=p}}}return{dom:a,contentDOM:l}}const ri=65535,si=Math.pow(2,16);function $c(t,e){return t+e*si}function oi(t){return t&ri}function Fc(t){return(t-(t&ri))/si}const ii=1,li=2,In=4,ai=8;class Vr{constructor(e,n,r){this.pos=e,this.delInfo=n,this.recover=r}get deleted(){return(this.delInfo&ai)>0}get deletedBefore(){return(this.delInfo&(ii|In))>0}get deletedAfter(){return(this.delInfo&(li|In))>0}get deletedAcross(){return(this.delInfo&In)>0}}class we{constructor(e,n=!1){if(this.ranges=e,this.inverted=n,!e.length&&we.empty)return we.empty}recover(e){let n=0,r=oi(e);if(!this.inverted)for(let s=0;s<r;s++)n+=this.ranges[s*3+2]-this.ranges[s*3+1];return this.ranges[r*3]+n+Fc(e)}mapResult(e,n=1){return this._map(e,n,!1)}map(e,n=1){return this._map(e,n,!0)}_map(e,n,r){let s=0,o=this.inverted?2:1,i=this.inverted?1:2;for(let l=0;l<this.ranges.length;l+=3){let a=this.ranges[l]-(this.inverted?s:0);if(a>e)break;let c=this.ranges[l+o],u=this.ranges[l+i],d=a+c;if(e<=d){let f=c?e==a?-1:e==d?1:n:n,h=a+s+(f<0?0:u);if(r)return h;let p=e==(n<0?a:d)?null:$c(l/3,e-a),g=e==a?li:e==d?ii:In;return(n<0?e!=a:e!=d)&&(g|=ai),new Vr(h,g,p)}s+=u-c}return r?e+s:new Vr(e+s,0,null)}touches(e,n){let r=0,s=oi(n),o=this.inverted?2:1,i=this.inverted?1:2;for(let l=0;l<this.ranges.length;l+=3){let a=this.ranges[l]-(this.inverted?r:0);if(a>e)break;let c=this.ranges[l+o],u=a+c;if(e<=u&&l==s*3)return!0;r+=this.ranges[l+i]-c}return!1}forEach(e){let n=this.inverted?2:1,r=this.inverted?1:2;for(let s=0,o=0;s<this.ranges.length;s+=3){let i=this.ranges[s],l=i-(this.inverted?o:0),a=i+(this.inverted?0:o),c=this.ranges[s+n],u=this.ranges[s+r];e(l,l+c,a,a+u),o+=u-c}}invert(){return new we(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?we.empty:new we(e<0?[0,-e,0]:[0,0,e])}}we.empty=new we([]);class zn{constructor(e,n,r=0,s=e?e.length:0){this.mirror=n,this.from=r,this.to=s,this._maps=e||[],this.ownData=!(e||n)}get maps(){return this._maps}slice(e=0,n=this.maps.length){return new zn(this._maps,this.mirror,e,n)}appendMap(e,n){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),n!=null&&this.setMirror(this._maps.length-1,n)}appendMapping(e){for(let n=0,r=this._maps.length;n<e._maps.length;n++){let s=e.getMirror(n);this.appendMap(e._maps[n],s!=null&&s<n?r+s:void 0)}}getMirror(e){if(this.mirror){for(let n=0;n<this.mirror.length;n++)if(this.mirror[n]==e)return this.mirror[n+(n%2?-1:1)]}}setMirror(e,n){this.mirror||(this.mirror=[]),this.mirror.push(e,n)}appendMappingInverted(e){for(let n=e.maps.length-1,r=this._maps.length+e._maps.length;n>=0;n--){let s=e.getMirror(n);this.appendMap(e._maps[n].invert(),s!=null&&s>n?r-s-1:void 0)}}invert(){let e=new zn;return e.appendMappingInverted(this),e}map(e,n=1){if(this.mirror)return this._map(e,n,!0);for(let r=this.from;r<this.to;r++)e=this._maps[r].map(e,n);return e}mapResult(e,n=1){return this._map(e,n,!1)}_map(e,n,r){let s=0;for(let o=this.from;o<this.to;o++){let i=this._maps[o],l=i.mapResult(e,n);if(l.recover!=null){let a=this.getMirror(o);if(a!=null&&a>o&&a<this.to){o=a,e=this._maps[a].recover(l.recover);continue}}s|=l.delInfo,e=l.pos}return r?e:new Vr(e,s,null)}}const Ur=Object.create(null);class he{getMap(){return we.empty}merge(e){return null}static fromJSON(e,n){if(!n||!n.stepType)throw new RangeError("Invalid input for Step.fromJSON");let r=Ur[n.stepType];if(!r)throw new RangeError(`No step type ${n.stepType} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in Ur)throw new RangeError("Duplicate use of step JSON ID "+e);return Ur[e]=n,n.prototype.jsonID=e,n}}class ne{constructor(e,n){this.doc=e,this.failed=n}static ok(e){return new ne(e,null)}static fail(e){return new ne(null,e)}static fromReplace(e,n,r,s){try{return ne.ok(e.replace(n,r,s))}catch(o){if(o instanceof En)return ne.fail(o.message);throw o}}}function qr(t,e,n){let r=[];for(let s=0;s<t.childCount;s++){let o=t.child(s);o.content.size&&(o=o.copy(qr(o.content,e,o))),o.isInline&&(o=e(o,n,s)),r.push(o)}return N.fromArray(r)}class Ge extends he{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=e.resolve(this.from),s=r.node(r.sharedDepth(this.to)),o=new T(qr(n.content,(i,l)=>!i.isAtom||!l.type.allowsMarkType(this.mark.type)?i:i.mark(this.mark.addToSet(i.marks)),s),n.openStart,n.openEnd);return ne.fromReplace(e,this.from,this.to,o)}invert(){return new Re(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new Ge(n.pos,r.pos,this.mark)}merge(e){return e instanceof Ge&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Ge(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new Ge(n.from,n.to,e.markFromJSON(n.mark))}}he.jsonID("addMark",Ge);class Re extends he{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=new T(qr(n.content,s=>s.mark(this.mark.removeFromSet(s.marks)),e),n.openStart,n.openEnd);return ne.fromReplace(e,this.from,this.to,r)}invert(){return new Ge(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new Re(n.pos,r.pos,this.mark)}merge(e){return e instanceof Re&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Re(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new Re(n.from,n.to,e.markFromJSON(n.mark))}}he.jsonID("removeMark",Re);class Ye extends he{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return ne.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.addToSet(n.marks));return ne.fromReplace(e,this.pos,this.pos+1,new T(N.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);if(n){let r=this.mark.addToSet(n.marks);if(r.length==n.marks.length){for(let s=0;s<n.marks.length;s++)if(!n.marks[s].isInSet(r))return new Ye(this.pos,n.marks[s]);return new Ye(this.pos,this.mark)}}return new ft(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new Ye(n.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new Ye(n.pos,e.markFromJSON(n.mark))}}he.jsonID("addNodeMark",Ye);class ft extends he{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return ne.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.removeFromSet(n.marks));return ne.fromReplace(e,this.pos,this.pos+1,new T(N.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);return!n||!this.mark.isInSet(n.marks)?this:new Ye(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new ft(n.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new ft(n.pos,e.markFromJSON(n.mark))}}he.jsonID("removeNodeMark",ft);class se extends he{constructor(e,n,r,s=!1){super(),this.from=e,this.to=n,this.slice=r,this.structure=s}apply(e){return this.structure&&Jr(e,this.from,this.to)?ne.fail("Structure replace would overwrite content"):ne.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new we([this.from,this.to-this.from,this.slice.size])}invert(e){return new se(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deletedAcross&&r.deletedAcross?null:new se(n.pos,Math.max(n.pos,r.pos),this.slice,this.structure)}merge(e){if(!(e instanceof se)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let n=this.slice.size+e.slice.size==0?T.empty:new T(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new se(this.from,this.to+(e.to-e.from),n,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let n=this.slice.size+e.slice.size==0?T.empty:new T(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new se(e.from,this.to,n,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new se(n.from,n.to,T.fromJSON(e,n.slice),!!n.structure)}}he.jsonID("replace",se);class oe extends he{constructor(e,n,r,s,o,i,l=!1){super(),this.from=e,this.to=n,this.gapFrom=r,this.gapTo=s,this.slice=o,this.insert=i,this.structure=l}apply(e){if(this.structure&&(Jr(e,this.from,this.gapFrom)||Jr(e,this.gapTo,this.to)))return ne.fail("Structure gap-replace would overwrite content");let n=e.slice(this.gapFrom,this.gapTo);if(n.openStart||n.openEnd)return ne.fail("Gap is not a flat range");let r=this.slice.insertAt(this.insert,n.content);return r?ne.fromReplace(e,this.from,this.to,r):ne.fail("Content does not fit in gap")}getMap(){return new we([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let n=this.gapTo-this.gapFrom;return new oe(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1),s=this.from==this.gapFrom?n.pos:e.map(this.gapFrom,-1),o=this.to==this.gapTo?r.pos:e.map(this.gapTo,1);return n.deletedAcross&&r.deletedAcross||s<n.pos||o>r.pos?null:new oe(n.pos,r.pos,s,o,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number"||typeof n.gapFrom!="number"||typeof n.gapTo!="number"||typeof n.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new oe(n.from,n.to,n.gapFrom,n.gapTo,T.fromJSON(e,n.slice),n.insert,!!n.structure)}}he.jsonID("replaceAround",oe);function Jr(t,e,n){let r=t.resolve(e),s=n-e,o=r.depth;for(;s>0&&o>0&&r.indexAfter(o)==r.node(o).childCount;)o--,s--;if(s>0){let i=r.node(o).maybeChild(r.indexAfter(o));for(;s>0;){if(!i||i.isLeaf)return!0;i=i.firstChild,s--}}return!1}function Bc(t,e,n,r){let s=[],o=[],i,l;t.doc.nodesBetween(e,n,(a,c,u)=>{if(!a.isInline)return;let d=a.marks;if(!r.isInSet(d)&&u.type.allowsMarkType(r.type)){let f=Math.max(c,e),h=Math.min(c+a.nodeSize,n),p=r.addToSet(d);for(let g=0;g<d.length;g++)d[g].isInSet(p)||(i&&i.to==f&&i.mark.eq(d[g])?i.to=h:s.push(i=new Re(f,h,d[g])));l&&l.to==f?l.to=h:o.push(l=new Ge(f,h,r))}}),s.forEach(a=>t.step(a)),o.forEach(a=>t.step(a))}function Hc(t,e,n,r){let s=[],o=0;t.doc.nodesBetween(e,n,(i,l)=>{if(!i.isInline)return;o++;let a=null;if(r instanceof Mn){let c=i.marks,u;for(;u=r.isInSet(c);)(a||(a=[])).push(u),c=u.removeFromSet(c)}else r?r.isInSet(i.marks)&&(a=[r]):a=i.marks;if(a&&a.length){let c=Math.min(l+i.nodeSize,n);for(let u=0;u<a.length;u++){let d=a[u],f;for(let h=0;h<s.length;h++){let p=s[h];p.step==o-1&&d.eq(s[h].style)&&(f=p)}f?(f.to=c,f.step=o):s.push({style:d,from:Math.max(l,e),to:c,step:o})}}}),s.forEach(i=>t.step(new Re(i.from,i.to,i.style)))}function Gr(t,e,n,r=n.contentMatch,s=!0){let o=t.doc.nodeAt(e),i=[],l=e+1;for(let a=0;a<o.childCount;a++){let c=o.child(a),u=l+c.nodeSize,d=r.matchType(c.type);if(!d)i.push(new se(l,u,T.empty));else{r=d;for(let f=0;f<c.marks.length;f++)n.allowsMarkType(c.marks[f].type)||t.step(new Re(l,u,c.marks[f]));if(s&&c.isText&&n.whitespace!="pre"){let f,h=/\r?\n|\r/g,p;for(;f=h.exec(c.text);)p||(p=new T(N.from(n.schema.text(" ",n.allowedMarks(c.marks))),0,0)),i.push(new se(l+f.index,l+f.index+f[0].length,p))}}l=u}if(!r.validEnd){let a=r.fillBefore(N.empty,!0);t.replace(l,l,new T(a,0,0))}for(let a=i.length-1;a>=0;a--)t.step(i[a])}function Wc(t,e,n){return(e==0||t.canReplace(e,t.childCount))&&(n==t.childCount||t.canReplace(0,n))}function Nt(t){let n=t.parent.content.cutByIndex(t.startIndex,t.endIndex);for(let r=t.depth,s=0,o=0;;--r){let i=t.$from.node(r),l=t.$from.index(r)+s,a=t.$to.indexAfter(r)-o;if(r<t.depth&&i.canReplace(l,a,n))return r;if(r==0||i.type.spec.isolating||!Wc(i,l,a))break;l&&(s=1),a<i.childCount&&(o=1)}return null}function _c(t,e,n){let{$from:r,$to:s,depth:o}=e,i=r.before(o+1),l=s.after(o+1),a=i,c=l,u=N.empty,d=0;for(let p=o,g=!1;p>n;p--)g||r.index(p)>0?(g=!0,u=N.from(r.node(p).copy(u)),d++):a--;let f=N.empty,h=0;for(let p=o,g=!1;p>n;p--)g||s.after(p+1)<s.end(p)?(g=!0,f=N.from(s.node(p).copy(f)),h++):c++;t.step(new oe(a,c,i,l,new T(u.append(f),d,h),u.size-d,!0))}function ci(t,e,n=null,r=t){let s=Kc(t,e),o=s&&Vc(r,e);return o?s.map(ui).concat({type:e,attrs:n}).concat(o.map(ui)):null}function ui(t){return{type:t,attrs:null}}function Kc(t,e){let{parent:n,startIndex:r,endIndex:s}=t,o=n.contentMatchAt(r).findWrapping(e);if(!o)return null;let i=o.length?o[0]:e;return n.canReplaceWith(r,s,i)?o:null}function Vc(t,e){let{parent:n,startIndex:r,endIndex:s}=t,o=n.child(r),i=e.contentMatch.findWrapping(o.type);if(!i)return null;let a=(i.length?i[i.length-1]:e).contentMatch;for(let c=r;a&&c<s;c++)a=a.matchType(n.child(c).type);return!a||!a.validEnd?null:i}function Uc(t,e,n){let r=N.empty;for(let i=n.length-1;i>=0;i--){if(r.size){let l=n[i].type.contentMatch.matchFragment(r);if(!l||!l.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}r=N.from(n[i].type.create(n[i].attrs,r))}let s=e.start,o=e.end;t.step(new oe(s,o,s,o,new T(r,0,0),n.length,!0))}function qc(t,e,n,r,s){if(!r.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let o=t.steps.length;t.doc.nodesBetween(e,n,(i,l)=>{let a=typeof s=="function"?s(i):s;if(i.isTextblock&&!i.hasMarkup(r,a)&&Jc(t.doc,t.mapping.slice(o).map(l),r)){let c=null;if(r.schema.linebreakReplacement){let h=r.whitespace=="pre",p=!!r.contentMatch.matchType(r.schema.linebreakReplacement);h&&!p?c=!1:!h&&p&&(c=!0)}c===!1&&fi(t,i,l,o),Gr(t,t.mapping.slice(o).map(l,1),r,void 0,c===null);let u=t.mapping.slice(o),d=u.map(l,1),f=u.map(l+i.nodeSize,1);return t.step(new oe(d,f,d+1,f-1,new T(N.from(r.create(a,null,i.marks)),0,0),1,!0)),c===!0&&di(t,i,l,o),!1}})}function di(t,e,n,r){e.forEach((s,o)=>{if(s.isText){let i,l=/\r?\n|\r/g;for(;i=l.exec(s.text);){let a=t.mapping.slice(r).map(n+1+o+i.index);t.replaceWith(a,a+1,e.type.schema.linebreakReplacement.create())}}})}function fi(t,e,n,r){e.forEach((s,o)=>{if(s.type==s.type.schema.linebreakReplacement){let i=t.mapping.slice(r).map(n+1+o);t.replaceWith(i,i+1,e.type.schema.text(`
`))}})}function Jc(t,e,n){let r=t.resolve(e),s=r.index();return r.parent.canReplaceWith(s,s+1,n)}function Gc(t,e,n,r,s){let o=t.doc.nodeAt(e);if(!o)throw new RangeError("No node at given position");n||(n=o.type);let i=n.create(r,null,s||o.marks);if(o.isLeaf)return t.replaceWith(e,e+o.nodeSize,i);if(!n.validContent(o.content))throw new RangeError("Invalid content for node type "+n.name);t.step(new oe(e,e+o.nodeSize,e+1,e+o.nodeSize-1,new T(N.from(i),0,0),1,!0))}function He(t,e,n=1,r){let s=t.resolve(e),o=s.depth-n,i=r&&r[r.length-1]||s.parent;if(o<0||s.parent.type.spec.isolating||!s.parent.canReplace(s.index(),s.parent.childCount)||!i.type.validContent(s.parent.content.cutByIndex(s.index(),s.parent.childCount)))return!1;for(let c=s.depth-1,u=n-2;c>o;c--,u--){let d=s.node(c),f=s.index(c);if(d.type.spec.isolating)return!1;let h=d.content.cutByIndex(f,d.childCount),p=r&&r[u+1];p&&(h=h.replaceChild(0,p.type.create(p.attrs)));let g=r&&r[u]||d;if(!d.canReplace(f+1,d.childCount)||!g.type.validContent(h))return!1}let l=s.indexAfter(o),a=r&&r[0];return s.node(o).canReplaceWith(l,l,a?a.type:s.node(o+1).type)}function Yc(t,e,n=1,r){let s=t.doc.resolve(e),o=N.empty,i=N.empty;for(let l=s.depth,a=s.depth-n,c=n-1;l>a;l--,c--){o=N.from(s.node(l).copy(o));let u=r&&r[c];i=N.from(u?u.type.create(u.attrs,i):s.node(l).copy(i))}t.step(new se(e,e,new T(o.append(i),n,n),!0))}function ht(t,e){let n=t.resolve(e),r=n.index();return hi(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(r,r+1)}function Qc(t,e){e.content.size||t.type.compatibleContent(e.type);let n=t.contentMatchAt(t.childCount),{linebreakReplacement:r}=t.type.schema;for(let s=0;s<e.childCount;s++){let o=e.child(s),i=o.type==r?t.type.schema.nodes.text:o.type;if(n=n.matchType(i),!n||!t.type.allowsMarks(o.marks))return!1}return n.validEnd}function hi(t,e){return!!(t&&e&&!t.isLeaf&&Qc(t,e))}function Ln(t,e,n=-1){let r=t.resolve(e);for(let s=r.depth;;s--){let o,i,l=r.index(s);if(s==r.depth?(o=r.nodeBefore,i=r.nodeAfter):n>0?(o=r.node(s+1),l++,i=r.node(s).maybeChild(l)):(o=r.node(s).maybeChild(l-1),i=r.node(s+1)),o&&!o.isTextblock&&hi(o,i)&&r.node(s).canReplace(l,l+1))return e;if(s==0)break;e=n<0?r.before(s):r.after(s)}}function Xc(t,e,n){let r=null,{linebreakReplacement:s}=t.doc.type.schema,o=t.doc.resolve(e-n),i=o.node().type;if(s&&i.inlineContent){let u=i.whitespace=="pre",d=!!i.contentMatch.matchType(s);u&&!d?r=!1:!u&&d&&(r=!0)}let l=t.steps.length;if(r===!1){let u=t.doc.resolve(e+n);fi(t,u.node(),u.before(),l)}i.inlineContent&&Gr(t,e+n-1,i,o.node().contentMatchAt(o.index()),r==null);let a=t.mapping.slice(l),c=a.map(e-n);if(t.step(new se(c,a.map(e+n,-1),T.empty,!0)),r===!0){let u=t.doc.resolve(c);di(t,u.node(),u.before(),t.steps.length)}return t}function Zc(t,e,n){let r=t.resolve(e);if(r.parent.canReplaceWith(r.index(),r.index(),n))return e;if(r.parentOffset==0)for(let s=r.depth-1;s>=0;s--){let o=r.index(s);if(r.node(s).canReplaceWith(o,o,n))return r.before(s+1);if(o>0)return null}if(r.parentOffset==r.parent.content.size)for(let s=r.depth-1;s>=0;s--){let o=r.indexAfter(s);if(r.node(s).canReplaceWith(o,o,n))return r.after(s+1);if(o<r.node(s).childCount)return null}return null}function eu(t,e,n){let r=t.resolve(e);if(!n.content.size)return e;let s=n.content;for(let o=0;o<n.openStart;o++)s=s.firstChild.content;for(let o=1;o<=(n.openStart==0&&n.size?2:1);o++)for(let i=r.depth;i>=0;i--){let l=i==r.depth?0:r.pos<=(r.start(i+1)+r.end(i+1))/2?-1:1,a=r.index(i)+(l>0?1:0),c=r.node(i),u=!1;if(o==1)u=c.canReplace(a,a,s);else{let d=c.contentMatchAt(a).findWrapping(s.firstChild.type);u=d&&c.canReplaceWith(a,a,d[0])}if(u)return l==0?r.pos:l<0?r.before(i+1):r.after(i+1)}return null}function Pn(t,e,n=e,r=T.empty){if(e==n&&!r.size)return null;let s=t.resolve(e),o=t.resolve(n);return pi(s,o,r)?new se(e,n,r):new tu(s,o,r).fit()}function pi(t,e,n){return!n.openStart&&!n.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),n.content)}class tu{constructor(e,n,r){this.$from=e,this.$to=n,this.unplaced=r,this.frontier=[],this.placed=N.empty;for(let s=0;s<=e.depth;s++){let o=e.node(s);this.frontier.push({type:o.type,match:o.contentMatchAt(e.indexAfter(s))})}for(let s=e.depth;s>0;s--)this.placed=N.from(e.node(s).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let c=this.findFittable();c?this.placeNodes(c):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),n=this.placed.size-this.depth-this.$from.depth,r=this.$from,s=this.close(e<0?this.$to:r.doc.resolve(e));if(!s)return null;let o=this.placed,i=r.depth,l=s.depth;for(;i&&l&&o.childCount==1;)o=o.firstChild.content,i--,l--;let a=new T(o,i,l);return e>-1?new oe(r.pos,e,this.$to.pos,this.$to.end(),a,n):a.size||r.pos!=this.$to.pos?new se(r.pos,s.pos,a):null}findFittable(){let e=this.unplaced.openStart;for(let n=this.unplaced.content,r=0,s=this.unplaced.openEnd;r<e;r++){let o=n.firstChild;if(n.childCount>1&&(s=0),o.type.spec.isolating&&s<=r){e=r;break}n=o.content}for(let n=1;n<=2;n++)for(let r=n==1?e:this.unplaced.openStart;r>=0;r--){let s,o=null;r?(o=Yr(this.unplaced.content,r-1).firstChild,s=o.content):s=this.unplaced.content;let i=s.firstChild;for(let l=this.depth;l>=0;l--){let{type:a,match:c}=this.frontier[l],u,d=null;if(n==1&&(i?c.matchType(i.type)||(d=c.fillBefore(N.from(i),!1)):o&&a.compatibleContent(o.type)))return{sliceDepth:r,frontierDepth:l,parent:o,inject:d};if(n==2&&i&&(u=c.findWrapping(i.type)))return{sliceDepth:r,frontierDepth:l,parent:o,wrap:u};if(o&&c.matchType(o.type))break}}}openMore(){let{content:e,openStart:n,openEnd:r}=this.unplaced,s=Yr(e,n);return!s.childCount||s.firstChild.isLeaf?!1:(this.unplaced=new T(e,n+1,Math.max(r,s.size+n>=e.size-r?n+1:0)),!0)}dropNode(){let{content:e,openStart:n,openEnd:r}=this.unplaced,s=Yr(e,n);if(s.childCount<=1&&n>0){let o=e.size-n<=n+s.size;this.unplaced=new T(Gt(e,n-1,1),n-1,o?n-1:r)}else this.unplaced=new T(Gt(e,n,1),n,r)}placeNodes({sliceDepth:e,frontierDepth:n,parent:r,inject:s,wrap:o}){for(;this.depth>n;)this.closeFrontierNode();if(o)for(let g=0;g<o.length;g++)this.openFrontierNode(o[g]);let i=this.unplaced,l=r?r.content:i.content,a=i.openStart-e,c=0,u=[],{match:d,type:f}=this.frontier[n];if(s){for(let g=0;g<s.childCount;g++)u.push(s.child(g));d=d.matchFragment(s)}let h=l.size+e-(i.content.size-i.openEnd);for(;c<l.childCount;){let g=l.child(c),y=d.matchType(g.type);if(!y)break;c++,(c>1||a==0||g.content.size)&&(d=y,u.push(mi(g.mark(f.allowedMarks(g.marks)),c==1?a:0,c==l.childCount?h:-1)))}let p=c==l.childCount;p||(h=-1),this.placed=Yt(this.placed,n,N.from(u)),this.frontier[n].match=d,p&&h<0&&r&&r.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let g=0,y=l;g<h;g++){let b=y.lastChild;this.frontier.push({type:b.type,match:b.contentMatchAt(b.childCount)}),y=b.content}this.unplaced=p?e==0?T.empty:new T(Gt(i.content,e-1,1),e-1,h<0?i.openEnd:e-1):new T(Gt(i.content,e,c),i.openStart,i.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],n;if(!e.type.isTextblock||!Qr(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(n=this.findCloseLevel(this.$to))&&n.depth==this.depth)return-1;let{depth:r}=this.$to,s=this.$to.after(r);for(;r>1&&s==this.$to.end(--r);)++s;return s}findCloseLevel(e){e:for(let n=Math.min(this.depth,e.depth);n>=0;n--){let{match:r,type:s}=this.frontier[n],o=n<e.depth&&e.end(n+1)==e.pos+(e.depth-(n+1)),i=Qr(e,n,s,r,o);if(i){for(let l=n-1;l>=0;l--){let{match:a,type:c}=this.frontier[l],u=Qr(e,l,c,a,!0);if(!u||u.childCount)continue e}return{depth:n,fit:i,move:o?e.doc.resolve(e.after(n+1)):e}}}}close(e){let n=this.findCloseLevel(e);if(!n)return null;for(;this.depth>n.depth;)this.closeFrontierNode();n.fit.childCount&&(this.placed=Yt(this.placed,n.depth,n.fit)),e=n.move;for(let r=n.depth+1;r<=e.depth;r++){let s=e.node(r),o=s.type.contentMatch.fillBefore(s.content,!0,e.index(r));this.openFrontierNode(s.type,s.attrs,o)}return e}openFrontierNode(e,n=null,r){let s=this.frontier[this.depth];s.match=s.match.matchType(e),this.placed=Yt(this.placed,this.depth,N.from(e.create(n,r))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let n=this.frontier.pop().match.fillBefore(N.empty,!0);n.childCount&&(this.placed=Yt(this.placed,this.frontier.length,n))}}function Gt(t,e,n){return e==0?t.cutByIndex(n,t.childCount):t.replaceChild(0,t.firstChild.copy(Gt(t.firstChild.content,e-1,n)))}function Yt(t,e,n){return e==0?t.append(n):t.replaceChild(t.childCount-1,t.lastChild.copy(Yt(t.lastChild.content,e-1,n)))}function Yr(t,e){for(let n=0;n<e;n++)t=t.firstChild.content;return t}function mi(t,e,n){if(e<=0)return t;let r=t.content;return e>1&&(r=r.replaceChild(0,mi(r.firstChild,e-1,r.childCount==1?n-1:0))),e>0&&(r=t.type.contentMatch.fillBefore(r).append(r),n<=0&&(r=r.append(t.type.contentMatch.matchFragment(r).fillBefore(N.empty,!0)))),t.copy(r)}function Qr(t,e,n,r,s){let o=t.node(e),i=s?t.indexAfter(e):t.index(e);if(i==o.childCount&&!n.compatibleContent(o.type))return null;let l=r.fillBefore(o.content,!0,i);return l&&!nu(n,o.content,i)?l:null}function nu(t,e,n){for(let r=n;r<e.childCount;r++)if(!t.allowsMarks(e.child(r).marks))return!0;return!1}function ru(t){return t.spec.defining||t.spec.definingForContent}function su(t,e,n,r){if(!r.size)return t.deleteRange(e,n);let s=t.doc.resolve(e),o=t.doc.resolve(n);if(pi(s,o,r))return t.step(new se(e,n,r));let i=yi(s,o);i[i.length-1]==0&&i.pop();let l=-(s.depth+1);i.unshift(l);for(let f=s.depth,h=s.pos-1;f>0;f--,h--){let p=s.node(f).type.spec;if(p.defining||p.definingAsContext||p.isolating)break;i.indexOf(f)>-1?l=f:s.before(f)==h&&i.splice(1,0,-f)}let a=i.indexOf(l),c=[],u=r.openStart;for(let f=r.content,h=0;;h++){let p=f.firstChild;if(c.push(p),h==r.openStart)break;f=p.content}for(let f=u-1;f>=0;f--){let h=c[f],p=ru(h.type);if(p&&!h.sameMarkup(s.node(Math.abs(l)-1)))u=f;else if(p||!h.type.isTextblock)break}for(let f=r.openStart;f>=0;f--){let h=(f+u+1)%(r.openStart+1),p=c[h];if(p)for(let g=0;g<i.length;g++){let y=i[(g+a)%i.length],b=!0;y<0&&(b=!1,y=-y);let x=s.node(y-1),k=s.index(y-1);if(x.canReplaceWith(k,k,p.type,p.marks))return t.replace(s.before(y),b?o.after(y):n,new T(gi(r.content,0,r.openStart,h),h,r.openEnd))}}let d=t.steps.length;for(let f=i.length-1;f>=0&&(t.replace(e,n,r),!(t.steps.length>d));f--){let h=i[f];h<0||(e=s.before(h),n=o.after(h))}}function gi(t,e,n,r,s){if(e<n){let o=t.firstChild;t=t.replaceChild(0,o.copy(gi(o.content,e+1,n,r,o)))}if(e>r){let o=s.contentMatchAt(0),i=o.fillBefore(t).append(t);t=i.append(o.matchFragment(i).fillBefore(N.empty,!0))}return t}function ou(t,e,n,r){if(!r.isInline&&e==n&&t.doc.resolve(e).parent.content.size){let s=Zc(t.doc,e,r.type);s!=null&&(e=n=s)}t.replaceRange(e,n,new T(N.from(r),0,0))}function iu(t,e,n){let r=t.doc.resolve(e),s=t.doc.resolve(n),o=yi(r,s);for(let i=0;i<o.length;i++){let l=o[i],a=i==o.length-1;if(a&&l==0||r.node(l).type.contentMatch.validEnd)return t.delete(r.start(l),s.end(l));if(l>0&&(a||r.node(l-1).canReplace(r.index(l-1),s.indexAfter(l-1))))return t.delete(r.before(l),s.after(l))}for(let i=1;i<=r.depth&&i<=s.depth;i++)if(e-r.start(i)==r.depth-i&&n>r.end(i)&&s.end(i)-n!=s.depth-i&&r.start(i-1)==s.start(i-1)&&r.node(i-1).canReplace(r.index(i-1),s.index(i-1)))return t.delete(r.before(i),n);t.delete(e,n)}function yi(t,e){let n=[],r=Math.min(t.depth,e.depth);for(let s=r;s>=0;s--){let o=t.start(s);if(o<t.pos-(t.depth-s)||e.end(s)>e.pos+(e.depth-s)||t.node(s).type.spec.isolating||e.node(s).type.spec.isolating)break;(o==e.start(s)||s==t.depth&&s==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&s&&e.start(s-1)==o-1)&&n.push(s)}return n}class At extends he{constructor(e,n,r){super(),this.pos=e,this.attr=n,this.value=r}apply(e){let n=e.nodeAt(this.pos);if(!n)return ne.fail("No node at attribute step's position");let r=Object.create(null);for(let o in n.attrs)r[o]=n.attrs[o];r[this.attr]=this.value;let s=n.type.create(r,null,n.marks);return ne.fromReplace(e,this.pos,this.pos+1,new T(N.from(s),0,n.isLeaf?0:1))}getMap(){return we.empty}invert(e){return new At(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new At(n.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.pos!="number"||typeof n.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new At(n.pos,n.attr,n.value)}}he.jsonID("attr",At);class Qt extends he{constructor(e,n){super(),this.attr=e,this.value=n}apply(e){let n=Object.create(null);for(let s in e.attrs)n[s]=e.attrs[s];n[this.attr]=this.value;let r=e.type.create(n,e.content,e.marks);return ne.ok(r)}getMap(){return we.empty}invert(e){return new Qt(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new Qt(n.attr,n.value)}}he.jsonID("docAttr",Qt);let Tt=class extends Error{};Tt=function t(e){let n=Error.call(this,e);return n.__proto__=t.prototype,n},Tt.prototype=Object.create(Error.prototype),Tt.prototype.constructor=Tt,Tt.prototype.name="TransformError";class bi{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new zn}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let n=this.maybeStep(e);if(n.failed)throw new Tt(n.failed);return this}maybeStep(e){let n=e.apply(this.doc);return n.failed||this.addStep(e,n.doc),n}get docChanged(){return this.steps.length>0}changedRange(){let e=1e9,n=-1e9;for(let r=0;r<this.mapping.maps.length;r++){let s=this.mapping.maps[r];r&&(e=s.map(e,1),n=s.map(n,-1)),s.forEach((o,i,l,a)=>{e=Math.min(e,l),n=Math.max(n,a)})}return e==1e9?null:{from:e,to:n}}addStep(e,n){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=n}replace(e,n=e,r=T.empty){let s=Pn(this.doc,e,n,r);return s&&this.step(s),this}replaceWith(e,n,r){return this.replace(e,n,new T(N.from(r),0,0))}delete(e,n){return this.replace(e,n,T.empty)}insert(e,n){return this.replaceWith(e,e,n)}replaceRange(e,n,r){return su(this,e,n,r),this}replaceRangeWith(e,n,r){return ou(this,e,n,r),this}deleteRange(e,n){return iu(this,e,n),this}lift(e,n){return _c(this,e,n),this}join(e,n=1){return Xc(this,e,n),this}wrap(e,n){return Uc(this,e,n),this}setBlockType(e,n=e,r,s=null){return qc(this,e,n,r,s),this}setNodeMarkup(e,n,r=null,s){return Gc(this,e,n,r,s),this}setNodeAttribute(e,n,r){return this.step(new At(e,n,r)),this}setDocAttribute(e,n){return this.step(new Qt(e,n)),this}addNodeMark(e,n){return this.step(new Ye(e,n)),this}removeNodeMark(e,n){let r=this.doc.nodeAt(e);if(!r)throw new RangeError("No node at position "+e);if(n instanceof X)n.isInSet(r.marks)&&this.step(new ft(e,n));else{let s=r.marks,o,i=[];for(;o=n.isInSet(s);)i.push(new ft(e,o)),s=o.removeFromSet(s);for(let l=i.length-1;l>=0;l--)this.step(i[l])}return this}split(e,n=1,r){return Yc(this,e,n,r),this}addMark(e,n,r){return Bc(this,e,n,r),this}removeMark(e,n,r){return Hc(this,e,n,r),this}clearIncompatible(e,n,r){return Gr(this,e,n,r),this}}const Xr=Object.create(null);class W{constructor(e,n,r){this.$anchor=e,this.$head=n,this.ranges=r||[new xi(e.min(n),e.max(n))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let n=0;n<e.length;n++)if(e[n].$from.pos!=e[n].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,n=T.empty){let r=n.content.lastChild,s=null;for(let l=0;l<n.openEnd;l++)s=r,r=r.lastChild;let o=e.steps.length,i=this.ranges;for(let l=0;l<i.length;l++){let{$from:a,$to:c}=i[l],u=e.mapping.slice(o);e.replaceRange(u.map(a.pos),u.map(c.pos),l?T.empty:n),l==0&&ki(e,o,(r?r.isInline:s&&s.isTextblock)?-1:1)}}replaceWith(e,n){let r=e.steps.length,s=this.ranges;for(let o=0;o<s.length;o++){let{$from:i,$to:l}=s[o],a=e.mapping.slice(r),c=a.map(i.pos),u=a.map(l.pos);o?e.deleteRange(c,u):(e.replaceRangeWith(c,u,n),ki(e,r,n.isInline?-1:1))}}static findFrom(e,n,r=!1){let s=e.parent.inlineContent?new F(e):Mt(e.node(0),e.parent,e.pos,e.index(),n,r);if(s)return s;for(let o=e.depth-1;o>=0;o--){let i=n<0?Mt(e.node(0),e.node(o),e.before(o+1),e.index(o),n,r):Mt(e.node(0),e.node(o),e.after(o+1),e.index(o)+1,n,r);if(i)return i}return null}static near(e,n=1){return this.findFrom(e,n)||this.findFrom(e,-n)||new ve(e.node(0))}static atStart(e){return Mt(e,e,0,0,1)||new ve(e)}static atEnd(e){return Mt(e,e,e.content.size,e.childCount,-1)||new ve(e)}static fromJSON(e,n){if(!n||!n.type)throw new RangeError("Invalid input for Selection.fromJSON");let r=Xr[n.type];if(!r)throw new RangeError(`No selection type ${n.type} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in Xr)throw new RangeError("Duplicate use of selection JSON ID "+e);return Xr[e]=n,n.prototype.jsonID=e,n}getBookmark(){return F.between(this.$anchor,this.$head).getBookmark()}}W.prototype.visible=!0;class xi{constructor(e,n){this.$from=e,this.$to=n}}let wi=!1;function vi(t){!wi&&!t.parent.inlineContent&&(wi=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+t.parent.type.name+")"))}class F extends W{constructor(e,n=e){vi(e),vi(n),super(e,n)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,n){let r=e.resolve(n.map(this.head));if(!r.parent.inlineContent)return W.near(r);let s=e.resolve(n.map(this.anchor));return new F(s.parent.inlineContent?s:r,r)}replace(e,n=T.empty){if(super.replace(e,n),n==T.empty){let r=this.$from.marksAcross(this.$to);r&&e.ensureMarks(r)}}eq(e){return e instanceof F&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new Dn(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,n){if(typeof n.anchor!="number"||typeof n.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new F(e.resolve(n.anchor),e.resolve(n.head))}static create(e,n,r=n){let s=e.resolve(n);return new this(s,r==n?s:e.resolve(r))}static between(e,n,r){let s=e.pos-n.pos;if((!r||s)&&(r=s>=0?1:-1),!n.parent.inlineContent){let o=W.findFrom(n,r,!0)||W.findFrom(n,-r,!0);if(o)n=o.$head;else return W.near(n,r)}return e.parent.inlineContent||(s==0?e=n:(e=(W.findFrom(e,-r,!0)||W.findFrom(e,r,!0)).$anchor,e.pos<n.pos!=s<0&&(e=n))),new F(e,n)}}W.jsonID("text",F);class Dn{constructor(e,n){this.anchor=e,this.head=n}map(e){return new Dn(e.map(this.anchor),e.map(this.head))}resolve(e){return F.between(e.resolve(this.anchor),e.resolve(this.head))}}class L extends W{constructor(e){let n=e.nodeAfter,r=e.node(0).resolve(e.pos+n.nodeSize);super(e,r),this.node=n}map(e,n){let{deleted:r,pos:s}=n.mapResult(this.anchor),o=e.resolve(s);return r?W.near(o):new L(o)}content(){return new T(N.from(this.node),0,0)}eq(e){return e instanceof L&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new Zr(this.anchor)}static fromJSON(e,n){if(typeof n.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new L(e.resolve(n.anchor))}static create(e,n){return new L(e.resolve(n))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}L.prototype.visible=!1,W.jsonID("node",L);class Zr{constructor(e){this.anchor=e}map(e){let{deleted:n,pos:r}=e.mapResult(this.anchor);return n?new Dn(r,r):new Zr(r)}resolve(e){let n=e.resolve(this.anchor),r=n.nodeAfter;return r&&L.isSelectable(r)?new L(n):W.near(n)}}class ve extends W{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,n=T.empty){if(n==T.empty){e.delete(0,e.doc.content.size);let r=W.atStart(e.doc);r.eq(e.selection)||e.setSelection(r)}else super.replace(e,n)}toJSON(){return{type:"all"}}static fromJSON(e){return new ve(e)}map(e){return new ve(e)}eq(e){return e instanceof ve}getBookmark(){return lu}}W.jsonID("all",ve);const lu={map(){return this},resolve(t){return new ve(t)}};function Mt(t,e,n,r,s,o=!1){if(e.inlineContent)return F.create(t,n);for(let i=r-(s>0?0:1);s>0?i<e.childCount:i>=0;i+=s){let l=e.child(i);if(l.isAtom){if(!o&&L.isSelectable(l))return L.create(t,n-(s<0?l.nodeSize:0))}else{let a=Mt(t,l,n+s,s<0?l.childCount:0,s,o);if(a)return a}n+=l.nodeSize*s}return null}function ki(t,e,n){let r=t.steps.length-1;if(r<e)return;let s=t.steps[r];if(!(s instanceof se||s instanceof oe))return;let o=t.mapping.maps[r],i;o.forEach((l,a,c,u)=>{i==null&&(i=u)}),t.setSelection(W.near(t.doc.resolve(i),n))}function Si(t,e){return!e||!t?t:t.bind(e)}class $n{constructor(e,n,r){this.name=e,this.init=Si(n.init,r),this.apply=Si(n.apply,r)}}new $n("doc",{init(t){return t.doc||t.schema.topNodeType.createAndFill()},apply(t){return t.doc}}),new $n("selection",{init(t,e){return t.selection||W.atStart(e.doc)},apply(t){return t.selection}}),new $n("storedMarks",{init(t){return t.storedMarks||null},apply(t,e,n,r){return r.selection.$cursor?t.storedMarks:null}}),new $n("scrollToSelection",{init(){return 0},apply(t,e){return t.scrolledIntoView?e+1:e}});function Ci(t,e,n){for(let r in t){let s=t[r];s instanceof Function?s=s.bind(e):r=="handleDOMEvents"&&(s=Ci(s,e,{})),n[r]=s}return n}class ke{constructor(e){this.spec=e,this.props={},e.props&&Ci(e.props,this,this.props),this.key=e.key?e.key.key:Ei("plugin")}getState(e){return e[this.key]}}const es=Object.create(null);function Ei(t){return t in es?t+"$"+ ++es[t]:(es[t]=0,t+"$")}class be{constructor(e="key"){this.key=Ei(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const ts=(t,e)=>t.selection.empty?!1:(e&&e(t.tr.deleteSelection().scrollIntoView()),!0);function Ni(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("backward",t):n.parentOffset>0)?null:n}const Ai=(t,e,n)=>{let r=Ni(t,n);if(!r)return!1;let s=ns(r);if(!s){let i=r.blockRange(),l=i&&Nt(i);return l==null?!1:(e&&e(t.tr.lift(i,l).scrollIntoView()),!0)}let o=s.nodeBefore;if(Pi(t,s,e,-1))return!0;if(r.parent.content.size==0&&(Rt(o,"end")||L.isSelectable(o)))for(let i=r.depth;;i--){let l=Pn(t.doc,r.before(i),r.after(i),T.empty);if(l&&l.slice.size<l.to-l.from){if(e){let a=t.tr.step(l);a.setSelection(Rt(o,"end")?W.findFrom(a.doc.resolve(a.mapping.map(s.pos,-1)),-1):L.create(a.doc,s.pos-o.nodeSize)),e(a.scrollIntoView())}return!0}if(i==1||r.node(i-1).childCount>1)break}return o.isAtom&&s.depth==r.depth-1?(e&&e(t.tr.delete(s.pos-o.nodeSize,s.pos).scrollIntoView()),!0):!1},au=(t,e,n)=>{let r=Ni(t,n);if(!r)return!1;let s=ns(r);return s?Ti(t,s,e):!1},cu=(t,e,n)=>{let r=Ri(t,n);if(!r)return!1;let s=rs(r);return s?Ti(t,s,e):!1};function Ti(t,e,n){let r=e.nodeBefore,s=r,o=e.pos-1;for(;!s.isTextblock;o--){if(s.type.spec.isolating)return!1;let u=s.lastChild;if(!u)return!1;s=u}let i=e.nodeAfter,l=i,a=e.pos+1;for(;!l.isTextblock;a++){if(l.type.spec.isolating)return!1;let u=l.firstChild;if(!u)return!1;l=u}let c=Pn(t.doc,o,a,T.empty);if(!c||c.from!=o||c instanceof se&&c.slice.size>=a-o)return!1;if(n){let u=t.tr.step(c);u.setSelection(F.create(u.doc,o)),n(u.scrollIntoView())}return!0}function Rt(t,e,n=!1){for(let r=t;r;r=e=="start"?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(n&&r.childCount!=1)return!1}return!1}const Mi=(t,e,n)=>{let{$head:r,empty:s}=t.selection,o=r;if(!s)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("backward",t):r.parentOffset>0)return!1;o=ns(r)}let i=o&&o.nodeBefore;return!i||!L.isSelectable(i)?!1:(e&&e(t.tr.setSelection(L.create(t.doc,o.pos-i.nodeSize)).scrollIntoView()),!0)};function ns(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}function Ri(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("forward",t):n.parentOffset<n.parent.content.size)?null:n}const Oi=(t,e,n)=>{let r=Ri(t,n);if(!r)return!1;let s=rs(r);if(!s)return!1;let o=s.nodeAfter;if(Pi(t,s,e,1))return!0;if(r.parent.content.size==0&&(Rt(o,"start")||L.isSelectable(o))){let i=Pn(t.doc,r.before(),r.after(),T.empty);if(i&&i.slice.size<i.to-i.from){if(e){let l=t.tr.step(i);l.setSelection(Rt(o,"start")?W.findFrom(l.doc.resolve(l.mapping.map(s.pos)),1):L.create(l.doc,l.mapping.map(s.pos))),e(l.scrollIntoView())}return!0}}return o.isAtom&&s.depth==r.depth-1?(e&&e(t.tr.delete(s.pos,s.pos+o.nodeSize).scrollIntoView()),!0):!1},ji=(t,e,n)=>{let{$head:r,empty:s}=t.selection,o=r;if(!s)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("forward",t):r.parentOffset<r.parent.content.size)return!1;o=rs(r)}let i=o&&o.nodeAfter;return!i||!L.isSelectable(i)?!1:(e&&e(t.tr.setSelection(L.create(t.doc,o.pos)).scrollIntoView()),!0)};function rs(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){let n=t.node(e);if(t.index(e)+1<n.childCount)return t.doc.resolve(t.after(e+1));if(n.type.spec.isolating)break}return null}const uu=(t,e)=>{let n=t.selection,r=n instanceof L,s;if(r){if(n.node.isTextblock||!ht(t.doc,n.from))return!1;s=n.from}else if(s=Ln(t.doc,n.from,-1),s==null)return!1;if(e){let o=t.tr.join(s);r&&o.setSelection(L.create(o.doc,s-t.doc.resolve(s).nodeBefore.nodeSize)),e(o.scrollIntoView())}return!0},du=(t,e)=>{let n=t.selection,r;if(n instanceof L){if(n.node.isTextblock||!ht(t.doc,n.to))return!1;r=n.to}else if(r=Ln(t.doc,n.to,1),r==null)return!1;return e&&e(t.tr.join(r).scrollIntoView()),!0},fu=(t,e)=>{let{$from:n,$to:r}=t.selection,s=n.blockRange(r),o=s&&Nt(s);return o==null?!1:(e&&e(t.tr.lift(s,o).scrollIntoView()),!0)},Ii=(t,e)=>{let{$head:n,$anchor:r}=t.selection;return!n.parent.type.spec.code||!n.sameParent(r)?!1:(e&&e(t.tr.insertText(`
`).scrollIntoView()),!0)};function ss(t){for(let e=0;e<t.edgeCount;e++){let{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}const hu=(t,e)=>{let{$head:n,$anchor:r}=t.selection;if(!n.parent.type.spec.code||!n.sameParent(r))return!1;let s=n.node(-1),o=n.indexAfter(-1),i=ss(s.contentMatchAt(o));if(!i||!s.canReplaceWith(o,o,i))return!1;if(e){let l=n.after(),a=t.tr.replaceWith(l,l,i.createAndFill());a.setSelection(W.near(a.doc.resolve(l),1)),e(a.scrollIntoView())}return!0},zi=(t,e)=>{let n=t.selection,{$from:r,$to:s}=n;if(n instanceof ve||r.parent.inlineContent||s.parent.inlineContent)return!1;let o=ss(s.parent.contentMatchAt(s.indexAfter()));if(!o||!o.isTextblock)return!1;if(e){let i=(!r.parentOffset&&s.index()<s.parent.childCount?r:s).pos,l=t.tr.insert(i,o.createAndFill());l.setSelection(F.create(l.doc,i+1)),e(l.scrollIntoView())}return!0},Li=(t,e)=>{let{$cursor:n}=t.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let o=n.before();if(He(t.doc,o))return e&&e(t.tr.split(o).scrollIntoView()),!0}let r=n.blockRange(),s=r&&Nt(r);return s==null?!1:(e&&e(t.tr.lift(r,s).scrollIntoView()),!0)};function pu(t){return(e,n)=>{let{$from:r,$to:s}=e.selection;if(e.selection instanceof L&&e.selection.node.isBlock)return!r.parentOffset||!He(e.doc,r.pos)?!1:(n&&n(e.tr.split(r.pos).scrollIntoView()),!0);if(!r.depth)return!1;let o=[],i,l,a=!1,c=!1;for(let h=r.depth;;h--)if(r.node(h).isBlock){a=r.end(h)==r.pos+(r.depth-h),c=r.start(h)==r.pos-(r.depth-h),l=ss(r.node(h-1).contentMatchAt(r.indexAfter(h-1))),o.unshift(a&&l?{type:l}:null),i=h;break}else{if(h==1)return!1;o.unshift(null)}let u=e.tr;(e.selection instanceof F||e.selection instanceof ve)&&u.deleteSelection();let d=u.mapping.map(r.pos),f=He(u.doc,d,o.length,o);if(f||(o[0]=l?{type:l}:null,f=He(u.doc,d,o.length,o)),!f)return!1;if(u.split(d,o.length,o),!a&&c&&r.node(i).type!=l){let h=u.mapping.map(r.before(i)),p=u.doc.resolve(h);l&&r.node(i-1).canReplaceWith(p.index(),p.index()+1,l)&&u.setNodeMarkup(u.mapping.map(r.before(i)),l)}return n&&n(u.scrollIntoView()),!0}}const mu=pu(),gu=(t,e)=>{let{$from:n,to:r}=t.selection,s,o=n.sharedDepth(r);return o==0?!1:(s=n.before(o),e&&e(t.tr.setSelection(L.create(t.doc,s))),!0)};function yu(t,e,n){let r=e.nodeBefore,s=e.nodeAfter,o=e.index();return!r||!s||!r.type.compatibleContent(s.type)?!1:!r.content.size&&e.parent.canReplace(o-1,o)?(n&&n(t.tr.delete(e.pos-r.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(o,o+1)||!(s.isTextblock||ht(t.doc,e.pos))?!1:(n&&n(t.tr.join(e.pos).scrollIntoView()),!0)}function Pi(t,e,n,r){let s=e.nodeBefore,o=e.nodeAfter,i,l,a=s.type.spec.isolating||o.type.spec.isolating;if(!a&&yu(t,e,n))return!0;let c=!a&&e.parent.canReplace(e.index(),e.index()+1);if(c&&(i=(l=s.contentMatchAt(s.childCount)).findWrapping(o.type))&&l.matchType(i[0]||o.type).validEnd){if(n){let h=e.pos+o.nodeSize,p=N.empty;for(let b=i.length-1;b>=0;b--)p=N.from(i[b].create(null,p));p=N.from(s.copy(p));let g=t.tr.step(new oe(e.pos-1,h,e.pos,h,new T(p,1,0),i.length,!0)),y=g.doc.resolve(h+2*i.length);y.nodeAfter&&y.nodeAfter.type==s.type&&ht(g.doc,y.pos)&&g.join(y.pos),n(g.scrollIntoView())}return!0}let u=o.type.spec.isolating||r>0&&a?null:W.findFrom(e,1),d=u&&u.$from.blockRange(u.$to),f=d&&Nt(d);if(f!=null&&f>=e.depth)return n&&n(t.tr.lift(d,f).scrollIntoView()),!0;if(c&&Rt(o,"start",!0)&&Rt(s,"end")){let h=s,p=[];for(;p.push(h),!h.isTextblock;)h=h.lastChild;let g=o,y=1;for(;!g.isTextblock;g=g.firstChild)y++;if(h.canReplace(h.childCount,h.childCount,g.content)){if(n){let b=N.empty;for(let k=p.length-1;k>=0;k--)b=N.from(p[k].copy(b));let x=t.tr.step(new oe(e.pos-p.length,e.pos+o.nodeSize,e.pos+y,e.pos+o.nodeSize-y,new T(b,p.length,0),0,!0));n(x.scrollIntoView())}return!0}}return!1}function Di(t){return function(e,n){let r=e.selection,s=t<0?r.$from:r.$to,o=s.depth;for(;s.node(o).isInline;){if(!o)return!1;o--}return s.node(o).isTextblock?(n&&n(e.tr.setSelection(F.create(e.doc,t<0?s.start(o):s.end(o)))),!0):!1}}const bu=Di(-1),xu=Di(1);function wu(t,e=null){return function(n,r){let{$from:s,$to:o}=n.selection,i=s.blockRange(o),l=i&&ci(i,t,e);return l?(r&&r(n.tr.wrap(i,l).scrollIntoView()),!0):!1}}function $i(t,e=null){return function(n,r){let s=!1;for(let o=0;o<n.selection.ranges.length&&!s;o++){let{$from:{pos:i},$to:{pos:l}}=n.selection.ranges[o];n.doc.nodesBetween(i,l,(a,c)=>{if(s)return!1;if(!(!a.isTextblock||a.hasMarkup(t,e)))if(a.type==t)s=!0;else{let u=n.doc.resolve(c),d=u.index();s=u.parent.canReplaceWith(d,d+1,t)}})}if(!s)return!1;if(r){let o=n.tr;for(let i=0;i<n.selection.ranges.length;i++){let{$from:{pos:l},$to:{pos:a}}=n.selection.ranges[i];o.setBlockType(l,a,t,e)}r(o.scrollIntoView())}return!0}}function is(...t){return function(e,n,r){for(let s=0;s<t.length;s++)if(t[s](e,n,r))return!0;return!1}}is(ts,Ai,Mi),is(ts,Oi,ji),is(Ii,zi,Li,mu),typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function vu(t,e=null){return function(n,r){let{$from:s,$to:o}=n.selection,i=s.blockRange(o);if(!i)return!1;let l=r?n.tr:null;return ku(l,i,t,e)?(r&&r(l.scrollIntoView()),!0):!1}}function ku(t,e,n,r=null){let s=!1,o=e,i=e.$from.doc;if(e.depth>=2&&e.$from.node(e.depth-1).type.compatibleContent(n)&&e.startIndex==0){if(e.$from.index(e.depth-1)==0)return!1;let a=i.resolve(e.start-2);o=new An(a,a,e.depth),e.endIndex<e.parent.childCount&&(e=new An(e.$from,i.resolve(e.$to.end(e.depth)),e.depth)),s=!0}let l=ci(o,n,r,e);return l?(t&&Su(t,e,l,s,n),!0):!1}function Su(t,e,n,r,s){let o=N.empty;for(let u=n.length-1;u>=0;u--)o=N.from(n[u].type.create(n[u].attrs,o));t.step(new oe(e.start-(r?2:0),e.end,e.start,e.end,new T(o,0,0),n.length,!0));let i=0;for(let u=0;u<n.length;u++)n[u].type==s&&(i=u+1);let l=n.length-i,a=e.start+n.length-(r?2:0),c=e.parent;for(let u=e.startIndex,d=e.endIndex,f=!0;u<d;u++,f=!1)!f&&He(t.doc,a,l)&&(t.split(a,l),a+=2*l),a+=c.child(u).nodeSize;return t}function Cu(t){return function(e,n){let{$from:r,$to:s}=e.selection,o=r.blockRange(s,i=>i.childCount>0&&i.firstChild.type==t);return o?n?r.node(o.depth-1).type==t?Eu(e,n,t,o):Nu(e,n,o):!0:!1}}function Eu(t,e,n,r){let s=t.tr,o=r.end,i=r.$to.end(r.depth);o<i&&(s.step(new oe(o-1,i,o,i,new T(N.from(n.create(null,r.parent.copy())),1,0),1,!0)),r=new An(s.doc.resolve(r.$from.pos),s.doc.resolve(i),r.depth));const l=Nt(r);if(l==null)return!1;s.lift(r,l);let a=s.doc.resolve(s.mapping.map(o,-1)-1);return ht(s.doc,a.pos)&&a.nodeBefore.type==a.nodeAfter.type&&s.join(a.pos),e(s.scrollIntoView()),!0}function Nu(t,e,n){let r=t.tr,s=n.parent;for(let h=n.end,p=n.endIndex-1,g=n.startIndex;p>g;p--)h-=s.child(p).nodeSize,r.delete(h-1,h+1);let o=r.doc.resolve(n.start),i=o.nodeAfter;if(r.mapping.map(n.end)!=n.start+o.nodeAfter.nodeSize)return!1;let l=n.startIndex==0,a=n.endIndex==s.childCount,c=o.node(-1),u=o.index(-1);if(!c.canReplace(u+(l?0:1),u+1,i.content.append(a?N.empty:N.from(s))))return!1;let d=o.pos,f=d+i.nodeSize;return r.step(new oe(d-(l?1:0),f+(a?1:0),d+1,f-1,new T((l?N.empty:N.from(s.copy(N.empty))).append(a?N.empty:N.from(s.copy(N.empty))),l?0:1,a?0:1),l?0:1)),e(r.scrollIntoView()),!0}function Au(t){return function(e,n){let{$from:r,$to:s}=e.selection,o=r.blockRange(s,c=>c.childCount>0&&c.firstChild.type==t);if(!o)return!1;let i=o.startIndex;if(i==0)return!1;let l=o.parent,a=l.child(i-1);if(a.type!=t)return!1;if(n){let c=a.lastChild&&a.lastChild.type==l.type,u=N.from(c?t.create():null),d=new T(N.from(t.create(null,N.from(l.type.create(null,u)))),c?3:1,0),f=o.start,h=o.end;n(e.tr.step(new oe(f-(c?3:1),h,f,h,d,1,!0)).scrollIntoView())}return!0}}const pt=function(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e},Fi=function(t,e,n,r){return n&&(Bi(t,e,n,r,-1)||Bi(t,e,n,r,1))},Tu=/^(img|br|input|textarea|hr)$/i;function Bi(t,e,n,r,s){for(var o;;){if(t==n&&e==r)return!0;if(e==(s<0?0:Fn(t))){let i=t.parentNode;if(!i||i.nodeType!=1||ls(t)||Tu.test(t.nodeName)||t.contentEditable=="false")return!1;e=pt(t)+(s<0?0:1),t=i}else if(t.nodeType==1){let i=t.childNodes[e+(s<0?-1:0)];if(i.nodeType==1&&i.contentEditable=="false")if(!((o=i.pmViewDesc)===null||o===void 0)&&o.ignoreForSelection)e+=s;else return!1;else t=i,e=s<0?Fn(t):0}else return!1}}function Fn(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function Mu(t,e,n){for(let r=e==0,s=e==Fn(t);r||s;){if(t==n)return!0;let o=pt(t);if(t=t.parentNode,!t)return!1;r=r&&o==0,s=s&&o==Fn(t)}}function ls(t){let e;for(let n=t;n&&!(e=n.pmViewDesc);n=n.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}const Hi=function(t){return t.focusNode&&Fi(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)};function Wi(t,e){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=t,n.key=n.code=e,n}const Pe=typeof navigator<"u"?navigator:null,_i=typeof document<"u"?document:null,Qe=Pe&&Pe.userAgent||"",as=/Edge\/(\d+)/.exec(Qe),Ki=/MSIE \d/.exec(Qe),cs=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Qe),Xt=!!(Ki||cs||as),Vi=Ki?document.documentMode:cs?+cs[1]:as?+as[1]:0,Bn=!Xt&&/gecko\/(\d+)/i.test(Qe);Bn&&+(/Firefox\/(\d+)/.exec(Qe)||[0,0])[1];const us=!Xt&&/Chrome\/(\d+)/.exec(Qe),We=!!us,Ui=us?+us[1]:0,mt=!Xt&&!!Pe&&/Apple Computer/.test(Pe.vendor),ds=mt&&(/Mobile\/\w+/.test(Qe)||!!Pe&&Pe.maxTouchPoints>2),Ne=ds||(Pe?/Mac/.test(Pe.platform):!1),qi=Pe?/Win/.test(Pe.platform):!1,Zt=/Android \d/.test(Qe),fs=!!_i&&"webkitFontSmoothing"in _i.documentElement.style,Ru=fs?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function Ou(t,e=null){let n=t.domSelectionRange(),r=t.state.doc;if(!n.focusNode)return null;let s=t.docView.nearestDesc(n.focusNode),o=s&&s.size==0,i=t.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(i<0)return null;let l=r.resolve(i),a,c;if(Hi(n)){for(a=i;s&&!s.node;)s=s.parent;let d=s.node;if(s&&d.isAtom&&L.isSelectable(d)&&s.parent&&!(d.isInline&&Mu(n.focusNode,n.focusOffset,s.dom))){let f=s.posBefore;c=new L(i==f?l:r.resolve(f))}}else{if(n instanceof t.dom.ownerDocument.defaultView.Selection&&n.rangeCount>1){let d=i,f=i;for(let h=0;h<n.rangeCount;h++){let p=n.getRangeAt(h);d=Math.min(d,t.docView.posFromDOM(p.startContainer,p.startOffset,1)),f=Math.max(f,t.docView.posFromDOM(p.endContainer,p.endOffset,-1))}if(d<0)return null;[a,i]=f==t.state.selection.anchor?[f,d]:[d,f],l=r.resolve(i)}else a=t.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(a<0)return null}let u=r.resolve(a);if(!c){let d=e=="pointer"||t.state.selection.head<l.pos&&!o?1:-1;c=Zi(t,u,l,d)}return c}function Ji(t){return t.editable?t.hasFocus():Lu(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function hs(t,e=!1){let n=t.state.selection;if(zu(t,n),!!Ji(t)){if(!e&&t.input.mouseDown&&t.input.mouseDown.allowDefault&&We){let r=t.domSelectionRange(),s=t.domObserver.currentSelection;if(r.anchorNode&&s.anchorNode&&Fi(r.anchorNode,r.anchorOffset,s.anchorNode,s.anchorOffset)){t.input.mouseDown.delayedSelectionSync=!0,t.domObserver.setCurSelection();return}}if(t.domObserver.disconnectSelection(),t.cursorWrapper)Iu(t);else{let{anchor:r,head:s}=n,o,i;Gi&&!(n instanceof F)&&(n.$from.parent.inlineContent||(o=Yi(t,n.from)),!n.empty&&!n.$from.parent.inlineContent&&(i=Yi(t,n.to))),t.docView.setSelection(r,s,t,e),Gi&&(o&&Qi(o),i&&Qi(i)),n.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&ju(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}const Gi=mt||We&&Ui<63;function Yi(t,e){let{node:n,offset:r}=t.docView.domFromPos(e,0),s=r<n.childNodes.length?n.childNodes[r]:null,o=r?n.childNodes[r-1]:null;if(mt&&s&&s.contentEditable=="false")return ps(s);if((!s||s.contentEditable=="false")&&(!o||o.contentEditable=="false")){if(s)return ps(s);if(o)return ps(o)}}function ps(t){return t.contentEditable="true",mt&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function Qi(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function ju(t){let e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.input.hideSelectionGuard);let n=t.domSelectionRange(),r=n.anchorNode,s=n.anchorOffset;e.addEventListener("selectionchange",t.input.hideSelectionGuard=()=>{(n.anchorNode!=r||n.anchorOffset!=s)&&(e.removeEventListener("selectionchange",t.input.hideSelectionGuard),setTimeout(()=>{(!Ji(t)||t.state.selection.visible)&&t.dom.classList.remove("ProseMirror-hideselection")},20))})}function Iu(t){let e=t.domSelection();if(!e)return;let n=t.cursorWrapper.dom,r=n.nodeName=="IMG";r?e.collapse(n.parentNode,pt(n)+1):e.collapse(n,0),!r&&!t.state.selection.visible&&Xt&&Vi<=11&&(n.disabled=!0,n.disabled=!1)}function zu(t,e){if(e instanceof L){let n=t.docView.descAt(e.from);n!=t.lastSelectedViewDesc&&(Xi(t),n&&n.selectNode(),t.lastSelectedViewDesc=n)}else Xi(t)}function Xi(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=void 0)}function Zi(t,e,n,r){return t.someProp("createSelectionBetween",s=>s(t,e,n))||F.between(e,n,r)}function Lu(t){let e=t.domSelectionRange();if(!e.anchorNode)return!1;try{return t.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function ms(t,e){let{$anchor:n,$head:r}=t.selection,s=e>0?n.max(r):n.min(r),o=s.parent.inlineContent?s.depth?t.doc.resolve(e>0?s.after():s.before()):null:s;return o&&W.findFrom(o,e)}function Xe(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function el(t,e,n){let r=t.state.selection;if(r instanceof F)if(n.indexOf("s")>-1){let{$head:s}=r,o=s.textOffset?null:e<0?s.nodeBefore:s.nodeAfter;if(!o||o.isText||!o.isLeaf)return!1;let i=t.state.doc.resolve(s.pos+o.nodeSize*(e<0?-1:1));return Xe(t,new F(r.$anchor,i))}else if(r.empty){if(t.endOfTextblock(e>0?"forward":"backward")){let s=ms(t.state,e);return s&&s instanceof L?Xe(t,s):!1}else if(!(Ne&&n.indexOf("m")>-1)){let s=r.$head,o=s.textOffset?null:e<0?s.nodeBefore:s.nodeAfter,i;if(!o||o.isText)return!1;let l=e<0?s.pos-o.nodeSize:s.pos;return o.isAtom||(i=t.docView.descAt(l))&&!i.contentDOM?L.isSelectable(o)?Xe(t,new L(e<0?t.state.doc.resolve(s.pos-o.nodeSize):s)):fs?Xe(t,new F(t.state.doc.resolve(e<0?l:l+o.nodeSize))):!1:!1}}else return!1;else{if(r instanceof L&&r.node.isInline)return Xe(t,new F(e>0?r.$to:r.$from));{let s=ms(t.state,e);return s?Xe(t,s):!1}}}function Hn(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function en(t,e){let n=t.pmViewDesc;return n&&n.size==0&&(e<0||t.nextSibling||t.nodeName!="BR")}function Ot(t,e){return e<0?Pu(t):Du(t)}function Pu(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let s,o,i=!1;for(Bn&&n.nodeType==1&&r<Hn(n)&&en(n.childNodes[r],-1)&&(i=!0);;)if(r>0){if(n.nodeType!=1)break;{let l=n.childNodes[r-1];if(en(l,-1))s=n,o=--r;else if(l.nodeType==3)n=l,r=n.nodeValue.length;else break}}else{if(tl(n))break;{let l=n.previousSibling;for(;l&&en(l,-1);)s=n.parentNode,o=pt(l),l=l.previousSibling;if(l)n=l,r=Hn(n);else{if(n=n.parentNode,n==t.dom)break;r=0}}}i?gs(t,n,r):s&&gs(t,s,o)}function Du(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let s=Hn(n),o,i;for(;;)if(r<s){if(n.nodeType!=1)break;let l=n.childNodes[r];if(en(l,1))o=n,i=++r;else break}else{if(tl(n))break;{let l=n.nextSibling;for(;l&&en(l,1);)o=l.parentNode,i=pt(l)+1,l=l.nextSibling;if(l)n=l,r=0,s=Hn(n);else{if(n=n.parentNode,n==t.dom)break;r=s=0}}}o&&gs(t,o,i)}function tl(t){let e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function $u(t,e){for(;t&&e==t.childNodes.length&&!ls(t);)e=pt(t)+1,t=t.parentNode;for(;t&&e<t.childNodes.length;){let n=t.childNodes[e];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=0}}function Fu(t,e){for(;t&&!e&&!ls(t);)e=pt(t),t=t.parentNode;for(;t&&e;){let n=t.childNodes[e-1];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=t.childNodes.length}}function gs(t,e,n){if(e.nodeType!=3){let o,i;(i=$u(e,n))?(e=i,n=0):(o=Fu(e,n))&&(e=o,n=o.nodeValue.length)}let r=t.domSelection();if(!r)return;if(Hi(r)){let o=document.createRange();o.setEnd(e,n),o.setStart(e,n),r.removeAllRanges(),r.addRange(o)}else r.extend&&r.extend(e,n);t.domObserver.setCurSelection();let{state:s}=t;setTimeout(()=>{t.state==s&&hs(t)},50)}function nl(t,e){let n=t.state.doc.resolve(e);if(!(We||qi)&&n.parent.inlineContent){let s=t.coordsAtPos(e);if(e>n.start()){let o=t.coordsAtPos(e-1),i=(o.top+o.bottom)/2;if(i>s.top&&i<s.bottom&&Math.abs(o.left-s.left)>1)return o.left<s.left?"ltr":"rtl"}if(e<n.end()){let o=t.coordsAtPos(e+1),i=(o.top+o.bottom)/2;if(i>s.top&&i<s.bottom&&Math.abs(o.left-s.left)>1)return o.left>s.left?"ltr":"rtl"}}return getComputedStyle(t.dom).direction=="rtl"?"rtl":"ltr"}function rl(t,e,n){let r=t.state.selection;if(r instanceof F&&!r.empty||n.indexOf("s")>-1||Ne&&n.indexOf("m")>-1)return!1;let{$from:s,$to:o}=r;if(!s.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){let i=ms(t.state,e);if(i&&i instanceof L)return Xe(t,i)}if(!s.parent.inlineContent){let i=e<0?s:o,l=r instanceof ve?W.near(i,e):W.findFrom(i,e);return l?Xe(t,l):!1}return!1}function sl(t,e){if(!(t.state.selection instanceof F))return!0;let{$head:n,$anchor:r,empty:s}=t.state.selection;if(!n.sameParent(r))return!0;if(!s)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;let o=!n.textOffset&&(e<0?n.nodeBefore:n.nodeAfter);if(o&&!o.isText){let i=t.state.tr;return e<0?i.delete(n.pos-o.nodeSize,n.pos):i.delete(n.pos,n.pos+o.nodeSize),t.dispatch(i),!0}return!1}function ol(t,e,n){t.domObserver.stop(),e.contentEditable=n,t.domObserver.start()}function Bu(t){if(!mt||t.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(e&&e.nodeType==1&&n==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let r=e.firstChild;ol(t,r,"true"),setTimeout(()=>ol(t,r,"false"),20)}return!1}function Hu(t){let e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}function Wu(t,e){let n=e.keyCode,r=Hu(e);if(n==8||Ne&&n==72&&r=="c")return sl(t,-1)||Ot(t,-1);if(n==46&&!e.shiftKey||Ne&&n==68&&r=="c")return sl(t,1)||Ot(t,1);if(n==13||n==27)return!0;if(n==37||Ne&&n==66&&r=="c"){let s=n==37?nl(t,t.state.selection.from)=="ltr"?-1:1:-1;return el(t,s,r)||Ot(t,s)}else if(n==39||Ne&&n==70&&r=="c"){let s=n==39?nl(t,t.state.selection.from)=="ltr"?1:-1:1;return el(t,s,r)||Ot(t,s)}else{if(n==38||Ne&&n==80&&r=="c")return rl(t,-1,r)||Ot(t,-1);if(n==40||Ne&&n==78&&r=="c")return Bu(t)||rl(t,1,r)||Ot(t,1);if(r==(Ne?"m":"c")&&(n==66||n==73||n==89||n==90))return!0}return!1}function il(t,e){t.someProp("transformCopied",h=>{e=h(e,t)});let n=[],{content:r,openStart:s,openEnd:o}=e;for(;s>1&&o>1&&r.childCount==1&&r.firstChild.childCount==1;){s--,o--;let h=r.firstChild;n.push(h.type.name,h.attrs!=h.type.defaultAttrs?h.attrs:null),r=h.content}let i=t.someProp("clipboardSerializer")||On.fromSchema(t.state.schema),l=pl(),a=l.createElement("div");a.appendChild(i.serializeFragment(r,{document:l}));let c=a.firstChild,u,d=0;for(;c&&c.nodeType==1&&(u=fl[c.nodeName.toLowerCase()]);){for(let h=u.length-1;h>=0;h--){let p=l.createElement(u[h]);for(;a.firstChild;)p.appendChild(a.firstChild);a.appendChild(p),d++}c=a.firstChild}c&&c.nodeType==1&&c.setAttribute("data-pm-slice",`${s} ${o}${d?` -${d}`:""} ${JSON.stringify(n)}`);let f=t.someProp("clipboardTextSerializer",h=>h(e,t))||e.content.textBetween(0,e.content.size,`

`);return{dom:a,text:f,slice:e}}function ll(t,e,n,r,s){let o=s.parent.type.spec.code,i,l;if(!n&&!e)return null;let a=!!e&&(r||o||!n);if(a){if(t.someProp("transformPastedText",f=>{e=f(e,o||r,t)}),o)return l=new T(N.from(t.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0),t.someProp("transformPasted",f=>{l=f(l,t,!0)}),l;let d=t.someProp("clipboardTextParser",f=>f(e,s,r,t));if(d)l=d;else{let f=s.marks(),{schema:h}=t.state,p=On.fromSchema(h);i=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(g=>{let y=i.appendChild(document.createElement("p"));g&&y.appendChild(p.serializeNode(h.text(g,f)))})}}else t.someProp("transformPastedHTML",d=>{n=d(n,t)}),i=Uu(n),fs&&qu(i);let c=i&&i.querySelector("[data-pm-slice]"),u=c&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(c.getAttribute("data-pm-slice")||"");if(u&&u[3])for(let d=+u[3];d>0;d--){let f=i.firstChild;for(;f&&f.nodeType!=1;)f=f.nextSibling;if(!f)break;i=f}if(l||(l=(t.someProp("clipboardParser")||t.someProp("domParser")||dt.fromSchema(t.state.schema)).parseSlice(i,{preserveWhitespace:!!(a||u),context:s,ruleFromNode(f){return f.nodeName=="BR"&&!f.nextSibling&&f.parentNode&&!_u.test(f.parentNode.nodeName)?{ignore:!0}:null}})),u)l=Ju(dl(l,+u[1],+u[2]),u[4]);else if(l=T.maxOpen(Ku(l.content,s),!0),l.openStart||l.openEnd){let d=0,f=0;for(let h=l.content.firstChild;d<l.openStart&&!h.type.spec.isolating;d++,h=h.firstChild);for(let h=l.content.lastChild;f<l.openEnd&&!h.type.spec.isolating;f++,h=h.lastChild);l=dl(l,d,f)}return t.someProp("transformPasted",d=>{l=d(l,t,a)}),l}const _u=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function Ku(t,e){if(t.childCount<2)return t;for(let n=e.depth;n>=0;n--){let s=e.node(n).contentMatchAt(e.index(n)),o,i=[];if(t.forEach(l=>{if(!i)return;let a=s.findWrapping(l.type),c;if(!a)return i=null;if(c=i.length&&o.length&&cl(a,o,l,i[i.length-1],0))i[i.length-1]=c;else{i.length&&(i[i.length-1]=ul(i[i.length-1],o.length));let u=al(l,a);i.push(u),s=s.matchType(u.type),o=a}}),i)return N.from(i)}return t}function al(t,e,n=0){for(let r=e.length-1;r>=n;r--)t=e[r].create(null,N.from(t));return t}function cl(t,e,n,r,s){if(s<t.length&&s<e.length&&t[s]==e[s]){let o=cl(t,e,n,r.lastChild,s+1);if(o)return r.copy(r.content.replaceChild(r.childCount-1,o));if(r.contentMatchAt(r.childCount).matchType(s==t.length-1?n.type:t[s+1]))return r.copy(r.content.append(N.from(al(n,t,s+1))))}}function ul(t,e){if(e==0)return t;let n=t.content.replaceChild(t.childCount-1,ul(t.lastChild,e-1)),r=t.contentMatchAt(t.childCount).fillBefore(N.empty,!0);return t.copy(n.append(r))}function ys(t,e,n,r,s,o){let i=e<0?t.firstChild:t.lastChild,l=i.content;return t.childCount>1&&(o=0),s<r-1&&(l=ys(l,e,n,r,s+1,o)),s>=n&&(l=e<0?i.contentMatchAt(0).fillBefore(l,o<=s).append(l):l.append(i.contentMatchAt(i.childCount).fillBefore(N.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,i.copy(l))}function dl(t,e,n){return e<t.openStart&&(t=new T(ys(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),n<t.openEnd&&(t=new T(ys(t.content,1,n,t.openEnd,0,0),t.openStart,n)),t}const fl={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let hl=null;function pl(){return hl||(hl=document.implementation.createHTMLDocument("title"))}let bs=null;function Vu(t){let e=window.trustedTypes;return e?(bs||(bs=e.defaultPolicy||e.createPolicy("ProseMirrorClipboard",{createHTML:n=>n})),bs.createHTML(t)):t}function Uu(t){let e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));let n=pl().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(t),s;if((s=r&&fl[r[1].toLowerCase()])&&(t=s.map(o=>"<"+o+">").join("")+t+s.map(o=>"</"+o+">").reverse().join("")),n.innerHTML=Vu(t),s)for(let o=0;o<s.length;o++)n=n.querySelector(s[o])||n;return n}function qu(t){let e=t.querySelectorAll(We?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<e.length;n++){let r=e[n];r.childNodes.length==1&&r.textContent==" "&&r.parentNode&&r.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),r)}}function Ju(t,e){if(!t.size)return t;let n=t.content.firstChild.type.schema,r;try{r=JSON.parse(e)}catch{return t}let{content:s,openStart:o,openEnd:i}=t;for(let l=r.length-2;l>=0;l-=2){let a=n.nodes[r[l]];if(!a||a.hasRequiredAttrs())break;s=N.from(a.create(r[l+1],s)),o++,i++}return new T(s,o,i)}const Oe={},Se={};function Ze(t,e){t.input.lastSelectionOrigin=e,t.input.lastSelectionTime=Date.now()}Se.keydown=(t,e)=>{let n=e;if(t.input.shiftKey=n.keyCode==16||n.shiftKey,!gl(t,n)&&(t.input.lastKeyCode=n.keyCode,t.input.lastKeyCodeTime=Date.now(),!(Zt&&We&&n.keyCode==13)))if(n.keyCode!=229&&t.domObserver.forceFlush(),ds&&n.keyCode==13&&!n.ctrlKey&&!n.altKey&&!n.metaKey){let r=Date.now();t.input.lastIOSEnter=r,t.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{t.input.lastIOSEnter==r&&(t.someProp("handleKeyDown",s=>s(t,Wi(13,"Enter"))),t.input.lastIOSEnter=0)},200)}else t.someProp("handleKeyDown",r=>r(t,n))||Wu(t,n)?n.preventDefault():Ze(t,"key")},Se.keyup=(t,e)=>{e.keyCode==16&&(t.input.shiftKey=!1)},Se.keypress=(t,e)=>{let n=e;if(gl(t,n)||!n.charCode||n.ctrlKey&&!n.altKey||Ne&&n.metaKey)return;if(t.someProp("handleKeyPress",s=>s(t,n))){n.preventDefault();return}let r=t.state.selection;if(!(r instanceof F)||!r.$from.sameParent(r.$to)){let s=String.fromCharCode(n.charCode),o=()=>t.state.tr.insertText(s).scrollIntoView();!/[\r\n]/.test(s)&&!t.someProp("handleTextInput",i=>i(t,r.$from.pos,r.$to.pos,s,o))&&t.dispatch(o()),n.preventDefault()}};function Wn(t){return{left:t.clientX,top:t.clientY}}function Gu(t,e){let n=e.x-t.clientX,r=e.y-t.clientY;return n*n+r*r<100}function xs(t,e,n,r,s){if(r==-1)return!1;let o=t.state.doc.resolve(r);for(let i=o.depth+1;i>0;i--)if(t.someProp(e,l=>i>o.depth?l(t,n,o.nodeAfter,o.before(i),s,!0):l(t,n,o.node(i),o.before(i),s,!1)))return!0;return!1}function jt(t,e,n){if(t.focused||t.focus(),t.state.selection.eq(e))return;let r=t.state.tr.setSelection(e);r.setMeta("pointer",!0),t.dispatch(r)}function Yu(t,e){if(e==-1)return!1;let n=t.state.doc.resolve(e),r=n.nodeAfter;return r&&r.isAtom&&L.isSelectable(r)?(jt(t,new L(n)),!0):!1}function Qu(t,e){if(e==-1)return!1;let n=t.state.selection,r,s;n instanceof L&&(r=n.node);let o=t.state.doc.resolve(e);for(let i=o.depth+1;i>0;i--){let l=i>o.depth?o.nodeAfter:o.node(i);if(L.isSelectable(l)){r&&n.$from.depth>0&&i>=n.$from.depth&&o.before(n.$from.depth+1)==n.$from.pos?s=o.before(n.$from.depth):s=o.before(i);break}}return s!=null?(jt(t,L.create(t.state.doc,s)),!0):!1}function Xu(t,e,n,r,s){return xs(t,"handleClickOn",e,n,r)||t.someProp("handleClick",o=>o(t,e,r))||(s?Qu(t,n):Yu(t,n))}function Zu(t,e,n,r){return xs(t,"handleDoubleClickOn",e,n,r)||t.someProp("handleDoubleClick",s=>s(t,e,r))}function ed(t,e,n,r){return xs(t,"handleTripleClickOn",e,n,r)||t.someProp("handleTripleClick",s=>s(t,e,r))||td(t,n,r)}function td(t,e,n){if(n.button!=0)return!1;let r=t.state.doc;if(e==-1)return r.inlineContent?(jt(t,F.create(r,0,r.content.size)),!0):!1;let s=r.resolve(e);for(let o=s.depth+1;o>0;o--){let i=o>s.depth?s.nodeAfter:s.node(o),l=s.before(o);if(i.inlineContent)jt(t,F.create(r,l+1,l+1+i.content.size));else if(L.isSelectable(i))jt(t,L.create(r,l));else continue;return!0}}function ws(t){return _n(t)}const ml=Ne?"metaKey":"ctrlKey";Oe.mousedown=(t,e)=>{let n=e;t.input.shiftKey=n.shiftKey;let r=ws(t),s=Date.now(),o="singleClick";s-t.input.lastClick.time<500&&Gu(n,t.input.lastClick)&&!n[ml]&&t.input.lastClick.button==n.button&&(t.input.lastClick.type=="singleClick"?o="doubleClick":t.input.lastClick.type=="doubleClick"&&(o="tripleClick")),t.input.lastClick={time:s,x:n.clientX,y:n.clientY,type:o,button:n.button};let i=t.posAtCoords(Wn(n));i&&(o=="singleClick"?(t.input.mouseDown&&t.input.mouseDown.done(),t.input.mouseDown=new nd(t,i,n,!!r)):(o=="doubleClick"?Zu:ed)(t,i.pos,i.inside,n)?n.preventDefault():Ze(t,"pointer"))};class nd{constructor(e,n,r,s){this.view=e,this.pos=n,this.event=r,this.flushed=s,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!r[ml],this.allowDefault=r.shiftKey;let o,i;if(n.inside>-1)o=e.state.doc.nodeAt(n.inside),i=n.inside;else{let u=e.state.doc.resolve(n.pos);o=u.parent,i=u.depth?u.before():0}const l=s?null:r.target,a=l?e.docView.nearestDesc(l,!0):null;this.target=a&&a.nodeDOM.nodeType==1?a.nodeDOM:null;let{selection:c}=e.state;(r.button==0&&o.type.spec.draggable&&o.type.spec.selectable!==!1||c instanceof L&&c.from<=i&&c.to>i)&&(this.mightDrag={node:o,pos:i,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&Bn&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),Ze(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>hs(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let n=this.pos;this.view.state.doc!=this.startDoc&&(n=this.view.posAtCoords(Wn(e))),this.updateAllowDefault(e),this.allowDefault||!n?Ze(this.view,"pointer"):Xu(this.view,n.pos,n.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||mt&&this.mightDrag&&!this.mightDrag.node.isAtom||We&&!this.view.state.selection.visible&&Math.min(Math.abs(n.pos-this.view.state.selection.from),Math.abs(n.pos-this.view.state.selection.to))<=2)?(jt(this.view,W.near(this.view.state.doc.resolve(n.pos))),e.preventDefault()):Ze(this.view,"pointer")}move(e){this.updateAllowDefault(e),Ze(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}Oe.touchstart=t=>{t.input.lastTouch=Date.now(),ws(t),Ze(t,"pointer")},Oe.touchmove=t=>{t.input.lastTouch=Date.now(),Ze(t,"pointer")},Oe.contextmenu=t=>ws(t);function gl(t,e){return t.composing?!0:mt&&Math.abs(e.timeStamp-t.input.compositionEndedAt)<500?(t.input.compositionEndedAt=-2e8,!0):!1}const rd=Zt?5e3:-1;Se.compositionstart=Se.compositionupdate=t=>{if(!t.composing){t.domObserver.flush();let{state:e}=t,n=e.selection.$to;if(e.selection instanceof F&&(e.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some(r=>r.type.spec.inclusive===!1)||We&&qi&&sd(t)))t.markCursor=t.state.storedMarks||n.marks(),_n(t,!0),t.markCursor=null;else if(_n(t,!e.selection.empty),Bn&&e.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let r=t.domSelectionRange();for(let s=r.focusNode,o=r.focusOffset;s&&s.nodeType==1&&o!=0;){let i=o<0?s.lastChild:s.childNodes[o-1];if(!i)break;if(i.nodeType==3){let l=t.domSelection();l&&l.collapse(i,i.nodeValue.length);break}else s=i,o=-1}}t.input.composing=!0}yl(t,rd)};function sd(t){let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(!e||e.nodeType!=1||n>=e.childNodes.length)return!1;let r=e.childNodes[n];return r.nodeType==1&&r.contentEditable=="false"}Se.compositionend=(t,e)=>{t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=e.timeStamp,t.input.compositionPendingChanges=t.domObserver.pendingRecords().length?t.input.compositionID:0,t.input.compositionNode=null,t.input.badSafariComposition?t.domObserver.forceFlush():t.input.compositionPendingChanges&&Promise.resolve().then(()=>t.domObserver.flush()),t.input.compositionID++,yl(t,20))};function yl(t,e){clearTimeout(t.input.composingTimeout),e>-1&&(t.input.composingTimeout=setTimeout(()=>_n(t),e))}function od(t){for(t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=id());t.input.compositionNodes.length>0;)t.input.compositionNodes.pop().markParentsDirty()}function id(){let t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}function _n(t,e=!1){if(!(Zt&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),od(t),e||t.docView&&t.docView.dirty){let n=Ou(t),r=t.state.selection;return n&&!n.eq(r)?t.dispatch(t.state.tr.setSelection(n)):(t.markCursor||e)&&!r.$from.node(r.$from.sharedDepth(r.to)).inlineContent?t.dispatch(t.state.tr.deleteSelection()):t.updateState(t.state),!0}return!1}}function ld(t,e){if(!t.dom.parentNode)return;let n=t.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(e),n.style.cssText="position: fixed; left: -10000px; top: 10px";let r=getSelection(),s=document.createRange();s.selectNodeContents(e),t.dom.blur(),r.removeAllRanges(),r.addRange(s),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),t.focus()},50)}const tn=Xt&&Vi<15||ds&&Ru<604;Oe.copy=Se.cut=(t,e)=>{let n=e,r=t.state.selection,s=n.type=="cut";if(r.empty)return;let o=tn?null:n.clipboardData,i=r.content(),{dom:l,text:a}=il(t,i);o?(n.preventDefault(),o.clearData(),o.setData("text/html",l.innerHTML),o.setData("text/plain",a)):ld(t,l),s&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function ad(t){return t.openStart==0&&t.openEnd==0&&t.content.childCount==1?t.content.firstChild:null}function cd(t,e){if(!t.dom.parentNode)return;let n=t.input.shiftKey||t.state.selection.$from.parent.type.spec.code,r=t.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus();let s=t.input.shiftKey&&t.input.lastKeyCode!=45;setTimeout(()=>{t.focus(),r.parentNode&&r.parentNode.removeChild(r),n?vs(t,r.value,null,s,e):vs(t,r.textContent,r.innerHTML,s,e)},50)}function vs(t,e,n,r,s){let o=ll(t,e,n,r,t.state.selection.$from);if(t.someProp("handlePaste",a=>a(t,s,o||T.empty)))return!0;if(!o)return!1;let i=ad(o),l=i?t.state.tr.replaceSelectionWith(i,r):t.state.tr.replaceSelection(o);return t.dispatch(l.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function bl(t){let e=t.getData("text/plain")||t.getData("Text");if(e)return e;let n=t.getData("text/uri-list");return n?n.replace(/\r?\n/g," "):""}Se.paste=(t,e)=>{let n=e;if(t.composing&&!Zt)return;let r=tn?null:n.clipboardData,s=t.input.shiftKey&&t.input.lastKeyCode!=45;r&&vs(t,bl(r),r.getData("text/html"),s,n)?n.preventDefault():cd(t,n)};class ud{constructor(e,n,r){this.slice=e,this.move=n,this.node=r}}const dd=Ne?"altKey":"ctrlKey";function xl(t,e){let n=t.someProp("dragCopies",r=>!r(e));return n??!e[dd]}Oe.dragstart=(t,e)=>{let n=e,r=t.input.mouseDown;if(r&&r.done(),!n.dataTransfer)return;let s=t.state.selection,o=s.empty?null:t.posAtCoords(Wn(n)),i;if(!(o&&o.pos>=s.from&&o.pos<=(s instanceof L?s.to-1:s.to))){if(r&&r.mightDrag)i=L.create(t.state.doc,r.mightDrag.pos);else if(n.target&&n.target.nodeType==1){let d=t.docView.nearestDesc(n.target,!0);d&&d.node.type.spec.draggable&&d!=t.docView&&(i=L.create(t.state.doc,d.posBefore))}}let l=(i||t.state.selection).content(),{dom:a,text:c,slice:u}=il(t,l);(!n.dataTransfer.files.length||!We||Ui>120)&&n.dataTransfer.clearData(),n.dataTransfer.setData(tn?"Text":"text/html",a.innerHTML),n.dataTransfer.effectAllowed="copyMove",tn||n.dataTransfer.setData("text/plain",c),t.dragging=new ud(u,xl(t,n),i)},Oe.dragend=t=>{let e=t.dragging;window.setTimeout(()=>{t.dragging==e&&(t.dragging=null)},50)},Se.dragover=Se.dragenter=(t,e)=>e.preventDefault(),Se.drop=(t,e)=>{try{fd(t,e,t.dragging)}finally{t.dragging=null}};function fd(t,e,n){if(!e.dataTransfer)return;let r=t.posAtCoords(Wn(e));if(!r)return;let s=t.state.doc.resolve(r.pos),o=n&&n.slice;o?t.someProp("transformPasted",h=>{o=h(o,t,!1)}):o=ll(t,bl(e.dataTransfer),tn?null:e.dataTransfer.getData("text/html"),!1,s);let i=!!(n&&xl(t,e));if(t.someProp("handleDrop",h=>h(t,e,o||T.empty,i))){e.preventDefault();return}if(!o)return;e.preventDefault();let l=o?eu(t.state.doc,s.pos,o):s.pos;l==null&&(l=s.pos);let a=t.state.tr;if(i){let{node:h}=n;h?h.replace(a):a.deleteSelection()}let c=a.mapping.map(l),u=o.openStart==0&&o.openEnd==0&&o.content.childCount==1,d=a.doc;if(u?a.replaceRangeWith(c,c,o.content.firstChild):a.replaceRange(c,c,o),a.doc.eq(d))return;let f=a.doc.resolve(c);if(u&&L.isSelectable(o.content.firstChild)&&f.nodeAfter&&f.nodeAfter.sameMarkup(o.content.firstChild))a.setSelection(new L(f));else{let h=a.mapping.map(l);a.mapping.maps[a.mapping.maps.length-1].forEach((p,g,y,b)=>h=b),a.setSelection(Zi(t,f,a.doc.resolve(h)))}t.focus(),t.dispatch(a.setMeta("uiEvent","drop"))}Oe.focus=t=>{t.input.lastFocus=Date.now(),t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout(()=>{t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.domSelectionRange())&&hs(t)},20))},Oe.blur=(t,e)=>{let n=e;t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),n.relatedTarget&&t.dom.contains(n.relatedTarget)&&t.domObserver.currentSelection.clear(),t.focused=!1)},Oe.beforeinput=(t,e)=>{if(We&&Zt&&e.inputType=="deleteContentBackward"){t.domObserver.flushSoon();let{domChangeCount:r}=t.input;setTimeout(()=>{if(t.input.domChangeCount!=r||(t.dom.blur(),t.focus(),t.someProp("handleKeyDown",o=>o(t,Wi(8,"Backspace")))))return;let{$cursor:s}=t.state.selection;s&&s.pos>0&&t.dispatch(t.state.tr.delete(s.pos-1,s.pos).scrollIntoView())},50)}};for(let t in Se)Oe[t]=Se[t];function nn(t,e){if(t==e)return!0;for(let n in t)if(t[n]!==e[n])return!1;for(let n in e)if(!(n in t))return!1;return!0}class Kn{constructor(e,n){this.toDOM=e,this.spec=n||gt,this.side=this.spec.side||0}map(e,n,r,s){let{pos:o,deleted:i}=e.mapResult(n.from+s,this.side<0?-1:1);return i?null:new Ae(o-r,o-r,this)}valid(){return!0}eq(e){return this==e||e instanceof Kn&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&nn(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class et{constructor(e,n){this.attrs=e,this.spec=n||gt}map(e,n,r,s){let o=e.map(n.from+s,this.spec.inclusiveStart?-1:1)-r,i=e.map(n.to+s,this.spec.inclusiveEnd?1:-1)-r;return o>=i?null:new Ae(o,i,this)}valid(e,n){return n.from<n.to}eq(e){return this==e||e instanceof et&&nn(this.attrs,e.attrs)&&nn(this.spec,e.spec)}static is(e){return e.type instanceof et}destroy(){}}class ks{constructor(e,n){this.attrs=e,this.spec=n||gt}map(e,n,r,s){let o=e.mapResult(n.from+s,1);if(o.deleted)return null;let i=e.mapResult(n.to+s,-1);return i.deleted||i.pos<=o.pos?null:new Ae(o.pos-r,i.pos-r,this)}valid(e,n){let{index:r,offset:s}=e.content.findIndex(n.from),o;return s==n.from&&!(o=e.child(r)).isText&&s+o.nodeSize==n.to}eq(e){return this==e||e instanceof ks&&nn(this.attrs,e.attrs)&&nn(this.spec,e.spec)}destroy(){}}class Ae{constructor(e,n,r){this.from=e,this.to=n,this.type=r}copy(e,n){return new Ae(e,n,this.type)}eq(e,n=0){return this.type.eq(e.type)&&this.from+n==e.from&&this.to+n==e.to}map(e,n,r){return this.type.map(e,this,n,r)}static widget(e,n,r){return new Ae(e,e,new Kn(n,r))}static inline(e,n,r,s){return new Ae(e,n,new et(r,s))}static node(e,n,r,s){return new Ae(e,n,new ks(r,s))}get spec(){return this.type.spec}get inline(){return this.type instanceof et}get widget(){return this.type instanceof Kn}}const It=[],gt={};class re{constructor(e,n){this.local=e.length?e:It,this.children=n.length?n:It}static create(e,n){return n.length?Vn(n,e,0,gt):ge}find(e,n,r){let s=[];return this.findInner(e??0,n??1e9,s,0,r),s}findInner(e,n,r,s,o){for(let i=0;i<this.local.length;i++){let l=this.local[i];l.from<=n&&l.to>=e&&(!o||o(l.spec))&&r.push(l.copy(l.from+s,l.to+s))}for(let i=0;i<this.children.length;i+=3)if(this.children[i]<n&&this.children[i+1]>e){let l=this.children[i]+1;this.children[i+2].findInner(e-l,n-l,r,s+l,o)}}map(e,n,r){return this==ge||e.maps.length==0?this:this.mapInner(e,n,0,0,r||gt)}mapInner(e,n,r,s,o){let i;for(let l=0;l<this.local.length;l++){let a=this.local[l].map(e,r,s);a&&a.type.valid(n,a)?(i||(i=[])).push(a):o.onRemove&&o.onRemove(this.local[l].spec)}return this.children.length?hd(this.children,i||[],e,n,r,s,o):i?new re(i.sort(bt),It):ge}add(e,n){return n.length?this==ge?re.create(e,n):this.addInner(e,n,0):this}addInner(e,n,r){let s,o=0;e.forEach((l,a)=>{let c=a+r,u;if(u=vl(n,l,c)){for(s||(s=this.children.slice());o<s.length&&s[o]<a;)o+=3;s[o]==a?s[o+2]=s[o+2].addInner(l,u,c+1):s.splice(o,0,a,a+l.nodeSize,Vn(u,l,c+1,gt)),o+=3}});let i=wl(o?kl(n):n,-r);for(let l=0;l<i.length;l++)i[l].type.valid(e,i[l])||i.splice(l--,1);return new re(i.length?this.local.concat(i).sort(bt):this.local,s||this.children)}remove(e){return e.length==0||this==ge?this:this.removeInner(e,0)}removeInner(e,n){let r=this.children,s=this.local;for(let o=0;o<r.length;o+=3){let i,l=r[o]+n,a=r[o+1]+n;for(let u=0,d;u<e.length;u++)(d=e[u])&&d.from>l&&d.to<a&&(e[u]=null,(i||(i=[])).push(d));if(!i)continue;r==this.children&&(r=this.children.slice());let c=r[o+2].removeInner(i,l+1);c!=ge?r[o+2]=c:(r.splice(o,3),o-=3)}if(s.length){for(let o=0,i;o<e.length;o++)if(i=e[o])for(let l=0;l<s.length;l++)s[l].eq(i,n)&&(s==this.local&&(s=this.local.slice()),s.splice(l--,1))}return r==this.children&&s==this.local?this:s.length||r.length?new re(s,r):ge}forChild(e,n){if(this==ge)return this;if(n.isLeaf)return re.empty;let r,s;for(let l=0;l<this.children.length;l+=3)if(this.children[l]>=e){this.children[l]==e&&(r=this.children[l+2]);break}let o=e+1,i=o+n.content.size;for(let l=0;l<this.local.length;l++){let a=this.local[l];if(a.from<i&&a.to>o&&a.type instanceof et){let c=Math.max(o,a.from)-o,u=Math.min(i,a.to)-o;c<u&&(s||(s=[])).push(a.copy(c,u))}}if(s){let l=new re(s.sort(bt),It);return r?new yt([l,r]):l}return r||ge}eq(e){if(this==e)return!0;if(!(e instanceof re)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let n=0;n<this.local.length;n++)if(!this.local[n].eq(e.local[n]))return!1;for(let n=0;n<this.children.length;n+=3)if(this.children[n]!=e.children[n]||this.children[n+1]!=e.children[n+1]||!this.children[n+2].eq(e.children[n+2]))return!1;return!0}locals(e){return Ss(this.localsInner(e))}localsInner(e){if(this==ge)return It;if(e.inlineContent||!this.local.some(et.is))return this.local;let n=[];for(let r=0;r<this.local.length;r++)this.local[r].type instanceof et||n.push(this.local[r]);return n}forEachSet(e){e(this)}}re.empty=new re([],[]),re.removeOverlap=Ss;const ge=re.empty;class yt{constructor(e){this.members=e}map(e,n){const r=this.members.map(s=>s.map(e,n,gt));return yt.from(r)}forChild(e,n){if(n.isLeaf)return re.empty;let r=[];for(let s=0;s<this.members.length;s++){let o=this.members[s].forChild(e,n);o!=ge&&(o instanceof yt?r=r.concat(o.members):r.push(o))}return yt.from(r)}eq(e){if(!(e instanceof yt)||e.members.length!=this.members.length)return!1;for(let n=0;n<this.members.length;n++)if(!this.members[n].eq(e.members[n]))return!1;return!0}locals(e){let n,r=!0;for(let s=0;s<this.members.length;s++){let o=this.members[s].localsInner(e);if(o.length)if(!n)n=o;else{r&&(n=n.slice(),r=!1);for(let i=0;i<o.length;i++)n.push(o[i])}}return n?Ss(r?n:n.sort(bt)):It}static from(e){switch(e.length){case 0:return ge;case 1:return e[0];default:return new yt(e.every(n=>n instanceof re)?e:e.reduce((n,r)=>n.concat(r instanceof re?r:r.members),[]))}}forEachSet(e){for(let n=0;n<this.members.length;n++)this.members[n].forEachSet(e)}}function hd(t,e,n,r,s,o,i){let l=t.slice();for(let c=0,u=o;c<n.maps.length;c++){let d=0;n.maps[c].forEach((f,h,p,g)=>{let y=g-p-(h-f);for(let b=0;b<l.length;b+=3){let x=l[b+1];if(x<0||f>x+u-d)continue;let k=l[b]+u-d;h>=k?l[b+1]=f<=k?-2:-1:f>=u&&y&&(l[b]+=y,l[b+1]+=y)}d+=y}),u=n.maps[c].map(u,-1)}let a=!1;for(let c=0;c<l.length;c+=3)if(l[c+1]<0){if(l[c+1]==-2){a=!0,l[c+1]=-1;continue}let u=n.map(t[c]+o),d=u-s;if(d<0||d>=r.content.size){a=!0;continue}let f=n.map(t[c+1]+o,-1),h=f-s,{index:p,offset:g}=r.content.findIndex(d),y=r.maybeChild(p);if(y&&g==d&&g+y.nodeSize==h){let b=l[c+2].mapInner(n,y,u+1,t[c]+o+1,i);b!=ge?(l[c]=d,l[c+1]=h,l[c+2]=b):(l[c+1]=-2,a=!0)}else a=!0}if(a){let c=pd(l,t,e,n,s,o,i),u=Vn(c,r,0,i);e=u.local;for(let d=0;d<l.length;d+=3)l[d+1]<0&&(l.splice(d,3),d-=3);for(let d=0,f=0;d<u.children.length;d+=3){let h=u.children[d];for(;f<l.length&&l[f]<h;)f+=3;l.splice(f,0,u.children[d],u.children[d+1],u.children[d+2])}}return new re(e.sort(bt),l)}function wl(t,e){if(!e||!t.length)return t;let n=[];for(let r=0;r<t.length;r++){let s=t[r];n.push(new Ae(s.from+e,s.to+e,s.type))}return n}function pd(t,e,n,r,s,o,i){function l(a,c){for(let u=0;u<a.local.length;u++){let d=a.local[u].map(r,s,c);d?n.push(d):i.onRemove&&i.onRemove(a.local[u].spec)}for(let u=0;u<a.children.length;u+=3)l(a.children[u+2],a.children[u]+c+1)}for(let a=0;a<t.length;a+=3)t[a+1]==-1&&l(t[a+2],e[a]+o+1);return n}function vl(t,e,n){if(e.isLeaf)return null;let r=n+e.nodeSize,s=null;for(let o=0,i;o<t.length;o++)(i=t[o])&&i.from>n&&i.to<r&&((s||(s=[])).push(i),t[o]=null);return s}function kl(t){let e=[];for(let n=0;n<t.length;n++)t[n]!=null&&e.push(t[n]);return e}function Vn(t,e,n,r){let s=[],o=!1;e.forEach((l,a)=>{let c=vl(t,l,a+n);if(c){o=!0;let u=Vn(c,l,n+a+1,r);u!=ge&&s.push(a,a+l.nodeSize,u)}});let i=wl(o?kl(t):t,-n).sort(bt);for(let l=0;l<i.length;l++)i[l].type.valid(e,i[l])||(r.onRemove&&r.onRemove(i[l].spec),i.splice(l--,1));return i.length||s.length?new re(i,s):ge}function bt(t,e){return t.from-e.from||t.to-e.to}function Ss(t){let e=t;for(let n=0;n<e.length-1;n++){let r=e[n];if(r.from!=r.to)for(let s=n+1;s<e.length;s++){let o=e[s];if(o.from==r.from){o.to!=r.to&&(e==t&&(e=t.slice()),e[s]=o.copy(o.from,r.to),Sl(e,s+1,o.copy(r.to,o.to)));continue}else{o.from<r.to&&(e==t&&(e=t.slice()),e[n]=r.copy(r.from,o.from),Sl(e,s,r.copy(o.from,r.to)));break}}}return e}function Sl(t,e,n){for(;e<t.length&&bt(n,t[e])>0;)e++;t.splice(e,0,n)}for(var tt={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Un={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},md=typeof navigator<"u"&&/Mac/.test(navigator.platform),gd=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),ae=0;ae<10;ae++)tt[48+ae]=tt[96+ae]=String(ae);for(var ae=1;ae<=24;ae++)tt[ae+111]="F"+ae;for(var ae=65;ae<=90;ae++)tt[ae]=String.fromCharCode(ae+32),Un[ae]=String.fromCharCode(ae);for(var Cs in tt)Un.hasOwnProperty(Cs)||(Un[Cs]=tt[Cs]);function yd(t){var e=md&&t.metaKey&&t.shiftKey&&!t.ctrlKey&&!t.altKey||gd&&t.shiftKey&&t.key&&t.key.length==1||t.key=="Unidentified",n=!e&&t.key||(t.shiftKey?Un:tt)[t.keyCode]||t.key||"Unidentified";return n=="Esc"&&(n="Escape"),n=="Del"&&(n="Delete"),n=="Left"&&(n="ArrowLeft"),n=="Up"&&(n="ArrowUp"),n=="Right"&&(n="ArrowRight"),n=="Down"&&(n="ArrowDown"),n}const bd=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),xd=typeof navigator<"u"&&/Win/.test(navigator.platform);function wd(t){let e=t.split(/-(?!$)/),n=e[e.length-1];n=="Space"&&(n=" ");let r,s,o,i;for(let l=0;l<e.length-1;l++){let a=e[l];if(/^(cmd|meta|m)$/i.test(a))i=!0;else if(/^a(lt)?$/i.test(a))r=!0;else if(/^(c|ctrl|control)$/i.test(a))s=!0;else if(/^s(hift)?$/i.test(a))o=!0;else if(/^mod$/i.test(a))bd?i=!0:s=!0;else throw new Error("Unrecognized modifier name: "+a)}return r&&(n="Alt-"+n),s&&(n="Ctrl-"+n),i&&(n="Meta-"+n),o&&(n="Shift-"+n),n}function vd(t){let e=Object.create(null);for(let n in t)e[wd(n)]=t[n];return e}function Es(t,e,n=!0){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),n&&e.shiftKey&&(t="Shift-"+t),t}function kd(t){let e=vd(t);return function(n,r){let s=yd(r),o,i=e[Es(s,r)];if(i&&i(n.state,n.dispatch,n))return!0;if(s.length==1&&s!=" "){if(r.shiftKey){let l=e[Es(s,r,!1)];if(l&&l(n.state,n.dispatch,n))return!0}if((r.altKey||r.metaKey||r.ctrlKey)&&!(xd&&r.ctrlKey&&r.altKey)&&(o=tt[r.keyCode])&&o!=s){let l=e[Es(o,r)];if(l&&l(n.state,n.dispatch,n))return!0}}return!1}}var Sd=Object.defineProperty,Ns=(t,e)=>{for(var n in e)Sd(t,n,{get:e[n],enumerable:!0})};function Cl(t){const{state:e,transaction:n}=t;let{selection:r}=n,{doc:s}=n,{storedMarks:o}=n;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return o},get selection(){return r},get doc(){return s},get tr(){return r=n.selection,s=n.doc,o=n.storedMarks,n}}}var Cd=class{constructor(t){this.editor=t.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=t.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:t,editor:e,state:n}=this,{view:r}=e,{tr:s}=n,o=this.buildProps(s);return Object.fromEntries(Object.entries(t).map(([i,l])=>[i,(...c)=>{const u=l(...c)(o);return!s.getMeta("preventDispatch")&&!this.hasCustomState&&r.dispatch(s),u}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(t,e=!0){const{rawCommands:n,editor:r,state:s}=this,{view:o}=r,i=[],l=!!t,a=t||s.tr,c=()=>(!l&&e&&!a.getMeta("preventDispatch")&&!this.hasCustomState&&o.dispatch(a),i.every(d=>d===!0)),u={...Object.fromEntries(Object.entries(n).map(([d,f])=>[d,(...p)=>{const g=this.buildProps(a,e),y=f(...p)(g);return i.push(y),u}])),run:c};return u}createCan(t){const{rawCommands:e,state:n}=this,r=!1,s=t||n.tr,o=this.buildProps(s,r);return{...Object.fromEntries(Object.entries(e).map(([l,a])=>[l,(...c)=>a(...c)({...o,dispatch:void 0})])),chain:()=>this.createChain(s,r)}}buildProps(t,e=!0){const{rawCommands:n,editor:r,state:s}=this,{view:o}=r,i={tr:t,editor:r,view:o,state:Cl({state:s,transaction:t}),dispatch:e?()=>{}:void 0,chain:()=>this.createChain(t,e),can:()=>this.createCan(t),get commands(){return Object.fromEntries(Object.entries(n).map(([l,a])=>[l,(...c)=>a(...c)(i)]))}};return i}},El={};Ns(El,{blur:()=>Ed,clearContent:()=>Nd,clearNodes:()=>Ad,command:()=>Td,createParagraphNear:()=>Md,cut:()=>Rd,deleteCurrentNode:()=>Od,deleteNode:()=>jd,deleteRange:()=>Id,deleteSelection:()=>zd,enter:()=>Ld,exitCode:()=>Pd,extendMarkRange:()=>$d,first:()=>Fd,focus:()=>Wd,forEach:()=>_d,insertContent:()=>Kd,insertContentAt:()=>qd,joinBackward:()=>Yd,joinDown:()=>Gd,joinForward:()=>Qd,joinItemBackward:()=>Xd,joinItemForward:()=>Zd,joinTextblockBackward:()=>ef,joinTextblockForward:()=>tf,joinUp:()=>Jd,keyboardShortcut:()=>rf,lift:()=>sf,liftEmptyBlock:()=>of,liftListItem:()=>lf,newlineInCode:()=>af,resetAttributes:()=>cf,scrollIntoView:()=>uf,selectAll:()=>df,selectNodeBackward:()=>ff,selectNodeForward:()=>hf,selectParentNode:()=>pf,selectTextblockEnd:()=>mf,selectTextblockStart:()=>gf,setContent:()=>bf,setMark:()=>Rf,setMeta:()=>Of,setNode:()=>jf,setNodeSelection:()=>If,setTextDirection:()=>zf,setTextSelection:()=>Lf,sinkListItem:()=>Pf,splitBlock:()=>Df,splitListItem:()=>$f,toggleList:()=>Ff,toggleMark:()=>Bf,toggleNode:()=>Hf,toggleWrap:()=>Wf,undoInputRule:()=>_f,unsetAllMarks:()=>Kf,unsetMark:()=>Vf,unsetTextDirection:()=>Uf,updateAttributes:()=>qf,wrapIn:()=>Jf,wrapInList:()=>Gf});var Ed=()=>({editor:t,view:e})=>(requestAnimationFrame(()=>{var n;t.isDestroyed||(e.dom.blur(),(n=window?.getSelection())==null||n.removeAllRanges())}),!0),Nd=(t=!0)=>({commands:e})=>e.setContent("",{emitUpdate:t}),Ad=()=>({state:t,tr:e,dispatch:n})=>{const{selection:r}=e,{ranges:s}=r;return n&&s.forEach(({$from:o,$to:i})=>{t.doc.nodesBetween(o.pos,i.pos,(l,a)=>{if(l.type.isText)return;const{doc:c,mapping:u}=e,d=c.resolve(u.map(a)),f=c.resolve(u.map(a+l.nodeSize)),h=d.blockRange(f);if(!h)return;const p=Nt(h);if(l.type.isTextblock){const{defaultType:g}=d.parent.contentMatchAt(d.index());e.setNodeMarkup(h.start,g)}(p||p===0)&&e.lift(h,p)})}),!0},Td=t=>e=>t(e),Md=()=>({state:t,dispatch:e})=>zi(t,e),Rd=(t,e)=>({editor:n,tr:r})=>{const{state:s}=n,o=s.doc.slice(t.from,t.to);r.deleteRange(t.from,t.to);const i=r.mapping.map(e);return r.insert(i,o.content),r.setSelection(new F(r.doc.resolve(Math.max(i-1,0)))),!0},Od=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,r=n.$anchor.node();if(r.content.size>0)return!1;const s=t.selection.$anchor;for(let o=s.depth;o>0;o-=1)if(s.node(o).type===r.type){if(e){const l=s.before(o),a=s.after(o);t.delete(l,a).scrollIntoView()}return!0}return!1};function ce(t,e){if(typeof t=="string"){if(!e.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return e.nodes[t]}return t}var jd=t=>({tr:e,state:n,dispatch:r})=>{const s=ce(t,n.schema),o=e.selection.$anchor;for(let i=o.depth;i>0;i-=1)if(o.node(i).type===s){if(r){const a=o.before(i),c=o.after(i);e.delete(a,c).scrollIntoView()}return!0}return!1},Id=t=>({tr:e,dispatch:n})=>{const{from:r,to:s}=t;return n&&e.delete(r,s),!0},zd=()=>({state:t,dispatch:e})=>ts(t,e),Ld=()=>({commands:t})=>t.keyboardShortcut("Enter"),Pd=()=>({state:t,dispatch:e})=>hu(t,e);function Dd(t){return Object.prototype.toString.call(t)==="[object RegExp]"}function qn(t,e,n={strict:!0}){const r=Object.keys(e);return r.length?r.every(s=>n.strict?e[s]===t[s]:Dd(e[s])?e[s].test(t[s]):e[s]===t[s]):!0}function Nl(t,e,n={}){return t.find(r=>r.type===e&&qn(Object.fromEntries(Object.keys(n).map(s=>[s,r.attrs[s]])),n))}function Al(t,e,n={}){return!!Nl(t,e,n)}function As(t,e,n){var r;if(!t||!e)return;let s=t.parent.childAfter(t.parentOffset);if((!s.node||!s.node.marks.some(u=>u.type===e))&&(s=t.parent.childBefore(t.parentOffset)),!s.node||!s.node.marks.some(u=>u.type===e)||(n=n||((r=s.node.marks[0])==null?void 0:r.attrs),!Nl([...s.node.marks],e,n)))return;let i=s.index,l=t.start()+s.offset,a=i+1,c=l+s.node.nodeSize;for(;i>0&&Al([...t.parent.child(i-1).marks],e,n);)i-=1,l-=t.parent.child(i).nodeSize;for(;a<t.parent.childCount&&Al([...t.parent.child(a).marks],e,n);)c+=t.parent.child(a).nodeSize,a+=1;return{from:l,to:c}}function nt(t,e){if(typeof t=="string"){if(!e.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return e.marks[t]}return t}var $d=(t,e={})=>({tr:n,state:r,dispatch:s})=>{const o=nt(t,r.schema),{doc:i,selection:l}=n,{$from:a,from:c,to:u}=l;if(s){const d=As(a,o,e);if(d&&d.from<=c&&d.to>=u){const f=F.create(i,d.from,d.to);n.setSelection(f)}}return!0},Fd=t=>e=>{const n=typeof t=="function"?t(e):t;for(let r=0;r<n.length;r+=1)if(n[r](e))return!0;return!1};function Tl(t){return t instanceof F}function xt(t=0,e=0,n=0){return Math.min(Math.max(t,e),n)}function Bd(t,e=null){if(!e)return null;const n=W.atStart(t),r=W.atEnd(t);if(e==="start"||e===!0)return n;if(e==="end")return r;const s=n.from,o=r.to;return e==="all"?F.create(t,xt(0,s,o),xt(t.content.size,s,o)):F.create(t,xt(e,s,o),xt(e,s,o))}function Ml(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function Jn(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}function Hd(){return typeof navigator<"u"?/^((?!chrome|android).)*safari/i.test(navigator.userAgent):!1}var Wd=(t=null,e={})=>({editor:n,view:r,tr:s,dispatch:o})=>{e={scrollIntoView:!0,...e};const i=()=>{(Jn()||Ml())&&r.dom.focus(),Hd()&&!Jn()&&!Ml()&&r.dom.focus({preventScroll:!0}),requestAnimationFrame(()=>{n.isDestroyed||(r.focus(),e?.scrollIntoView&&n.commands.scrollIntoView())})};try{if(r.hasFocus()&&t===null||t===!1)return!0}catch{return!1}if(o&&t===null&&!Tl(n.state.selection))return i(),!0;const l=Bd(s.doc,t)||n.state.selection,a=n.state.selection.eq(l);return o&&(a||s.setSelection(l),a&&s.storedMarks&&s.setStoredMarks(s.storedMarks),i()),!0},_d=(t,e)=>n=>t.every((r,s)=>e(r,{...n,index:s})),Kd=(t,e)=>({tr:n,commands:r})=>r.insertContentAt({from:n.selection.from,to:n.selection.to},t,e),Rl=t=>{const e=t.childNodes;for(let n=e.length-1;n>=0;n-=1){const r=e[n];r.nodeType===3&&r.nodeValue&&/^(\n\s\s|\n)$/.test(r.nodeValue)?t.removeChild(r):r.nodeType===1&&Rl(r)}return t};function Gn(t){if(typeof window>"u")throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");const e=`<body>${t}</body>`,n=new window.DOMParser().parseFromString(e,"text/html").body;return Rl(n)}function rn(t,e,n){if(t instanceof Le||t instanceof N)return t;n={slice:!0,parseOptions:{},...n};const r=typeof t=="object"&&t!==null,s=typeof t=="string";if(r)try{if(Array.isArray(t)&&t.length>0)return N.fromArray(t.map(l=>e.nodeFromJSON(l)));const i=e.nodeFromJSON(t);return n.errorOnInvalidContent&&i.check(),i}catch(o){if(n.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:o});return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",o),rn("",e,n)}if(s){if(n.errorOnInvalidContent){let i=!1,l="";const a=new Rc({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:c=>(i=!0,l=typeof c=="string"?c:c.outerHTML,null)}]}})});if(n.slice?dt.fromSchema(a).parseSlice(Gn(t),n.parseOptions):dt.fromSchema(a).parse(Gn(t),n.parseOptions),n.errorOnInvalidContent&&i)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${l}`)})}const o=dt.fromSchema(e);return n.slice?o.parseSlice(Gn(t),n.parseOptions).content:o.parse(Gn(t),n.parseOptions)}return rn("",e,n)}function Vd(t,e,n){const r=t.steps.length-1;if(r<e)return;const s=t.steps[r];if(!(s instanceof se||s instanceof oe))return;const o=t.mapping.maps[r];let i=0;o.forEach((l,a,c,u)=>{i===0&&(i=u)}),t.setSelection(W.near(t.doc.resolve(i),n))}var Ud=t=>!("type"in t),qd=(t,e,n)=>({tr:r,dispatch:s,editor:o})=>{var i;if(s){n={parseOptions:o.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...n};let l;const a=y=>{o.emit("contentError",{editor:o,error:y,disableCollaboration:()=>{"collaboration"in o.storage&&typeof o.storage.collaboration=="object"&&o.storage.collaboration&&(o.storage.collaboration.isDisabled=!0)}})},c={preserveWhitespace:"full",...n.parseOptions};if(!n.errorOnInvalidContent&&!o.options.enableContentCheck&&o.options.emitContentError)try{rn(e,o.schema,{parseOptions:c,errorOnInvalidContent:!0})}catch(y){a(y)}try{l=rn(e,o.schema,{parseOptions:c,errorOnInvalidContent:(i=n.errorOnInvalidContent)!=null?i:o.options.enableContentCheck})}catch(y){return a(y),!1}let{from:u,to:d}=typeof t=="number"?{from:t,to:t}:{from:t.from,to:t.to},f=!0,h=!0;if((Ud(l)?l:[l]).forEach(y=>{y.check(),f=f?y.isText&&y.marks.length===0:!1,h=h?y.isBlock:!1}),u===d&&h){const{parent:y}=r.doc.resolve(u);y.isTextblock&&!y.type.spec.code&&!y.childCount&&(u-=1,d+=1)}let g;if(f){if(Array.isArray(e))g=e.map(y=>y.text||"").join("");else if(e instanceof N){let y="";e.forEach(b=>{b.text&&(y+=b.text)}),g=y}else typeof e=="object"&&e&&e.text?g=e.text:g=e;r.insertText(g,u,d)}else{g=l;const y=r.doc.resolve(u),b=y.node(),x=y.parentOffset===0,k=b.isText||b.isTextblock,E=b.content.size>0;x&&k&&E&&(u=Math.max(0,u-1)),r.replaceWith(u,d,g)}n.updateSelection&&Vd(r,r.steps.length-1,-1),n.applyInputRules&&r.setMeta("applyInputRules",{from:u,text:g}),n.applyPasteRules&&r.setMeta("applyPasteRules",{from:u,text:g})}return!0},Jd=()=>({state:t,dispatch:e})=>uu(t,e),Gd=()=>({state:t,dispatch:e})=>du(t,e),Yd=()=>({state:t,dispatch:e})=>Ai(t,e),Qd=()=>({state:t,dispatch:e})=>Oi(t,e),Xd=()=>({state:t,dispatch:e,tr:n})=>{try{const r=Ln(t.doc,t.selection.$from.pos,-1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},Zd=()=>({state:t,dispatch:e,tr:n})=>{try{const r=Ln(t.doc,t.selection.$from.pos,1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},ef=()=>({state:t,dispatch:e})=>au(t,e),tf=()=>({state:t,dispatch:e})=>cu(t,e);function Ol(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function nf(t){const e=t.split(/-(?!$)/);let n=e[e.length-1];n==="Space"&&(n=" ");let r,s,o,i;for(let l=0;l<e.length-1;l+=1){const a=e[l];if(/^(cmd|meta|m)$/i.test(a))i=!0;else if(/^a(lt)?$/i.test(a))r=!0;else if(/^(c|ctrl|control)$/i.test(a))s=!0;else if(/^s(hift)?$/i.test(a))o=!0;else if(/^mod$/i.test(a))Jn()||Ol()?i=!0:s=!0;else throw new Error(`Unrecognized modifier name: ${a}`)}return r&&(n=`Alt-${n}`),s&&(n=`Ctrl-${n}`),i&&(n=`Meta-${n}`),o&&(n=`Shift-${n}`),n}var rf=t=>({editor:e,view:n,tr:r,dispatch:s})=>{const o=nf(t).split(/-(?!$)/),i=o.find(c=>!["Alt","Ctrl","Meta","Shift"].includes(c)),l=new KeyboardEvent("keydown",{key:i==="Space"?" ":i,altKey:o.includes("Alt"),ctrlKey:o.includes("Ctrl"),metaKey:o.includes("Meta"),shiftKey:o.includes("Shift"),bubbles:!0,cancelable:!0}),a=e.captureTransaction(()=>{n.someProp("handleKeyDown",c=>c(n,l))});return a?.steps.forEach(c=>{const u=c.map(r.mapping);u&&s&&r.maybeStep(u)}),!0};function Ts(t,e,n={}){const{from:r,to:s,empty:o}=t.selection,i=e?ce(e,t.schema):null,l=[];t.doc.nodesBetween(r,s,(d,f)=>{if(d.isText)return;const h=Math.max(r,f),p=Math.min(s,f+d.nodeSize);l.push({node:d,from:h,to:p})});const a=s-r,c=l.filter(d=>i?i.name===d.node.type.name:!0).filter(d=>qn(d.node.attrs,n,{strict:!1}));return o?!!c.length:c.reduce((d,f)=>d+f.to-f.from,0)>=a}var sf=(t,e={})=>({state:n,dispatch:r})=>{const s=ce(t,n.schema);return Ts(n,s,e)?fu(n,r):!1},of=()=>({state:t,dispatch:e})=>Li(t,e),lf=t=>({state:e,dispatch:n})=>{const r=ce(t,e.schema);return Cu(r)(e,n)},af=()=>({state:t,dispatch:e})=>Ii(t,e);function Ms(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function jl(t,e){const n=typeof e=="string"?[e]:e;return Object.keys(t).reduce((r,s)=>(n.includes(s)||(r[s]=t[s]),r),{})}var cf=(t,e)=>({tr:n,state:r,dispatch:s})=>{let o=null,i=null;const l=Ms(typeof t=="string"?t:t.name,r.schema);if(!l)return!1;l==="node"&&(o=ce(t,r.schema)),l==="mark"&&(i=nt(t,r.schema));let a=!1;return n.selection.ranges.forEach(c=>{r.doc.nodesBetween(c.$from.pos,c.$to.pos,(u,d)=>{o&&o===u.type&&(a=!0,s&&n.setNodeMarkup(d,void 0,jl(u.attrs,e))),i&&u.marks.length&&u.marks.forEach(f=>{i===f.type&&(a=!0,s&&n.addMark(d,d+u.nodeSize,i.create(jl(f.attrs,e))))})})}),a},uf=()=>({tr:t,dispatch:e})=>(e&&t.scrollIntoView(),!0),df=()=>({tr:t,dispatch:e})=>{if(e){const n=new ve(t.doc);t.setSelection(n)}return!0},ff=()=>({state:t,dispatch:e})=>Mi(t,e),hf=()=>({state:t,dispatch:e})=>ji(t,e),pf=()=>({state:t,dispatch:e})=>gu(t,e),mf=()=>({state:t,dispatch:e})=>xu(t,e),gf=()=>({state:t,dispatch:e})=>bu(t,e);function yf(t,e,n={},r={}){return rn(t,e,{slice:!1,parseOptions:n,errorOnInvalidContent:r.errorOnInvalidContent})}var bf=(t,{errorOnInvalidContent:e,emitUpdate:n=!0,parseOptions:r={}}={})=>({editor:s,tr:o,dispatch:i,commands:l})=>{const{doc:a}=o;if(r.preserveWhitespace!=="full"){const c=yf(t,s.schema,r,{errorOnInvalidContent:e??s.options.enableContentCheck});return i&&o.replaceWith(0,a.content.size,c).setMeta("preventUpdate",!n),!0}return i&&o.setMeta("preventUpdate",!n),l.insertContentAt({from:0,to:a.content.size},t,{parseOptions:r,errorOnInvalidContent:e??s.options.enableContentCheck})};function Il(t,e){const n=nt(e,t.schema),{from:r,to:s,empty:o}=t.selection,i=[];o?(t.storedMarks&&i.push(...t.storedMarks),i.push(...t.selection.$head.marks())):t.doc.nodesBetween(r,s,a=>{i.push(...a.marks)});const l=i.find(a=>a.type.name===n.name);return l?{...l.attrs}:{}}function zl(t,e){const n=new bi(t);return e.forEach(r=>{r.steps.forEach(s=>{n.step(s)})}),n}function xf(t){for(let e=0;e<t.edgeCount;e+=1){const{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}function wf(t,e,n){const r=[];return t.nodesBetween(e.from,e.to,(s,o)=>{n(s)&&r.push({node:s,pos:o})}),r}function Ll(t,e){for(let n=t.depth;n>0;n-=1){const r=t.node(n);if(e(r))return{pos:n>0?t.before(n):0,start:t.start(n),depth:n,node:r}}}function Rs(t){return e=>Ll(e.$from,t)}function zt(t,e,n){return t.config[e]===void 0&&t.parent?zt(t.parent,e,n):typeof t.config[e]=="function"?t.config[e].bind({...n,parent:t.parent?zt(t.parent,e,n):null}):t.config[e]}function vf(t){return typeof t=="function"}function Lt(t,e=void 0,...n){return vf(t)?e?t.bind(e)(...n):t(...n):t}function Pl(t){const e=t.filter(s=>s.type==="extension"),n=t.filter(s=>s.type==="node"),r=t.filter(s=>s.type==="mark");return{baseExtensions:e,nodeExtensions:n,markExtensions:r}}function rt(...t){return t.filter(e=>!!e).reduce((e,n)=>{const r={...e};return Object.entries(n).forEach(([s,o])=>{if(!r[s]){r[s]=o;return}if(s==="class"){const l=o?String(o).split(" "):[],a=r[s]?r[s].split(" "):[],c=l.filter(u=>!a.includes(u));r[s]=[...a,...c].join(" ")}else if(s==="style"){const l=o?o.split(";").map(u=>u.trim()).filter(Boolean):[],a=r[s]?r[s].split(";").map(u=>u.trim()).filter(Boolean):[],c=new Map;a.forEach(u=>{const[d,f]=u.split(":").map(h=>h.trim());c.set(d,f)}),l.forEach(u=>{const[d,f]=u.split(":").map(h=>h.trim());c.set(d,f)}),r[s]=Array.from(c.entries()).map(([u,d])=>`${u}: ${d}`).join("; ")}else r[s]=o}),r},{})}function kf(t,e,n){const{from:r,to:s}=e,{blockSeparator:o=`

`,textSerializers:i={}}=n||{};let l="";return t.nodesBetween(r,s,(a,c,u,d)=>{var f;a.isBlock&&c>r&&(l+=o);const h=i?.[a.type.name];if(h)return u&&(l+=h({node:a,pos:c,parent:u,index:d,range:e})),!1;a.isText&&(l+=(f=a?.text)==null?void 0:f.slice(Math.max(r,c)-c,s-c))}),l}function Sf(t){return Object.fromEntries(Object.entries(t.nodes).filter(([,e])=>e.spec.toText).map(([e,n])=>[e,n.spec.toText]))}function Cf(t,e){const n=ce(e,t.schema),{from:r,to:s}=t.selection,o=[];t.doc.nodesBetween(r,s,l=>{o.push(l)});const i=o.reverse().find(l=>l.type.name===n.name);return i?{...i.attrs}:{}}function Ef(t,e){const n=Ms(typeof e=="string"?e:e.name,t.schema);return n==="node"?Cf(t,e):n==="mark"?Il(t,e):{}}function Nf(t,e=JSON.stringify){const n={};return t.filter(r=>{const s=e(r);return Object.prototype.hasOwnProperty.call(n,s)?!1:n[s]=!0})}function Af(t){const e=Nf(t);return e.length===1?e:e.filter((n,r)=>!e.filter((o,i)=>i!==r).some(o=>n.oldRange.from>=o.oldRange.from&&n.oldRange.to<=o.oldRange.to&&n.newRange.from>=o.newRange.from&&n.newRange.to<=o.newRange.to))}function Dl(t){const{mapping:e,steps:n}=t,r=[];return e.maps.forEach((s,o)=>{const i=[];if(s.ranges.length)s.forEach((l,a)=>{i.push({from:l,to:a})});else{const{from:l,to:a}=n[o];if(l===void 0||a===void 0)return;i.push({from:l,to:a})}i.forEach(({from:l,to:a})=>{const c=e.slice(o).map(l,-1),u=e.slice(o).map(a),d=e.invert().map(c,-1),f=e.invert().map(u);r.push({oldRange:{from:d,to:f},newRange:{from:c,to:u}})})}),Af(r)}function $l(t,e,n){const r=[];return t===e?n.resolve(t).marks().forEach(s=>{const o=n.resolve(t),i=As(o,s.type);i&&r.push({mark:s,...i})}):n.nodesBetween(t,e,(s,o)=>{!s||s?.nodeSize===void 0||r.push(...s.marks.map(i=>({from:o,to:o+s.nodeSize,mark:i})))}),r}function Yn(t,e,n){return Object.fromEntries(Object.entries(n).filter(([r])=>{const s=t.find(o=>o.type===e&&o.name===r);return s?s.attribute.keepOnSplit:!1}))}function Tf(t,e,n={}){const{empty:r,ranges:s}=t.selection,o=e?nt(e,t.schema):null;if(r)return!!(t.storedMarks||t.selection.$from.marks()).filter(d=>o?o.name===d.type.name:!0).find(d=>qn(d.attrs,n,{strict:!1}));let i=0;const l=[];if(s.forEach(({$from:d,$to:f})=>{const h=d.pos,p=f.pos;t.doc.nodesBetween(h,p,(g,y)=>{if(!g.isText&&!g.marks.length)return;const b=Math.max(h,y),x=Math.min(p,y+g.nodeSize),k=x-b;i+=k,l.push(...g.marks.map(E=>({mark:E,from:b,to:x})))})}),i===0)return!1;const a=l.filter(d=>o?o.name===d.mark.type.name:!0).filter(d=>qn(d.mark.attrs,n,{strict:!1})).reduce((d,f)=>d+f.to-f.from,0),c=l.filter(d=>o?d.mark.type!==o&&d.mark.type.excludes(o):!0).reduce((d,f)=>d+f.to-f.from,0);return(a>0?a+c:a)>=i}function Fl(t,e){const{nodeExtensions:n}=Pl(e),r=n.find(i=>i.name===t);if(!r)return!1;const s={name:r.name,options:r.options,storage:r.storage},o=Lt(zt(r,"group",s));return typeof o!="string"?!1:o.split(" ").includes("list")}function Bl(t,{checkChildren:e=!0,ignoreWhitespace:n=!1}={}){var r;if(n){if(t.type.name==="hardBreak")return!0;if(t.isText)return/^\s*$/m.test((r=t.text)!=null?r:"")}if(t.isText)return!t.text;if(t.isAtom||t.isLeaf)return!1;if(t.content.childCount===0)return!0;if(e){let s=!0;return t.content.forEach(o=>{s!==!1&&(Bl(o,{ignoreWhitespace:n,checkChildren:e})||(s=!1))}),s}return!1}function Mf(t,e,n){var r;const{selection:s}=e;let o=null;if(Tl(s)&&(o=s.$cursor),o){const l=(r=t.storedMarks)!=null?r:o.marks();return o.parent.type.allowsMarkType(n)&&(!!n.isInSet(l)||!l.some(c=>c.type.excludes(n)))}const{ranges:i}=s;return i.some(({$from:l,$to:a})=>{let c=l.depth===0?t.doc.inlineContent&&t.doc.type.allowsMarkType(n):!1;return t.doc.nodesBetween(l.pos,a.pos,(u,d,f)=>{if(c)return!1;if(u.isInline){const h=!f||f.type.allowsMarkType(n),p=!!n.isInSet(u.marks)||!u.marks.some(g=>g.type.excludes(n));c=h&&p}return!c}),c})}var Rf=(t,e={})=>({tr:n,state:r,dispatch:s})=>{const{selection:o}=n,{empty:i,ranges:l}=o,a=nt(t,r.schema);if(s)if(i){const c=Il(r,a);n.addStoredMark(a.create({...c,...e}))}else l.forEach(c=>{const u=c.$from.pos,d=c.$to.pos;r.doc.nodesBetween(u,d,(f,h)=>{const p=Math.max(h,u),g=Math.min(h+f.nodeSize,d);f.marks.find(b=>b.type===a)?f.marks.forEach(b=>{a===b.type&&n.addMark(p,g,a.create({...b.attrs,...e}))}):n.addMark(p,g,a.create(e))})});return Mf(r,n,a)},Of=(t,e)=>({tr:n})=>(n.setMeta(t,e),!0),jf=(t,e={})=>({state:n,dispatch:r,chain:s})=>{const o=ce(t,n.schema);let i;return n.selection.$anchor.sameParent(n.selection.$head)&&(i=n.selection.$anchor.parent.attrs),o.isTextblock?s().command(({commands:l})=>$i(o,{...i,...e})(n)?!0:l.clearNodes()).command(({state:l})=>$i(o,{...i,...e})(l,r)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},If=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,s=xt(t,0,r.content.size),o=L.create(r,s);e.setSelection(o)}return!0},zf=(t,e)=>({tr:n,state:r,dispatch:s})=>{const{selection:o}=r;let i,l;return typeof e=="number"?(i=e,l=e):e&&"from"in e&&"to"in e?(i=e.from,l=e.to):(i=o.from,l=o.to),s&&n.doc.nodesBetween(i,l,(a,c)=>{a.isText||n.setNodeMarkup(c,void 0,{...a.attrs,dir:t})}),!0},Lf=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,{from:s,to:o}=typeof t=="number"?{from:t,to:t}:t,i=F.atStart(r).from,l=F.atEnd(r).to,a=xt(s,i,l),c=xt(o,i,l),u=F.create(r,a,c);e.setSelection(u)}return!0},Pf=t=>({state:e,dispatch:n})=>{const r=ce(t,e.schema);return Au(r)(e,n)};function Hl(t,e){const n=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(n){const r=n.filter(s=>e?.includes(s.type.name));t.tr.ensureMarks(r)}}var Df=({keepMarks:t=!0}={})=>({tr:e,state:n,dispatch:r,editor:s})=>{const{selection:o,doc:i}=e,{$from:l,$to:a}=o,c=s.extensionManager.attributes,u=Yn(c,l.node().type.name,l.node().attrs);if(o instanceof L&&o.node.isBlock)return!l.parentOffset||!He(i,l.pos)?!1:(r&&(t&&Hl(n,s.extensionManager.splittableMarks),e.split(l.pos).scrollIntoView()),!0);if(!l.parent.isBlock)return!1;const d=a.parentOffset===a.parent.content.size,f=l.depth===0?void 0:xf(l.node(-1).contentMatchAt(l.indexAfter(-1)));let h=d&&f?[{type:f,attrs:u}]:void 0,p=He(e.doc,e.mapping.map(l.pos),1,h);if(!h&&!p&&He(e.doc,e.mapping.map(l.pos),1,f?[{type:f}]:void 0)&&(p=!0,h=f?[{type:f,attrs:u}]:void 0),r){if(p&&(o instanceof F&&e.deleteSelection(),e.split(e.mapping.map(l.pos),1,h),f&&!d&&!l.parentOffset&&l.parent.type!==f)){const g=e.mapping.map(l.before()),y=e.doc.resolve(g);l.node(-1).canReplaceWith(y.index(),y.index()+1,f)&&e.setNodeMarkup(e.mapping.map(l.before()),f)}t&&Hl(n,s.extensionManager.splittableMarks),e.scrollIntoView()}return p},$f=(t,e={})=>({tr:n,state:r,dispatch:s,editor:o})=>{var i;const l=ce(t,r.schema),{$from:a,$to:c}=r.selection,u=r.selection.node;if(u&&u.isBlock||a.depth<2||!a.sameParent(c))return!1;const d=a.node(-1);if(d.type!==l)return!1;const f=o.extensionManager.attributes;if(a.parent.content.size===0&&a.node(-1).childCount===a.indexAfter(-1)){if(a.depth===2||a.node(-3).type!==l||a.index(-2)!==a.node(-2).childCount-1)return!1;if(s){let b=N.empty;const x=a.index(-1)?1:a.index(-2)?2:3;for(let P=a.depth-x;P>=a.depth-3;P-=1)b=N.from(a.node(P).copy(b));const k=a.indexAfter(-1)<a.node(-2).childCount?1:a.indexAfter(-2)<a.node(-3).childCount?2:3,E={...Yn(f,a.node().type.name,a.node().attrs),...e},C=((i=l.contentMatch.defaultType)==null?void 0:i.createAndFill(E))||void 0;b=b.append(N.from(l.createAndFill(null,C)||void 0));const M=a.before(a.depth-(x-1));n.replace(M,a.after(-k),new T(b,4-x,0));let I=-1;n.doc.nodesBetween(M,n.doc.content.size,(P,V)=>{if(I>-1)return!1;P.isTextblock&&P.content.size===0&&(I=V+1)}),I>-1&&n.setSelection(F.near(n.doc.resolve(I))),n.scrollIntoView()}return!0}const h=c.pos===a.end()?d.contentMatchAt(0).defaultType:null,p={...Yn(f,d.type.name,d.attrs),...e},g={...Yn(f,a.node().type.name,a.node().attrs),...e};n.delete(a.pos,c.pos);const y=h?[{type:l,attrs:p},{type:h,attrs:g}]:[{type:l,attrs:p}];if(!He(n.doc,a.pos,2))return!1;if(s){const{selection:b,storedMarks:x}=r,{splittableMarks:k}=o.extensionManager,E=x||b.$to.parentOffset&&b.$from.marks();if(n.split(a.pos,2,y).scrollIntoView(),!E||!s)return!0;const C=E.filter(M=>k.includes(M.type.name));n.ensureMarks(C)}return!0},Os=(t,e)=>{const n=Rs(i=>i.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(r===void 0)return!0;const s=t.doc.nodeAt(r);return n.node.type===s?.type&&ht(t.doc,n.pos)&&t.join(n.pos),!0},js=(t,e)=>{const n=Rs(i=>i.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(n.start).after(n.depth);if(r===void 0)return!0;const s=t.doc.nodeAt(r);return n.node.type===s?.type&&ht(t.doc,r)&&t.join(r),!0},Ff=(t,e,n,r={})=>({editor:s,tr:o,state:i,dispatch:l,chain:a,commands:c,can:u})=>{const{extensions:d,splittableMarks:f}=s.extensionManager,h=ce(t,i.schema),p=ce(e,i.schema),{selection:g,storedMarks:y}=i,{$from:b,$to:x}=g,k=b.blockRange(x),E=y||g.$to.parentOffset&&g.$from.marks();if(!k)return!1;const C=Rs(M=>Fl(M.type.name,d))(g);if(k.depth>=1&&C&&k.depth-C.depth<=1){if(C.node.type===h)return c.liftListItem(p);if(Fl(C.node.type.name,d)&&h.validContent(C.node.content)&&l)return a().command(()=>(o.setNodeMarkup(C.pos,h),!0)).command(()=>Os(o,h)).command(()=>js(o,h)).run()}return!n||!E||!l?a().command(()=>u().wrapInList(h,r)?!0:c.clearNodes()).wrapInList(h,r).command(()=>Os(o,h)).command(()=>js(o,h)).run():a().command(()=>{const M=u().wrapInList(h,r),I=E.filter(P=>f.includes(P.type.name));return o.ensureMarks(I),M?!0:c.clearNodes()}).wrapInList(h,r).command(()=>Os(o,h)).command(()=>js(o,h)).run()},Bf=(t,e={},n={})=>({state:r,commands:s})=>{const{extendEmptyMarkRange:o=!1}=n,i=nt(t,r.schema);return Tf(r,i,e)?s.unsetMark(i,{extendEmptyMarkRange:o}):s.setMark(i,e)},Hf=(t,e,n={})=>({state:r,commands:s})=>{const o=ce(t,r.schema),i=ce(e,r.schema),l=Ts(r,o,n);let a;return r.selection.$anchor.sameParent(r.selection.$head)&&(a=r.selection.$anchor.parent.attrs),l?s.setNode(i,a):s.setNode(o,{...a,...n})},Wf=(t,e={})=>({state:n,commands:r})=>{const s=ce(t,n.schema);return Ts(n,s,e)?r.lift(s):r.wrapIn(s,e)},_f=()=>({state:t,dispatch:e})=>{const n=t.plugins;for(let r=0;r<n.length;r+=1){const s=n[r];let o;if(s.spec.isInputRules&&(o=s.getState(t))){if(e){const i=t.tr,l=o.transform;for(let a=l.steps.length-1;a>=0;a-=1)i.step(l.steps[a].invert(l.docs[a]));if(o.text){const a=i.doc.resolve(o.from).marks();i.replaceWith(o.from,o.to,t.schema.text(o.text,a))}else i.delete(o.from,o.to)}return!0}}return!1},Kf=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,{empty:r,ranges:s}=n;return r||e&&s.forEach(o=>{t.removeMark(o.$from.pos,o.$to.pos)}),!0},Vf=(t,e={})=>({tr:n,state:r,dispatch:s})=>{var o;const{extendEmptyMarkRange:i=!1}=e,{selection:l}=n,a=nt(t,r.schema),{$from:c,empty:u,ranges:d}=l;if(!s)return!0;if(u&&i){let{from:f,to:h}=l;const p=(o=c.marks().find(y=>y.type===a))==null?void 0:o.attrs,g=As(c,a,p);g&&(f=g.from,h=g.to),n.removeMark(f,h,a)}else d.forEach(f=>{n.removeMark(f.$from.pos,f.$to.pos,a)});return n.removeStoredMark(a),!0},Uf=t=>({tr:e,state:n,dispatch:r})=>{const{selection:s}=n;let o,i;return typeof t=="number"?(o=t,i=t):t&&"from"in t&&"to"in t?(o=t.from,i=t.to):(o=s.from,i=s.to),r&&e.doc.nodesBetween(o,i,(l,a)=>{if(l.isText)return;const c={...l.attrs};delete c.dir,e.setNodeMarkup(a,void 0,c)}),!0},qf=(t,e={})=>({tr:n,state:r,dispatch:s})=>{let o=null,i=null;const l=Ms(typeof t=="string"?t:t.name,r.schema);if(!l)return!1;l==="node"&&(o=ce(t,r.schema)),l==="mark"&&(i=nt(t,r.schema));let a=!1;return n.selection.ranges.forEach(c=>{const u=c.$from.pos,d=c.$to.pos;let f,h,p,g;n.selection.empty?r.doc.nodesBetween(u,d,(y,b)=>{o&&o===y.type&&(a=!0,p=Math.max(b,u),g=Math.min(b+y.nodeSize,d),f=b,h=y)}):r.doc.nodesBetween(u,d,(y,b)=>{b<u&&o&&o===y.type&&(a=!0,p=Math.max(b,u),g=Math.min(b+y.nodeSize,d),f=b,h=y),b>=u&&b<=d&&(o&&o===y.type&&(a=!0,s&&n.setNodeMarkup(b,void 0,{...y.attrs,...e})),i&&y.marks.length&&y.marks.forEach(x=>{if(i===x.type&&(a=!0,s)){const k=Math.max(b,u),E=Math.min(b+y.nodeSize,d);n.addMark(k,E,i.create({...x.attrs,...e}))}}))}),h&&(f!==void 0&&s&&n.setNodeMarkup(f,void 0,{...h.attrs,...e}),i&&h.marks.length&&h.marks.forEach(y=>{i===y.type&&s&&n.addMark(p,g,i.create({...y.attrs,...e}))}))}),a},Jf=(t,e={})=>({state:n,dispatch:r})=>{const s=ce(t,n.schema);return wu(s,e)(n,r)},Gf=(t,e={})=>({state:n,dispatch:r})=>{const s=ce(t,n.schema);return vu(s,e)(n,r)},Yf=class{constructor(t){var e;this.find=t.find,this.handler=t.handler,this.undoable=(e=t.undoable)!=null?e:!0}};function Qf(t){return Object.prototype.toString.call(t).slice(8,-1)}function Qn(t){return Qf(t)!=="Object"?!1:t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function Wl(t,e){const n={...t};return Qn(t)&&Qn(e)&&Object.keys(e).forEach(r=>{Qn(e[r])&&Qn(t[r])?n[r]=Wl(t[r],e[r]):n[r]=e[r]}),n}var Is=class{constructor(t={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...t},this.name=this.config.name}get options(){return{...Lt(zt(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...Lt(zt(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(t={}){const e=this.extend({...this.config,addOptions:()=>Wl(this.options,t)});return e.name=this.name,e.parent=this.parent,e}extend(t={}){const e=new this.constructor({...this.config,...t});return e.parent=this,this.child=e,e.name="name"in t?t.name:e.parent.name,e}},_l=class Pa extends Is{constructor(){super(...arguments),this.type="mark"}static create(e={}){const n=typeof e=="function"?e():e;return new Pa(n)}static handleExit({editor:e,mark:n}){const{tr:r}=e.state,s=e.state.selection.$from;if(s.pos===s.end()){const i=s.marks();if(!!!i.find(c=>c?.type.name===n.name))return!1;const a=i.find(c=>c?.type.name===n.name);return a&&r.removeStoredMark(a),r.insertText(" ",s.pos),e.view.dispatch(r),!0}return!1}configure(e){return super.configure(e)}extend(e){const n=typeof e=="function"?e():e;return super.extend(n)}},Xf=class{constructor(t){this.find=t.find,this.handler=t.handler}},Zf={};Ns(Zf,{ClipboardTextSerializer:()=>eh,Commands:()=>th,Delete:()=>nh,Drop:()=>rh,Editable:()=>sh,FocusEvents:()=>oh,Keymap:()=>ih,Paste:()=>lh,Tabindex:()=>ah,TextDirection:()=>ch,focusEventsPluginKey:()=>Kl});var je=class Da extends Is{constructor(){super(...arguments),this.type="extension"}static create(e={}){const n=typeof e=="function"?e():e;return new Da(n)}configure(e){return super.configure(e)}extend(e){const n=typeof e=="function"?e():e;return super.extend(n)}},eh=je.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new ke({key:new be("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:t}=this,{state:e,schema:n}=t,{doc:r,selection:s}=e,{ranges:o}=s,i=Math.min(...o.map(u=>u.$from.pos)),l=Math.max(...o.map(u=>u.$to.pos)),a=Sf(n);return kf(r,{from:i,to:l},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:a})}}})]}}),th=je.create({name:"commands",addCommands(){return{...El}}}),nh=je.create({name:"delete",onUpdate({transaction:t,appendedTransactions:e}){var n,r,s;const o=()=>{var i,l,a,c;if((c=(a=(l=(i=this.editor.options.coreExtensionOptions)==null?void 0:i.delete)==null?void 0:l.filterTransaction)==null?void 0:a.call(l,t))!=null?c:t.getMeta("y-sync$"))return;const u=zl(t.before,[t,...e]);Dl(u).forEach(h=>{u.mapping.mapResult(h.oldRange.from).deletedAfter&&u.mapping.mapResult(h.oldRange.to).deletedBefore&&u.before.nodesBetween(h.oldRange.from,h.oldRange.to,(p,g)=>{const y=g+p.nodeSize-2,b=h.oldRange.from<=g&&y<=h.oldRange.to;this.editor.emit("delete",{type:"node",node:p,from:g,to:y,newFrom:u.mapping.map(g),newTo:u.mapping.map(y),deletedRange:h.oldRange,newRange:h.newRange,partial:!b,editor:this.editor,transaction:t,combinedTransform:u})})});const f=u.mapping;u.steps.forEach((h,p)=>{var g,y;if(h instanceof Re){const b=f.slice(p).map(h.from,-1),x=f.slice(p).map(h.to),k=f.invert().map(b,-1),E=f.invert().map(x),C=(g=u.doc.nodeAt(b-1))==null?void 0:g.marks.some(I=>I.eq(h.mark)),M=(y=u.doc.nodeAt(x))==null?void 0:y.marks.some(I=>I.eq(h.mark));this.editor.emit("delete",{type:"mark",mark:h.mark,from:h.from,to:h.to,deletedRange:{from:k,to:E},newRange:{from:b,to:x},partial:!!(M||C),editor:this.editor,transaction:t,combinedTransform:u})}})};(s=(r=(n=this.editor.options.coreExtensionOptions)==null?void 0:n.delete)==null?void 0:r.async)==null||s?setTimeout(o,0):o()}}),rh=je.create({name:"drop",addProseMirrorPlugins(){return[new ke({key:new be("tiptapDrop"),props:{handleDrop:(t,e,n,r)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:n,moved:r})}}})]}}),sh=je.create({name:"editable",addProseMirrorPlugins(){return[new ke({key:new be("editable"),props:{editable:()=>this.editor.options.editable}})]}}),Kl=new be("focusEvents"),oh=je.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:t}=this;return[new ke({key:Kl,props:{handleDOMEvents:{focus:(e,n)=>{t.isFocused=!0;const r=t.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1},blur:(e,n)=>{t.isFocused=!1;const r=t.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1}}}})]}}),ih=je.create({name:"keymap",addKeyboardShortcuts(){const t=()=>this.editor.commands.first(({commands:i})=>[()=>i.undoInputRule(),()=>i.command(({tr:l})=>{const{selection:a,doc:c}=l,{empty:u,$anchor:d}=a,{pos:f,parent:h}=d,p=d.parent.isTextblock&&f>0?l.doc.resolve(f-1):d,g=p.parent.type.spec.isolating,y=d.pos-d.parentOffset,b=g&&p.parent.childCount===1?y===d.pos:W.atStart(c).from===f;return!u||!h.type.isTextblock||h.textContent.length||!b||b&&d.parent.type.name==="paragraph"?!1:i.clearNodes()}),()=>i.deleteSelection(),()=>i.joinBackward(),()=>i.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:i})=>[()=>i.deleteSelection(),()=>i.deleteCurrentNode(),()=>i.joinForward(),()=>i.selectNodeForward()]),r={Enter:()=>this.editor.commands.first(({commands:i})=>[()=>i.newlineInCode(),()=>i.createParagraphNear(),()=>i.liftEmptyBlock(),()=>i.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},s={...r},o={...r,"Ctrl-h":t,"Alt-Backspace":t,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return Jn()||Ol()?o:s},addProseMirrorPlugins(){return[new ke({key:new be("clearDocument"),appendTransaction:(t,e,n)=>{if(t.some(g=>g.getMeta("composition")))return;const r=t.some(g=>g.docChanged)&&!e.doc.eq(n.doc),s=t.some(g=>g.getMeta("preventClearDocument"));if(!r||s)return;const{empty:o,from:i,to:l}=e.selection,a=W.atStart(e.doc).from,c=W.atEnd(e.doc).to;if(o||!(i===a&&l===c)||!Bl(n.doc))return;const f=n.tr,h=Cl({state:n,transaction:f}),{commands:p}=new Cd({editor:this.editor,state:h});if(p.clearNodes(),!!f.steps.length)return f}})]}}),lh=je.create({name:"paste",addProseMirrorPlugins(){return[new ke({key:new be("tiptapPaste"),props:{handlePaste:(t,e,n)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:n})}}})]}}),ah=je.create({name:"tabindex",addProseMirrorPlugins(){return[new ke({key:new be("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}}),ch=je.create({name:"textDirection",addOptions(){return{direction:void 0}},addGlobalAttributes(){if(!this.options.direction)return[];const{nodeExtensions:t}=Pl(this.extensions);return[{types:t.filter(e=>e.name!=="text").map(e=>e.name),attributes:{dir:{default:this.options.direction,parseHTML:e=>{const n=e.getAttribute("dir");return n&&(n==="ltr"||n==="rtl"||n==="auto")?n:this.options.direction},renderHTML:e=>e.dir?{dir:e.dir}:{}}}}]},addProseMirrorPlugins(){return[new ke({key:new be("textDirection"),props:{attributes:()=>{const t=this.options.direction;return t?{dir:t}:{}}}})]}});function uh(t){return new Yf({find:t.find,handler:({state:e,range:n,match:r})=>{const s=Lt(t.getAttributes,void 0,r)||{},{tr:o}=e,i=n.from;let l=n.to;const a=t.type.create(s);if(r[1]){const c=r[0].lastIndexOf(r[1]);let u=i+c;u>l?u=l:l=u+r[1].length;const d=r[0][r[0].length-1];o.insertText(d,i+r[0].length-1),o.replaceWith(u,l,a)}else if(r[0]){const c=t.type.isInline?i:i-1;o.insert(c,t.type.create(s)).delete(o.mapping.map(i),o.mapping.map(l))}o.scrollIntoView()},undoable:t.undoable})}var dh=t=>"touches"in t,fh=class{constructor(t){this.directions=["bottom-left","bottom-right","top-left","top-right"],this.minSize={height:8,width:8},this.preserveAspectRatio=!1,this.classNames={container:"",wrapper:"",handle:"",resizing:""},this.initialWidth=0,this.initialHeight=0,this.aspectRatio=1,this.isResizing=!1,this.activeHandle=null,this.startX=0,this.startY=0,this.startWidth=0,this.startHeight=0,this.isShiftKeyPressed=!1,this.lastEditableState=void 0,this.handleMap=new Map,this.handleMouseMove=l=>{if(!this.isResizing||!this.activeHandle)return;const a=l.clientX-this.startX,c=l.clientY-this.startY;this.handleResize(a,c)},this.handleTouchMove=l=>{if(!this.isResizing||!this.activeHandle)return;const a=l.touches[0];if(!a)return;const c=a.clientX-this.startX,u=a.clientY-this.startY;this.handleResize(c,u)},this.handleMouseUp=()=>{if(!this.isResizing)return;const l=this.element.offsetWidth,a=this.element.offsetHeight;this.onCommit(l,a),this.isResizing=!1,this.activeHandle=null,this.container.dataset.resizeState="false",this.classNames.resizing&&this.container.classList.remove(this.classNames.resizing),document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp)},this.handleKeyDown=l=>{l.key==="Shift"&&(this.isShiftKeyPressed=!0)},this.handleKeyUp=l=>{l.key==="Shift"&&(this.isShiftKeyPressed=!1)};var e,n,r,s,o,i;this.node=t.node,this.editor=t.editor,this.element=t.element,this.contentElement=t.contentElement,this.getPos=t.getPos,this.onResize=t.onResize,this.onCommit=t.onCommit,this.onUpdate=t.onUpdate,(e=t.options)!=null&&e.min&&(this.minSize={...this.minSize,...t.options.min}),(n=t.options)!=null&&n.max&&(this.maxSize=t.options.max),(r=t?.options)!=null&&r.directions&&(this.directions=t.options.directions),(s=t.options)!=null&&s.preserveAspectRatio&&(this.preserveAspectRatio=t.options.preserveAspectRatio),(o=t.options)!=null&&o.className&&(this.classNames={container:t.options.className.container||"",wrapper:t.options.className.wrapper||"",handle:t.options.className.handle||"",resizing:t.options.className.resizing||""}),(i=t.options)!=null&&i.createCustomHandle&&(this.createCustomHandle=t.options.createCustomHandle),this.wrapper=this.createWrapper(),this.container=this.createContainer(),this.applyInitialSize(),this.attachHandles(),this.editor.on("update",this.handleEditorUpdate.bind(this))}get dom(){return this.container}get contentDOM(){var t;return(t=this.contentElement)!=null?t:null}handleEditorUpdate(){const t=this.editor.isEditable;t!==this.lastEditableState&&(this.lastEditableState=t,t?t&&this.handleMap.size===0&&this.attachHandles():this.removeHandles())}update(t,e,n){return t.type!==this.node.type?!1:(this.node=t,this.onUpdate?this.onUpdate(t,e,n):!0)}destroy(){this.isResizing&&(this.container.dataset.resizeState="false",this.classNames.resizing&&this.container.classList.remove(this.classNames.resizing),document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp),this.isResizing=!1,this.activeHandle=null),this.editor.off("update",this.handleEditorUpdate.bind(this)),this.container.remove()}createContainer(){const t=document.createElement("div");return t.dataset.resizeContainer="",t.dataset.node=this.node.type.name,t.style.display="flex",this.classNames.container&&(t.className=this.classNames.container),t.appendChild(this.wrapper),t}createWrapper(){const t=document.createElement("div");return t.style.position="relative",t.style.display="block",t.dataset.resizeWrapper="",this.classNames.wrapper&&(t.className=this.classNames.wrapper),t.appendChild(this.element),t}createHandle(t){const e=document.createElement("div");return e.dataset.resizeHandle=t,e.style.position="absolute",this.classNames.handle&&(e.className=this.classNames.handle),e}positionHandle(t,e){const n=e.includes("top"),r=e.includes("bottom"),s=e.includes("left"),o=e.includes("right");n&&(t.style.top="0"),r&&(t.style.bottom="0"),s&&(t.style.left="0"),o&&(t.style.right="0"),(e==="top"||e==="bottom")&&(t.style.left="0",t.style.right="0"),(e==="left"||e==="right")&&(t.style.top="0",t.style.bottom="0")}attachHandles(){this.directions.forEach(t=>{let e;this.createCustomHandle?e=this.createCustomHandle(t):e=this.createHandle(t),e instanceof HTMLElement||(console.warn(`[ResizableNodeView] createCustomHandle("${t}") did not return an HTMLElement. Falling back to default handle.`),e=this.createHandle(t)),this.createCustomHandle||this.positionHandle(e,t),e.addEventListener("mousedown",n=>this.handleResizeStart(n,t)),e.addEventListener("touchstart",n=>this.handleResizeStart(n,t)),this.handleMap.set(t,e),this.wrapper.appendChild(e)})}removeHandles(){this.handleMap.forEach(t=>t.remove()),this.handleMap.clear()}applyInitialSize(){const t=this.node.attrs.width,e=this.node.attrs.height;t?(this.element.style.width=`${t}px`,this.initialWidth=t):this.initialWidth=this.element.offsetWidth,e?(this.element.style.height=`${e}px`,this.initialHeight=e):this.initialHeight=this.element.offsetHeight,this.initialWidth>0&&this.initialHeight>0&&(this.aspectRatio=this.initialWidth/this.initialHeight)}handleResizeStart(t,e){t.preventDefault(),t.stopPropagation(),this.isResizing=!0,this.activeHandle=e,dh(t)?(this.startX=t.touches[0].clientX,this.startY=t.touches[0].clientY):(this.startX=t.clientX,this.startY=t.clientY),this.startWidth=this.element.offsetWidth,this.startHeight=this.element.offsetHeight,this.startWidth>0&&this.startHeight>0&&(this.aspectRatio=this.startWidth/this.startHeight),this.getPos(),this.container.dataset.resizeState="true",this.classNames.resizing&&this.container.classList.add(this.classNames.resizing),document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("touchmove",this.handleTouchMove),document.addEventListener("mouseup",this.handleMouseUp),document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp)}handleResize(t,e){if(!this.activeHandle)return;const n=this.preserveAspectRatio||this.isShiftKeyPressed,{width:r,height:s}=this.calculateNewDimensions(this.activeHandle,t,e),o=this.applyConstraints(r,s,n);this.element.style.width=`${o.width}px`,this.element.style.height=`${o.height}px`,this.onResize&&this.onResize(o.width,o.height)}calculateNewDimensions(t,e,n){let r=this.startWidth,s=this.startHeight;const o=t.includes("right"),i=t.includes("left"),l=t.includes("bottom"),a=t.includes("top");return o?r=this.startWidth+e:i&&(r=this.startWidth-e),l?s=this.startHeight+n:a&&(s=this.startHeight-n),(t==="right"||t==="left")&&(r=this.startWidth+(o?e:-e)),(t==="top"||t==="bottom")&&(s=this.startHeight+(l?n:-n)),this.preserveAspectRatio||this.isShiftKeyPressed?this.applyAspectRatio(r,s,t):{width:r,height:s}}applyConstraints(t,e,n){var r,s,o,i;if(!n){let c=Math.max(this.minSize.width,t),u=Math.max(this.minSize.height,e);return(r=this.maxSize)!=null&&r.width&&(c=Math.min(this.maxSize.width,c)),(s=this.maxSize)!=null&&s.height&&(u=Math.min(this.maxSize.height,u)),{width:c,height:u}}let l=t,a=e;return l<this.minSize.width&&(l=this.minSize.width,a=l/this.aspectRatio),a<this.minSize.height&&(a=this.minSize.height,l=a*this.aspectRatio),(o=this.maxSize)!=null&&o.width&&l>this.maxSize.width&&(l=this.maxSize.width,a=l/this.aspectRatio),(i=this.maxSize)!=null&&i.height&&a>this.maxSize.height&&(a=this.maxSize.height,l=a*this.aspectRatio),{width:l,height:a}}applyAspectRatio(t,e,n){const r=n==="left"||n==="right",s=n==="top"||n==="bottom";return r?{width:t,height:t/this.aspectRatio}:s?{width:e*this.aspectRatio,height:e}:{width:t,height:t/this.aspectRatio}}},hh={};Ns(hh,{createAtomBlockMarkdownSpec:()=>ph,createBlockMarkdownSpec:()=>mh,createInlineMarkdownSpec:()=>bh,parseAttributes:()=>zs,parseIndentedBlocks:()=>xh,renderNestedMarkdownContent:()=>wh,serializeAttributes:()=>Ls});function zs(t){if(!t?.trim())return{};const e={},n=[],r=t.replace(/["']([^"']*)["']/g,c=>(n.push(c),`__QUOTED_${n.length-1}__`)),s=r.match(/(?:^|\s)\.([a-zA-Z][\w-]*)/g);if(s){const c=s.map(u=>u.trim().slice(1));e.class=c.join(" ")}const o=r.match(/(?:^|\s)#([a-zA-Z][\w-]*)/);o&&(e.id=o[1]);const i=/([a-zA-Z][\w-]*)\s*=\s*(__QUOTED_\d+__)/g;Array.from(r.matchAll(i)).forEach(([,c,u])=>{var d;const f=parseInt(((d=u.match(/__QUOTED_(\d+)__/))==null?void 0:d[1])||"0",10),h=n[f];h&&(e[c]=h.slice(1,-1))});const a=r.replace(/(?:^|\s)\.([a-zA-Z][\w-]*)/g,"").replace(/(?:^|\s)#([a-zA-Z][\w-]*)/g,"").replace(/([a-zA-Z][\w-]*)\s*=\s*__QUOTED_\d+__/g,"").trim();return a&&a.split(/\s+/).filter(Boolean).forEach(u=>{u.match(/^[a-zA-Z][\w-]*$/)&&(e[u]=!0)}),e}function Ls(t){if(!t||Object.keys(t).length===0)return"";const e=[];return t.class&&String(t.class).split(/\s+/).filter(Boolean).forEach(r=>e.push(`.${r}`)),t.id&&e.push(`#${t.id}`),Object.entries(t).forEach(([n,r])=>{n==="class"||n==="id"||(r===!0?e.push(n):r!==!1&&r!=null&&e.push(`${n}="${String(r)}"`))}),e.join(" ")}function ph(t){const{nodeName:e,name:n,parseAttributes:r=zs,serializeAttributes:s=Ls,defaultAttributes:o={},requiredAttributes:i=[],allowedAttributes:l}=t,a=n||e,c=u=>{if(!l)return u;const d={};return l.forEach(f=>{f in u&&(d[f]=u[f])}),d};return{parseMarkdown:(u,d)=>{const f={...o,...u.attributes};return d.createNode(e,f,[])},markdownTokenizer:{name:e,level:"block",start(u){var d;const f=new RegExp(`^:::${a}(?:\\s|$)`,"m"),h=(d=u.match(f))==null?void 0:d.index;return h!==void 0?h:-1},tokenize(u,d,f){const h=new RegExp(`^:::${a}(?:\\s+\\{([^}]*)\\})?\\s*:::(?:\\n|$)`),p=u.match(h);if(!p)return;const g=p[1]||"",y=r(g);if(!i.find(x=>!(x in y)))return{type:e,raw:p[0],attributes:y}}},renderMarkdown:u=>{const d=c(u.attrs||{}),f=s(d),h=f?` {${f}}`:"";return`:::${a}${h} :::`}}}function mh(t){const{nodeName:e,name:n,getContent:r,parseAttributes:s=zs,serializeAttributes:o=Ls,defaultAttributes:i={},content:l="block",allowedAttributes:a}=t,c=n||e,u=d=>{if(!a)return d;const f={};return a.forEach(h=>{h in d&&(f[h]=d[h])}),f};return{parseMarkdown:(d,f)=>{let h;if(r){const g=r(d);h=typeof g=="string"?[{type:"text",text:g}]:g}else l==="block"?h=f.parseChildren(d.tokens||[]):h=f.parseInline(d.tokens||[]);const p={...i,...d.attributes};return f.createNode(e,p,h)},markdownTokenizer:{name:e,level:"block",start(d){var f;const h=new RegExp(`^:::${c}`,"m"),p=(f=d.match(h))==null?void 0:f.index;return p!==void 0?p:-1},tokenize(d,f,h){var p;const g=new RegExp(`^:::${c}(?:\\s+\\{([^}]*)\\})?\\s*\\n`),y=d.match(g);if(!y)return;const[b,x=""]=y,k=s(x);let E=1;const C=b.length;let M="";const I=/^:::([\w-]*)(\s.*)?/gm,P=d.slice(C);for(I.lastIndex=0;;){const V=I.exec(P);if(V===null)break;const B=V.index,v=V[1];if(!((p=V[2])!=null&&p.endsWith(":::"))){if(v)E+=1;else if(E-=1,E===0){const H=P.slice(0,B);M=H.trim();const ue=d.slice(0,C+B+V[0].length);let U=[];if(M)if(l==="block")for(U=h.blockTokens(H),U.forEach(J=>{J.text&&(!J.tokens||J.tokens.length===0)&&(J.tokens=h.inlineTokens(J.text))});U.length>0;){const J=U[U.length-1];if(J.type==="paragraph"&&(!J.text||J.text.trim()===""))U.pop();else break}else U=h.inlineTokens(M);return{type:e,raw:ue,attributes:k,content:M,tokens:U}}}}}},renderMarkdown:(d,f)=>{const h=u(d.attrs||{}),p=o(h),g=p?` {${p}}`:"",y=f.renderChildren(d.content||[],`

`);return`:::${c}${g}

${y}

:::`}}}function gh(t){if(!t.trim())return{};const e={},n=/(\w+)=(?:"([^"]*)"|'([^']*)')/g;let r=n.exec(t);for(;r!==null;){const[,s,o,i]=r;e[s]=o||i,r=n.exec(t)}return e}function yh(t){return Object.entries(t).filter(([,e])=>e!=null).map(([e,n])=>`${e}="${n}"`).join(" ")}function bh(t){const{nodeName:e,name:n,getContent:r,parseAttributes:s=gh,serializeAttributes:o=yh,defaultAttributes:i={},selfClosing:l=!1,allowedAttributes:a}=t,c=n||e,u=f=>{if(!a)return f;const h={};return a.forEach(p=>{const g=typeof p=="string"?p:p.name,y=typeof p=="string"?void 0:p.skipIfDefault;if(g in f){const b=f[g];if(y!==void 0&&b===y)return;h[g]=b}}),h},d=c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return{parseMarkdown:(f,h)=>{const p={...i,...f.attributes};if(l)return h.createNode(e,p);const g=r?r(f):f.content||"";return g?h.createNode(e,p,[h.createTextNode(g)]):h.createNode(e,p,[])},markdownTokenizer:{name:e,level:"inline",start(f){const h=l?new RegExp(`\\[${d}\\s*[^\\]]*\\]`):new RegExp(`\\[${d}\\s*[^\\]]*\\][\\s\\S]*?\\[\\/${d}\\]`),p=f.match(h),g=p?.index;return g!==void 0?g:-1},tokenize(f,h,p){const g=l?new RegExp(`^\\[${d}\\s*([^\\]]*)\\]`):new RegExp(`^\\[${d}\\s*([^\\]]*)\\]([\\s\\S]*?)\\[\\/${d}\\]`),y=f.match(g);if(!y)return;let b="",x="";if(l){const[,E]=y;x=E}else{const[,E,C]=y;x=E,b=C||""}const k=s(x.trim());return{type:e,raw:y[0],content:b.trim(),attributes:k}}},renderMarkdown:f=>{let h="";r?h=r(f):f.content&&f.content.length>0&&(h=f.content.filter(b=>b.type==="text").map(b=>b.text).join(""));const p=u(f.attrs||{}),g=o(p),y=g?` ${g}`:"";return l?`[${c}${y}]`:`[${c}${y}]${h}[/${c}]`}}}function xh(t,e,n){var r,s,o,i;const l=t.split(`
`),a=[];let c="",u=0;const d=e.baseIndentSize||2;for(;u<l.length;){const f=l[u],h=f.match(e.itemPattern);if(!h){if(a.length>0)break;if(f.trim()===""){u+=1,c=`${c}${f}
`;continue}else return}const p=e.extractItemData(h),{indentLevel:g,mainContent:y}=p;c=`${c}${f}
`;const b=[y];for(u+=1;u<l.length;){const C=l[u];if(C.trim()===""){const I=l.slice(u+1).findIndex(B=>B.trim()!=="");if(I===-1)break;if((((s=(r=l[u+1+I].match(/^(\s*)/))==null?void 0:r[1])==null?void 0:s.length)||0)>g){b.push(C),c=`${c}${C}
`,u+=1;continue}else break}if((((i=(o=C.match(/^(\s*)/))==null?void 0:o[1])==null?void 0:i.length)||0)>g)b.push(C),c=`${c}${C}
`,u+=1;else break}let x;const k=b.slice(1);if(k.length>0){const C=k.map(M=>M.slice(g+d)).join(`
`);C.trim()&&(e.customNestedParser?x=e.customNestedParser(C):x=n.blockTokens(C))}const E=e.createToken(p,x);a.push(E)}if(a.length!==0)return{items:a,raw:c}}function wh(t,e,n,r){if(!t||!Array.isArray(t.content))return"";const s=typeof n=="function"?n(r):n,[o,...i]=t.content,l=e.renderChildren([o]),a=[`${s}${l}`];return i&&i.length>0&&i.forEach(c=>{const u=e.renderChildren([c]);if(u){const d=u.split(`
`).map(f=>f?e.indent(f):"").join(`
`);a.push(d)}}),a.join(`
`)}var sn=class $a extends Is{constructor(){super(...arguments),this.type="node"}static create(e={}){const n=typeof e=="function"?e():e;return new $a(n)}configure(e){return super.configure(e)}extend(e){const n=typeof e=="function"?e():e;return super.extend(n)}};function vh(t){return new Xf({find:t.find,handler:({state:e,range:n,match:r,pasteEvent:s})=>{const o=Lt(t.getAttributes,void 0,r,s);if(o===!1||o===null)return null;const{tr:i}=e,l=r[r.length-1],a=r[0];let c=n.to;if(l){const u=a.search(/\S/),d=n.from+a.indexOf(l),f=d+l.length;if($l(n.from,n.to,e.doc).filter(p=>p.mark.type.excluded.find(y=>y===t.type&&y!==p.mark.type)).filter(p=>p.to>d).length)return null;f<n.to&&i.delete(f,n.to),d>n.from&&i.delete(n.from+u,d),c=n.from+u+l.length,i.addMark(n.from+u,c,t.type.create(o||{})),i.removeStoredMark(t.type)}}})}var kh=_l.create({name:"underline",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("underline")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["u",rt(this.options.HTMLAttributes,t),0]},parseMarkdown(t,e){return e.applyMark(this.name||"underline",e.parseInline(t.tokens||[]))},renderMarkdown(t,e){return`++${e.renderChildren(t)}++`},markdownTokenizer:{name:"underline",level:"inline",start(t){return t.indexOf("++")},tokenize(t,e,n){const s=/^(\+\+)([\s\S]+?)(\+\+)/.exec(t);if(!s)return;const o=s[2].trim();return{type:"underline",raw:s[0],text:o,tokens:n.inlineTokens(o)}}},addCommands(){return{setUnderline:()=>({commands:t})=>t.setMark(this.name),toggleUnderline:()=>({commands:t})=>t.toggleMark(this.name),unsetUnderline:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}}),Sh=kh;const Ch="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mögensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",Eh="ελ1υ2бг1ел3дети4ею2католик6ом3мкд2он1сква6онлайн5рг3рус2ф2сайт3рб3укр3қаз3հայ3ישראל5קום3ابوظبي5رامكو5لاردن4بحرين5جزائر5سعودية6عليان5مغرب5مارات5یران5بارت2زار4يتك3ھارت5تونس4سودان3رية5شبكة4عراق2ب2مان4فلسطين6قطر3كاثوليك6وم3مصر2ليسيا5وريتانيا7قع4همراه5پاکستان7ڀارت4कॉम3नेट3भारत0म्3ोत5संगठन5বাংলা5ভারত2ৰত4ਭਾਰਤ4ભારત4ଭାରତ4இந்தியா6லங்கை6சிங்கப்பூர்11భారత్5ಭಾರತ4ഭാരതം5ලංකා4คอม3ไทย3ລາວ3გე2みんな3アマゾン4クラウド4グーグル4コム2ストア3セール3ファッション6ポイント4世界2中信1国1國1文网3亚马逊3企业2佛山2信息2健康2八卦2公司1益2台湾1灣2商城1店1标2嘉里0大酒店5在线2大拿2天主教3娱乐2家電2广东2微博2慈善2我爱你3手机2招聘2政务1府2新加坡2闻2时尚2書籍2机构2淡马锡3游戏2澳門2点看2移动2组织机构4网址1店1站1络2联通2谷歌2购物2通販2集团2電訊盈科4飞利浦3食品2餐厅2香格里拉3港2닷넷1컴2삼성2한국2",Ps="numeric",Ds="ascii",$s="alpha",on="asciinumeric",ln="alphanumeric",Fs="domain",Vl="emoji",Nh="scheme",Ah="slashscheme",Bs="whitespace";function Th(t,e){return t in e||(e[t]=[]),e[t]}function wt(t,e,n){e[Ps]&&(e[on]=!0,e[ln]=!0),e[Ds]&&(e[on]=!0,e[$s]=!0),e[on]&&(e[ln]=!0),e[$s]&&(e[ln]=!0),e[ln]&&(e[Fs]=!0),e[Vl]&&(e[Fs]=!0);for(const r in e){const s=Th(r,n);s.indexOf(t)<0&&s.push(t)}}function Mh(t,e){const n={};for(const r in e)e[r].indexOf(t)>=0&&(n[r]=!0);return n}function xe(t=null){this.j={},this.jr=[],this.jd=null,this.t=t}xe.groups={},xe.prototype={accepts(){return!!this.t},go(t){const e=this,n=e.j[t];if(n)return n;for(let r=0;r<e.jr.length;r++){const s=e.jr[r][0],o=e.jr[r][1];if(o&&s.test(t))return o}return e.jd},has(t,e=!1){return e?t in this.j:!!this.go(t)},ta(t,e,n,r){for(let s=0;s<t.length;s++)this.tt(t[s],e,n,r)},tr(t,e,n,r){r=r||xe.groups;let s;return e&&e.j?s=e:(s=new xe(e),n&&r&&wt(e,n,r)),this.jr.push([t,s]),s},ts(t,e,n,r){let s=this;const o=t.length;if(!o)return s;for(let i=0;i<o-1;i++)s=s.tt(t[i]);return s.tt(t[o-1],e,n,r)},tt(t,e,n,r){r=r||xe.groups;const s=this;if(e&&e.j)return s.j[t]=e,e;const o=e;let i,l=s.go(t);if(l?(i=new xe,Object.assign(i.j,l.j),i.jr.push.apply(i.jr,l.jr),i.jd=l.jd,i.t=l.t):i=new xe,o){if(r)if(i.t&&typeof i.t=="string"){const a=Object.assign(Mh(i.t,r),n);wt(o,a,r)}else n&&wt(o,n,r);i.t=o}return s.j[t]=i,i}};const _=(t,e,n,r,s)=>t.ta(e,n,r,s),Z=(t,e,n,r,s)=>t.tr(e,n,r,s),Ul=(t,e,n,r,s)=>t.ts(e,n,r,s),A=(t,e,n,r,s)=>t.tt(e,n,r,s),_e="WORD",Hs="UWORD",ql="ASCIINUMERICAL",Jl="ALPHANUMERICAL",an="LOCALHOST",Ws="TLD",_s="UTLD",Xn="SCHEME",Pt="SLASH_SCHEME",Ks="NUM",Vs="WS",Us="NL",cn="OPENBRACE",un="CLOSEBRACE",Zn="OPENBRACKET",er="CLOSEBRACKET",tr="OPENPAREN",nr="CLOSEPAREN",rr="OPENANGLEBRACKET",sr="CLOSEANGLEBRACKET",or="FULLWIDTHLEFTPAREN",ir="FULLWIDTHRIGHTPAREN",lr="LEFTCORNERBRACKET",ar="RIGHTCORNERBRACKET",cr="LEFTWHITECORNERBRACKET",ur="RIGHTWHITECORNERBRACKET",dr="FULLWIDTHLESSTHAN",fr="FULLWIDTHGREATERTHAN",hr="AMPERSAND",pr="APOSTROPHE",mr="ASTERISK",st="AT",gr="BACKSLASH",yr="BACKTICK",br="CARET",ot="COLON",qs="COMMA",xr="DOLLAR",De="DOT",wr="EQUALS",Js="EXCLAMATION",Te="HYPHEN",dn="PERCENT",vr="PIPE",kr="PLUS",Sr="POUND",fn="QUERY",Gs="QUOTE",Gl="FULLWIDTHMIDDLEDOT",Ys="SEMI",$e="SLASH",hn="TILDE",Cr="UNDERSCORE",Yl="EMOJI",Er="SYM";var Ql=Object.freeze({__proto__:null,ALPHANUMERICAL:Jl,AMPERSAND:hr,APOSTROPHE:pr,ASCIINUMERICAL:ql,ASTERISK:mr,AT:st,BACKSLASH:gr,BACKTICK:yr,CARET:br,CLOSEANGLEBRACKET:sr,CLOSEBRACE:un,CLOSEBRACKET:er,CLOSEPAREN:nr,COLON:ot,COMMA:qs,DOLLAR:xr,DOT:De,EMOJI:Yl,EQUALS:wr,EXCLAMATION:Js,FULLWIDTHGREATERTHAN:fr,FULLWIDTHLEFTPAREN:or,FULLWIDTHLESSTHAN:dr,FULLWIDTHMIDDLEDOT:Gl,FULLWIDTHRIGHTPAREN:ir,HYPHEN:Te,LEFTCORNERBRACKET:lr,LEFTWHITECORNERBRACKET:cr,LOCALHOST:an,NL:Us,NUM:Ks,OPENANGLEBRACKET:rr,OPENBRACE:cn,OPENBRACKET:Zn,OPENPAREN:tr,PERCENT:dn,PIPE:vr,PLUS:kr,POUND:Sr,QUERY:fn,QUOTE:Gs,RIGHTCORNERBRACKET:ar,RIGHTWHITECORNERBRACKET:ur,SCHEME:Xn,SEMI:Ys,SLASH:$e,SLASH_SCHEME:Pt,SYM:Er,TILDE:hn,TLD:Ws,UNDERSCORE:Cr,UTLD:_s,UWORD:Hs,WORD:_e,WS:Vs});const Ke=/[a-z]/,pn=new RegExp("\\p{L}","u"),Qs=new RegExp("\\p{Emoji}","u"),Ve=/\d/,Xs=/\s/,Xl="\r",Zs=`
`,Rh="️",Oh="‍",eo="￼";let Nr=null,Ar=null;function jh(t=[]){const e={};xe.groups=e;const n=new xe;Nr==null&&(Nr=ea(Ch)),Ar==null&&(Ar=ea(Eh)),A(n,"'",pr),A(n,"{",cn),A(n,"}",un),A(n,"[",Zn),A(n,"]",er),A(n,"(",tr),A(n,")",nr),A(n,"<",rr),A(n,">",sr),A(n,"（",or),A(n,"）",ir),A(n,"「",lr),A(n,"」",ar),A(n,"『",cr),A(n,"』",ur),A(n,"＜",dr),A(n,"＞",fr),A(n,"&",hr),A(n,"*",mr),A(n,"@",st),A(n,"`",yr),A(n,"^",br),A(n,":",ot),A(n,",",qs),A(n,"$",xr),A(n,".",De),A(n,"=",wr),A(n,"!",Js),A(n,"-",Te),A(n,"%",dn),A(n,"|",vr),A(n,"+",kr),A(n,"#",Sr),A(n,"?",fn),A(n,'"',Gs),A(n,"/",$e),A(n,";",Ys),A(n,"~",hn),A(n,"_",Cr),A(n,"\\",gr),A(n,"・",Gl);const r=Z(n,Ve,Ks,{[Ps]:!0});Z(r,Ve,r);const s=Z(r,Ke,ql,{[on]:!0}),o=Z(r,pn,Jl,{[ln]:!0}),i=Z(n,Ke,_e,{[Ds]:!0});Z(i,Ve,s),Z(i,Ke,i),Z(s,Ve,s),Z(s,Ke,s);const l=Z(n,pn,Hs,{[$s]:!0});Z(l,Ke),Z(l,Ve,o),Z(l,pn,l),Z(o,Ve,o),Z(o,Ke),Z(o,pn,o);const a=A(n,Zs,Us,{[Bs]:!0}),c=A(n,Xl,Vs,{[Bs]:!0}),u=Z(n,Xs,Vs,{[Bs]:!0});A(n,eo,u),A(c,Zs,a),A(c,eo,u),Z(c,Xs,u),A(u,Xl),A(u,Zs),Z(u,Xs,u),A(u,eo,u);const d=Z(n,Qs,Yl,{[Vl]:!0});A(d,"#"),Z(d,Qs,d),A(d,Rh,d);const f=A(d,Oh);A(f,"#"),Z(f,Qs,d);const h=[[Ke,i],[Ve,s]],p=[[Ke,null],[pn,l],[Ve,o]];for(let g=0;g<Nr.length;g++)it(n,Nr[g],Ws,_e,h);for(let g=0;g<Ar.length;g++)it(n,Ar[g],_s,Hs,p);wt(Ws,{tld:!0,ascii:!0},e),wt(_s,{utld:!0,alpha:!0},e),it(n,"file",Xn,_e,h),it(n,"mailto",Xn,_e,h),it(n,"http",Pt,_e,h),it(n,"https",Pt,_e,h),it(n,"ftp",Pt,_e,h),it(n,"ftps",Pt,_e,h),wt(Xn,{scheme:!0,ascii:!0},e),wt(Pt,{slashscheme:!0,ascii:!0},e),t=t.sort((g,y)=>g[0]>y[0]?1:-1);for(let g=0;g<t.length;g++){const y=t[g][0],x=t[g][1]?{[Nh]:!0}:{[Ah]:!0};y.indexOf("-")>=0?x[Fs]=!0:Ke.test(y)?Ve.test(y)?x[on]=!0:x[Ds]=!0:x[Ps]=!0,Ul(n,y,y,x)}return Ul(n,"localhost",an,{ascii:!0}),n.jd=new xe(Er),{start:n,tokens:Object.assign({groups:e},Ql)}}function Zl(t,e){const n=Ih(e.replace(/[A-Z]/g,l=>l.toLowerCase())),r=n.length,s=[];let o=0,i=0;for(;i<r;){let l=t,a=null,c=0,u=null,d=-1,f=-1;for(;i<r&&(a=l.go(n[i]));)l=a,l.accepts()?(d=0,f=0,u=l):d>=0&&(d+=n[i].length,f++),c+=n[i].length,o+=n[i].length,i++;o-=d,i-=f,c-=d,s.push({t:u.t,v:e.slice(o-c,o),s:o-c,e:o})}return s}function Ih(t){const e=[],n=t.length;let r=0;for(;r<n;){let s=t.charCodeAt(r),o,i=s<55296||s>56319||r+1===n||(o=t.charCodeAt(r+1))<56320||o>57343?t[r]:t.slice(r,r+2);e.push(i),r+=i.length}return e}function it(t,e,n,r,s){let o;const i=e.length;for(let l=0;l<i-1;l++){const a=e[l];t.j[a]?o=t.j[a]:(o=new xe(r),o.jr=s.slice(),t.j[a]=o),t=o}return o=new xe(n),o.jr=s.slice(),t.j[e[i-1]]=o,o}function ea(t){const e=[],n=[];let r=0,s="0123456789";for(;r<t.length;){let o=0;for(;s.indexOf(t[r+o])>=0;)o++;if(o>0){e.push(n.join(""));for(let i=parseInt(t.substring(r,r+o),10);i>0;i--)n.pop();r+=o}else n.push(t[r]),r++}return e}const mn={defaultProtocol:"http",events:null,format:ta,formatHref:ta,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function to(t,e=null){let n=Object.assign({},mn);t&&(n=Object.assign(n,t instanceof to?t.o:t));const r=n.ignoreTags,s=[];for(let o=0;o<r.length;o++)s.push(r[o].toUpperCase());this.o=n,e&&(this.defaultRender=e),this.ignoreTags=s}to.prototype={o:mn,ignoreTags:[],defaultRender(t){return t},check(t){return this.get("validate",t.toString(),t)},get(t,e,n){const r=e!=null;let s=this.o[t];return s&&(typeof s=="object"?(s=n.t in s?s[n.t]:mn[t],typeof s=="function"&&r&&(s=s(e,n))):typeof s=="function"&&r&&(s=s(e,n.t,n)),s)},getObj(t,e,n){let r=this.o[t];return typeof r=="function"&&e!=null&&(r=r(e,n.t,n)),r},render(t){const e=t.render(this);return(this.get("render",null,t)||this.defaultRender)(e,t.t,t)}};function ta(t){return t}function na(t,e){this.t="token",this.v=t,this.tk=e}na.prototype={isLink:!1,toString(){return this.v},toHref(t){return this.toString()},toFormattedString(t){const e=this.toString(),n=t.get("truncate",e,this),r=t.get("format",e,this);return n&&r.length>n?r.substring(0,n)+"…":r},toFormattedHref(t){return t.get("formatHref",this.toHref(t.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(t=mn.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(t),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(t){return{type:this.t,value:this.toFormattedString(t),isLink:this.isLink,href:this.toFormattedHref(t),start:this.startIndex(),end:this.endIndex()}},validate(t){return t.get("validate",this.toString(),this)},render(t){const e=this,n=this.toHref(t.get("defaultProtocol")),r=t.get("formatHref",n,this),s=t.get("tagName",n,e),o=this.toFormattedString(t),i={},l=t.get("className",n,e),a=t.get("target",n,e),c=t.get("rel",n,e),u=t.getObj("attributes",n,e),d=t.getObj("events",n,e);return i.href=r,l&&(i.class=l),a&&(i.target=a),c&&(i.rel=c),u&&Object.assign(i,u),{tagName:s,attributes:i,content:o,eventListeners:d}}};function Tr(t,e){class n extends na{constructor(s,o){super(s,o),this.t=t}}for(const r in e)n.prototype[r]=e[r];return n.t=t,n}const ra=Tr("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),sa=Tr("text"),zh=Tr("nl"),Mr=Tr("url",{isLink:!0,toHref(t=mn.defaultProtocol){return this.hasProtocol()?this.v:`${t}://${this.v}`},hasProtocol(){const t=this.tk;return t.length>=2&&t[0].t!==an&&t[1].t===ot}}),Me=t=>new xe(t);function Lh({groups:t}){const e=t.domain.concat([hr,mr,st,gr,yr,br,xr,wr,Te,Ks,dn,vr,kr,Sr,$e,Er,hn,Cr]),n=[pr,ot,qs,De,Js,dn,fn,Gs,Ys,rr,sr,cn,un,er,Zn,tr,nr,or,ir,lr,ar,cr,ur,dr,fr],r=[hr,pr,mr,gr,yr,br,xr,wr,Te,cn,un,dn,vr,kr,Sr,fn,$e,Er,hn,Cr],s=Me(),o=A(s,hn);_(o,r,o),_(o,t.domain,o);const i=Me(),l=Me(),a=Me();_(s,t.domain,i),_(s,t.scheme,l),_(s,t.slashscheme,a),_(i,r,o),_(i,t.domain,i);const c=A(i,st);A(o,st,c),A(l,st,c),A(a,st,c);const u=A(o,De);_(u,r,o),_(u,t.domain,o);const d=Me();_(c,t.domain,d),_(d,t.domain,d);const f=A(d,De);_(f,t.domain,d);const h=Me(ra);_(f,t.tld,h),_(f,t.utld,h),A(c,an,h);const p=A(d,Te);A(p,Te,p),_(p,t.domain,d),_(h,t.domain,d),A(h,De,f),A(h,Te,p);const g=A(h,ot);_(g,t.numeric,ra);const y=A(i,Te),b=A(i,De);A(y,Te,y),_(y,t.domain,i),_(b,r,o),_(b,t.domain,i);const x=Me(Mr);_(b,t.tld,x),_(b,t.utld,x),_(x,t.domain,i),_(x,r,o),A(x,De,b),A(x,Te,y),A(x,st,c);const k=A(x,ot),E=Me(Mr);_(k,t.numeric,E);const C=Me(Mr),M=Me();_(C,e,C),_(C,n,M),_(M,e,C),_(M,n,M),A(x,$e,C),A(E,$e,C);const I=A(l,ot),P=A(a,ot),V=A(P,$e),B=A(V,$e);_(l,t.domain,i),A(l,De,b),A(l,Te,y),_(a,t.domain,i),A(a,De,b),A(a,Te,y),_(I,t.domain,C),A(I,$e,C),A(I,fn,C),_(B,t.domain,C),_(B,e,C),A(B,$e,C);const v=[[cn,un],[Zn,er],[tr,nr],[rr,sr],[or,ir],[lr,ar],[cr,ur],[dr,fr]];for(let H=0;H<v.length;H++){const[ue,U]=v[H],J=A(C,ue);A(M,ue,J),A(J,U,C);const te=Me(Mr);_(J,e,te);const ye=Me();_(J,n),_(te,e,te),_(te,n,ye),_(ye,e,te),_(ye,n,ye),A(te,U,C),A(ye,U,C)}return A(s,an,x),A(s,Us,zh),{start:s,tokens:Ql}}function Ph(t,e,n){let r=n.length,s=0,o=[],i=[];for(;s<r;){let l=t,a=null,c=null,u=0,d=null,f=-1;for(;s<r&&!(a=l.go(n[s].t));)i.push(n[s++]);for(;s<r&&(c=a||l.go(n[s].t));)a=null,l=c,l.accepts()?(f=0,d=l):f>=0&&f++,s++,u++;if(f<0)s-=u,s<r&&(i.push(n[s]),s++);else{i.length>0&&(o.push(no(sa,e,i)),i=[]),s-=f,u-=f;const h=d.t,p=n.slice(s-u,s);o.push(no(h,e,p))}}return i.length>0&&o.push(no(sa,e,i)),o}function no(t,e,n){const r=n[0].s,s=n[n.length-1].e,o=e.slice(r,s);return new t(o,n)}const Dh=typeof console<"u"&&console&&console.warn||(()=>{}),$h="until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.",Q={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function Fh(){return xe.groups={},Q.scanner=null,Q.parser=null,Q.tokenQueue=[],Q.pluginQueue=[],Q.customSchemes=[],Q.initialized=!1,Q}function oa(t,e=!1){if(Q.initialized&&Dh(`linkifyjs: already initialized - will not register custom scheme "${t}" ${$h}`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(t))throw new Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);Q.customSchemes.push([t,e])}function Bh(){Q.scanner=jh(Q.customSchemes);for(let t=0;t<Q.tokenQueue.length;t++)Q.tokenQueue[t][1]({scanner:Q.scanner});Q.parser=Lh(Q.scanner.tokens);for(let t=0;t<Q.pluginQueue.length;t++)Q.pluginQueue[t][1]({scanner:Q.scanner,parser:Q.parser});return Q.initialized=!0,Q}function ro(t){return Q.initialized||Bh(),Ph(Q.parser.start,t,Zl(Q.scanner.start,t))}ro.scan=Zl;function ia(t,e=null,n=null){if(e&&typeof e=="object"){if(n)throw Error(`linkifyjs: Invalid link type ${e}; must be a string`);n=e,e=null}const r=new to(n),s=ro(t),o=[];for(let i=0;i<s.length;i++){const l=s[i];l.isLink&&(!e||l.t===e)&&r.check(l)&&o.push(l.toFormattedObject(r))}return o}var so="[\0-   ᠎ -\u2029 　]",Hh=new RegExp(so),Wh=new RegExp(`${so}$`),_h=new RegExp(so,"g");function Kh(t){return t.length===1?t[0].isLink:t.length===3&&t[1].isLink?["()","[]"].includes(t[0].value+t[2].value):!1}function Vh(t){return new ke({key:new be("autolink"),appendTransaction:(e,n,r)=>{const s=e.some(c=>c.docChanged)&&!n.doc.eq(r.doc),o=e.some(c=>c.getMeta("preventAutolink"));if(!s||o)return;const{tr:i}=r,l=zl(n.doc,[...e]);if(Dl(l).forEach(({newRange:c})=>{const u=wf(r.doc,c,h=>h.isTextblock);let d,f;if(u.length>1)d=u[0],f=r.doc.textBetween(d.pos,d.pos+d.node.nodeSize,void 0," ");else if(u.length){const h=r.doc.textBetween(c.from,c.to," "," ");if(!Wh.test(h))return;d=u[0],f=r.doc.textBetween(d.pos,c.to,void 0," ")}if(d&&f){const h=f.split(Hh).filter(Boolean);if(h.length<=0)return!1;const p=h[h.length-1],g=d.pos+f.lastIndexOf(p);if(!p)return!1;const y=ro(p).map(b=>b.toObject(t.defaultProtocol));if(!Kh(y))return!1;y.filter(b=>b.isLink).map(b=>({...b,from:g+b.start+1,to:g+b.end+1})).filter(b=>r.schema.marks.code?!r.doc.rangeHasMark(b.from,b.to,r.schema.marks.code):!0).filter(b=>t.validate(b.value)).filter(b=>t.shouldAutoLink(b.value)).forEach(b=>{$l(b.from,b.to,r.doc).some(x=>x.mark.type===t.type)||i.addMark(b.from,b.to,t.type.create({href:b.href}))})}}),!!i.steps.length)return i}})}function Uh(t){return new ke({key:new be("handleClickLink"),props:{handleClick:(e,n,r)=>{var s,o;if(r.button!==0||!e.editable)return!1;let i=null;if(r.target instanceof HTMLAnchorElement)i=r.target;else{const a=r.target;if(!a)return!1;const c=t.editor.view.dom;i=a.closest("a"),i&&!c.contains(i)&&(i=null)}if(!i)return!1;let l=!1;if(t.enableClickSelection&&(l=t.editor.commands.extendMarkRange(t.type.name)),t.openOnClick){const a=Ef(e.state,t.type.name),c=(s=i.href)!=null?s:a.href,u=(o=i.target)!=null?o:a.target;c&&(window.open(c,u),l=!0)}return l}}})}function qh(t){return new ke({key:new be("handlePasteLink"),props:{handlePaste:(e,n,r)=>{const{shouldAutoLink:s}=t,{state:o}=e,{selection:i}=o,{empty:l}=i;if(l)return!1;let a="";r.content.forEach(u=>{a+=u.textContent});const c=ia(a,{defaultProtocol:t.defaultProtocol}).find(u=>u.isLink&&u.value===a);return!a||!c||s!==void 0&&!s(c.value)?!1:t.editor.commands.setMark(t.type,{href:c.href})}}})}function vt(t,e){const n=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return e&&e.forEach(r=>{const s=typeof r=="string"?r:r.scheme;s&&n.push(s)}),!t||t.replace(_h,"").match(new RegExp(`^(?:(?:${n.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}var Jh=_l.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(t=>{if(typeof t=="string"){oa(t);return}oa(t.scheme,t.optionalSlashes)})},onDestroy(){Fh()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,enableClickSelection:!1,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(t,e)=>!!vt(t,e.protocols),validate:t=>!!t,shouldAutoLink:t=>{const e=/^[a-z][a-z0-9+.-]*:\/\//i.test(t),n=/^[a-z][a-z0-9+.-]*:/i.test(t);if(e||n&&!t.includes("@"))return!0;const s=(t.includes("@")?t.split("@").pop():t).split(/[/?#:]/)[0];return!(/^\d{1,3}(\.\d{1,3}){3}$/.test(s)||!/\./.test(s))}}},addAttributes(){return{href:{default:null,parseHTML(t){return t.getAttribute("href")}},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class},title:{default:null}}},parseHTML(){return[{tag:"a[href]",getAttrs:t=>{const e=t.getAttribute("href");return!e||!this.options.isAllowedUri(e,{defaultValidate:n=>!!vt(n,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:null}}]},renderHTML({HTMLAttributes:t}){return this.options.isAllowedUri(t.href,{defaultValidate:e=>!!vt(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",rt(this.options.HTMLAttributes,t),0]:["a",rt(this.options.HTMLAttributes,{...t,href:""}),0]},markdownTokenName:"link",parseMarkdown:(t,e)=>e.applyMark("link",e.parseInline(t.tokens||[]),{href:t.href,title:t.title||null}),renderMarkdown:(t,e)=>{var n,r,s,o;const i=(r=(n=t.attrs)==null?void 0:n.href)!=null?r:"",l=(o=(s=t.attrs)==null?void 0:s.title)!=null?o:"",a=e.renderChildren(t);return l?`[${a}](${i} "${l}")`:`[${a}](${i})`},addCommands(){return{setLink:t=>({chain:e})=>{const{href:n}=t;return this.options.isAllowedUri(n,{defaultValidate:r=>!!vt(r,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?e().setMark(this.name,t).setMeta("preventAutolink",!0).run():!1},toggleLink:t=>({chain:e})=>{const{href:n}=t||{};return n&&!this.options.isAllowedUri(n,{defaultValidate:r=>!!vt(r,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:e().toggleMark(this.name,t,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()},unsetLink:()=>({chain:t})=>t().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[vh({find:t=>{const e=[];if(t){const{protocols:n,defaultProtocol:r}=this.options,s=ia(t).filter(o=>o.isLink&&this.options.isAllowedUri(o.value,{defaultValidate:i=>!!vt(i,n),protocols:n,defaultProtocol:r}));s.length&&s.forEach(o=>{this.options.shouldAutoLink(o.value)&&e.push({text:o.value,data:{href:o.href},index:o.start})})}return e},type:this.type,getAttributes:t=>{var e;return{href:(e=t.data)==null?void 0:e.href}}})]},addProseMirrorPlugins(){const t=[],{protocols:e,defaultProtocol:n}=this.options;return this.options.autolink&&t.push(Vh({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:r=>this.options.isAllowedUri(r,{defaultValidate:s=>!!vt(s,e),protocols:e,defaultProtocol:n}),shouldAutoLink:this.options.shouldAutoLink})),t.push(Uh({type:this.type,editor:this.editor,openOnClick:this.options.openOnClick==="whenNotEditable"?!0:this.options.openOnClick,enableClickSelection:this.options.enableClickSelection})),this.options.linkOnPaste&&t.push(qh({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type,shouldAutoLink:this.options.shouldAutoLink})),t}}),Gh=Jh,Yh=/(?:^|\s)(!\[(.+|:?)]\((\S+)(?:(?:\s+)["'](\S+)["'])?\))$/,Qh=sn.create({name:"image",addOptions(){return{inline:!1,allowBase64:!1,HTMLAttributes:{},resize:!1}},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes(){return{src:{default:null},alt:{default:null},title:{default:null},width:{default:null},height:{default:null}}},parseHTML(){return[{tag:this.options.allowBase64?"img[src]":'img[src]:not([src^="data:"])'}]},renderHTML({HTMLAttributes:t}){return["img",rt(this.options.HTMLAttributes,t)]},parseMarkdown:(t,e)=>e.createNode("image",{src:t.href,title:t.title,alt:t.text}),renderMarkdown:t=>{var e,n,r,s,o,i;const l=(n=(e=t.attrs)==null?void 0:e.src)!=null?n:"",a=(s=(r=t.attrs)==null?void 0:r.alt)!=null?s:"",c=(i=(o=t.attrs)==null?void 0:o.title)!=null?i:"";return c?`![${a}](${l} "${c}")`:`![${a}](${l})`},addNodeView(){if(!this.options.resize||!this.options.resize.enabled||typeof document>"u")return null;const{directions:t,minWidth:e,minHeight:n,alwaysPreserveAspectRatio:r}=this.options.resize;return({node:s,getPos:o,HTMLAttributes:i,editor:l})=>{const a=document.createElement("img");Object.entries(i).forEach(([d,f])=>{if(f!=null)switch(d){case"width":case"height":break;default:a.setAttribute(d,f);break}}),a.src=i.src;const c=new fh({element:a,editor:l,node:s,getPos:o,onResize:(d,f)=>{a.style.width=`${d}px`,a.style.height=`${f}px`},onCommit:(d,f)=>{const h=o();h!==void 0&&this.editor.chain().setNodeSelection(h).updateAttributes(this.name,{width:d,height:f}).run()},onUpdate:(d,f,h)=>d.type===s.type,options:{directions:t,min:{width:e,height:n},preserveAspectRatio:r===!0}}),u=c.dom;return u.style.visibility="hidden",u.style.pointerEvents="none",a.onload=()=>{u.style.visibility="",u.style.pointerEvents=""},c}},addCommands(){return{setImage:t=>({commands:e})=>e.insertContent({type:this.name,attrs:t})}},addInputRules(){return[uh({find:Yh,type:this.type,getAttributes:t=>{const[,,e,n,r]=t;return{src:n,alt:e,title:r}}})]}}),Xh=Qh;let oo,io;if(typeof WeakMap<"u"){let t=new WeakMap;oo=e=>t.get(e),io=(e,n)=>(t.set(e,n),n)}else{const t=[];let n=0;oo=r=>{for(let s=0;s<t.length;s+=2)if(t[s]==r)return t[s+1]},io=(r,s)=>(n==10&&(n=0),t[n++]=r,t[n++]=s)}var ee=class{constructor(t,e,n,r){this.width=t,this.height=e,this.map=n,this.problems=r}findCell(t){for(let e=0;e<this.map.length;e++){const n=this.map[e];if(n!=t)continue;const r=e%this.width,s=e/this.width|0;let o=r+1,i=s+1;for(let l=1;o<this.width&&this.map[e+l]==n;l++)o++;for(let l=1;i<this.height&&this.map[e+this.width*l]==n;l++)i++;return{left:r,top:s,right:o,bottom:i}}throw new RangeError(`No cell with offset ${t} found`)}colCount(t){for(let e=0;e<this.map.length;e++)if(this.map[e]==t)return e%this.width;throw new RangeError(`No cell with offset ${t} found`)}nextCell(t,e,n){const{left:r,right:s,top:o,bottom:i}=this.findCell(t);return e=="horiz"?(n<0?r==0:s==this.width)?null:this.map[o*this.width+(n<0?r-1:s)]:(n<0?o==0:i==this.height)?null:this.map[r+this.width*(n<0?o-1:i)]}rectBetween(t,e){const{left:n,right:r,top:s,bottom:o}=this.findCell(t),{left:i,right:l,top:a,bottom:c}=this.findCell(e);return{left:Math.min(n,i),top:Math.min(s,a),right:Math.max(r,l),bottom:Math.max(o,c)}}cellsInRect(t){const e=[],n={};for(let r=t.top;r<t.bottom;r++)for(let s=t.left;s<t.right;s++){const o=r*this.width+s,i=this.map[o];n[i]||(n[i]=!0,!(s==t.left&&s&&this.map[o-1]==i||r==t.top&&r&&this.map[o-this.width]==i)&&e.push(i))}return e}positionAt(t,e,n){for(let r=0,s=0;;r++){const o=s+n.child(r).nodeSize;if(r==t){let i=e+t*this.width;const l=(t+1)*this.width;for(;i<l&&this.map[i]<s;)i++;return i==l?o-1:this.map[i]}s=o}}static get(t){return oo(t)||io(t,Zh(t))}};function Zh(t){if(t.type.spec.tableRole!="table")throw new RangeError("Not a table node: "+t.type.name);const e=ep(t),n=t.childCount,r=[];let s=0,o=null;const i=[];for(let c=0,u=e*n;c<u;c++)r[c]=0;for(let c=0,u=0;c<n;c++){const d=t.child(c);u++;for(let p=0;;p++){for(;s<r.length&&r[s]!=0;)s++;if(p==d.childCount)break;const g=d.child(p),{colspan:y,rowspan:b,colwidth:x}=g.attrs;for(let k=0;k<b;k++){if(k+c>=n){(o||(o=[])).push({type:"overlong_rowspan",pos:u,n:b-k});break}const E=s+k*e;for(let C=0;C<y;C++){r[E+C]==0?r[E+C]=u:(o||(o=[])).push({type:"collision",row:c,pos:u,n:y-C});const M=x&&x[C];if(M){const I=(E+C)%e*2,P=i[I];P==null||P!=M&&i[I+1]==1?(i[I]=M,i[I+1]=1):P==M&&i[I+1]++}}}s+=y,u+=g.nodeSize}const f=(c+1)*e;let h=0;for(;s<f;)r[s++]==0&&h++;h&&(o||(o=[])).push({type:"missing",row:c,n:h}),u++}(e===0||n===0)&&(o||(o=[])).push({type:"zero_sized"});const l=new ee(e,n,r,o);let a=!1;for(let c=0;!a&&c<i.length;c+=2)i[c]!=null&&i[c+1]<n&&(a=!0);return a&&tp(l,i,t),l}function ep(t){let e=-1,n=!1;for(let r=0;r<t.childCount;r++){const s=t.child(r);let o=0;if(n)for(let i=0;i<r;i++){const l=t.child(i);for(let a=0;a<l.childCount;a++){const c=l.child(a);i+c.attrs.rowspan>r&&(o+=c.attrs.colspan)}}for(let i=0;i<s.childCount;i++){const l=s.child(i);o+=l.attrs.colspan,l.attrs.rowspan>1&&(n=!0)}e==-1?e=o:e!=o&&(e=Math.max(e,o))}return e}function tp(t,e,n){t.problems||(t.problems=[]);const r={};for(let s=0;s<t.map.length;s++){const o=t.map[s];if(r[o])continue;r[o]=!0;const i=n.nodeAt(o);if(!i)throw new RangeError(`No cell with offset ${o} found`);let l=null;const a=i.attrs;for(let c=0;c<a.colspan;c++){const u=e[(s+c)%t.width*2];u!=null&&(!a.colwidth||a.colwidth[c]!=u)&&((l||(l=np(a)))[c]=u)}l&&t.problems.unshift({type:"colwidth mismatch",pos:o,colwidth:l})}}function np(t){if(t.colwidth)return t.colwidth.slice();const e=[];for(let n=0;n<t.colspan;n++)e.push(0);return e}function pe(t){let e=t.cached.tableNodeTypes;if(!e){e=t.cached.tableNodeTypes={};for(const n in t.nodes){const r=t.nodes[n],s=r.spec.tableRole;s&&(e[s]=r)}}return e}const lt=new be("selectingCells");function kt(t){for(let e=t.depth-1;e>0;e--)if(t.node(e).type.spec.tableRole=="row")return t.node(0).resolve(t.before(e+1));return null}function rp(t){for(let e=t.depth;e>0;e--){const n=t.node(e).type.spec.tableRole;if(n==="cell"||n==="header_cell")return t.node(e)}return null}function Ie(t){const e=t.selection.$head;for(let n=e.depth;n>0;n--)if(e.node(n).type.spec.tableRole=="row")return!0;return!1}function Rr(t){const e=t.selection;if("$anchorCell"in e&&e.$anchorCell)return e.$anchorCell.pos>e.$headCell.pos?e.$anchorCell:e.$headCell;if("node"in e&&e.node&&e.node.type.spec.tableRole=="cell")return e.$anchor;const n=kt(e.$head)||sp(e.$head);if(n)return n;throw new RangeError(`No cell found around position ${e.head}`)}function sp(t){for(let e=t.nodeAfter,n=t.pos;e;e=e.firstChild,n++){const r=e.type.spec.tableRole;if(r=="cell"||r=="header_cell")return t.doc.resolve(n)}for(let e=t.nodeBefore,n=t.pos;e;e=e.lastChild,n--){const r=e.type.spec.tableRole;if(r=="cell"||r=="header_cell")return t.doc.resolve(n-e.nodeSize)}}function lo(t){return t.parent.type.spec.tableRole=="row"&&!!t.nodeAfter}function op(t){return t.node(0).resolve(t.pos+t.nodeAfter.nodeSize)}function ao(t,e){return t.depth==e.depth&&t.pos>=e.start(-1)&&t.pos<=e.end(-1)}function la(t,e,n){const r=t.node(-1),s=ee.get(r),o=t.start(-1),i=s.nextCell(t.pos-o,e,n);return i==null?null:t.node(0).resolve(o+i)}function St(t,e,n=1){const r={...t,colspan:t.colspan-n};return r.colwidth&&(r.colwidth=r.colwidth.slice(),r.colwidth.splice(e,n),r.colwidth.some(s=>s>0)||(r.colwidth=null)),r}function aa(t,e,n=1){const r={...t,colspan:t.colspan+n};if(r.colwidth){r.colwidth=r.colwidth.slice();for(let s=0;s<n;s++)r.colwidth.splice(e,0,0)}return r}function ip(t,e,n){const r=pe(e.type.schema).header_cell;for(let s=0;s<t.height;s++)if(e.nodeAt(t.map[n+s*t.width]).type!=r)return!1;return!0}var Y=class Je extends W{constructor(e,n=e){const r=e.node(-1),s=ee.get(r),o=e.start(-1),i=s.rectBetween(e.pos-o,n.pos-o),l=e.node(0),a=s.cellsInRect(i).filter(u=>u!=n.pos-o);a.unshift(n.pos-o);const c=a.map(u=>{const d=r.nodeAt(u);if(!d)throw new RangeError(`No cell with offset ${u} found`);const f=o+u+1;return new xi(l.resolve(f),l.resolve(f+d.content.size))});super(c[0].$from,c[0].$to,c),this.$anchorCell=e,this.$headCell=n}map(e,n){const r=e.resolve(n.map(this.$anchorCell.pos)),s=e.resolve(n.map(this.$headCell.pos));if(lo(r)&&lo(s)&&ao(r,s)){const o=this.$anchorCell.node(-1)!=r.node(-1);return o&&this.isRowSelection()?Je.rowSelection(r,s):o&&this.isColSelection()?Je.colSelection(r,s):new Je(r,s)}return F.between(r,s)}content(){const e=this.$anchorCell.node(-1),n=ee.get(e),r=this.$anchorCell.start(-1),s=n.rectBetween(this.$anchorCell.pos-r,this.$headCell.pos-r),o={},i=[];for(let a=s.top;a<s.bottom;a++){const c=[];for(let u=a*n.width+s.left,d=s.left;d<s.right;d++,u++){const f=n.map[u];if(o[f])continue;o[f]=!0;const h=n.findCell(f);let p=e.nodeAt(f);if(!p)throw new RangeError(`No cell with offset ${f} found`);const g=s.left-h.left,y=h.right-s.right;if(g>0||y>0){let b=p.attrs;if(g>0&&(b=St(b,0,g)),y>0&&(b=St(b,b.colspan-y,y)),h.left<s.left){if(p=p.type.createAndFill(b),!p)throw new RangeError(`Could not create cell with attrs ${JSON.stringify(b)}`)}else p=p.type.create(b,p.content)}if(h.top<s.top||h.bottom>s.bottom){const b={...p.attrs,rowspan:Math.min(h.bottom,s.bottom)-Math.max(h.top,s.top)};h.top<s.top?p=p.type.createAndFill(b):p=p.type.create(b,p.content)}c.push(p)}i.push(e.child(a).copy(N.from(c)))}const l=this.isColSelection()&&this.isRowSelection()?e:i;return new T(N.from(l),1,1)}replace(e,n=T.empty){const r=e.steps.length,s=this.ranges;for(let i=0;i<s.length;i++){const{$from:l,$to:a}=s[i],c=e.mapping.slice(r);e.replace(c.map(l.pos),c.map(a.pos),i?T.empty:n)}const o=W.findFrom(e.doc.resolve(e.mapping.slice(r).map(this.to)),-1);o&&e.setSelection(o)}replaceWith(e,n){this.replace(e,new T(N.from(n),0,0))}forEachCell(e){const n=this.$anchorCell.node(-1),r=ee.get(n),s=this.$anchorCell.start(-1),o=r.cellsInRect(r.rectBetween(this.$anchorCell.pos-s,this.$headCell.pos-s));for(let i=0;i<o.length;i++)e(n.nodeAt(o[i]),s+o[i])}isColSelection(){const e=this.$anchorCell.index(-1),n=this.$headCell.index(-1);if(Math.min(e,n)>0)return!1;const r=e+this.$anchorCell.nodeAfter.attrs.rowspan,s=n+this.$headCell.nodeAfter.attrs.rowspan;return Math.max(r,s)==this.$headCell.node(-1).childCount}static colSelection(e,n=e){const r=e.node(-1),s=ee.get(r),o=e.start(-1),i=s.findCell(e.pos-o),l=s.findCell(n.pos-o),a=e.node(0);return i.top<=l.top?(i.top>0&&(e=a.resolve(o+s.map[i.left])),l.bottom<s.height&&(n=a.resolve(o+s.map[s.width*(s.height-1)+l.right-1]))):(l.top>0&&(n=a.resolve(o+s.map[l.left])),i.bottom<s.height&&(e=a.resolve(o+s.map[s.width*(s.height-1)+i.right-1]))),new Je(e,n)}isRowSelection(){const e=this.$anchorCell.node(-1),n=ee.get(e),r=this.$anchorCell.start(-1),s=n.colCount(this.$anchorCell.pos-r),o=n.colCount(this.$headCell.pos-r);if(Math.min(s,o)>0)return!1;const i=s+this.$anchorCell.nodeAfter.attrs.colspan,l=o+this.$headCell.nodeAfter.attrs.colspan;return Math.max(i,l)==n.width}eq(e){return e instanceof Je&&e.$anchorCell.pos==this.$anchorCell.pos&&e.$headCell.pos==this.$headCell.pos}static rowSelection(e,n=e){const r=e.node(-1),s=ee.get(r),o=e.start(-1),i=s.findCell(e.pos-o),l=s.findCell(n.pos-o),a=e.node(0);return i.left<=l.left?(i.left>0&&(e=a.resolve(o+s.map[i.top*s.width])),l.right<s.width&&(n=a.resolve(o+s.map[s.width*(l.top+1)-1]))):(l.left>0&&(n=a.resolve(o+s.map[l.top*s.width])),i.right<s.width&&(e=a.resolve(o+s.map[s.width*(i.top+1)-1]))),new Je(e,n)}toJSON(){return{type:"cell",anchor:this.$anchorCell.pos,head:this.$headCell.pos}}static fromJSON(e,n){return new Je(e.resolve(n.anchor),e.resolve(n.head))}static create(e,n,r=n){return new Je(e.resolve(n),e.resolve(r))}getBookmark(){return new lp(this.$anchorCell.pos,this.$headCell.pos)}};Y.prototype.visible=!1,W.jsonID("cell",Y);var lp=class Fa{constructor(e,n){this.anchor=e,this.head=n}map(e){return new Fa(e.map(this.anchor),e.map(this.head))}resolve(e){const n=e.resolve(this.anchor),r=e.resolve(this.head);return n.parent.type.spec.tableRole=="row"&&r.parent.type.spec.tableRole=="row"&&n.index()<n.parent.childCount&&r.index()<r.parent.childCount&&ao(n,r)?new Y(n,r):W.near(r,1)}};function ap(t){if(!(t.selection instanceof Y))return null;const e=[];return t.selection.forEachCell((n,r)=>{e.push(Ae.node(r,r+n.nodeSize,{class:"selectedCell"}))}),re.create(t.doc,e)}function cp({$from:t,$to:e}){if(t.pos==e.pos||t.pos<e.pos-6)return!1;let n=t.pos,r=e.pos,s=t.depth;for(;s>=0&&!(t.after(s+1)<t.end(s));s--,n++);for(let o=e.depth;o>=0&&!(e.before(o+1)>e.start(o));o--,r--);return n==r&&/row|table/.test(t.node(s).type.spec.tableRole)}function up({$from:t,$to:e}){let n,r;for(let s=t.depth;s>0;s--){const o=t.node(s);if(o.type.spec.tableRole==="cell"||o.type.spec.tableRole==="header_cell"){n=o;break}}for(let s=e.depth;s>0;s--){const o=e.node(s);if(o.type.spec.tableRole==="cell"||o.type.spec.tableRole==="header_cell"){r=o;break}}return n!==r&&e.parentOffset===0}function dp(t,e,n){const r=(e||t).selection,s=(e||t).doc;let o,i;if(r instanceof L&&(i=r.node.type.spec.tableRole)){if(i=="cell"||i=="header_cell")o=Y.create(s,r.from);else if(i=="row"){const l=s.resolve(r.from+1);o=Y.rowSelection(l,l)}else if(!n){const l=ee.get(r.node),a=r.from+1,c=a+l.map[l.width*l.height-1];o=Y.create(s,a+1,c)}}else r instanceof F&&cp(r)?o=F.create(s,r.from):r instanceof F&&up(r)&&(o=F.create(s,r.$from.start(),r.$from.end()));return o&&(e||(e=t.tr)).setSelection(o),e}const fp=new be("fix-tables");function ca(t,e,n,r){const s=t.childCount,o=e.childCount;e:for(let i=0,l=0;i<o;i++){const a=e.child(i);for(let c=l,u=Math.min(s,i+3);c<u;c++)if(t.child(c)==a){l=c+1,n+=a.nodeSize;continue e}r(a,n),l<s&&t.child(l).sameMarkup(a)?ca(t.child(l),a,n+1,r):a.nodesBetween(0,a.content.size,r,n+1),n+=a.nodeSize}}function ua(t,e){let n;const r=(s,o)=>{s.type.spec.tableRole=="table"&&(n=hp(t,s,o,n))};return e?e.doc!=t.doc&&ca(e.doc,t.doc,0,r):t.doc.descendants(r),n}function hp(t,e,n,r){const s=ee.get(e);if(!s.problems)return r;r||(r=t.tr);const o=[];for(let a=0;a<s.height;a++)o.push(0);for(let a=0;a<s.problems.length;a++){const c=s.problems[a];if(c.type=="collision"){const u=e.nodeAt(c.pos);if(!u)continue;const d=u.attrs;for(let f=0;f<d.rowspan;f++)o[c.row+f]+=c.n;r.setNodeMarkup(r.mapping.map(n+1+c.pos),null,St(d,d.colspan-c.n,c.n))}else if(c.type=="missing")o[c.row]+=c.n;else if(c.type=="overlong_rowspan"){const u=e.nodeAt(c.pos);if(!u)continue;r.setNodeMarkup(r.mapping.map(n+1+c.pos),null,{...u.attrs,rowspan:u.attrs.rowspan-c.n})}else if(c.type=="colwidth mismatch"){const u=e.nodeAt(c.pos);if(!u)continue;r.setNodeMarkup(r.mapping.map(n+1+c.pos),null,{...u.attrs,colwidth:c.colwidth})}else if(c.type=="zero_sized"){const u=r.mapping.map(n);r.delete(u,u+e.nodeSize)}}let i,l;for(let a=0;a<o.length;a++)o[a]&&(i==null&&(i=a),l=a);for(let a=0,c=n+1;a<s.height;a++){const u=e.child(a),d=c+u.nodeSize,f=o[a];if(f>0){let h="cell";u.firstChild&&(h=u.firstChild.type.spec.tableRole);const p=[];for(let y=0;y<f;y++){const b=pe(t.schema)[h].createAndFill();b&&p.push(b)}const g=(a==0||i==a-1)&&l==a?c+1:d-1;r.insert(r.mapping.map(g),p)}c=d}return r.setMeta(fp,{fixTables:!0})}function Fe(t){const e=t.selection,n=Rr(t),r=n.node(-1),s=n.start(-1),o=ee.get(r);return{...e instanceof Y?o.rectBetween(e.$anchorCell.pos-s,e.$headCell.pos-s):o.findCell(n.pos-s),tableStart:s,map:o,table:r}}function da(t,{map:e,tableStart:n,table:r},s){let o=s>0?-1:0;ip(e,r,s+o)&&(o=s==0||s==e.width?null:0);for(let i=0;i<e.height;i++){const l=i*e.width+s;if(s>0&&s<e.width&&e.map[l-1]==e.map[l]){const a=e.map[l],c=r.nodeAt(a);t.setNodeMarkup(t.mapping.map(n+a),null,aa(c.attrs,s-e.colCount(a))),i+=c.attrs.rowspan-1}else{const a=o==null?pe(r.type.schema).cell:r.nodeAt(e.map[l+o]).type,c=e.positionAt(i,s,r);t.insert(t.mapping.map(n+c),a.createAndFill())}}return t}function pp(t,e){if(!Ie(t))return!1;if(e){const n=Fe(t);e(da(t.tr,n,n.left))}return!0}function mp(t,e){if(!Ie(t))return!1;if(e){const n=Fe(t);e(da(t.tr,n,n.right))}return!0}function gp(t,{map:e,table:n,tableStart:r},s){const o=t.mapping.maps.length;for(let i=0;i<e.height;){const l=i*e.width+s,a=e.map[l],c=n.nodeAt(a),u=c.attrs;if(s>0&&e.map[l-1]==a||s<e.width-1&&e.map[l+1]==a)t.setNodeMarkup(t.mapping.slice(o).map(r+a),null,St(u,s-e.colCount(a)));else{const d=t.mapping.slice(o).map(r+a);t.delete(d,d+c.nodeSize)}i+=u.rowspan}}function yp(t,e){if(!Ie(t))return!1;if(e){const n=Fe(t),r=t.tr;if(n.left==0&&n.right==n.map.width)return!1;for(let s=n.right-1;gp(r,n,s),s!=n.left;s--){const o=n.tableStart?r.doc.nodeAt(n.tableStart-1):r.doc;if(!o)throw new RangeError("No table found");n.table=o,n.map=ee.get(o)}e(r)}return!0}function bp(t,e,n){var r;const s=pe(e.type.schema).header_cell;for(let o=0;o<t.width;o++)if(((r=e.nodeAt(t.map[o+n*t.width]))===null||r===void 0?void 0:r.type)!=s)return!1;return!0}function fa(t,{map:e,tableStart:n,table:r},s){let o=n;for(let c=0;c<s;c++)o+=r.child(c).nodeSize;const i=[];let l=s>0?-1:0;bp(e,r,s+l)&&(l=s==0||s==e.height?null:0);for(let c=0,u=e.width*s;c<e.width;c++,u++)if(s>0&&s<e.height&&e.map[u]==e.map[u-e.width]){const d=e.map[u],f=r.nodeAt(d).attrs;t.setNodeMarkup(n+d,null,{...f,rowspan:f.rowspan+1}),c+=f.colspan-1}else{var a;const d=l==null?pe(r.type.schema).cell:(a=r.nodeAt(e.map[u+l*e.width]))===null||a===void 0?void 0:a.type,f=d?.createAndFill();f&&i.push(f)}return t.insert(o,pe(r.type.schema).row.create(null,i)),t}function xp(t,e){if(!Ie(t))return!1;if(e){const n=Fe(t);e(fa(t.tr,n,n.top))}return!0}function wp(t,e){if(!Ie(t))return!1;if(e){const n=Fe(t);e(fa(t.tr,n,n.bottom))}return!0}function vp(t,{map:e,table:n,tableStart:r},s){let o=0;for(let c=0;c<s;c++)o+=n.child(c).nodeSize;const i=o+n.child(s).nodeSize,l=t.mapping.maps.length;t.delete(o+r,i+r);const a=new Set;for(let c=0,u=s*e.width;c<e.width;c++,u++){const d=e.map[u];if(!a.has(d)){if(a.add(d),s>0&&d==e.map[u-e.width]){const f=n.nodeAt(d).attrs;t.setNodeMarkup(t.mapping.slice(l).map(d+r),null,{...f,rowspan:f.rowspan-1}),c+=f.colspan-1}else if(s<e.height&&d==e.map[u+e.width]){const f=n.nodeAt(d),h=f.attrs,p=f.type.create({...h,rowspan:f.attrs.rowspan-1},f.content),g=e.positionAt(s+1,c,n);t.insert(t.mapping.slice(l).map(r+g),p),c+=h.colspan-1}}}}function kp(t,e){if(!Ie(t))return!1;if(e){const n=Fe(t),r=t.tr;if(n.top==0&&n.bottom==n.map.height)return!1;for(let s=n.bottom-1;vp(r,n,s),s!=n.top;s--){const o=n.tableStart?r.doc.nodeAt(n.tableStart-1):r.doc;if(!o)throw new RangeError("No table found");n.table=o,n.map=ee.get(n.table)}e(r)}return!0}function ha(t){const e=t.content;return e.childCount==1&&e.child(0).isTextblock&&e.child(0).childCount==0}function Sp({width:t,height:e,map:n},r){let s=r.top*t+r.left,o=s,i=(r.bottom-1)*t+r.left,l=s+(r.right-r.left-1);for(let a=r.top;a<r.bottom;a++){if(r.left>0&&n[o]==n[o-1]||r.right<t&&n[l]==n[l+1])return!0;o+=t,l+=t}for(let a=r.left;a<r.right;a++){if(r.top>0&&n[s]==n[s-t]||r.bottom<e&&n[i]==n[i+t])return!0;s++,i++}return!1}function pa(t,e){const n=t.selection;if(!(n instanceof Y)||n.$anchorCell.pos==n.$headCell.pos)return!1;const r=Fe(t),{map:s}=r;if(Sp(s,r))return!1;if(e){const o=t.tr,i={};let l=N.empty,a,c;for(let u=r.top;u<r.bottom;u++)for(let d=r.left;d<r.right;d++){const f=s.map[u*s.width+d],h=r.table.nodeAt(f);if(!(i[f]||!h))if(i[f]=!0,a==null)a=f,c=h;else{ha(h)||(l=l.append(h.content));const p=o.mapping.map(f+r.tableStart);o.delete(p,p+h.nodeSize)}}if(a==null||c==null)return!0;if(o.setNodeMarkup(a+r.tableStart,null,{...aa(c.attrs,c.attrs.colspan,r.right-r.left-c.attrs.colspan),rowspan:r.bottom-r.top}),l.size>0){const u=a+1+c.content.size,d=ha(c)?a+1:u;o.replaceWith(d+r.tableStart,u+r.tableStart,l)}o.setSelection(new Y(o.doc.resolve(a+r.tableStart))),e(o)}return!0}function ma(t,e){const n=pe(t.schema);return Cp(({node:r})=>n[r.type.spec.tableRole])(t,e)}function Cp(t){return(e,n)=>{const r=e.selection;let s,o;if(r instanceof Y){if(r.$anchorCell.pos!=r.$headCell.pos)return!1;s=r.$anchorCell.nodeAfter,o=r.$anchorCell.pos}else{var i;if(s=rp(r.$from),!s)return!1;o=(i=kt(r.$from))===null||i===void 0?void 0:i.pos}if(s==null||o==null||s.attrs.colspan==1&&s.attrs.rowspan==1)return!1;if(n){let l=s.attrs;const a=[],c=l.colwidth;l.rowspan>1&&(l={...l,rowspan:1}),l.colspan>1&&(l={...l,colspan:1});const u=Fe(e),d=e.tr;for(let h=0;h<u.right-u.left;h++)a.push(c?{...l,colwidth:c&&c[h]?[c[h]]:null}:l);let f;for(let h=u.top;h<u.bottom;h++){let p=u.map.positionAt(h,u.left,u.table);h==u.top&&(p+=s.nodeSize);for(let g=u.left,y=0;g<u.right;g++,y++)g==u.left&&h==u.top||d.insert(f=d.mapping.map(p+u.tableStart,1),t({node:s,row:h,col:g}).createAndFill(a[y]))}d.setNodeMarkup(o,t({node:s,row:u.top,col:u.left}),a[0]),r instanceof Y&&d.setSelection(new Y(d.doc.resolve(r.$anchorCell.pos),f?d.doc.resolve(f):void 0)),n(d)}return!0}}function Ep(t,e){return function(n,r){if(!Ie(n))return!1;const s=Rr(n);if(s.nodeAfter.attrs[t]===e)return!1;if(r){const o=n.tr;n.selection instanceof Y?n.selection.forEachCell((i,l)=>{i.attrs[t]!==e&&o.setNodeMarkup(l,null,{...i.attrs,[t]:e})}):o.setNodeMarkup(s.pos,null,{...s.nodeAfter.attrs,[t]:e}),r(o)}return!0}}function Np(t){return function(e,n){if(!Ie(e))return!1;if(n){const r=pe(e.schema),s=Fe(e),o=e.tr,i=s.map.cellsInRect(t=="column"?{left:s.left,top:0,right:s.right,bottom:s.map.height}:t=="row"?{left:0,top:s.top,right:s.map.width,bottom:s.bottom}:s),l=i.map(a=>s.table.nodeAt(a));for(let a=0;a<i.length;a++)l[a].type==r.header_cell&&o.setNodeMarkup(s.tableStart+i[a],r.cell,l[a].attrs);if(o.steps.length===0)for(let a=0;a<i.length;a++)o.setNodeMarkup(s.tableStart+i[a],r.header_cell,l[a].attrs);n(o)}return!0}}function ga(t,e,n){const r=e.map.cellsInRect({left:0,top:0,right:t=="row"?e.map.width:1,bottom:t=="column"?e.map.height:1});for(let s=0;s<r.length;s++){const o=e.table.nodeAt(r[s]);if(o&&o.type!==n.header_cell)return!1}return!0}function gn(t,e){return e=e||{useDeprecatedLogic:!1},e.useDeprecatedLogic?Np(t):function(n,r){if(!Ie(n))return!1;if(r){const s=pe(n.schema),o=Fe(n),i=n.tr,l=ga("row",o,s),a=ga("column",o,s),c=(t==="column"?l:t==="row"&&a)?1:0,u=t=="column"?{left:0,top:c,right:1,bottom:o.map.height}:t=="row"?{left:c,top:0,right:o.map.width,bottom:1}:o,d=t=="column"?a?s.cell:s.header_cell:t=="row"?l?s.cell:s.header_cell:s.cell;o.map.cellsInRect(u).forEach(f=>{const h=f+o.tableStart,p=i.doc.nodeAt(h);p&&i.setNodeMarkup(h,d,p.attrs)}),r(i)}return!0}}gn("row",{useDeprecatedLogic:!0}),gn("column",{useDeprecatedLogic:!0});const Ap=gn("cell",{useDeprecatedLogic:!0});function Tp(t,e){if(e<0){const n=t.nodeBefore;if(n)return t.pos-n.nodeSize;for(let r=t.index(-1)-1,s=t.before();r>=0;r--){const o=t.node(-1).child(r),i=o.lastChild;if(i)return s-1-i.nodeSize;s-=o.nodeSize}}else{if(t.index()<t.parent.childCount-1)return t.pos+t.nodeAfter.nodeSize;const n=t.node(-1);for(let r=t.indexAfter(-1),s=t.after();r<n.childCount;r++){const o=n.child(r);if(o.childCount)return s+1;s+=o.nodeSize}}return null}function ya(t){return function(e,n){if(!Ie(e))return!1;const r=Tp(Rr(e),t);if(r==null)return!1;if(n){const s=e.doc.resolve(r);n(e.tr.setSelection(F.between(s,op(s))).scrollIntoView())}return!0}}function Mp(t,e){const n=t.selection.$anchor;for(let r=n.depth;r>0;r--)if(n.node(r).type.spec.tableRole=="table")return e&&e(t.tr.delete(n.before(r),n.after(r)).scrollIntoView()),!0;return!1}function Or(t,e){const n=t.selection;if(!(n instanceof Y))return!1;if(e){const r=t.tr,s=pe(t.schema).cell.createAndFill().content;n.forEachCell((o,i)=>{o.content.eq(s)||r.replace(r.mapping.map(i+1),r.mapping.map(i+o.nodeSize-1),new T(s,0,0))}),r.docChanged&&e(r)}return!0}function Rp(t){if(t.size===0)return null;let{content:e,openStart:n,openEnd:r}=t;for(;e.childCount==1&&(n>0&&r>0||e.child(0).type.spec.tableRole=="table");)n--,r--,e=e.child(0).content;const s=e.child(0),o=s.type.spec.tableRole,i=s.type.schema,l=[];if(o=="row")for(let a=0;a<e.childCount;a++){let c=e.child(a).content;const u=a?0:Math.max(0,n-1),d=a<e.childCount-1?0:Math.max(0,r-1);(u||d)&&(c=co(pe(i).row,new T(c,u,d)).content),l.push(c)}else if(o=="cell"||o=="header_cell")l.push(n||r?co(pe(i).row,new T(e,n,r)).content:e);else return null;return Op(i,l)}function Op(t,e){const n=[];for(let s=0;s<e.length;s++){const o=e[s];for(let i=o.childCount-1;i>=0;i--){const{rowspan:l,colspan:a}=o.child(i).attrs;for(let c=s;c<s+l;c++)n[c]=(n[c]||0)+a}}let r=0;for(let s=0;s<n.length;s++)r=Math.max(r,n[s]);for(let s=0;s<n.length;s++)if(s>=e.length&&e.push(N.empty),n[s]<r){const o=pe(t).cell.createAndFill(),i=[];for(let l=n[s];l<r;l++)i.push(o);e[s]=e[s].append(N.from(i))}return{height:e.length,width:r,rows:e}}function co(t,e){const n=t.createAndFill();return new bi(n).replace(0,n.content.size,e).doc}function jp({width:t,height:e,rows:n},r,s){if(t!=r){const o=[],i=[];for(let l=0;l<n.length;l++){const a=n[l],c=[];for(let u=o[l]||0,d=0;u<r;d++){let f=a.child(d%a.childCount);u+f.attrs.colspan>r&&(f=f.type.createChecked(St(f.attrs,f.attrs.colspan,u+f.attrs.colspan-r),f.content)),c.push(f),u+=f.attrs.colspan;for(let h=1;h<f.attrs.rowspan;h++)o[l+h]=(o[l+h]||0)+f.attrs.colspan}i.push(N.from(c))}n=i,t=r}if(e!=s){const o=[];for(let i=0,l=0;i<s;i++,l++){const a=[],c=n[l%e];for(let u=0;u<c.childCount;u++){let d=c.child(u);i+d.attrs.rowspan>s&&(d=d.type.create({...d.attrs,rowspan:Math.max(1,s-d.attrs.rowspan)},d.content)),a.push(d)}o.push(N.from(a))}n=o,e=s}return{width:t,height:e,rows:n}}function Ip(t,e,n,r,s,o,i){const l=t.doc.type.schema,a=pe(l);let c,u;if(s>e.width)for(let d=0,f=0;d<e.height;d++){const h=n.child(d);f+=h.nodeSize;const p=[];let g;h.lastChild==null||h.lastChild.type==a.cell?g=c||(c=a.cell.createAndFill()):g=u||(u=a.header_cell.createAndFill());for(let y=e.width;y<s;y++)p.push(g);t.insert(t.mapping.slice(i).map(f-1+r),p)}if(o>e.height){const d=[];for(let p=0,g=(e.height-1)*e.width;p<Math.max(e.width,s);p++){const y=p>=e.width?!1:n.nodeAt(e.map[g+p]).type==a.header_cell;d.push(y?u||(u=a.header_cell.createAndFill()):c||(c=a.cell.createAndFill()))}const f=a.row.create(null,N.from(d)),h=[];for(let p=e.height;p<o;p++)h.push(f);t.insert(t.mapping.slice(i).map(r+n.nodeSize-2),h)}return!!(c||u)}function ba(t,e,n,r,s,o,i,l){if(i==0||i==e.height)return!1;let a=!1;for(let c=s;c<o;c++){const u=i*e.width+c,d=e.map[u];if(e.map[u-e.width]==d){a=!0;const f=n.nodeAt(d),{top:h,left:p}=e.findCell(d);t.setNodeMarkup(t.mapping.slice(l).map(d+r),null,{...f.attrs,rowspan:i-h}),t.insert(t.mapping.slice(l).map(e.positionAt(i,p,n)),f.type.createAndFill({...f.attrs,rowspan:h+f.attrs.rowspan-i})),c+=f.attrs.colspan-1}}return a}function xa(t,e,n,r,s,o,i,l){if(i==0||i==e.width)return!1;let a=!1;for(let c=s;c<o;c++){const u=c*e.width+i,d=e.map[u];if(e.map[u-1]==d){a=!0;const f=n.nodeAt(d),h=e.colCount(d),p=t.mapping.slice(l).map(d+r);t.setNodeMarkup(p,null,St(f.attrs,i-h,f.attrs.colspan-(i-h))),t.insert(p+f.nodeSize,f.type.createAndFill(St(f.attrs,0,i-h))),c+=f.attrs.rowspan-1}}return a}function wa(t,e,n,r,s){let o=n?t.doc.nodeAt(n-1):t.doc;if(!o)throw new Error("No table found");let i=ee.get(o);const{top:l,left:a}=r,c=a+s.width,u=l+s.height,d=t.tr;let f=0;function h(){if(o=n?d.doc.nodeAt(n-1):d.doc,!o)throw new Error("No table found");i=ee.get(o),f=d.mapping.maps.length}Ip(d,i,o,n,c,u,f)&&h(),ba(d,i,o,n,a,c,l,f)&&h(),ba(d,i,o,n,a,c,u,f)&&h(),xa(d,i,o,n,l,u,a,f)&&h(),xa(d,i,o,n,l,u,c,f)&&h();for(let p=l;p<u;p++){const g=i.positionAt(p,a,o),y=i.positionAt(p,c,o);d.replace(d.mapping.slice(f).map(g+n),d.mapping.slice(f).map(y+n),new T(s.rows[p-l],0,0))}h(),d.setSelection(new Y(d.doc.resolve(n+i.positionAt(l,a,o)),d.doc.resolve(n+i.positionAt(u-1,c-1,o)))),e(d)}const zp=kd({ArrowLeft:Ir("horiz",-1),ArrowRight:Ir("horiz",1),ArrowUp:Ir("vert",-1),ArrowDown:Ir("vert",1),"Shift-ArrowLeft":zr("horiz",-1),"Shift-ArrowRight":zr("horiz",1),"Shift-ArrowUp":zr("vert",-1),"Shift-ArrowDown":zr("vert",1),Backspace:Or,"Mod-Backspace":Or,Delete:Or,"Mod-Delete":Or});function jr(t,e,n){return n.eq(t.selection)?!1:(e&&e(t.tr.setSelection(n).scrollIntoView()),!0)}function Ir(t,e){return(n,r,s)=>{if(!s)return!1;const o=n.selection;if(o instanceof Y)return jr(n,r,W.near(o.$headCell,e));if(t!="horiz"&&!o.empty)return!1;const i=va(s,t,e);if(i==null)return!1;if(t=="horiz")return jr(n,r,W.near(n.doc.resolve(o.head+e),e));{const l=n.doc.resolve(i),a=la(l,t,e);let c;return a?c=W.near(a,1):e<0?c=W.near(n.doc.resolve(l.before(-1)),-1):c=W.near(n.doc.resolve(l.after(-1)),1),jr(n,r,c)}}}function zr(t,e){return(n,r,s)=>{if(!s)return!1;const o=n.selection;let i;if(o instanceof Y)i=o;else{const a=va(s,t,e);if(a==null)return!1;i=new Y(n.doc.resolve(a))}const l=la(i.$headCell,t,e);return l?jr(n,r,new Y(i.$anchorCell,l)):!1}}function Lp(t,e){const n=t.state.doc,r=kt(n.resolve(e));return r?(t.dispatch(t.state.tr.setSelection(new Y(r))),!0):!1}function Pp(t,e,n){if(!Ie(t.state))return!1;let r=Rp(n);const s=t.state.selection;if(s instanceof Y){r||(r={width:1,height:1,rows:[N.from(co(pe(t.state.schema).cell,n))]});const o=s.$anchorCell.node(-1),i=s.$anchorCell.start(-1),l=ee.get(o).rectBetween(s.$anchorCell.pos-i,s.$headCell.pos-i);return r=jp(r,l.right-l.left,l.bottom-l.top),wa(t.state,t.dispatch,i,l,r),!0}else if(r){const o=Rr(t.state),i=o.start(-1);return wa(t.state,t.dispatch,i,ee.get(o.node(-1)).findCell(o.pos-i),r),!0}else return!1}function Dp(t,e){var n;if(e.button!=0||e.ctrlKey||e.metaKey)return;const r=ka(t,e.target);let s;if(e.shiftKey&&t.state.selection instanceof Y)o(t.state.selection.$anchorCell,e),e.preventDefault();else if(e.shiftKey&&r&&(s=kt(t.state.selection.$anchor))!=null&&((n=uo(t,e))===null||n===void 0?void 0:n.pos)!=s.pos)o(s,e),e.preventDefault();else if(!r)return;function o(a,c){let u=uo(t,c);const d=lt.getState(t.state)==null;if(!u||!ao(a,u))if(d)u=a;else return;const f=new Y(a,u);if(d||!t.state.selection.eq(f)){const h=t.state.tr.setSelection(f);d&&h.setMeta(lt,a.pos),t.dispatch(h)}}function i(){t.root.removeEventListener("mouseup",i),t.root.removeEventListener("dragstart",i),t.root.removeEventListener("mousemove",l),lt.getState(t.state)!=null&&t.dispatch(t.state.tr.setMeta(lt,-1))}function l(a){const c=a,u=lt.getState(t.state);let d;if(u!=null)d=t.state.doc.resolve(u);else if(ka(t,c.target)!=r&&(d=uo(t,e),!d))return i();d&&o(d,c)}t.root.addEventListener("mouseup",i),t.root.addEventListener("dragstart",i),t.root.addEventListener("mousemove",l)}function va(t,e,n){if(!(t.state.selection instanceof F))return null;const{$head:r}=t.state.selection;for(let s=r.depth-1;s>=0;s--){const o=r.node(s);if((n<0?r.index(s):r.indexAfter(s))!=(n<0?0:o.childCount))return null;if(o.type.spec.tableRole=="cell"||o.type.spec.tableRole=="header_cell"){const i=r.before(s),l=e=="vert"?n>0?"down":"up":n>0?"right":"left";return t.endOfTextblock(l)?i:null}}return null}function ka(t,e){for(;e&&e!=t.dom;e=e.parentNode)if(e.nodeName=="TD"||e.nodeName=="TH")return e;return null}function uo(t,e){const n=t.posAtCoords({left:e.clientX,top:e.clientY});if(!n)return null;let{inside:r,pos:s}=n;return r>=0&&kt(t.state.doc.resolve(r))||kt(t.state.doc.resolve(s))}var $p=class{constructor(e,n){this.node=e,this.defaultCellMinWidth=n,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.table.style.setProperty("--default-cell-min-width",`${n}px`),this.colgroup=this.table.appendChild(document.createElement("colgroup")),fo(e,this.colgroup,this.table,n),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(e){return e.type!=this.node.type?!1:(this.node=e,fo(e,this.colgroup,this.table,this.defaultCellMinWidth),!0)}ignoreMutation(e){return e.type=="attributes"&&(e.target==this.table||this.colgroup.contains(e.target))}};function fo(t,e,n,r,s,o){let i=0,l=!0,a=e.firstChild;const c=t.firstChild;if(c){for(let d=0,f=0;d<c.childCount;d++){const{colspan:h,colwidth:p}=c.child(d).attrs;for(let g=0;g<h;g++,f++){const y=s==f?o:p&&p[g],b=y?y+"px":"";if(i+=y||r,y||(l=!1),a)a.style.width!=b&&(a.style.width=b),a=a.nextSibling;else{const x=document.createElement("col");x.style.width=b,e.appendChild(x)}}}for(;a;){var u;const d=a.nextSibling;(u=a.parentNode)===null||u===void 0||u.removeChild(a),a=d}l?(n.style.width=i+"px",n.style.minWidth=""):(n.style.width="",n.style.minWidth=i+"px")}}const Ce=new be("tableColumnResizing");function Fp({handleWidth:t=5,cellMinWidth:e=25,defaultCellMinWidth:n=100,View:r=$p,lastColumnResizable:s=!0}={}){const o=new ke({key:Ce,state:{init(i,l){var a;const c=(a=o.spec)===null||a===void 0||(a=a.props)===null||a===void 0?void 0:a.nodeViews,u=pe(l.schema).table.name;return r&&c&&(c[u]=(d,f)=>new r(d,n,f)),new Bp(-1,!1)},apply(i,l){return l.apply(i)}},props:{attributes:i=>{const l=Ce.getState(i);return l&&l.activeHandle>-1?{class:"resize-cursor"}:{}},handleDOMEvents:{mousemove:(i,l)=>{Hp(i,l,t,s)},mouseleave:i=>{Wp(i)},mousedown:(i,l)=>{_p(i,l,e,n)}},decorations:i=>{const l=Ce.getState(i);if(l&&l.activeHandle>-1)return Jp(i,l.activeHandle)},nodeViews:{}}});return o}var Bp=class Dr{constructor(e,n){this.activeHandle=e,this.dragging=n}apply(e){const n=this,r=e.getMeta(Ce);if(r&&r.setHandle!=null)return new Dr(r.setHandle,!1);if(r&&r.setDragging!==void 0)return new Dr(n.activeHandle,r.setDragging);if(n.activeHandle>-1&&e.docChanged){let s=e.mapping.map(n.activeHandle,-1);return lo(e.doc.resolve(s))||(s=-1),new Dr(s,n.dragging)}return n}};function Hp(t,e,n,r){if(!t.editable)return;const s=Ce.getState(t.state);if(s&&!s.dragging){const o=Vp(e.target);let i=-1;if(o){const{left:l,right:a}=o.getBoundingClientRect();e.clientX-l<=n?i=Sa(t,e,"left",n):a-e.clientX<=n&&(i=Sa(t,e,"right",n))}if(i!=s.activeHandle){if(!r&&i!==-1){const l=t.state.doc.resolve(i),a=l.node(-1),c=ee.get(a),u=l.start(-1);if(c.colCount(l.pos-u)+l.nodeAfter.attrs.colspan-1==c.width-1)return}Ea(t,i)}}}function Wp(t){if(!t.editable)return;const e=Ce.getState(t.state);e&&e.activeHandle>-1&&!e.dragging&&Ea(t,-1)}function _p(t,e,n,r){var s;if(!t.editable)return!1;const o=(s=t.dom.ownerDocument.defaultView)!==null&&s!==void 0?s:window,i=Ce.getState(t.state);if(!i||i.activeHandle==-1||i.dragging)return!1;const l=t.state.doc.nodeAt(i.activeHandle),a=Kp(t,i.activeHandle,l.attrs);t.dispatch(t.state.tr.setMeta(Ce,{setDragging:{startX:e.clientX,startWidth:a}}));function c(d){o.removeEventListener("mouseup",c),o.removeEventListener("mousemove",u);const f=Ce.getState(t.state);f?.dragging&&(Up(t,f.activeHandle,Ca(f.dragging,d,n)),t.dispatch(t.state.tr.setMeta(Ce,{setDragging:null})))}function u(d){if(!d.which)return c(d);const f=Ce.getState(t.state);if(f&&f.dragging){const h=Ca(f.dragging,d,n);Na(t,f.activeHandle,h,r)}}return Na(t,i.activeHandle,a,r),o.addEventListener("mouseup",c),o.addEventListener("mousemove",u),e.preventDefault(),!0}function Kp(t,e,{colspan:n,colwidth:r}){const s=r&&r[r.length-1];if(s)return s;const o=t.domAtPos(e);let i=o.node.childNodes[o.offset].offsetWidth,l=n;if(r)for(let a=0;a<n;a++)r[a]&&(i-=r[a],l--);return i/l}function Vp(t){for(;t&&t.nodeName!="TD"&&t.nodeName!="TH";)t=t.classList&&t.classList.contains("ProseMirror")?null:t.parentNode;return t}function Sa(t,e,n,r){const s=n=="right"?-r:r,o=t.posAtCoords({left:e.clientX+s,top:e.clientY});if(!o)return-1;const{pos:i}=o,l=kt(t.state.doc.resolve(i));if(!l)return-1;if(n=="right")return l.pos;const a=ee.get(l.node(-1)),c=l.start(-1),u=a.map.indexOf(l.pos-c);return u%a.width==0?-1:c+a.map[u-1]}function Ca(t,e,n){const r=e.clientX-t.startX;return Math.max(n,t.startWidth+r)}function Ea(t,e){t.dispatch(t.state.tr.setMeta(Ce,{setHandle:e}))}function Up(t,e,n){const r=t.state.doc.resolve(e),s=r.node(-1),o=ee.get(s),i=r.start(-1),l=o.colCount(r.pos-i)+r.nodeAfter.attrs.colspan-1,a=t.state.tr;for(let c=0;c<o.height;c++){const u=c*o.width+l;if(c&&o.map[u]==o.map[u-o.width])continue;const d=o.map[u],f=s.nodeAt(d).attrs,h=f.colspan==1?0:l-o.colCount(d);if(f.colwidth&&f.colwidth[h]==n)continue;const p=f.colwidth?f.colwidth.slice():qp(f.colspan);p[h]=n,a.setNodeMarkup(i+d,null,{...f,colwidth:p})}a.docChanged&&t.dispatch(a)}function Na(t,e,n,r){const s=t.state.doc.resolve(e),o=s.node(-1),i=s.start(-1),l=ee.get(o).colCount(s.pos-i)+s.nodeAfter.attrs.colspan-1;let a=t.domAtPos(s.start(-1)).node;for(;a&&a.nodeName!="TABLE";)a=a.parentNode;a&&fo(o,a.firstChild,a,r,l,n)}function qp(t){return Array(t).fill(0)}function Jp(t,e){const n=[],r=t.doc.resolve(e),s=r.node(-1);if(!s)return re.empty;const o=ee.get(s),i=r.start(-1),l=o.colCount(r.pos-i)+r.nodeAfter.attrs.colspan-1;for(let c=0;c<o.height;c++){const u=l+c*o.width;if((l==o.width-1||o.map[u]!=o.map[u+1])&&(c==0||o.map[u]!=o.map[u-o.width])){var a;const d=o.map[u],f=i+d+s.nodeAt(d).nodeSize-1,h=document.createElement("div");h.className="column-resize-handle",!((a=Ce.getState(t))===null||a===void 0)&&a.dragging&&n.push(Ae.node(i+d,i+d+s.nodeAt(d).nodeSize,{class:"column-resize-dragging"})),n.push(Ae.widget(f,h))}}return re.create(t.doc,n)}function Gp({allowTableNodeSelection:t=!1}={}){return new ke({key:lt,state:{init(){return null},apply(e,n){const r=e.getMeta(lt);if(r!=null)return r==-1?null:r;if(n==null||!e.docChanged)return n;const{deleted:s,pos:o}=e.mapping.mapResult(n);return s?null:o}},props:{decorations:ap,handleDOMEvents:{mousedown:Dp},createSelectionBetween(e){return lt.getState(e.state)!=null?e.state.selection:null},handleTripleClick:Lp,handleKeyDown:zp,handlePaste:Pp},appendTransaction(e,n,r){return dp(r,ua(r,n),t)}})}var Aa=sn.create({name:"tableCell",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:t=>{var e,n;const r=t.getAttribute("colwidth"),s=r?r.split(",").map(o=>parseInt(o,10)):null;if(!s){const o=(e=t.closest("table"))==null?void 0:e.querySelectorAll("colgroup > col"),i=Array.from(((n=t.parentElement)==null?void 0:n.children)||[]).indexOf(t);if(i&&i>-1&&o&&o[i]){const l=o[i].getAttribute("width");return l?[parseInt(l,10)]:null}}return s}}}},tableRole:"cell",isolating:!0,parseHTML(){return[{tag:"td"}]},renderHTML({HTMLAttributes:t}){return["td",rt(this.options.HTMLAttributes,t),0]}}),Ta=sn.create({name:"tableHeader",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:t=>{const e=t.getAttribute("colwidth");return e?e.split(",").map(r=>parseInt(r,10)):null}}}},tableRole:"header_cell",isolating:!0,parseHTML(){return[{tag:"th"}]},renderHTML({HTMLAttributes:t}){return["th",rt(this.options.HTMLAttributes,t),0]}}),Ma=sn.create({name:"tableRow",addOptions(){return{HTMLAttributes:{}}},content:"(tableCell | tableHeader)*",tableRole:"row",parseHTML(){return[{tag:"tr"}]},renderHTML({HTMLAttributes:t}){return["tr",rt(this.options.HTMLAttributes,t),0]}});function ho(t,e){return e?["width",`${Math.max(e,t)}px`]:["min-width",`${t}px`]}function Ra(t,e,n,r,s,o){var i;let l=0,a=!0,c=e.firstChild;const u=t.firstChild;if(u!==null)for(let f=0,h=0;f<u.childCount;f+=1){const{colspan:p,colwidth:g}=u.child(f).attrs;for(let y=0;y<p;y+=1,h+=1){const b=s===h?o:g&&g[y],x=b?`${b}px`:"";if(l+=b||r,b||(a=!1),c){if(c.style.width!==x){const[k,E]=ho(r,b);c.style.setProperty(k,E)}c=c.nextSibling}else{const k=document.createElement("col"),[E,C]=ho(r,b);k.style.setProperty(E,C),e.appendChild(k)}}}for(;c;){const f=c.nextSibling;(i=c.parentNode)==null||i.removeChild(c),c=f}const d=t.attrs.style&&typeof t.attrs.style=="string"&&/\bwidth\s*:/i.test(t.attrs.style);a&&!d?(n.style.width=`${l}px`,n.style.minWidth=""):(n.style.width="",n.style.minWidth=`${l}px`)}var Yp=class{constructor(t,e){this.node=t,this.cellMinWidth=e,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),t.attrs.style&&(this.table.style.cssText=t.attrs.style),this.colgroup=this.table.appendChild(document.createElement("colgroup")),Ra(t,this.colgroup,this.table,e),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(t){return t.type!==this.node.type?!1:(this.node=t,Ra(t,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(t){const e=t.target,n=this.dom.contains(e),r=this.contentDOM.contains(e);return!!(n&&!r&&(t.type==="attributes"||t.type==="childList"||t.type==="characterData"))}};function Qp(t,e,n,r){let s=0,o=!0;const i=[],l=t.firstChild;if(!l)return{};for(let d=0,f=0;d<l.childCount;d+=1){const{colspan:h,colwidth:p}=l.child(d).attrs;for(let g=0;g<h;g+=1,f+=1){const y=n===f?r:p&&p[g];s+=y||e,y||(o=!1);const[b,x]=ho(e,y);i.push(["col",{style:`${b}: ${x}`}])}}const a=o?`${s}px`:"",c=o?"":`${s}px`;return{colgroup:["colgroup",{},...i],tableWidth:a,tableMinWidth:c}}function Oa(t,e){return t.createAndFill()}function Xp(t){if(t.cached.tableNodeTypes)return t.cached.tableNodeTypes;const e={};return Object.keys(t.nodes).forEach(n=>{const r=t.nodes[n];r.spec.tableRole&&(e[r.spec.tableRole]=r)}),t.cached.tableNodeTypes=e,e}function Zp(t,e,n,r,s){const o=Xp(t),i=[],l=[];for(let c=0;c<n;c+=1){const u=Oa(o.cell);if(u&&l.push(u),r){const d=Oa(o.header_cell);d&&i.push(d)}}const a=[];for(let c=0;c<e;c+=1)a.push(o.row.createChecked(null,r&&c===0?i:l));return o.table.createChecked(null,a)}function em(t){return t instanceof Y}var Lr=({editor:t})=>{const{selection:e}=t.state;if(!em(e))return!1;let n=0;const r=Ll(e.ranges[0].$from,o=>o.type.name==="table");return r?.node.descendants(o=>{if(o.type.name==="table")return!1;["tableCell","tableHeader"].includes(o.type.name)&&(n+=1)}),n===e.ranges.length?(t.commands.deleteTable(),!0):!1},tm="";function nm(t){return(t||"").replace(/\s+/g," ").trim()}function rm(t,e,n={}){var r;const s=(r=n.cellLineSeparator)!=null?r:tm;if(!t||!t.content||t.content.length===0)return"";const o=[];t.content.forEach(p=>{const g=[];p.content&&p.content.forEach(y=>{let b="";y.content&&Array.isArray(y.content)&&y.content.length>1?b=y.content.map(C=>e.renderChildren(C)).join(s):b=y.content?e.renderChildren(y.content):"";const x=nm(b),k=y.type==="tableHeader";g.push({text:x,isHeader:k})}),o.push(g)});const i=o.reduce((p,g)=>Math.max(p,g.length),0);if(i===0)return"";const l=new Array(i).fill(0);o.forEach(p=>{var g;for(let y=0;y<i;y+=1){const x=(((g=p[y])==null?void 0:g.text)||"").length;x>l[y]&&(l[y]=x),l[y]<3&&(l[y]=3)}});const a=(p,g)=>p+" ".repeat(Math.max(0,g-p.length)),c=o[0],u=c.some(p=>p.isHeader);let d=`
`;const f=new Array(i).fill(0).map((p,g)=>u&&c[g]&&c[g].text||"");return d+=`| ${f.map((p,g)=>a(p,l[g])).join(" | ")} |
`,d+=`| ${l.map(p=>"-".repeat(Math.max(3,p))).join(" | ")} |
`,(u?o.slice(1):o).forEach(p=>{d+=`| ${new Array(i).fill(0).map((g,y)=>a(p[y]&&p[y].text||"",l[y])).join(" | ")} |
`}),d}var sm=rm,ja=sn.create({name:"table",addOptions(){return{HTMLAttributes:{},resizable:!1,renderWrapper:!1,handleWidth:5,cellMinWidth:25,View:Yp,lastColumnResizable:!0,allowTableNodeSelection:!1}},content:"tableRow+",tableRole:"table",isolating:!0,group:"block",parseHTML(){return[{tag:"table"}]},renderHTML({node:t,HTMLAttributes:e}){const{colgroup:n,tableWidth:r,tableMinWidth:s}=Qp(t,this.options.cellMinWidth),o=e.style;function i(){return o||(r?`width: ${r}`:`min-width: ${s}`)}const l=["table",rt(this.options.HTMLAttributes,e,{style:i()}),n,["tbody",0]];return this.options.renderWrapper?["div",{class:"tableWrapper"},l]:l},parseMarkdown:(t,e)=>{const n=[];if(t.header){const r=[];t.header.forEach(s=>{r.push(e.createNode("tableHeader",{},[{type:"paragraph",content:e.parseInline(s.tokens)}]))}),n.push(e.createNode("tableRow",{},r))}return t.rows&&t.rows.forEach(r=>{const s=[];r.forEach(o=>{s.push(e.createNode("tableCell",{},[{type:"paragraph",content:e.parseInline(o.tokens)}]))}),n.push(e.createNode("tableRow",{},s))}),e.createNode("table",void 0,n)},renderMarkdown:(t,e)=>sm(t,e),addCommands(){return{insertTable:({rows:t=3,cols:e=3,withHeaderRow:n=!0}={})=>({tr:r,dispatch:s,editor:o})=>{const i=Zp(o.schema,t,e,n);if(s){const l=r.selection.from+1;r.replaceSelectionWith(i).scrollIntoView().setSelection(F.near(r.doc.resolve(l)))}return!0},addColumnBefore:()=>({state:t,dispatch:e})=>pp(t,e),addColumnAfter:()=>({state:t,dispatch:e})=>mp(t,e),deleteColumn:()=>({state:t,dispatch:e})=>yp(t,e),addRowBefore:()=>({state:t,dispatch:e})=>xp(t,e),addRowAfter:()=>({state:t,dispatch:e})=>wp(t,e),deleteRow:()=>({state:t,dispatch:e})=>kp(t,e),deleteTable:()=>({state:t,dispatch:e})=>Mp(t,e),mergeCells:()=>({state:t,dispatch:e})=>pa(t,e),splitCell:()=>({state:t,dispatch:e})=>ma(t,e),toggleHeaderColumn:()=>({state:t,dispatch:e})=>gn("column")(t,e),toggleHeaderRow:()=>({state:t,dispatch:e})=>gn("row")(t,e),toggleHeaderCell:()=>({state:t,dispatch:e})=>Ap(t,e),mergeOrSplit:()=>({state:t,dispatch:e})=>pa(t,e)?!0:ma(t,e),setCellAttribute:(t,e)=>({state:n,dispatch:r})=>Ep(t,e)(n,r),goToNextCell:()=>({state:t,dispatch:e})=>ya(1)(t,e),goToPreviousCell:()=>({state:t,dispatch:e})=>ya(-1)(t,e),fixTables:()=>({state:t,dispatch:e})=>(e&&ua(t),!0),setCellSelection:t=>({tr:e,dispatch:n})=>{if(n){const r=Y.create(e.doc,t.anchorCell,t.headCell);e.setSelection(r)}return!0}}},addKeyboardShortcuts(){return{Tab:()=>this.editor.commands.goToNextCell()?!0:this.editor.can().addRowAfter()?this.editor.chain().addRowAfter().goToNextCell().run():!1,"Shift-Tab":()=>this.editor.commands.goToPreviousCell(),Backspace:Lr,"Mod-Backspace":Lr,Delete:Lr,"Mod-Delete":Lr}},addProseMirrorPlugins(){return[...this.options.resizable&&this.editor.isEditable?[Fp({handleWidth:this.options.handleWidth,cellMinWidth:this.options.cellMinWidth,defaultCellMinWidth:this.options.cellMinWidth,View:this.options.View,lastColumnResizable:this.options.lastColumnResizable})]:[],Gp({allowTableNodeSelection:this.options.allowTableNodeSelection})]},extendNodeSchema(t){const e={name:t.name,options:t.options,storage:t.storage};return{tableRole:Lt(zt(t,"tableRole",e))}}});je.create({name:"tableKit",addExtensions(){const t=[];return this.options.table!==!1&&t.push(ja.configure(this.options.table)),this.options.tableCell!==!1&&t.push(Aa.configure(this.options.tableCell)),this.options.tableHeader!==!1&&t.push(Ta.configure(this.options.tableHeader)),this.options.tableRow!==!1&&t.push(Ma.configure(this.options.tableRow)),t}});function ze(t){const{title:e,active:n,disabled:r,onClick:s}=t;return m.jsx("button",{type:"button",title:e,disabled:r,onClick:s,className:`
        h-8 min-w-[32px] px-2
        flex items-center justify-center gap-1
        rounded-md text-sm transition
        ${n?"bg-indigo-100 text-indigo-700":"text-gray-600 hover:bg-gray-100"}
        disabled:opacity-40 disabled:cursor-not-allowed
      `,children:"icon"in t?m.jsx("i",{className:t.icon}):t.children})}function om({editor:t}){const[e,n]=$.useState(!1);if(!t)return null;const r=t.isActive("heading",{level:1})?"Heading 1":t.isActive("heading",{level:2})?"Heading 2":"Paragraph";return m.jsxs("div",{className:"relative",children:[m.jsxs("button",{type:"button",onMouseDown:s=>{s.preventDefault(),n(o=>!o)},className:`
          h-8 px-2 flex items-center gap-2
          rounded-md text-sm
          text-gray-700 hover:bg-gray-100
        `,children:[m.jsx("i",{className:"fa-solid fa-heading"}),m.jsx("span",{className:"text-xs font-medium",children:r}),m.jsx("i",{className:"fa-solid fa-chevron-down text-[10px]"})]}),e&&m.jsxs("div",{className:"absolute z-20 mt-1 w-40 bg-white border rounded-md shadow",children:[m.jsx(po,{label:"Paragraph",onClick:()=>{t.chain().focus().setParagraph().run(),n(!1)}}),m.jsx(po,{label:"Heading 1",onClick:()=>{t.chain().focus().toggleHeading({level:1}).run(),n(!1)}}),m.jsx(po,{label:"Heading 2",onClick:()=>{t.chain().focus().toggleHeading({level:2}).run(),n(!1)}})]})]})}function po({label:t,onClick:e}){return m.jsx("button",{type:"button",onMouseDown:n=>{n.preventDefault(),e()},className:"w-full text-left px-3 py-2 text-sm hover:bg-gray-100",children:t})}function yn(){return m.jsx("div",{className:"w-px h-5 bg-gray-300 mx-1"})}function im({editor:t}){return m.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 border-b bg-gray-50",children:[m.jsx(ze,{title:"Bold",icon:"fa-solid fa-bold",onClick:()=>t.chain().focus().toggleBold().run(),active:t.isActive("bold")}),m.jsx(ze,{title:"Italic",icon:"fa-solid fa-italic",active:t.isActive("italic"),onClick:()=>t.chain().focus().toggleItalic().run()}),m.jsx(ze,{title:"Underline",icon:"fa-solid fa-underline",active:t.isActive("underline"),onClick:()=>t.chain().focus().toggleUnderline().run()}),m.jsx(yn,{}),m.jsx(om,{editor:t}),m.jsx(yn,{}),m.jsx(ze,{title:"Bullet List",icon:"fa-solid fa-list-ul",active:t.isActive("bulletList"),onClick:()=>t.chain().focus().toggleBulletList().run()}),m.jsx(ze,{title:"Ordered List",icon:"fa-solid fa-list-ol",active:t.isActive("orderedList"),onClick:()=>t.chain().focus().toggleOrderedList().run()}),m.jsx(yn,{}),m.jsx(ze,{icon:"fa-solid fa-link",title:"Add Link",active:t.isActive("link"),onClick:()=>{const e=t.getAttributes("link").href;let n=window.prompt("Enter URL",e);if(n===null)return;if(n===""){t.chain().focus().unsetLink().run();return}/^https?:\/\//i.test(n)||(n=`https://${n}`);const{empty:r}=t.state.selection;r?t.chain().focus().insertContent({type:"text",text:n,marks:[{type:"link",attrs:{href:n}}]}).run():t.chain().focus().extendMarkRange("link").setLink({href:n}).run()}}),m.jsx(ze,{title:"Insert Image",icon:"fa-regular fa-image",active:t.isActive("image"),onClick:()=>{const e=prompt("Enter image URL");e&&t.chain().focus().setImage({src:e}).run()}}),m.jsx(yn,{}),m.jsx(ze,{title:"Insert Table",icon:"fa-solid fa-table",active:t.isActive("table"),onClick:()=>t.chain().focus().insertTable({rows:3,cols:3,withHeaderRow:!0}).run()}),m.jsx(yn,{}),m.jsx(ze,{title:"Code Block",icon:"fa-solid fa-code",active:t.isActive("codeBlock"),disabled:!t.can().toggleCodeBlock(),onClick:()=>t.chain().focus().toggleCodeBlock().run()}),m.jsx("div",{className:"flex-1"}),m.jsx(ze,{title:"Undo",icon:"fa-solid fa-rotate-left",disabled:!t.can().undo(),onClick:()=>t.chain().focus().undo().run()}),m.jsx(ze,{title:"Redo",icon:"fa-solid fa-rotate-right",disabled:!t.can().redo(),onClick:()=>t.chain().focus().redo().run()})]})}function lm({value:t,onChange:e,disabled:n}){const r=go.useEditor({extensions:[Ha,Sh,Gh.configure({openOnClick:!1}),Xh,ja.configure({resizable:!0}),Ma,Ta,Aa],content:t||"",editable:!n,immediatelyRender:!1,editorProps:{attributes:{class:"tiptap focus:outline-none min-h-[120px]"}},onUpdate:({editor:o})=>{e(o.getHTML())}});if(!r)return null;const s=`
  w-full px-4 py-2 rounded-lg border transition-all duration-300
  backdrop-blur-sm text-gray-800 placeholder-gray-400
  focus:outline-none focus:ring-0

  ${n?"bg-gray-100 border-gray-200 text-gray-500 cursor-not-allowed":"bg-white border-gray-300 hover:border-gray-400 focus:border-indigo-500 focus:shadow-md"}
`;return m.jsxs("div",{className:`
    ${s} 
     py-2
    focus-within:ring-1 focus-within:ring-indigo-500
  `,children:[!n&&m.jsx(im,{editor:r}),m.jsx(go.EditorContent,{editor:r,className:"tiptap max-w-none p-3 min-h-[200px] max-h-[220px] overflow-auto focus:outline-none"})]})}function bn({field:t,formik:e,methods:n={},sqlOpsUrls:r,refid:s,module_refid:o="menuManager.main",optionsOverride:i,setFieldOptions:l}){const{setHighlightedIndex:a,executeFieldMethod:c,handleFileUpload:u,handleKeyDown:d,handleToggle:f,setSearch:h,setOpen:p,setIsFocused:g,handleInputChange:y,handleSelect:b,handlePersist:x,optionCount:k,baseInputClasses:E,focusClasses:C,labelClasses:M,search:I,highlightedIndex:P,options:V,isDisabled:B,key:v,filteredOptions:H,open:ue,listRef:U,detailsRef:J,isFocused:te}=cc({field:t,formik:e,methods:n,sqlOpsUrls:r,refid:s,module_refid:o,...i&&{optionsOverride:i},...l&&{setFieldOptions:l}}),ye=Ue=>Ue.icon?m.jsx("i",{className:Ue.icon}):null;switch(t.type){case"suggest":case"autosuggest":case"autocomplete":{const w=e.values[v]??"",S=I!==""?I:$r(V,w)??String(w??"");return m.jsxs("div",{className:"relative",children:[m.jsxs("label",{className:M,children:[t.label,t.required&&m.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),m.jsx("input",{className:`${E} ${C}`,value:S,placeholder:t.placeholder||"Type to search...",onChange:y,onBlur:()=>{setTimeout(()=>p(!1),150)},onKeyDown:R=>{if(R.key==="Enter"){if(R.preventDefault(),H[P]){const[j]=H[P];e.setFieldValue(v,j),x(j,t,o)}else I.trim()&&(e.setFieldValue(v,I.trim()),x(I.trim(),t,o));p(!1);return}d(R,!0)},disabled:B}),ue&&!B&&m.jsx("div",{ref:U,className:"absolute z-20 w-full bg-white border rounded shadow max-h-52 overflow-y-auto mt-1",children:H.length>0?H.map(([R,j],K)=>m.jsx("div",{id:`${v}-${R}`,"data-index":K,className:`px-3 py-2 cursor-pointer text-sm
                  ${P===K?"bg-gray-100":"hover:bg-gray-100"}`,onMouseDown:()=>b(R),children:j},R)):m.jsx("div",{className:"px-3 py-2 text-sm text-gray-400",children:`Press "ENTER" to ADD "${S}" `})}),e.touched[v]&&e.errors[v]&&m.jsx("span",{className:"text-xs text-red-500",children:String(e.errors[v])})]})}case"dataSelector":case"dataSelectorFromTable":case"dataSelectorFromUniques":case"dataMethod":{if(t.multiple===!0){const w=e.values[v];return m.jsx(To,{field:t,isDisabled:B,handleToggle:f,detailsRef:J,handleKeyDown:d,valueArray:w,labelClasses:M,listRef:U,search:I,filteredOptions:H,highlightedIndex:P,setSearch:h,formik:e,executeFieldMethod:c,setHighlightedIndex:a,handlePersist:x,module_refid:o,options:V})}return m.jsxs("div",{className:"relative",children:[m.jsxs("label",{className:M,children:[t.label,t.required&&m.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),m.jsxs("details",{className:`relative w-full ${B?"opacity-70":""}`,onToggle:f,ref:J,onKeyDown:w=>{B||d(w,!0)},children:[m.jsxs("summary",{className:`
    select-none border rounded-lg px-4 py-2.5 flex justify-between items-center
    ${B?"bg-gray-100 border-gray-200 text-gray-500 cursor-not-allowed":"bg-white border-gray-300 cursor-pointer"}
  `,children:[m.jsx("span",{className:"text-sm text-gray-700",children:e.values[v]?$r(V,e.values[v])??"Select option":`Select ${t.label}`}),m.jsx("svg",{className:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),!B&&m.jsxs("div",{ref:U,className:"absolute mt-1 w-full border border-gray-200 rounded-lg bg-white shadow-md z-10 max-h-60 overflow-y-auto p-2",children:[t.search&&m.jsx("div",{className:"sticky top-0 bg-white p-1",children:m.jsx("input",{type:"text",value:I,onChange:w=>{h(w.target.value),a(0)},onKeyDown:w=>d(w,!0),placeholder:"Search...",className:`px-2 py-[5px] rounded w-full border border-gray-200 transition-all duration-300 
                  bg-white/80 backdrop-blur-sm text-gray-800 placeholder-gray-400
                  focus:outline-none focus:ring-0`})}),H.length>0&&m.jsx("div",{onClick:w=>{w.preventDefault(),w.stopPropagation(),e.setFieldValue(v,""),x("",t,o),J.current?.removeAttribute("open"),h("")},className:"px-2 py-1 hover:bg-gray-50 rounded cursor-pointer text-sm hover:bg-gray-50",children:"Clear selection"}),H.length>0?H.map(([w,S],R)=>m.jsx("div",{id:`${v}-${w}`,"data-index":R,onClick:j=>{j.preventDefault(),j.stopPropagation(),e.setFieldValue(v,w),x(w,t,o),J.current?.removeAttribute("open"),h(""),a(0),c("onChange",t,`${v}-${w}`)},className:`px-2 py-1 hover:bg-gray-50 rounded cursor-pointer text-sm 
                        ${e.values[v]===w?"bg-indigo-50 text-indigo-600 font-medium":P===R?"bg-gray-100":"hover:bg-gray-50"}`,children:S},w)):m.jsx("div",{className:"px-2 py-1 text-gray-400 text-sm",children:"No results"})]})]}),e.touched[v]&&e.errors[v]&&m.jsx("span",{className:"text-xs text-red-500 ml-2",children:String(e.errors[v])})]})}case"richtextarea":return m.jsxs("div",{className:"relative",children:[m.jsxs("label",{className:M,children:[t.label,t.required&&m.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),m.jsx(lm,{value:e.values[v]??"",disabled:B,onChange:w=>{e.setFieldValue(v,w),x(w,t,o),c("onChange",t,v)}}),e.touched[v]&&e.errors[v]&&m.jsx("span",{className:"text-xs text-red-500",children:String(e.errors[v])})]});case"textarea":return m.jsx(m.Fragment,{children:m.jsxs("div",{className:"relative",children:[m.jsxs("label",{className:M,children:[t.label,t.required&&m.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),m.jsxs("div",{className:"relative",children:[m.jsx("textarea",{id:v,className:`${E} ${C} min-h-[120px] resize-none`,onFocus:()=>g(!0),name:v,value:e.values[v],onBlur:e.handleBlur,onChange:w=>{e.setFieldValue(v,w.target.value),x(w.target.value,t,o),c("onChange",t,`${v}`)},placeholder:t.placeholder,disabled:B}),m.jsx("div",{className:`absolute inset-0 rounded-lg bg-gradient-to-r from-purple-400 to-indigo-400 opacity-0 transition-opacity duration-300 pointer-events-none ${te?"opacity-20":""}`,style:{zIndex:-1,filter:"blur(8px)"}})]}),e.touched[v]&&e.errors[v]&&m.jsx("span",{className:"text-xs text-red-500",children:String(e.errors[v])})]})});case"select":if(t.multiple===!0){const w=e.values[v];return m.jsx(To,{field:t,isDisabled:B,handleToggle:f,detailsRef:J,handleKeyDown:d,valueArray:w,labelClasses:M,listRef:U,search:I,filteredOptions:H,highlightedIndex:P,setSearch:h,formik:e,executeFieldMethod:c,setHighlightedIndex:a,handlePersist:x,module_refid:o,options:V})}return m.jsxs("div",{className:"relative",children:[m.jsxs("label",{className:M,children:[t.label,t.required&&m.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),m.jsxs("div",{className:"relative",children:[m.jsxs("select",{className:`${E} ${C} appearance-none ${B?"":"cursor-pointer"} pr-12`,onFocus:()=>g(!0),name:v,id:v,value:e.values[v],onBlur:e.handleBlur,onChange:w=>{e.setFieldValue(v,w.target.value),x(w.target.value,t,o),c("onChange",t,`${v}`)},disabled:B,children:[m.jsx("option",{value:"",disabled:!0,children:t?.["no-option"]||`Please select ${t.label}`}),!vo(V)&&Object.entries(V).map(([w,S])=>m.jsx("option",{value:w,className:"py-2",children:S},w)),vo(V)&&Object.entries(V).map(([w,S])=>m.jsx("optgroup",{label:w,children:Object.entries(S).map(([R,j])=>m.jsx("option",{value:R,children:j},R))},w))]}),m.jsx("div",{className:"absolute right-4 top-1/2 transform -translate-y-1/2 pointer-events-none",children:m.jsx("svg",{className:"w-5 h-5 transition-colors duration-300 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),e.touched[v]&&e.errors[v]&&m.jsx("span",{className:"text-xs text-red-500",children:String(e.errors[v])})]});case"radioList":case"radio":return m.jsxs("div",{className:"relative",children:[m.jsxs("label",{className:M,children:[t.label,t.required&&m.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),m.jsx("div",{className:`flex ${k>3?"flex-col":""} gap-2 ml-1`,children:Object.entries(V||{}).map(([w,S])=>m.jsxs("label",{htmlFor:`${v}-${w}`,className:"flex items-center gap-x-2 text-sm font-medium text-gray-700 cursor-pointer",children:[m.jsx("input",{id:`${v}-${w}`,type:"radio",name:v,checked:e.values[v]===w,value:w,onChange:R=>{e.setFieldValue(v,R.target.value),x(R.target.value,t,o),c("onChange",t,`${v}-${w}`)},onBlur:e.handleBlur,disabled:B,className:`h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500
                    ${B?"bg-gray-100 border-gray-200 text-gray-500 cursor-not-allowed":""}
                    `}),S]},w))}),e.touched[v]&&e.errors[v]&&m.jsx("span",{className:"text-xs text-red-500 ml-2",children:String(e.errors[v])})]});case"checkbox":{const w=e.values[v];return m.jsxs("div",{className:"relative",children:[m.jsxs("label",{className:M,children:[t.label,t.required&&m.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),m.jsx("div",{className:"flex flex-col gap-2 ml-1",children:Object.entries(V||{}).map(([S,R])=>m.jsxs("label",{className:"flex items-center gap-x-2 text-sm font-medium text-gray-700 cursor-pointer",children:[m.jsx("input",{id:`${v}-${S}`,type:"checkbox",checked:w.includes(S),onChange:j=>{const K=j.target.checked?[...w,S]:w.filter(G=>G!==S);e.setFieldValue(v,K),x(K,t,o),c("onChange",t,`${v}-${S}`)},onBlur:e.handleBlur,disabled:B,className:`h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500
                    ${B?"bg-gray-100 border-gray-200 text-gray-500 cursor-not-allowed":""}
                    `}),R]},S))}),e.touched[v]&&e.errors[v]&&m.jsx("span",{className:"text-xs text-red-500 ml-2",children:String(e.errors[v])})]})}case"tags":{const w=e.values[v],S=I.trim(),R=Array.isArray(V)?V:Object.entries(V||{}).map(([O,z])=>({value:O,label:z})),j=O=>{if(!B&&O&&!w.includes(O)){let z=[...w,O];e.setFieldValue(v,z),x(z,t,o),h("")}},K=O=>{let z=w.filter(D=>D!==O);e.setFieldValue(v,z),x(z,t,o)},G=O=>R.find(z=>z.value===O)?.label??O;return m.jsxs("div",{className:"relative",children:[m.jsxs("label",{className:M,children:[t.label,t.required&&m.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),m.jsxs("div",{className:`${E} 
            flex flex-wrap gap-2 min-h-[42px] max-h-[120px] overflow-y-auto items-center
            ${B?"pointer-events-none opacity-70":""}
            `,onClick:()=>!B&&document.getElementById(`${v}-input`)?.focus(),children:[w.map(O=>m.jsxs("span",{className:"flex items-center gap-2 px-2 py-1 rounded-full text-sm bg-indigo-50 border border-indigo-100",children:[m.jsx("span",{className:"text-indigo-700",children:G(O)}),m.jsx("button",{type:"button",onClick:z=>{z.stopPropagation(),B||K(O)},onMouseDown:z=>z.preventDefault(),className:"ml-1 text-indigo-500 hover:text-red-500 focus:outline-none",children:"×"})]},O)),m.jsx("input",{id:`${v}-input`,type:"text",value:I,onChange:O=>h(O.target.value),onKeyDown:O=>{(O.key==="Enter"||O.key===",")&&(O.preventDefault(),j(S))},placeholder:w.length===0?t.placeholder||"Type and press Enter":"",className:"flex-1 min-w-[120px] border-none outline-none text-sm bg-transparent p-1",disabled:B})]}),e.touched[v]&&e.errors[v]&&m.jsx("span",{className:"text-xs text-red-500",children:String(e.errors[v])})]})}case"photo":case"avatar":return m.jsx(Mo,{formik:e,field:t,sqlOpsUrls:r,module_refid:o});case"attachment":case"file":const Ue=t.multiple===!0,Dt=Array.isArray(e.values[v])?e.values[v]:e.values[v]?[e.values[v]]:[];return m.jsxs("div",{className:"relative",children:[m.jsxs("label",{className:M,children:[t.label,t.required&&m.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),m.jsxs("div",{className:"relative mb-1",children:[t.icon&&m.jsx("div",{className:"absolute z-10 left-3 top-1/2 -translate-y-1/2 pointer-events-none",children:ye(t)}),m.jsx("input",{id:v,type:"file",className:`${E} ${C} ${t.icon?"pl-9":""} `,onFocus:()=>g(!0),name:v,multiple:Ue,onChange:w=>{const S=w.currentTarget.files;S&&u(S),c("onChange",t,`${v}`)},onBlur:e.handleBlur,placeholder:t.placeholder,disabled:B}),m.jsx("div",{className:`absolute inset-0 rounded-lg bg-gradient-to-r from-purple-400 to-indigo-400 opacity-0 transition-opacity duration-300 pointer-events-none ${te?"opacity-20":""}`,style:{zIndex:-1,filter:"blur(8px)"}})]}),Dt.map(w=>{const S=w?.split("/").pop();return m.jsx(fc,{sqlOpsUrls:r,filePath:w},S)}),e.touched[v]&&e.errors[v]&&m.jsx("span",{className:"text-xs text-red-500",children:String(e.errors[v])})]});case"json":return m.jsxs("div",{className:"relative",children:[m.jsxs("label",{className:M,children:[t.label,t.required&&m.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),m.jsxs("div",{className:"relative",children:[m.jsx("textarea",{id:v,name:v,value:e.values[v],onChange:w=>{e.setFieldValue(v,w.target.value),x(w.target.value,t,o),c("onChange",t,`${v}`)},onBlur:e.handleBlur,placeholder:t.placeholder||"Enter valid JSON",disabled:B,className:`${E} ${C} min-h-[200px] font-mono text-sm resize-y`}),m.jsx("div",{className:`absolute inset-0 rounded-lg bg-gradient-to-r from-emerald-400 to-cyan-400 opacity-0 transition-opacity duration-300 pointer-events-none ${te?"opacity-20":""}`,style:{zIndex:-1,filter:"blur(8px)"}})]}),e.touched[v]&&e.errors[v]&&m.jsx("span",{className:"text-xs text-red-500",children:String(e.errors[v])})]});case"date":return m.jsxs("div",{className:"relative",children:[m.jsxs("label",{className:M,children:[t.label,t.required&&m.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),m.jsxs("div",{className:"relative",children:[m.jsx("div",{className:"absolute z-10 right-3 top-1/2 -translate-y-1/2 pointer-events-none",children:m.jsx("i",{className:"fa-solid fa-calendar"})}),m.jsx("input",{id:v,type:"date",name:v,min:t.min,max:t.max,value:e.values[v]??"",onChange:w=>{e.setFieldValue(v,w.target.value),x(w.target.value,t,o),c("onChange",t,`${v}`)},onBlur:e.handleBlur,placeholder:t.placeholder,disabled:B,className:`${E} ${C} ${t.icon?"pl-9":""}`}),m.jsx("div",{className:`absolute inset-0 rounded-lg bg-gradient-to-r from-purple-400 to-indigo-400 opacity-0 transition-opacity duration-300 pointer-events-none ${te?"opacity-20":""}`,style:{zIndex:-1,filter:"blur(8px)"}})]}),e.touched[v]&&e.errors[v]&&m.jsx("span",{className:"text-xs text-red-500",children:String(e.errors[v])})]});case"number":return m.jsxs("div",{className:"relative",children:[m.jsxs("label",{className:M,children:[t.label,t.required&&m.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),m.jsxs("div",{className:"relative",children:[t.icon&&m.jsx("div",{className:"absolute z-10 left-3 top-1/2 -translate-y-1/2 pointer-events-none",children:ye(t)}),m.jsx("input",{id:v,type:"number",className:`${E} ${C} ${t.icon?"pl-9":""} `,onFocus:()=>g(!0),name:v,value:e.values[v],onBlur:e.handleBlur,onChange:w=>{e.setFieldValue(v,w.target.value),x(w.target.value,t,o),c("onChange",t,`${v}`)},step:t.step,placeholder:t.placeholder,disabled:B,min:t.min??1,max:t.max}),m.jsx("div",{className:`absolute inset-0 rounded-lg bg-gradient-to-r from-purple-400 to-indigo-400 opacity-0 transition-opacity duration-300 pointer-events-none ${te?"opacity-20":""}`,style:{zIndex:-1,filter:"blur(8px)"}})]}),e.touched[v]&&e.errors[v]&&m.jsx("span",{className:"text-xs text-red-500",children:String(e.errors[v])})]});default:return m.jsxs("div",{className:"relative",children:[m.jsxs("label",{className:M,children:[t.label,t.required&&m.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),m.jsxs("div",{className:"relative",children:[t.icon&&m.jsx("div",{className:"absolute z-10 left-3 top-1/2 -translate-y-1/2 pointer-events-none",children:ye(t)}),m.jsx("input",{id:v,type:t.type||"text",className:`${E} ${C} ${t.icon?"pl-9":""} `,onFocus:()=>g(!0),name:v,value:e.values[v],onBlur:e.handleBlur,onChange:w=>{e.setFieldValue(v,w.target.value),x(w.target.value,t,o),c("onChange",t,`${v}`)},step:t.step,placeholder:t.placeholder,disabled:B,minLength:t.minlength,maxLength:t.maxlength}),m.jsx("div",{className:`absolute inset-0 rounded-lg bg-gradient-to-r from-purple-400 to-indigo-400 opacity-0 transition-opacity duration-300 pointer-events-none ${te?"opacity-20":""}`,style:{zIndex:-1,filter:"blur(8px)"}})]}),e.touched[v]&&e.errors[v]&&m.jsx("span",{className:"text-xs text-red-500",children:String(e.errors[v])})]})}}function Ia({title:t,children:e,isFirst:n}){const[r,s]=$.useState(n);return m.jsx("div",{className:"group relative mt-1",children:m.jsxs("div",{className:"relative bg-white rounded-lg border border-gray-100 shadow-xs hover:shadow-sm transition-all duration-300 overflow-hidden ",children:[m.jsxs("button",{onClick:()=>s(!r),className:"w-full bg-gray-50 flex justify-between items-center px-6 py-3 b text-left transition-all duration-300 ",children:[m.jsxs("div",{className:"flex items-center space-x-3",children:[m.jsx("div",{className:`w-3 h-3 rounded-full transition-all duration-300 ${r?"bg-action":"bg-gray-300"}`}),m.jsx("h3",{className:"text-md font-semibold bg-gradient-to-r from-gray-800 to-gray-600 bg-clip-text text-transparent",children:t})]}),m.jsxs("div",{className:`relative transition-all duration-300 ${r?"rotate-180":""}`,children:[m.jsx("div",{className:`absolute inset-0 rounded-full blur-md transition-opacity duration-300 ${r?"bg-action opacity-30":"bg-transparent opacity-0"}`}),m.jsx("svg",{className:"relative w-4 h-4 text-gray-500 group-hover:text-action-500 transition-colors duration-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]}),m.jsx("div",{className:`transition-all duration-500 ease-in-out overflow-hidden  ${r?"max-h-[2000px] opacity-100":"max-h-0 opacity-0"}`,children:m.jsx("div",{className:"px-6 pb-6 bg-gradient-to-br from-gray-50/50 to-white overflow-auto mb-5",children:m.jsx("div",{className:"space-y-5 pt-4",children:e})})})]})})}function Pr({fields:t,formik:e,methods:n={},sqlOpsUrls:r,refid:s,module_refid:o,fieldOptions:i,setFieldOptions:l}){return m.jsx("div",{className:"bg-white min-h-3/10 overflow-auto",children:m.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6",children:[m.jsx("div",{className:"lg:col-span-2 flex flex-col ",children:m.jsx("div",{className:"relative w-42 h-42 ",children:t?.filter(a=>a.type==="avatar").map(a=>m.jsx(Mo,{formik:e,field:a,sqlOpsUrls:r,module_refid:o}))})}),m.jsx("div",{className:"lg:col-span-10 min-h-0 max-h-40  overflow-y-auto custom-scrollbar",children:m.jsx("div",{className:"grid grid-cols-12 gap-2",children:t?.map((a,c)=>a.type==="avatar"?null:m.jsx("div",{className:`transition-colors duration-200 col-span-12 md:col-span-6 ${Ht[Wt(Number(a.width))]||"lg:col-span-4"}`,children:m.jsx(bn,{refid:s,module_refid:o,sqlOpsUrls:r,field:a,formik:e,methods:n,setFieldOptions:l,...i?.[a.name]?{optionsOverride:i[a.name]}:{}},a?.name||c)},a.name))})})]})})}function am({title:t,groupedFields:e,data:n,onSubmit:r=u=>{},onCancel:s=()=>{},methods:o={},components:i={},sqlOpsUrls:l,refid:a,module_refid:c}){const{common:u=[],...d}=e,[f,h]=$.useState({}),p=(x,k)=>{h(E=>({...E,[x]:k}))},{initialValues:g,validationSchema:y}=$.useMemo(()=>{const x={},k={};return Object.values(e).flat().forEach(E=>{Bt([E],x,k,n,c,l?.operation)}),{initialValues:x,validationSchema:k}},[e,n,c,l?.operation]),b=xn.useFormik({initialValues:g,enableReinitialize:!0,validationSchema:fe.object().shape(y),onSubmit:x=>{r(x)}});return m.jsx("div",{className:"relative z-10 max-w-full  m-4",children:m.jsx("div",{className:"bg-white border border-gray-100 rounded-md animate-in fade-in duration-300",children:m.jsxs("form",{onSubmit:b.handleSubmit,className:"p-4 mx-auto",children:[m.jsxs("div",{className:"space-y-2",children:[u.length>0&&m.jsx(Ia,{title:"Common",isFirst:!0,children:m.jsx(Pr,{refid:a,module_refid:c,sqlOpsUrls:l,fields:u,formik:b,methods:o,setFieldOptions:p,fieldOptions:f})}),d&&Object.entries(d).map(([x,k],E)=>m.jsx(Ia,{title:x,isFirst:E===0&&u.length===0,children:m.jsx("div",{className:"grid grid-cols-12 gap-4",children:k.map((C,M)=>vn(C.hidden)||C.type==="geolocation"?null:m.jsx("div",{className:`col-span-12 md:col-span-6 ${Ht[Wt(Number(C.width))]||"lg:col-span-4"}`,children:m.jsx(bn,{refid:a,module_refid:c,sqlOpsUrls:l,components:i,field:C,formik:b,methods:o,setFieldOptions:p,...f[C.name]?{optionsOverride:f[C.name]}:{}},C.name)},C?.name??`field-${M}`))})},x))]}),m.jsxs("div",{className:"mt-8 flex justify-between space-x-3",children:[m.jsx("p",{className:"text-sm text-gray-700",children:"All fields marked (*) are required"}),m.jsxs("div",{className:"space-x-3",children:[m.jsx("button",{type:"button",onClick:s,className:"px-5 py-2 bg-white text-gray-700 font-semibold rounded-lg border-2 border-gray-200  shadow-sm hover:shadow-lg transform hover:scale-105 transition-all duration-300 ",children:"Cancel"}),m.jsx("button",{type:"submit",className:"px-5 py-2 bg-action font-semibold rounded-lg border-2 border-gray-200 shadow-sm hover:shadow-lg transform hover:scale-105 transition-all duration-300 ",children:"Save"})]})]})]})})})}function cm({title:t,groupedFields:e,data:n,onSubmit:r=d=>{},onCancel:s=()=>{},methods:o={},components:i={},sqlOpsUrls:l,widget:a,refid:c,module_refid:u}){const{common:d=[],...f}=e,h=Object.keys(f),[p,g]=$.useState(0),[y,b]=$.useState({}),x=(v,H)=>{b(ue=>({...ue,[v]:H}))},{initialValues:k,validationSchema:E,stepperSchemas:C}=$.useMemo(()=>{const v={},H={},ue={};return a?Object.entries(e).forEach(([U,J])=>{const te={};Bt(J,v,te,n,u,l?.operation),ue[U]=te}):Object.entries(e).forEach(([U,J])=>{Bt(J,v,H,n,u,l?.operation)}),{initialValues:v,validationSchema:H,stepperSchemas:ue}},[e,n,a,u,l?.operation]),M=h[p]??null,I=a&&M?C[M]??{}:E,P=xn.useFormik({initialValues:k,enableReinitialize:!0,validationSchema:fe.object().shape(I),onSubmit:v=>{a?(p<h.length-1&&g(H=>H+1),p===h.length-1&&r(v)):r(v)}}),V=async v=>{if(v.preventDefault(),!a){const H=await P.validateForm();if(Object.keys(H).length>0){alert("Please fill all required fields before submitting."),P.setTouched(Object.keys(H).reduce((ue,U)=>({...ue,[U]:!0}),{}));return}}P.handleSubmit(v)},B=()=>{g(v=>v>0?v-1:v)};return m.jsx("div",{className:" max-w-full  m-4",children:m.jsxs("form",{onSubmit:V,className:"w-full mx-auto",children:[m.jsx("div",{className:"relative",children:m.jsxs("div",{className:"relative  rounded-t-lg px-1 pt-1  shadow-inner",children:[d.length>0&&m.jsx("div",{className:"p-3",children:m.jsx(Pr,{refid:c,module_refid:u,sqlOpsUrls:l,fields:d,formik:P,methods:o,setFieldOptions:x,fieldOptions:y})}),m.jsx("nav",{className:"relative flex bg-gray-100",children:h.map((v,H)=>m.jsx("button",{type:"button",onClick:()=>g(H),className:`relative cursor-pointer flex-shrink-0 py-2 px-2 sm:px-4 rounded-t-lg  text-xs sm:text-sm font-semibold transition-all duration-300 ease-out focus:outline-none whitespace-nowrap ${p===H?"text-action bg-white":"text-gray-600 hover:text-gray-800 hover:bg-white/50"}`,children:m.jsx("span",{className:"relative z-10 flex items-center justify-center gap-2 capitalize",children:v})},v))})]})}),m.jsxs("div",{className:"bg-white  border border-gray-100 border-t-0 rounded-b-lg p-3 animate-in fade-in duration-300",children:[m.jsx("div",{className:"grid grid-cols-12 gap-4",children:M&&f[M]?.map((v,H)=>vn(v.hidden)||v.type==="geolocation"?null:m.jsx("div",{className:`col-span-12  ${Ht[Wt(Number(v.width))]||"lg:col-span-4"}`,children:m.jsx(bn,{refid:c,module_refid:u,sqlOpsUrls:l,field:v,formik:P,methods:o,components:i,setFieldOptions:x,...y[v.name]?{optionsOverride:y[v.name]}:{}},v.name)},v?.name??`field-${H}`))}),m.jsxs("div",{className:`mt-8 flex ${p>0?"justify-between":"justify-end"} space-x-3`,children:[p>0&&m.jsx("button",{onClick:B,type:"button",className:"px-5 py-2 bg-white text-gray-700 font-semibold rounded-lg border-2 border-gray-200  shadow-sm hover:shadow-lg transform hover:scale-105 transition-all duration-300 ",children:"Previous"}),m.jsxs("div",{className:"space-x-3",children:[m.jsx("button",{onClick:s,type:"button",className:"px-5 cursor-pointer py-2 bg-white text-gray-700 font-semibold rounded-lg border-2 border-gray-200  shadow-sm hover:shadow-lg transform hover:scale-105 transition-all duration-300 ",children:"Cancel"}),m.jsx("button",{type:"submit",className:"px-5 cursor-pointer py-2 bg-action font-semibold rounded-lg border-2 border-gray-200 shadow-sm hover:shadow-lg transform hover:scale-105 transition-all duration-300 ",children:a?"Next":"Save"})]})]}),m.jsx("div",{className:"mt-2 pt-3  border-t border-gray-100",children:m.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[m.jsxs("div",{className:"flex items-center",children:[m.jsxs("span",{children:["Tab ",p+1," of ",h.length]}),m.jsx("p",{className:"text-sm text-gray-700 ml-3",children:"All fields marked (*) are required"})]}),m.jsx("div",{className:"flex gap-1",children:h.map((v,H)=>m.jsx("div",{className:`w-2 h-2 rounded-full transition-all duration-300 ${H===p?"bg-action w-6":"bg-gray-300"}`},H))})]})})]},h[p])]})})}function um({title:t,fields:e,data:n,onSubmit:r=c=>{},onCancel:s=()=>{},methods:o={},sqlOpsUrls:i,refid:l,module_refid:a}){const c=tc(e,i?.operation),[u,d]=$.useState({}),f=(x,k)=>{d(E=>({...E,[x]:k}))},{commonFields:h,otherFields:p}=$.useMemo(()=>c.reduce((x,k)=>(k.group==="common"?x.commonFields.push(k):x.otherFields.push(k),x),{commonFields:[],otherFields:[]}),[c]),{initialValues:g,validationSchema:y}=$.useMemo(()=>{const x={},k={};return c.forEach(E=>{Bt([E],x,k,n,a,i?.operation)}),{initialValues:x,validationSchema:k}},[c,n]),b=xn.useFormik({initialValues:g,enableReinitialize:!0,validationSchema:fe.object().shape(y),onSubmit:x=>{r(x)}});return m.jsx(m.Fragment,{children:m.jsx("div",{className:"relative z-10 max-w-full  m-4",children:m.jsx("div",{className:"bg-white border border-gray-100 rounded-md animate-in fade-in duration-300",children:m.jsxs("form",{onSubmit:b.handleSubmit,className:"p-4  mx-auto",children:[h.length>0&&m.jsx(Pr,{refid:l,module_refid:a,sqlOpsUrls:i,fields:h,formik:b,methods:o,setFieldOptions:f,fieldOptions:u}),m.jsx("div",{className:"grid grid-cols-12 gap-4",children:p.map((x,k)=>vn(x.hidden)||x.type==="geolocation"?null:m.jsx("div",{className:`col-span-12 md:col-span-6 ${Ht[Wt(Number(x.width))]||"lg:col-span-4"}`,children:m.jsx(bn,{refid:l,module_refid:a,sqlOpsUrls:i,field:x,formik:b,methods:o,setFieldOptions:f,...u[x.name]?{optionsOverride:u[x.name]}:{}})},x?.name??`field-${k}`))}),m.jsxs("div",{className:"mt-8 flex justify-between space-x-3",children:[m.jsx("p",{className:"text-sm text-gray-700",children:"All fields marked (*) are required"}),m.jsxs("div",{className:"space-x-3",children:[m.jsx("button",{type:"button",onClick:s,className:"px-5 py-2 bg-white text-gray-700 font-semibold rounded-lg border-2 border-gray-200  shadow-sm hover:shadow-lg transform hover:scale-105 transition-all duration-300 cursor-pointer",children:"Cancel"}),m.jsx("button",{type:"submit",className:"px-5 py-2 bg-action font-semibold rounded-lg border-2 border-gray-200 shadow-sm hover:shadow-lg transform hover:scale-105 transition-all duration-300 cursor-pointer",children:"Save"})]})]})]})})})})}function za({title:t,children:e}){return m.jsx("div",{className:"group relative mt-1",children:m.jsxs("div",{className:"relative bg-white rounded-lg border border-gray-100 shadow-sm hover:shadow-lg transition-all duration-300 overflow-hidden ",children:[m.jsx("button",{className:"w-full bg-gray-50 flex justify-between items-center px-6 py-3 b text-left transition-all duration-300 ",children:m.jsxs("div",{className:"flex items-center space-x-3",children:[m.jsx("div",{className:"w-3 h-3 rounded-full transition-all duration-300 bg-action"}),m.jsx("h3",{className:"text-md font-semibold bg-gradient-to-r from-gray-800 to-gray-600 bg-clip-text text-transparent",children:t})]})}),m.jsx("div",{className:`transition-all duration-500 ease-in-out overflow-hidden max-h-[2000px] opacity-100'
            }`,children:m.jsx("div",{className:"px-4 pb-4 bg-gradient-to-br from-gray-50/50 to-white",children:m.jsx("div",{className:"space-y-5 pt-4",children:e})})})]})})}function dm({title:t,groupedFields:e,data:n,onSubmit:r=u=>{},onCancel:s=()=>{},methods:o={},components:i={},sqlOpsUrls:l,refid:a,module_refid:c}){const{common:u=[],...d}=e,[f,h]=$.useState({}),p=(x,k)=>{h(E=>({...E,[x]:k}))},{initialValues:g,validationSchema:y}=$.useMemo(()=>{const x={},k={};return Object.values(e).flat().forEach(E=>{Bt([E],x,k,n,c,l?.operation)}),{initialValues:x,validationSchema:k}},[e,n,c,l?.operation]),b=xn.useFormik({initialValues:g,enableReinitialize:!0,validationSchema:fe.object().shape(y),onSubmit:x=>{r(x)}});return m.jsx("div",{className:"relative z-10 max-w-full  m-4",children:m.jsx("div",{className:"bg-white animate-in fade-in duration-300",children:m.jsxs("form",{onSubmit:b.handleSubmit,className:"p-4 mx-auto",children:[m.jsxs("div",{className:"space-y-2",children:[u.length>0&&m.jsx(za,{title:"Common",children:m.jsx(Pr,{refid:a,module_refid:c,sqlOpsUrls:l,fields:u,formik:b,methods:o,setFieldOptions:p,fieldOptions:f})}),d&&Object.entries(d).map(([x,k],E)=>m.jsx(za,{title:x,children:m.jsx("div",{className:"grid grid-cols-12 gap-4",children:k.map((C,M)=>vn(C.hidden)||C.type==="geolocation"?null:m.jsx("div",{className:`col-span-12 md:col-span-6 ${Ht[Wt(Number(C.width))]||"lg:col-span-4"}`,children:m.jsx(bn,{refid:a,module_refid:c,sqlOpsUrls:l,components:i,field:C,formik:b,methods:o,setFieldOptions:p,...f[C.name]?{optionsOverride:f[C.name]}:{}},C.name)},C?.name??`field-${M}`))})},x))]}),m.jsxs("div",{className:"mt-8 flex justify-between space-x-3",children:[m.jsx("p",{className:"px-4 pt-4 text-sm text-secondary",children:"All fields marked (*) are required"}),m.jsxs("div",{className:"space-x-3",children:[m.jsx("button",{type:"button",onClick:s,className:"px-5 py-2 bg-white text-gray-700 font-semibold rounded-lg border-2 border-gray-200  shadow-sm hover:shadow-lg transform hover:scale-105 transition-all duration-300 ",children:"Cancel"}),m.jsx("button",{type:"submit",className:"px-5 py-2 bg-action font-semibold rounded-lg border-2 border-gray-200 shadow-sm hover:shadow-lg transform hover:scale-105 transition-all duration-300 ",children:"Save"})]})]})]})})})}function fm({formJson:t,methods:e={},userid:n=null,onCancel:r=()=>{},components:s={},callback:o=()=>{},initialvalues:i={}}){let l=Ya(t);const a=t.endPoints,c=t?.source?.refid,u=Qa(t?.fields??{},a?.operation),[d,f]=$.useState(i),h=$.useMemo(()=>ec(t.fields),[t.fields]);$.useEffect(()=>{let y=!0;return(async()=>{const x=t?.source??{};if(!x?.type){y&&f({});return}if(x.type==="method"){const k=x.method,E=k?e[k]:void 0;if(E)try{const C=await Promise.resolve(E());y&&f(C??{})}catch(C){console.error("Method execution failed:",C),y&&f({})}else y&&f({})}if(x.type==="api"&&a?.operation!=="create")try{const k=await de({method:x.method||"GET",url:x.url??"",data:x.body??{},params:x.params??{},headers:x.headers??{}});y&&f(k.data??{})}catch(k){console.error("API fetch failed:",k),y&&f({})}if(x.type==="sql"&&x.refid&&x.refid!=="0"&&a?.operation!=="create"||a?.operation!=="create"&&x.dbopsid){if(!a){console.error("SQL source requires formJson.endPoints but it is missing");return}try{const k=await ac.fetch(a,{source:{...x,table:x.table,columns:x.columns,where:Be(x.where,{refid:c})},fields:wo(t.fields,a.operation)},x?.dbopsid,t?.module_refid);y&&f(k)}catch(k){console.error("API fetch failed:",k)}}})(),()=>{y=!1}},[n,t?.source?.type||"",t?.source?.method||"",t?.source?.url||"",JSON.stringify(t?.source?.params??{}),JSON.stringify(t?.source?.body??{}),JSON.stringify(t?.source?.headers??{})]);const p=async y=>{const b=t?.source??{};let x=null;if(h.length>0)try{x=await Za()}catch(E){console.error("catch fetchGeolocation",E),x=null}const k={...y,...Object.fromEntries(h.map(E=>[E,x]))};if(b.type==="method"){const E=b.method,C=E?e[E]:void 0;if(C)try{const M=await Promise.resolve(C(k));if(o?.(M),e?.handleActions){let I=a?.operation==="update"?c:M?.data?.refid;const P=t?.gotolink?.replace("{hashid}",String(I));e.handleActions(P)}}catch(M){o?.(M),console.error("Method execution failed:",M)}}if(b.type==="api"){if(!a){console.error("SQL source requires formJson.endPoints but it is missing");return}try{const E=await de({method:b.method||"POST",url:a.baseURL+b.endpoint,data:k??{},headers:{Authorization:`Bearer ${a?.accessToken}`}});if(o?.(E),e?.handleActions){let C=a.operation==="update"?c:E?.data?.refid;const M=t?.gotolink?.replace("{hashid}",String(C));e.handleActions(M)}}catch(E){o?.(E),console.error("API fetch failed:",E)}}if(b.type==="sql"){const E=t.endPoints;if(!E){console.error("SQL source requires formJson.endPoints but it is missing");return}try{let C=!1,M;b?.dbopsid&&(C=!0,M=b?.dbopsid);const I=await de({method:"GET",url:E.baseURL+E.dbopsGetHash,headers:{Authorization:`Bearer ${E?.accessToken}`}});if(!C){let V={...b};b.where&&(V={...b,where:Be(b.where,{refid:c})}),M=(await de({method:"POST",url:E.baseURL+E.dbopsGetRefId,data:{operation:E.operation,source:V,fields:wo(t.fields,E.operation),forcefill:t.forcefill,datahash:I.data.refhash,srcid:t?.module_refid},headers:{Authorization:`Bearer ${E?.accessToken}`}}))?.data.refid}const P=await de({method:"POST",url:E.baseURL+E[E.operation==="update"?"dbopsUpdate":"dbopsCreate"],data:{refid:M,fields:k,datahash:I.data.refhash},headers:{Authorization:`Bearer ${E?.accessToken}`}});if(o?.(P),e?.handleActions){let V=E.operation==="update"?c:P?.data?.refid;const B=t?.gotolink?.replace("{hashid}",String(V));e.handleActions(B)}}catch(C){o?.(C),console.error("API fetch failed:",C)}}},g={accordion:m.jsx(am,{title:t?.title??"",groupedFields:u,data:d,onSubmit:p,onCancel:r,methods:e,components:s,sqlOpsUrls:a,refid:c,module_refid:t?.module_refid}),cards:m.jsx(dm,{title:t?.title??"",groupedFields:u,data:d,onSubmit:p,onCancel:r,methods:e,components:s,sqlOpsUrls:a,refid:c,module_refid:t?.module_refid}),tab:m.jsx(cm,{title:t?.title??"",groupedFields:u,data:d,onSubmit:p,onCancel:r,methods:e,components:s,widget:t?.widget,sqlOpsUrls:a,refid:c,module_refid:t?.module_refid}),simple:m.jsx(um,{title:t?.title??"",fields:t.fields,data:d,onSubmit:p,onCancel:r,methods:e,components:s,sqlOpsUrls:a,refid:c,module_refid:t?.module_refid})};return m.jsx("div",{className:"relative",children:g[l]})}Ee.LogiksForm=fm,Object.defineProperty(Ee,Symbol.toStringTag,{value:"Module"})});
